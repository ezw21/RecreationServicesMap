System.register(["jimu-core","jimu-ui"],(function(e){var t,r;return{setters:[function(e){t=e},function(e){r=e}],execute:function(){e(function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=992)}({0:function(e,r){e.exports=t},1:function(e,t){e.exports=r},328:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11 9c0 1.657-2.239 3-5 3s-5-1.343-5-3V3c0-1.657 2.239-3 5-3s5 1.343 5 3v6zM9.021 4.264C9.766 3.817 10 3.339 10 3c0-.34-.234-.817-.979-1.264C8.296 1.301 7.231 1 6 1c-1.23 0-2.296.301-3.021.736C2.234 2.183 2 2.661 2 3c0 .34.234.817.979 1.264C3.704 4.699 4.769 5 6 5c1.23 0 2.296-.301 3.021-.736zM10 7.8V9c0 .34-.234.817-.979 1.264C8.296 10.699 7.231 11 6 11c-1.23 0-2.296-.301-3.021-.736C2.234 9.817 2 9.339 2 9V7.8C2.912 8.53 4.364 9 6 9c1.636 0 3.088-.471 4-1.2zM2 6V4.8C2.912 5.53 4.364 6 6 6c1.636 0 3.088-.471 4-1.2V6c0 .34-.234.817-.979 1.264C8.296 7.699 7.231 8 6 8c-1.23 0-2.296-.301-3.021-.736C2.234 6.817 2 6.339 2 6z" fill="#000"></path></svg>'},334:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.95 5.243l.707-.707a1 1 0 000-1.415L3.828.293a1 1 0 00-1.414 0L.293 2.414a1 1 0 000 1.414L3.12 6.657a1 1 0 001.415 0l.707-.707.81.81-.707.707a1 1 0 000 1.414l2.828 2.829a1 1 0 001.414 0l2.122-2.122a1 1 0 000-1.414L8.88 5.346a1 1 0 00-1.414 0l-.707.707-.81-.81zm0-1.415L3.12 1 1 3.121 3.828 5.95l.708-.707-.527-.527a.5.5 0 11.707-.707l.527.527.707-.708zm.81 3.64l.502.5a.5.5 0 00.707-.706l-.502-.502.707-.707 2.829 2.828-2.122 2.122-2.828-2.829.707-.707z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},992:function(e,t,r){"use strict";r.r(t),r.d(t,"DynamicUrlEditor",(function(){return j})),r.d(t,"UrlInfoSelector",(function(){return u}));var o={};r.r(o),r.d(o,"DynamicUrlEditor",(function(){return n})),r.d(o,"UrlInfoSelector",(function(){return s}));var i=r(0);function n(e){const t=e.theme;return i.css`
    .component-dynamic-url-editor{
      width: 100%;
      height: 100%;
      .ql-container{
        background-color: ${t.colors.palette.light[200]};
      }
      .ql-editor{
        outline: none;
        padding: ${i.polished.rem(5)} ${i.polished.rem(6)};
        p{
          word-break: break-all;
        }
        &:focus {
          border: 1px solid ${t.colors.palette.primary[700]};
        }
      }
      .dynamic-url-editor-btngroup{
        background-color: ${t.colors.palette.light[200]};
      }
    }
  `}function s(e){const t=e.theme;return i.css`
    .component-url-info-selector{
      .param-list{
        height: calc(100% - 45px);
        overflow-y: auto;
        .param-item.param-item-selected{
          border: 1px solid ${t.colors.primary};
        }
        .param-item{
          border: 1px solid transparent;
          cursor: pointer;
          background-color: ${t.colors.palette.light[400]};
          user-select: none;
        }
        .param-item:hover{
          background-color: ${t.colors.palette.light[500]};
        }
        .param-item:active.param-item:hover{
          background-color: ${t.colors.white};
        }
      }
    }
  `}var l=r(1);const{useSelector:a}=i.ReactRedux,{useState:c}=i.React,d=e=>{const t=[];return Object.keys(e).forEach(r=>{"draft"!==r&&t.push({key:r,value:e[r]})}),t},u=i.themeUtils.withStyles(e=>{const{editor:t,className:r,selectWidgets:o,selection:n}=e,s=a(e=>(e.appStateInBuilder?e.appStateInBuilder:e).queryObject),u=e=>{const t=o.findIndex(t=>t.id===e);let r={};if(t>-1){const e=o[t].config.expression;let n="";if(e&&(n=e.replace(/<[^>]+>/g,"")),n&&-1!=n.indexOf("?")){const e=n.substr(n.indexOf("?"));r=i.queryString.parse(e)}}else r=s;return r},[p,m]=c("appURL"),[f,h]=c(d(u(p))),b=l.hooks.useEventCallback(e=>{if(null==n)return;const r=Object(i.Immutable)(e).name;((e,r,o,i)=>{t.deleteText(i.index,i.length),t.insertEmbed(i.index,"urlInfo",{uniqueid:e,name:r,urlInfo:o},"user"),t.setSelection(i.index+1,"user"),t.focus()})(i.utils.getUUID(),r,e,n)});return i.React.createElement("div",{className:Object(i.classNames)("w-100 h-100",{[r]:!!r})},i.React.createElement("div",{className:"component-url-info-selector w-100 h-100"},i.React.createElement("div",{className:"p-3",style:{display:"none"}},i.React.createElement(l.Select,{size:"sm",value:p,onChange:e=>{const t=e.target.value;m(t),h(d(u(t)))},className:"top-drop"},[{id:"appURL",name:"App Url"}].map(e=>i.React.createElement("option",{key:e.id,value:e.id,title:e.name},e.name)))),i.React.createElement("div",{className:"param-list px-3"},f.map(e=>i.React.createElement("div",{key:e.key,title:e.key,onClick:()=>(e=>{const t=e.key,r={type:i.UrlInfoPartType.Urlinfo,urlsearch:`{${p}.search.${t}}`};b({name:r.urlsearch,parts:[r]})})(e),className:"param-item text-truncate mt-2 p-1"},""+e.key)))))},"UrlInfoSelector");var p=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]])}return r};const{useState:m,useRef:f}=i.React,h=r(328),b=r(334),x=[{name:"preventOverflow",options:{altAxis:!0}},Object(l.getFallbackPlacementsModifier)(["left-start","left-end"],!0)],y=[0,8],g=e=>{const{className:t,editorRef:r,useDataSourcesEnabled:o,useDataSources:n,onChange:s,widgetId:a,value:c,selectWidgets:d,RichExpressionBuilder:g,useMixinKeyboardEnterModules:v,useEditorSelectionFormats:j,richTextEditorUtils:E,RichEditorCore:O,Delta:w,ExpressionBuilderType:S}=e,R=p(e,["className","editorRef","useDataSourcesEnabled","useDataSources","onChange","widgetId","value","selectWidgets","RichExpressionBuilder","useMixinKeyboardEnterModules","useEditorSelectionFormats","richTextEditorUtils","RichEditorCore","Delta","ExpressionBuilderType"]),[C,M]=m(!1),[k,I]=m(!1),U=f(null),T=f(null),[P,B]=l.hooks.useForwardValueRef(r),N=l.hooks.useTranslate(l.defaultMessages),[D,z]=j(P,!0),[L,$]=m(c),[V,F]=m(!1),K=i.React.useCallback((e,t)=>{if((e=>{var t;return!!(null===(t=null==e?void 0:e.ops)||void 0===t?void 0:t.length)&&e.ops.some(e=>{var t;const r=null!==(t=null==e?void 0:e.insert)&&void 0!==t?t:{};return r.urlInfo||r.expression||r.urlinfo})})(t))return t;const r=t.map(e=>"string"==typeof e.insert?e.insert:"").join("");return(new w).insert(r)},[w]),_=i.React.useMemo(()=>({toolbar:!1,keyboard:{bindings:{bold:{handler:()=>{}},italic:{handler:()=>{}},underline:{handler:()=>{}},enter:{key:13,handler:()=>{}}}},clipboard:{matchers:[["*",K]]}}),[K]);l.hooks.useUnmount(()=>{s(L)});const q=n&&n.length>0;return Object(i.jsx)("div",{className:Object(i.classNames)("w-100 h-100",{[t]:!!t})},Object(i.jsx)("div",{className:"component-dynamic-url-editor"},Object(i.jsx)(O,Object.assign({modules:_,className:Object(i.classNames)("rich-text-editor"),onChange:e=>{$(e)},onClick:()=>{V||(F(!0),E.setEditorCursorEnd(P))},onBlur:()=>{F(!1),s(L)},editorRef:B,onKeyDown:e=>{e&&e.target&&13===e.keyCode&&e.target.blur()},defaultValue:c,placeholder:N("websitePlaceholder")},R)),Object(i.jsx)("div",{className:"dynamic-url-editor-btngroup"},Object(i.jsx)(l.Button,{size:"sm",icon:!0,onClick:()=>{M(!C),C&&!k||P.focus(),k&&I(!1)},ref:U,active:C,type:"tertiary",title:N("urlInfo")},Object(i.jsx)(l.Icon,{icon:b,size:12})),o&&Object(i.jsx)(l.Button,{size:"sm",icon:!0,onClick:()=>{I(!k),!C&&k||P.focus(),C&&M(!1)},ref:T,active:k,type:"tertiary",disabled:!q,title:N(q?"data":"dataUnavailableTips")},Object(i.jsx)(l.Icon,{icon:h,size:12}))),Object(i.jsx)(l.Popper,{open:C,disableResize:!0,placement:"left-start",reference:U.current,modifiers:x,showArrow:!0,toggle:e=>{(null==P?void 0:P.root.contains(null==e?void 0:e.target))||M(e=>!e)},a11yVersion:-1},Object(i.jsx)("div",{style:{width:180,height:300}},Object(i.jsx)(l.PanelHeader,{className:"px-3 py-2",title:N("urlInfo"),onClose:()=>M(!1)}),Object(i.jsx)(u,{editor:P,className:t,selectWidgets:d,selection:z,formats:D}))),Object(i.jsx)(l.Popper,{open:k,disableResize:!0,placement:"left-start",reference:T.current,modifiers:x,showArrow:!0,toggle:e=>{(null==P?void 0:P.root.contains(null==e?void 0:e.target))||I(e=>!e)},offset:y,a11yVersion:-1},Object(i.jsx)("div",{css:i.css`
            width: 240px;
            height: 360px;
            .field-list{
              height: calc(100% - 200px) !important;
            }
          `},Object(i.jsx)(l.PanelHeader,{className:"px-3 py-2",title:N("dataPanelTitle"),onClose:()=>I(!1)}),Object(i.jsx)(g,{widgetId:a,source:"user",useDataSources:n,editor:P,formats:D,editable:!1,autoInsertSpace:!1,types:Object(i.Immutable)([S.Attribute]),selection:z})))))};class v extends i.React.PureComponent{constructor(){super(...arguments),this.state={moduleLoaded:!1}}componentDidMount(){Promise.all([i.moduleLoader.loadModule("jimu-ui/advanced/rich-text-editor"),i.moduleLoader.loadModule("jimu-ui/advanced/expression-builder")]).then(e=>{const[{RichExpressionBuilder:t,useEditorSelectionFormats:r,richTextEditorUtils:o,RichEditorCore:i,Delta:n,useMixinKeyboardEnterModules:s},{ExpressionBuilderType:l}]=e;this.state.moduleLoaded||(this.RichExpressionBuilder=t,this.useEditorSelectionFormats=r,this.richTextEditorUtils=o,this.RichEditorCore=i,this.ExpressionBuilderType=l,this.Delta=n,this.useMixinKeyboardEnterModules=s,this.setState({moduleLoaded:!0}))})}render(){return this.state.moduleLoaded?Object(i.jsx)(g,Object.assign({},this.props,{Delta:this.Delta,useMixinKeyboardEnterModules:this.useMixinKeyboardEnterModules,RichExpressionBuilder:this.RichExpressionBuilder,useEditorSelectionFormats:this.useEditorSelectionFormats,richTextEditorUtils:this.richTextEditorUtils,RichEditorCore:this.RichEditorCore,ExpressionBuilderType:this.ExpressionBuilderType})):null}}const j=i.themeUtils.withStyles(v,"DynamicUrlEditor");i.ThemeManager.getInstance().registerJimuThemeStyleModule("jimu-ui/advanced/dynamic-url-editor",{componentStyles:o})}}))}}}));