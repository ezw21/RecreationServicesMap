System.register(["jimu-core","jimu-ui","jimu-ui/basic/item-selector","jimu-arcgis","jimu-layouts/layout-runtime","jimu-core/data-source"],(function(e){var t,s,a,i,o,r;return{setters:[function(e){t=e},function(e){s=e},function(e){a=e},function(e){i=e},function(e){o=e},function(e){r=e}],execute:function(){e(function(e){var t={};function s(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=978)}({0:function(e,s){e.exports=t},1:function(e,t){e.exports=s},102:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7 1a6 6 0 100 12A6 6 0 007 1zm0 13a7 7 0 115.621-2.828l-.222.284 3.405 3.404a.668.668 0 01-.944.944L11.456 12.4A6.974 6.974 0 017 14z" fill="#000" fill-rule="evenodd"></path></svg>'},106:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 5.5v-5a.5.5 0 011 0v5h5a.5.5 0 010 1h-5v5a.5.5 0 01-1 0v-5h-5a.5.5 0 010-1h5z" fill="#000" fill-rule="nonzero"></path></svg>'},117:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 0a.5.5 0 01.5.5V1h2a1 1 0 011 1v9a1 1 0 01-1 1H1a1 1 0 01-1-1V2a1 1 0 011-1h2V.5a.5.5 0 011 0V1h4V.5a.5.5 0 01.5-.5zM11 5H1v6h10V5zM8.5 8.5a.5.5 0 010 1h-5a.5.5 0 010-1h5zm0-2a.5.5 0 010 1h-5a.5.5 0 010-1h5zM3 2H1v2h10V2H9v.5a.5.5 0 01-1 0V2H4v.5a.5.5 0 01-1 0V2z" fill="#000" fill-rule="nonzero"></path></svg>'},12:function(e,t){e.exports=a},126:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm0 1a5 5 0 100 10A5 5 0 006 1zm4 4.5v1H2v-1h8z" fill="#000" fill-rule="nonzero"></path></svg>'},127:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm0 1a5 5 0 100 10A5 5 0 006 1zm.5 1v3.5H10v1H6.5V10h-1V6.5H2v-1h3.5V2h1z" fill="#000" fill-rule="nonzero"></path></svg>'},129:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M7.185 0c.105 0 .195.118.232.24l.013.062.245 1.567c.294.145.588.29.85.465l.19.138 1.53-.603c.154-.05.264-.016.332.031l.036.03 1.224 2.11c.051.1.06.201-.01.302l-.05.06-1.286 1.025c.061.181.061.362.061.603 0 .181-.034.328-.052.467l-.01.136 1.409.965c.105.052.12.192.083.307l-.022.055-1.224 2.11c-.053.104-.195.163-.312.14l-.056-.019-1.53-.603a4.796 4.796 0 01-.82.494l-.22.109-.245 1.568c0 .103-.135.207-.25.234L7.246 12H4.798c-.157 0-.27-.089-.298-.19l-.253-1.619c-.293-.145-.587-.29-.85-.465l-.19-.138-1.53.603c-.153.05-.264.017-.332-.03l-.036-.03L.085 8.02c-.05-.101-.06-.202.01-.302l.051-.06 1.286-1.026c-.061-.18-.061-.362-.061-.603 0-.18.034-.328.051-.466l.01-.137-1.286-.965c-.104-.103-.164-.25-.14-.329L1.247 1.99c.102-.1.204-.16.342-.141l.087.02 1.469.603.419-.281c.135-.09.268-.17.407-.236l.214-.086.245-1.628c0-.103.135-.207.25-.234L4.738 0h2.448zm-.658 1h-1.2l-.243 1.627-.586.192a1.42 1.42 0 00-.3.154l-.503.335-.441.29-1.439-.593-.59 1.017 1.207.905v.5c0 .088-.003.147-.013.228l-.044.31a.577.577 0 00-.004.065l.005.26.005.027.223.66L1.258 8.05l.581 1.001 1.536-.604.45.356c.162.126.334.226.712.416l.618.304.23 1.476h1.274l.23-1.476.751-.371c.206-.106.342-.182.453-.258l.126-.091.451-.356 1.506.595.587-1.01-1.272-.872v-.607l.009-.117.048-.341.003-.035v-.18l-.003-.098-.004-.034-.225-.665 1.345-1.073-.581-1.002-1.535.605-.451-.355-.126-.092a5.312 5.312 0 00-.59-.326l-.614-.303L6.527 1zM6 3.75a2.25 2.25 0 110 4.5 2.25 2.25 0 010-4.5zm0 1a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5z" fill="#000" fill-rule="nonzero"></path></svg>'},13:function(e,t){e.exports=i},169:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M6 11.943l4 1.711V4.057L6 2.346v9.597zm-1 .17V2.494l-4 1.48v9.619l4-1.48zm6 1.393l4-1.48V2.407l-4 1.48v9.619zM0 15V3.307L5.75 1.18l4.528 1.937L16 1v11.693l-5.75 2.127-4.528-1.937L0 15z" fill="#000" fill-rule="nonzero"></path></svg>'},170:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 4V1.39C6.402 2.12 5.565 2.99 4.985 4H7.5zm0 3.5V5H4.512a8.13 8.13 0 00-.5 2.5H7.5zm0 3.5V8.5H4.012a8.13 8.13 0 00.5 2.5H7.5zm0 3.61V12H4.985c.58 1.01 1.417 1.88 2.515 2.61zm2.543.087A7.014 7.014 0 0013.745 12h-1.6a8.278 8.278 0 01-2.102 2.697zM11.015 12H8.5v2.61c1.098-.73 1.935-1.6 2.515-2.61zm1.974-3.5a9.328 9.328 0 01-.441 2.5h1.778c.365-.767.594-1.61.656-2.5H12.99zm-1.001 0H8.5V11h2.988a8.13 8.13 0 00.5-2.5zm.56-3.5c.254.775.401 1.609.441 2.5h1.993a6.957 6.957 0 00-.656-2.5h-1.778zm-1.06 0H8.5v2.5h3.488a8.13 8.13 0 00-.5-2.5zm-1.445-3.697c.91.78 1.611 1.68 2.102 2.697h1.6a7.014 7.014 0 00-3.702-2.697zM8.5 4h2.515c-.58-1.01-1.417-1.88-2.515-2.61V4zm-.527 12a8 8 0 11.055-16 8 8 0 01-.055 16zM5.957 1.302A7.014 7.014 0 002.255 4h1.6a8.278 8.278 0 012.102-2.697zM3.011 7.5c.04-.891.187-1.725.441-2.5H1.674a6.957 6.957 0 00-.656 2.5H3.01zm.441 3.5a9.328 9.328 0 01-.441-2.5H1.018c.062.89.291 1.733.656 2.5h1.778zm2.505 3.697A8.278 8.278 0 013.855 12h-1.6a7.014 7.014 0 003.702 2.697z" fill="#000" fill-rule="nonzero"></path></svg>'},171:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0l8 6-8 6-8-6 8-6zM1.887 6L8 10.82 14.113 6 8 1.18 1.887 6zM.563 9L8 14.775 15.437 9l.563.81L8 16 0 9.81.563 9z" fill="#000" fill-rule="nonzero"></path></svg>'},172:function(e,t){e.exports='<svg viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg"><path d="M6 5.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm0 1a2.5 2.5 0 110-5 2.5 2.5 0 010 5zM6 1c-2.124 0-3.714.967-4.867 3C2.286 6.033 3.876 7 6 7s3.714-.967 4.867-3C9.714 1.967 8.124 1 6 1zm0 7C3.333 8 1.333 6.667 0 4c1.333-2.667 3.333-4 6-4s4.667 1.333 6 4c-1.333 2.667-3.333 4-6 4z"></path></svg>'},173:function(e,t){e.exports='<svg viewBox="0 0 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.62 6.366L4.635 4.379a1.5 1.5 0 001.987 1.987zm.746-.745a1.5 1.5 0 00-1.987-1.987l1.987 1.987zM3.899 3.644l-.825-.825C2.322 3.314 1.678 4.038 1.133 5 2.286 7.033 3.876 8 6 8c.702 0 1.345-.106 1.934-.32L7.356 7.1A2.5 2.5 0 013.9 3.645zm.745-.745A2.5 2.5 0 018.1 6.355l.826.826c.752-.495 1.396-1.219 1.941-2.181C9.714 2.967 8.124 2 6 2c-.702 0-1.345.106-1.934.32l.578.579zM2.354 2.1L1.155.9A.527.527 0 011.9.154l1.4 1.4C4.107 1.184 5.008 1 6 1c2.667 0 4.667 1.333 6 4-.634 1.268-1.419 2.235-2.355 2.9l1.2 1.2a.527.527 0 01-.745.746l-1.4-1.4C7.893 8.816 6.992 9 6 9 3.333 9 1.333 7.667 0 5c.634-1.268 1.419-2.235 2.355-2.9z"></path></svg>'},174:function(e,t){e.exports='<svg viewBox="0 0 80 71" xmlns="http://www.w3.org/2000/svg"><path d="M63.86 24a4 4 0 013.327 1.781l12.141 18.211a4 4 0 01.672 2.22V67a4 4 0 01-4 4H4a4 4 0 01-4-4V46.211a4 4 0 01.672-2.219l12.14-18.21A4 4 0 0116.142 24h47.718zm0 4H16.14L4.808 44.999H29a2 2 0 012 2V47c0 .687.077 1.357.223 2l-27.224-.001L4 67h72l-.001-18.001H48.777A9.03 9.03 0 0049 47a2 2 0 012-2.001h23.585L63.859 28zM31.222 49a9.003 9.003 0 0017.554 0h4.07C51.885 55.23 46.499 60 40 60c-6.5 0-11.885-4.77-12.847-11h4.07zm36.42-42.128a2.5 2.5 0 01.307 3.522l-7.07 8.426a2.5 2.5 0 01-3.83-3.214l7.07-8.426a2.5 2.5 0 013.522-.308zM15.88 7.18l7.07 8.426a2.5 2.5 0 01-3.83 3.214l-7.07-8.426a2.5 2.5 0 013.83-3.214zM40 0a2.5 2.5 0 012.5 2.5v14a2.5 2.5 0 11-5 0v-14A2.5 2.5 0 0140 0z" fill="#6A6A6A" fill-rule="evenodd"></path></svg>'},18:function(e,t){e.exports=o},256:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M1.6 4.23L.553 5.238 0 4.558l1.687-1.46h.86v5.804H1.6V4.23zm2.035 3.63l2.168-2.18L6 5.471c.068-.073.13-.151.185-.233.055-.082.101-.168.138-.258a.741.741 0 00.055-.283.729.729 0 00-.244-.558.786.786 0 00-.256-.151.9.9 0 00-.312-.054.822.822 0 00-.583.214.918.918 0 00-.276.573l-.993-.082c.02-.267.082-.504.185-.709.102-.205.235-.375.398-.512.163-.137.352-.24.568-.311A2.23 2.23 0 015.566 3c.253 0 .488.034.706.102.218.069.409.17.572.304.163.134.291.304.386.512.095.208.142.45.142.73 0 .366-.08.681-.24.946-.16.265-.367.518-.62.758L4.786 8.016h2.586v.886H3.635V7.86zm5.952-2.426h.245c.136 0 .27-.008.398-.024a.999.999 0 00.347-.107.64.64 0 00.248-.237.8.8 0 00.095-.418.73.73 0 00-.22-.55.794.794 0 00-.576-.213.828.828 0 00-.509.168.948.948 0 00-.327.472l-1.002-.28c.064-.212.153-.398.269-.556.115-.159.252-.289.41-.39.157-.1.33-.176.52-.225.19-.05.386-.074.591-.074.242 0 .47.033.686.098.216.066.405.163.568.291a1.412 1.412 0 01.536 1.16c0 .312-.084.589-.252.832a1.177 1.177 0 01-.702.48v.016c.357.055.628.213.812.475.184.263.276.574.276.935 0 .279-.051.524-.154.738-.102.213-.24.392-.414.536a1.786 1.786 0 01-.603.328 2.31 2.31 0 01-.713.111c-.232 0-.45-.026-.655-.078a1.805 1.805 0 01-.556-.242 1.602 1.602 0 01-.43-.422A1.91 1.91 0 018.2 7.64l1.009-.278c.058.24.16.426.307.557.148.131.347.197.6.197a.986.986 0 00.658-.25.855.855 0 00.205-.287.906.906 0 00.075-.373.822.822 0 00-.114-.455.781.781 0 00-.292-.27 1.225 1.225 0 00-.398-.128 2.95 2.95 0 00-.434-.032h-.229v-.886z" fill="#000" fill-rule="nonzero"></path></svg>'},257:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M1.804 3.145h.638l1.786 5.71h-.843L3 7.548H1.2L.826 8.855H0l1.804-5.71zm.937 3.532l-.639-2.322-.65 2.322h1.289zm1.95-3.532h1.616c.157 0 .31.026.463.077.152.05.288.134.407.25.12.115.216.265.29.447.074.183.111.404.111.662 0 .322-.066.588-.199.798-.133.21-.306.36-.521.452v.016a.871.871 0 01.36.149c.111.078.206.177.284.298.078.121.14.261.185.42.045.158.067.329.067.512 0 .312-.045.571-.135.778-.09.207-.208.374-.354.5a1.308 1.308 0 01-.504.27c-.189.054-.381.08-.577.08H4.691V3.146zm.738 2.323h.673c.246 0 .43-.066.554-.198a.731.731 0 00.184-.52c0-.247-.063-.431-.19-.552-.127-.121-.33-.182-.612-.182H5.43v1.452zm0 2.516h.68c.093 0 .194-.008.301-.024a.675.675 0 00.518-.367.96.96 0 00.088-.448c0-.3-.071-.51-.214-.629-.142-.118-.364-.177-.664-.177h-.709v1.645zm5.903-3.5c-.152-.226-.3-.376-.442-.452a.914.914 0 00-.43-.113c-.215 0-.41.053-.583.158-.174.104-.323.25-.448.435a2.203 2.203 0 00-.29.65 2.988 2.988 0 00-.102.798c0 .306.034.588.102.846.068.259.165.482.29.67.125.188.274.336.448.443.174.108.368.162.583.162.168 0 .33-.055.489-.166.158-.11.305-.286.442-.528l.609.597c-.187.355-.416.613-.685.774-.27.161-.557.242-.861.242-.32 0-.614-.071-.882-.214a2.064 2.064 0 01-.69-.605 3.012 3.012 0 01-.454-.94 4.241 4.241 0 01-.164-1.217c0-.457.054-.872.164-1.246.109-.373.26-.692.453-.955.194-.264.424-.467.691-.61.268-.142.562-.213.882-.213.281 0 .542.069.782.206.24.137.463.37.67.697l-.574.58z" fill="#000" fill-rule="nonzero"></path></svg>'},258:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M1.5 16a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0-13a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm13 13a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0-13a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM8 9.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z" fill-rule="nonzero"></path></svg>'},259:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2.147 13.146l11-11a1.5 1.5 0 11.707.707l-11 11a1.5 1.5 0 11-.707-.707z" fill-rule="nonzero"></path></svg>'},260:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2.915 14h10.17c.05-.14.12-.271.207-.389l-2.204-4.114a1.5 1.5 0 110-2.995l2.204-4.113A1.496 1.496 0 0113.085 2H2.915c-.151.426-.489.764-.915.915v10.17c.426.151.764.489.915.915zm0 1A1.5 1.5 0 111 13.085V2.915A1.5 1.5 0 112.915 1h10.17a1.5 1.5 0 111.276 1.994l-2.272 3.975a1.495 1.495 0 010 2.063l2.272 3.974A1.5 1.5 0 1113.086 15H2.914z" fill-rule="nonzero"></path></svg>'},261:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M0 11V1h12v10H0zm1-.833l2-.001V9H1v1.167zM7 9H4v1.166h3V9zm4 0H8v1.166h3V9zm0-1V7H8v1h3zM1 8h2V7H1v1zm6-1H4v1h3V7zm4-1V5H8v1h3zM1 6h2V5H1v1zm6-1H4v1h3V5zm4-3.167H1V4h10V1.833z" fill="#000" fill-rule="nonzero"></path></svg>'},262:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9l-2-9H2L0 9l.36.087c2.18.507 3.893.547 5.14.121V11H2v1h8v-1H6.5V8.792c1.315-.45 3.148-.38 5.5.208zM2.802 1h6.395l1.489 6.701-.227-.037c-2.03-.316-3.662-.18-4.906.442l-.159.073c-.926.394-2.309.433-4.14.077l-.062-.013L2.802 1zM6 2H5v3H3v1h2v1h1V4h3V3H6V2z" fill="#000"></path></svg>'},263:function(e,t){e.exports='<svg viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 0l2 9c-2.352-.588-4.185-.657-5.5-.208V11h3.5v1h-8v-1H6V9.208c-1.247.426-2.96.386-5.14-.121L.5 9l2-9h8zM8.87 1H3.505c.084.58.207 1.325.61 1.991.294.486.75.95 1.503 1.253.257-.828.9-1.543 1.56-2.098C7.72 1.69 8.323 1.302 8.87 1zm.966.625l1.144 5.15a5.006 5.006 0 00-.988-.9c-.868-.614-2.063-1.143-3.408-1.368.177-.53.62-1.077 1.238-1.596a10.147 10.147 0 012.014-1.286zM3.26 3.51a4.578 4.578 0 01-.354-.727L1.692 8.243l.062.013c1.831.356 3.214.317 4.14-.077l.159-.073c1.113-.557 2.538-.724 4.28-.527a1.968 1.968 0 00-.077-.108 3.856 3.856 0 00-.842-.78c-.746-.528-1.8-.998-2.996-1.198C4.776 5.22 3.815 4.427 3.26 3.51z" fill="#000"></path></svg>'},264:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M12 0v12H0V0h12zm-1 1H1v10h3L1 9l3-2 3 2-3 2h7V1zM4 8.202L2.803 9 4 9.797 5.196 9 4 8.202zM8 4l3 2-3 2-3-2 3-2zm0 1.202L6.803 6 8 6.797 9.196 6 8 5.202zM4 1l3 2-3 2-3-2 3-2zm0 1.202L2.803 3 4 3.797 5.196 3 4 2.202z" fill="#000" fill-rule="nonzero"></path></svg>'},265:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9l-2-9H2L0 9l.36.087c2.18.507 3.893.547 5.14.121V11H2v1h8v-1H6.5V8.792c1.315-.45 3.148-.38 5.5.208zM2.802 1h6.395l1.489 6.701-.227-.037c-2.03-.316-3.662-.18-4.906.442l-.159.073c-.926.394-2.309.433-4.14.077l-.062-.013L2.802 1zM4 3.78V6h2V3.28l-2 .5zm2-1.53L3 3v4h6V4H7V2l-1 .25zM8 6H7V5h1v1z" fill="#000"></path></svg>'},266:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 1H1v10h5V1zM1 0H0v12h12V5H7V0H1zm6 6v5h4V6H7zM2 2h3v1H2V2zm3 2H2v1h3V4zm3 3h2v1H8V7zm2 2H8v1h2V9zM2 6h3v1H2V6z" fill="#000"></path></svg>'},267:function(e,t){e.exports='<svg viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg"><path d="M1 5.304V6.5C1 7.692 3.615 9 7 9s6-1.308 6-2.5V5.304C11.775 6.32 9.546 7 7 7s-4.775-.68-6-1.696zM14 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C0 1.567 3.134 0 7 0s7 1.567 7 3.5zm-1 4.804C11.775 9.32 9.546 10 7 10s-4.775-.68-6-1.696V9.5C1 10.692 3.615 12 7 12s6-1.308 6-2.5V8.304zm0 3C11.775 12.32 9.546 13 7 13s-4.775-.68-6-1.696V12.5C1 13.692 3.615 15 7 15s6-1.308 6-2.5v-1.196zM7 6c3.385 0 6-1.308 6-2.5S10.385 1 7 1 1 2.308 1 3.5 3.615 6 7 6z" fill="#000" fill-rule="nonzero"></path></svg>'},268:function(e,t){e.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm0 2C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10-4.477 10-10 10zm8.282-1.718a.961.961 0 011.359 0l4.077 4.077a.961.961 0 01-1.359 1.36l-4.077-4.078a.961.961 0 010-1.36z" fill="#000" fill-rule="nonzero"></path></svg>'},269:function(e,t){e.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.462 12l10.235 10.235a1.034 1.034 0 11-1.462 1.462L12 13.462 1.765 23.697a1.034 1.034 0 11-1.462-1.462L10.538 12 .303 1.765A1.034 1.034 0 111.765.303L12 10.538 22.235.303a1.034 1.034 0 111.462 1.462L13.462 12z" fill="#000" fill-rule="nonzero"></path></svg>'},270:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M6.262 6.972l-.893-.893a.5.5 0 010-.707l.003-.003a.5.5 0 01.707 0l.893.893.709-.709a1.003 1.003 0 000-1.419L4.844 1.297a1.003 1.003 0 00-1.419 0L1.297 3.425a1.003 1.003 0 000 1.419L4.134 7.68a1.003 1.003 0 001.419 0l.71-.71zm1.419 0l1.347 1.347.71-.71a2.006 2.006 0 012.837 0l2.837 2.838a2.006 2.006 0 010 2.837l-2.128 2.128a2.006 2.006 0 01-2.837 0L7.61 12.575a2.006 2.006 0 010-2.837l.709-.71-1.347-1.347-.71.71a2.006 2.006 0 01-2.837 0L.588 5.552a2.006 2.006 0 010-2.837L2.716.588a2.006 2.006 0 012.837 0L8.39 3.425a2.006 2.006 0 010 2.837l-.709.71zm2.057 2.056l.599.6a.5.5 0 010 .707l-.002.002a.5.5 0 01-.707 0l-.6-.6-.709.71a1.003 1.003 0 000 1.419l2.837 2.837a1.003 1.003 0 001.419 0l2.128-2.128a1.003 1.003 0 000-1.419L11.866 8.32a1.003 1.003 0 00-1.419 0l-.71.71z" fill="#000" fill-rule="nonzero"></path></svg>'},271:function(e,t){e.exports='<svg viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 3.5v-3a.5.5 0 011 0v3h3a.5.5 0 010 1h-3v3a.5.5 0 01-1 0v-3h-3a.5.5 0 010-1h3z" fill-rule="evenodd"></path></svg>'},272:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M4 3h11a1 1 0 011 1v11a1 1 0 01-1 1H4a1 1 0 01-1-1V4a1 1 0 011-1zm0 1v11h11V4H4zm-4 7.5V1a1 1 0 011-1h9.5a.5.5 0 010 1H1v10.5a.5.5 0 01-1 0z" fill-rule="nonzero"></path></svg>'},273:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M9 6V2.333C9 .939 10.408 0 12 0h8c1.592 0 3 .939 3 2.333V6h8a1 1 0 010 2h-3l-1.858 22.153A2 2 0 0124.148 32H7.852a2 2 0 01-1.994-1.847L4 8H1a1 1 0 010-2h8zm2 0h10V2c0-.078-10-.078-10 0v4zM6.006 8l1.846 22h16.296l1.846-22H6.006zM13 12a1 1 0 011 1v12a1 1 0 01-2 0V13a1 1 0 011-1zm6 0a1 1 0 011 1v12a1 1 0 01-2 0V13a1 1 0 011-1z"></path></svg>'},274:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M9.5 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zm-4.75 0a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zM0 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0z" fill="#000"></path><path d="M0 0h12v12H0z"></path></g></svg>'},275:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M11 0v6h-1V1H1v10h5v1H0V0h11zM8.5 6a2.5 2.5 0 012.099 3.859l1.248 1.25a.522.522 0 11-.739.738l-1.25-1.248A2.5 2.5 0 118.5 6zm0 1a1.5 1.5 0 10.84 2.742l-.03.019.031-.02.034-.024.028-.02c.021-.015.041-.031.06-.048l-.057.045.082-.065a1.51 1.51 0 00.214-.23l.039-.057.001-.001.015-.024.014-.022.003-.005.008-.012.034-.058.003-.006A1.5 1.5 0 008.5 7zM5 7v1H2V7h3zm1-2v1H2V5h4zm3-2v1H2V3h7z" fill-rule="nonzero" fill="#000"></path></svg>'},276:function(e,t){e.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M12.8 8L14 9l-7 5-7-5 1.2-1L7 12l5.8-4zM7 0l7 5-7 5-7-5 7-5z" fill-rule="evenodd"></path></svg>'},277:function(e,t){e.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><path d="M7.25 8.201V14h5.8V8.201h-5.8zM0 14h5.8V8.201H0V14zM0 .953v5.799h5.8V.953H0zM9.9 0L5.8 4.103 9.9 8.2 14 4.103 9.9 0z" fill-rule="nonzero"></path></svg>'},278:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm0 1a5 5 0 100 10A5 5 0 006 1zm.5 3.5v4H7a.5.5 0 110 1H5a.5.5 0 110-1h.5v-3H5a.5.5 0 110-1h1.5zm-.5-2a.5.5 0 110 1 .5.5 0 010-1z" fill="#FFF" fill-rule="nonzero"></path></svg>'},37:function(e,t){e.exports=r},38:function(e,t){e.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M7.745 7l4.1 4.1a.527.527 0 01-.745.746L7 7.746l-4.1 4.1a.527.527 0 01-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 01.746-.746l4.1 4.1 4.1-4.1a.527.527 0 01.746.746L7.746 7z" fill="#000"></path><path d="M1 1h12v12H1z"></path></g></svg>'},61:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 3.146a.5.5 0 01.708 0L6 8.5l5.146-5.354a.5.5 0 01.708.708l-5.5 5.707a.5.5 0 01-.708 0l-5.5-5.707a.5.5 0 010-.708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},67:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 32"><path d="M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 11.001 3.999 2 2 0 01-.001-3.999zm0-2.666a2 2 0 01-2-2v-8a2 2 0 114 0v8a2 2 0 01-2 2z"></path></svg>'},92:function(e,t){e.exports='<svg viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.5 13a.5.5 0 010-1h4a.5.5 0 010 1h-4zM0 8.5a.5.5 0 00.5.5h7a.5.5 0 000-1h-7a.5.5 0 00-.5.5zM.5 5a.5.5 0 010-1h11a.5.5 0 010 1H.5zM.5 1a.5.5 0 110-1h15a.5.5 0 010 1H.5z" fill="#000"></path></svg>'},93:function(e,t){e.exports='<svg viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.5 0a.5.5 0 000 1h4a.5.5 0 000-1h-4zM0 4.5A.5.5 0 01.5 4h7a.5.5 0 010 1h-7a.5.5 0 01-.5-.5zM.5 8a.5.5 0 000 1h11a.5.5 0 000-1H.5zM.5 12a.5.5 0 000 1h15a.5.5 0 000-1H.5z" fill="#000"></path></svg>'},94:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 9.56a.5.5 0 00.708 0L6 4.208l5.146 5.354a.5.5 0 00.708-.708l-5.5-5.707a.5.5 0 00-.708 0l-5.5 5.707a.5.5 0 000 .708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},95:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2.212 9.936L2 12.27l2.333-.212L13.27 3.12 11.149 1 2.212 9.936zm-.707-.707L10.441.293a1 1 0 011.415 0l2.12 2.121a1 1 0 010 1.414l-8.935 8.937a1 1 0 01-.617.289l-2.333.212a1 1 0 01-1.087-1.087l.212-2.333a1 1 0 01.289-.617zm7.434-6.497l2.829 2.829-.707.707-2.829-2.829.707-.707zM.5 15h15a.5.5 0 010 1H.5a.5.5 0 010-1z" fill="#000" fill-rule="nonzero"></path></svg>'},978:function(e,t,s){"use strict";s.r(t),s.d(t,"DataSourceSelector",(function(){return Vt})),s.d(t,"DataSourceList",(function(){return dt})),s.d(t,"ExternalDataSourceSelector",(function(){return $e})),s.d(t,"DataSourceItem",(function(){return Ft})),s.d(t,"DataSourceErrorItem",(function(){return Wt})),s.d(t,"FieldSelector",(function(){return es})),s.d(t,"DataViewPriority",(function(){return Jt})),s.d(t,"MainDataAndViewSelector",(function(){return Qt})),s.d(t,"DataViewSettingPopup",(function(){return yt})),s.d(t,"DataSourceRemoveWaringReason",(function(){return pt})),s.d(t,"DataSourceRemoveWarningPopup",(function(){return gt})),s.d(t,"AllDataSourceTypes",(function(){return S})),s.d(t,"dataComponentsUtils",(function(){return i}));var a={};s.r(a),s.d(a,"DataSourceSelector",(function(){return r})),s.d(a,"DataSourceList",(function(){return n})),s.d(a,"DataSourceTree",(function(){return l})),s.d(a,"ExternalDataSourceSelector",(function(){return c})),s.d(a,"DataSourceItem",(function(){return d})),s.d(a,"DataSourceErrorItem",(function(){return p})),s.d(a,"FieldSelector",(function(){return h})),s.d(a,"MainDataAndViewSelector",(function(){return u})),s.d(a,"DataViewSettingPopup",(function(){return m})),s.d(a,"DataSourceRemoveWarningPopup",(function(){return g}));var i={};s.r(i),s.d(i,"getWidgetsUsingDsOrItsViews",(function(){return j})),s.d(i,"getWidgetsUsingDsOrItsDescendantDss",(function(){return O})),s.d(i,"getDescendantDssAndViews",(function(){return C})),s.d(i,"isFuzzySearch",(function(){return N})),s.d(i,"isFuzzyFromDsIds",(function(){return T})),s.d(i,"getOutputDssFromOriginDs",(function(){return E})),s.d(i,"getAppConfig",(function(){return V})),s.d(i,"getDsIcon",(function(){return R})),s.d(i,"getDsTypeString",(function(){return L})),s.d(i,"getWhetherDataSourceIsInited",(function(){return A})),s.d(i,"editDataSourceJson",(function(){return k})),s.d(i,"getOriginalDataUrl",(function(){return U})),s.d(i,"getWidgetsUsingOutputDsFromOneWidget",(function(){return z})),s.d(i,"getIconFromFieldType",(function(){return I}));var o=s(0);function r(e){const t=e.theme;return o.css`
    .component-data-source-selector{
      .font-dark-600{
        color: ${t.colors.palette.dark[600]};
      }
      .dv-select-container{
        margin-top: ${o.polished.rem(12)};
        .jimu-dropdown-button{
          .settings-icon{
            display: none;
          }
        }
      }
      .ds-selector-button{
        height: ${o.polished.rem(40)};
        line-height: ${o.polished.rem(40)};
        padding: 0;
        border: 1px dashed ${t.colors.palette.dark[100]};
        border-radius: ${o.polished.rem(2)};
        cursor: pointer;
        color: ${t.colors.palette.primary[700]};
        font-size: ${o.polished.rem(14)};
        text-decoration: none;
        &:hover{
          border-color: ${t.colors.palette.dark[400]};
          color: ${t.colors.palette.primary[800]};
        }
      }
      .ds-item.ds-error-item{
        background-color: ${t.colors.palette.secondary[400]};
        *{
          color: ${t.colors.palette.dark[400]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.secondary[800]};
        }
      }
      .ds-item.ds-item-open{
        border-left: 2px solid ${t.colors.palette.primary[600]};
      }
      .ds-item{
        &:not(:first-of-type) {
          margin-top: ${o.polished.rem(8)};
        }

        padding: ${o.polished.rem(8)} ${o.polished.rem(10)} ${o.polished.rem(10)} ${o.polished.rem(10)};
        background-color: ${t.colors.palette.secondary[500]};
        cursor: pointer;

        &:hover{
          background-color: ${t.colors.palette.light[600]};
        }

        .mr-30{
          margin-right: ${o.polished.rem(30)};
        }

        &.disable-cursor{
          cursor: default;
        }

        .ds-item-close{
          height: 100%;
          cursor: pointer;
          margin-left: ${o.polished.rem(5)};
          margin-right: -5px;
        }

        .ds-item-filter{
          height: 100%;
          cursor: pointer;
        }

        .ds-item-sort{
          height: 100%;
          cursor: pointer;
          margin-left: ${o.polished.rem(5)};
        }

        .ds-thumbnail{
          width:  ${o.polished.rem(18)};
          height:  ${o.polished.rem(18)};
          background-color: ${t.colors.palette.info[400]};
        }
        .ds-type{
          font-size: ${o.polished.rem(14)};
          color: ${t.colors.palette.dark[800]};
        }
        .top-right-red-dot-container{
          position: relative;
        }
        .top-right-red-dot{
          position: absolute;
          top: 0;
          right: 0;
          display: inline-block;
          width: 8px;
          height: 8px;
          border-radius: 4px;
          background-color: ${t.colors.palette.danger[700]};
        }
      }
    }

  `}function n(e){const t=e.theme;return o.css`
    .component-data-source-list{
      font-size: ${t.typography.fontSizeBase};
      overflow: hidden;

      .search{
        position: relative;
      }
      .search-input{
        height: 26px;
        border-radius: 2px;
      }
      .search-icon{
        color: ${t.colors.palette.dark[600]};
      }

      .empty-placeholder{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        .empty-placeholder-text, .empty-placeholder-icon{
          display: table;
          margin: 0 auto;
        }
        .empty-placeholder-text{
          color: ${t.colors.palette.dark[400]};
          font-size: ${o.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon{
          color: ${t.colors.palette.secondary[800]};
        }
      }

      .jimu-tab{
        height: 100%;
        .tab-content{
          height: calc(100% - 40px);
        }
        .tab-pane{
          width: 100%;
        }
        .jimu-nav.nav-pills{
            margin: 0 ${o.polished.rem(16)} !important;
          }
      }

      .ds-list-container{
        height: calc(100% - 110px);
      }

      .ds-list{
        height: calc(100% - 70px);
        overflow: auto;
      }

      .ds-list-header{
        width: 100%;
      }

      .ds-add-data{
        position: absolute;
        bottom: 0;
        height: ${o.polished.rem(40)};
        width: 100%;
        color: ${t.colors.palette.primary[700]};
        font-size: ${o.polished.rem(14)};
        border-top: 1px solid ${t.colors.palette.secondary[800]};
        cursor: pointer;
        &:hover{
          .add-data-icon-container{
            background-color: ${t.colors.palette.primary[800]};
          }
          color: ${t.colors.palette.primary[800]};
        }
        .add-data-icon-container{
          width: ${o.polished.rem(20)};
          height: ${o.polished.rem(20)};
          background-color: ${t.colors.palette.primary[700]};
          border-radius: ${o.polished.rem(10)};
        }
        .add-data-icon{
          color: ${t.colors.palette.light[300]};
        }
      }

      .ds-list-close{
        width: ${o.polished.rem(30)};
        height: 100%;
        cursor: pointer;
      }

      .ds-widget-back{
        width: ${o.polished.rem(80)};
        height: ${o.polished.rem(30)};
        cursor: pointer;
      }

      .ds-types{
        color: ${t.colors.black};
        font-size: ${t.typography.fontSizeBase};
        margin: ${o.polished.rem(6)} 0;
        padding: 0 ${o.polished.rem(16)};
      }

      .ds-widget-outputs{
        padding: 0;
      }

      .ds-added-data{
        padding: 0;
      }

      .to-use-types{
        color: ${t.colors.black};
        .types-selected{
          max-width: ${o.polished.rem(150)};
        }
        .to-use-dp{
          width: ${o.polished.rem(120)};
          height: ${o.polished.rem(26)};
        }
      }

      .ds-thumbnail{
        width:  ${o.polished.rem(26)};
        height:  ${o.polished.rem(26)};
        background-color: ${t.colors.palette.info[400]};
      }
      .ds-type{
        font-size: ${o.polished.rem(14)};
        color: ${t.colors.palette.dark[800]};
      }
      .ds-item.ds-error-item{
        background-color: ${t.colors.palette.secondary[400]};
        *{
          color: ${t.colors.palette.dark[400]} !important;
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.secondary[800]};
        }
      }
      .ds-item{
        border: 2px solid transparent;
        position: relative;
        left: -2px;
        cursor: pointer;
        .item{
          height: ${o.polished.rem(26)};
          background-color: ${t.colors.palette.secondary[500]};
          padding-left: 0;
          padding-right: ${o.polished.rem(10)};
        }
        .selected{
          width:  ${o.polished.rem(24)};
          height:  ${o.polished.rem(24)};
          border-radius: 0 0 0 2px;
          background-color: ${t.colors.palette.primary[700]};
          position: absolute;
          top: 0;
          right: 0;
          .selected-icon{
            color: ${t.colors.palette.secondary[500]};
            margin-left: 2px;
            margin-top: -2px;
          }
        }
      }
      .ds-item.ds-item-selected{
        border: 2px solid ${t.colors.palette.primary[700]};
      }
    }

  `}function l(e){const t=e.theme;return o.css`
    *{
      margin: 0;
      padding: 0;
    }
    .bg{
      padding: ${o.polished.rem(16)} ${o.polished.rem(2)};
      background-color: ${t.colors.palette.light[200]};
      border-top: 2px solid ${t.colors.palette.primary[600]};
    }
    .tree-root{
      padding-left: ${o.polished.rem(20)};
      padding-right: ${o.polished.rem(5)};
    }
    .component-data-source-tree{
      position: relative;
      .collapse-button{
        position: absolute;
        left: 2px;
        z-index: 1;
      }
      .collapse-content{
        padding-left: ${o.polished.rem(20)};
        padding-top: ${o.polished.rem(16)};
        position: relative;
      }
      .collapse-button:not(.root):not(.leaf){
        left: ${o.polished.rem(-18)};
      }
      .collapse-button.leaf{
        left: 2px;
      }
      .collapse-button:not(.root):before{
        content: '';
        position: absolute;
        top: 50%;
        left: -2px;
        border-top: 1px solid ${t.colors.palette.dark[400]};
        width: ${o.polished.rem(21)};
        transform: translateY(-50%);
      }
      .collapse-line{
        border-left: 1px solid ${t.colors.palette.dark[400]};
        border-bottom: 1px solid ${t.colors.palette.dark[400]};
        width: ${o.polished.rem(22)};
        position: absolute;
        top: -1px;
        left: 0;
        z-index: 0;
      }
      .collapse-line:not(.root){
        width: ${o.polished.rem(20)};
        top: -2px;
      }
    }

  `}function c(e){const t=e.theme;return o.css`
    .component-external-data-source-selector{
      height: 100%;
      overflow: hidden;
      position: relative;

      .search-input .input-wrapper {
        >input {
          width: calc(100% - 30px);
          padding-right: 25px;
        }
      }

      .inner-item-selector-container{
        .item-selector-container{
          height: calc(100% - 110px);
        }
      }

      .hint-label{
        font-size: ${o.polished.rem(12)};
        color: ${t.colors.palette.dark[400]};
      }

      .font-size-12{
        font-size: ${o.polished.rem(12)};
      }

      .added-ds-item{
        position: relative;
        cursor: pointer;
        margin: ${o.polished.rem(16)} ${o.polished.rem(8)} ${o.polished.rem(16)} ${o.polished.rem(10)};
        .ds-thumbnail{
          width:  ${o.polished.rem(26)};
          height:  ${o.polished.rem(26)};
          background-color: ${t.colors.palette.info[400]};
        }
        .ds-type{
          font-size: ${o.polished.rem(13)};
          color: ${t.colors.dark};
        }
        .item{
          height: ${o.polished.rem(26)};
        }
      }

      .added-ds-container{
        width: ${o.polished.rem(300)};
        background-color: ${t.colors.palette.light[600]};
        box-shadow: 0 0 10px 4px ${o.polished.rgba(t.colors.white,.3)};
        position: absolute;
        right: 30px;
        bottom: 30px;
        .added-ds-items{
          max-height: ${o.polished.rem(500)};
          overflow-y: auto;
          overflow-x: hidden;
        }
        .small-done-btn{
          max-width: ${o.polished.rem(100)};
        }
      }

      .mt-30{
        margin-top: ${o.polished.rem(30)};
        margin-bottom: ${o.polished.rem(20)};
      }

      .selector-left{
        @media only screen and (max-width: 1100px){
          &{
            width: ${o.polished.rem(160)};
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: ${o.polished.rem(200)};
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: ${o.polished.rem(260)};
          }
        }
        background-color: ${t.colors.palette.light[400]};
        border-right: 1px solid ${t.colors.palette.light[800]};
        .selector-left-title{
          padding: ${o.polished.rem(20)} ${o.polished.rem(20)} ${o.polished.rem(27)} ${o.polished.rem(20)};
          margin: 0;
          font-size: ${o.polished.rem(20)};
          color: ${t.colors.palette.dark[600]};
        }
        .nav.nav-underline{
          border: 0;
          .nav-item{
            .nav-link{
              padding: 0;
              border: 0;
              .jimu-nav-link-wrapper{
                display: flex;
                justify-content: flex-start;
                align-items: center;
                padding: ${o.polished.rem(7)} ${o.polished.rem(20)};
                font-size: ${o.polished.rem(16)};
                color: ${t.colors.palette.dark[600]};
              }
            }
          }

          .nav-item:hover{
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.colors.black};
              }
            }
          }

          .nav-item.active-tab{
            background-color: ${t.colors.palette.light[500]};
            border-left: 4px solid ${t.colors.palette.primary[600]};
            .nav-link{
              .jimu-nav-link-wrapper{
                color: ${t.colors.black};
                font-weight: 500;
                padding-left: ${o.polished.rem(16)};
              }
            }
          }
        }
      }

      .selector-right{
        @media only screen and (max-width: 1100px){
          &{
            width: calc(100% - ${o.polished.rem(160)});
          }
        }
        @media only screen and (min-width: 1100px){
          &{
            width: calc(100% - ${o.polished.rem(200)});
          }
        }
        @media only screen and (min-width: 1300px){
          &{
            width: calc(100% - ${o.polished.rem(260)});
          }
        }
        .selector-right-header{
          padding: ${o.polished.rem(23)} ${o.polished.rem(20)} ${o.polished.rem(12)} ${o.polished.rem(20)};
        }
        .selector-right-body{
          height: calc(100% - 70px);
          @media only screen and (max-width: 1100px){
            &{
              padding: ${o.polished.rem(10)} ${o.polished.rem(25)};
            }
          }
          @media only screen and (min-width: 1100px){
            &{
              padding: ${o.polished.rem(10)} ${o.polished.rem(45)};
            }
          }
          @media only screen and (min-width: 1300px){
            &{
              padding: ${o.polished.rem(10)} ${o.polished.rem(65)};
            }
          }
        }
        .nav-item{
          .nav-link{
            .jimu-nav-link-wrapper{
              font-size: ${o.polished.rem(16)};
            }
          }
        }
        .nav-item.active-tab{
          .nav-link{
            border-bottom: 3px solid ${t.colors.palette.primary[600]};
            padding: 0;
            .jimu-nav-link-wrapper{
              color: ${t.colors.black};
              font-weight: 500;
            }
          }
        }
      }

      .external-data-source-url-input{
        .url-type-select{
          width: ${o.polished.rem(250)};
        }
        .url-input{
          width: ${o.polished.rem(500)};
        }
        .url-input-add-btn{
          height: ${o.polished.rem(30)};
        }
        .url-input-label{
          font-size: ${o.polished.rem(13)};
          color: ${t.colors.palette.dark[400]};
          margin-bottom: 12px;
          font-weight: 500;
        }
      }

      .external-data-source-app-data{
        .item-list{
          display: flex;
          flex-wrap: wrap;
          margin-top: 2rem;
          margin-left: -0.5rem;
          margin-right: -0.5rem;
          overflow-x: hidden;
          overflow-y: auto;

          .item{
            width: ${20}%;
            margin-bottom: 1rem;
            padding: 0 0.5rem;

            .item-active-border-transparent{
              border: ${o.polished.rem(2)} solid transparent;

              &:hover{
                border-color: ${t.colors.primary};
              }
            }

            .item-card-container.item-border-transparent{
              border: ${o.polished.rem(2)} solid transparent;
            }

            .item-card-container{
              border: ${o.polished.rem(1)} solid;
              padding-bottom: ${o.polished.rem(135)};
              position: relative;
              overflow: hidden;

              &:hover{
                border-color: transparent !important;
              }

              .item-card{
                position: absolute;

                .item-card-content{
                  padding: ${o.polished.rem(5)};
                }

                .item-label{
                  max-height: ${o.polished.rem(60)};
                  overflow: hidden;
                  text-overflow: ellipsis;
                  white-space: nowrap;
                }

                .item-logo{
                  width: ${o.polished.rem(60)};
                  height: ${o.polished.rem(60)};
                }

                .item-active-icon{
                  position: absolute;
                  top: ${o.polished.rem(5)};
                  left: ${o.polished.rem(5)};

                  .item-active-icon-container{
                    width: ${o.polished.rem(20)};
                    height: ${o.polished.rem(20)};
                    line-height: ${o.polished.rem(20)};
                  }
                }
              }
            }
          }
        }
      }

      .external-data-source-item-selector{
        .nav.nav-underline{
          border: 0;
          .nav-item:not(:last-child){
            @media only screen and (max-width: 1100px){
              &{
                margin-right: ${o.polished.rem(10)};
              }
            }
            @media only screen and (min-width: 1100px){
              &{
                margin-right: ${o.polished.rem(25)};
              }
            }
            @media only screen and (min-width: 1300px){
              &{
                margin-right: ${o.polished.rem(40)};
              }
            }
          }
        }
        .item-selector-search{
          position: relative;
          margin-left: ${o.polished.rem(50)};

          .search-icon{
            padding: 0;
            padding: 0;
            top: 4px;
            .jimu-icon{
              margin: 0;
            }
          }

          .close-icon{
            position: absolute;
            right: ${o.polished.rem(4)};
            padding: 0;
            padding: 0;
            top: 4px;
            .jimu-icon{
              margin: 0;
            }
          }

          @media only screen and (max-width: 1490px){
            &,.search-input{
              width: 100%;
            }
          }

          @media only screen and (min-width: 1490px){
            &{
              width: auto;
            }
            .search-input{
              width: ${o.polished.rem(400)};
            }
          }

          @media only screen and (max-width: 1000px){
            margin-left: ${o.polished.rem(20)};
          }

          .search-input{
            height: ${o.polished.rem(32)};
            line-height: ${o.polished.rem(32)};
            background-color: ${t.colors.palette.secondary[200]};
            color: ${t.colors.palette.dark[400]};
            font-size: ${o.polished.rem(14)};
            border-radius: 2px;
            min-width: ${o.polished.rem(120)};
          }
          .search-input::-ms-clear{
            display: none;
          }
        }

        .item-selector-sort{
          margin-right: -${o.polished.rem(16)};
          .item-selector-sort-by{
            color: ${t.colors.palette.dark[400]};
            font-size: ${o.polished.rem(13)};
            height: ${o.polished.rem(32)};
            .item-selector-sort-select{
              width: ${o.polished.rem(140)};
              padding: 2px 6px;
              font-size: ${o.polished.rem(13)};
              height: ${o.polished.rem(26)};
            }
          }
        }
      }

    }

  `}function d(e){const t=e.theme;return o.css`
    .component-data-source-item{
      background-color: ${t.colors.palette.light[500]};
      font-size: ${o.polished.rem(12)};
      border-radius: 2px;
      padding: 0;
      &:hover{
        background-color: ${t.colors.palette.light[600]};
      }
      .font-dark-600{
        color: ${t.colors.palette.dark[600]} !important;
      }
      .ds-item-header{
        width: 100%;
        height: ${o.polished.rem(38)};
        padding: 0 10px;
        background-color: ${t.colors.palette.light[700]};
      }
      .ds-item-body{
        width: 100%;
        height: 100%;
        padding: 14px 10px 6px 10px;
      }
      .two-line-truncate{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        word-break: break-word;
        word-wrap: break-word;
      }
      .ds-more{
        margin-right: ${o.polished.rem(-8)};
      }
      .ds-label{
        font-size: ${o.polished.rem(14)};
        color: ${t.colors.palette.dark[800]};
      }
      .ds-type{
        font-size: ${o.polished.rem(13)};
        color: ${t.colors.palette.dark[800]};
        max-width: ${o.polished.rem(100)};
      }
      .ds-thumbnail{
        width:  ${o.polished.rem(18)};
        height:  ${o.polished.rem(18)};
        background-color: ${t.colors.palette.info[400]};
      }
      .ds-related-widgets, .ds-child-dss{
        font-size: ${o.polished.rem(13)};
      }
      .warning-icon, .warning-icon>*{
        color: ${t.colors.palette.danger[700]};
        fill: ${t.colors.palette.danger[700]};
      }
    }

    .component-data-source-item.component-data-source-item-selected-item{
      border: ${o.polished.rem(2)} solid ${t.colors.primary};
    }

    .cursor-pointer{
      cursor: pointer;
    }

  `}function p(e){const t=e.theme;return o.css`
    .component-data-source-error-item{
      .component-data-source-item{
        background-color: ${t.colors.palette.secondary[400]};
        *:not(.ds-badge svg){
          color: ${t.colors.palette.dark[400]} !important;
        }

        .ds-origin-label{
          max-width: 100%;
          .ds-origin-label-link, .ds-origin-label-link:hover, .ds-origin-label-link:focus, .ds-origin-label-link:active{
            color: ${t.colors.palette.dark[400]};
          }
        }
        .ds-item-header{
          background-color: ${t.colors.palette.secondary[500]};
        }
        .ds-thumbnail{
          background-color: ${t.colors.palette.light[800]};
        }
      }

    }

  `}function h(e){const t=e.theme;return o.css`
    .component-field-selector{
      font-size: ${t.typography.fontSizeBase};
      .ds-name{
        color: ${t.colors.black};
      }
      .ds-name-label{
        font-size: ${o.polished.rem(14)};
        color: ${t.colors.palette.dark[400]};
        font-weight: 400;
      }
      .field-data-selected{
        width: 70%;
      }

      .item-selector-search{
        height: ${o.polished.rem(26)};
        position: relative;
      }

      .field-list{
        height: calc(100% - 160px);
        overflow-y: auto;
        .field-item.field-item-selected{
          border: 2px solid ${t.colors.palette.primary[600]};
        }
        .field-item{
          border: 1px solid transparent;
          cursor: pointer;
          background-color: ${t.colors.palette.light[400]};
          user-select: none;
        }
        .field-item:hover{
          background-color: ${t.colors.palette.light[500]};
        }
        .field-item:active.field-item:hover{
          background-color: ${t.colors.white};
        }
      }

      .search-input{
        height: ${o.polished.rem(26)};
        width: 100%;
      }

    }

  `}function u(e){const t=e.theme;return o.css`
    .component-main-data-and-view{
      .option-label{
        font-size: ${o.polished.rem(13)};
        font-weight: 500;
        color: ${t.colors.palette.dark[400]};
      }
    }
  `}function m(e){const t=e.theme;return o.css`
    .data-view-container{
      width: ${o.polished.rem(960)};
      height: ${o.polished.rem(670)};
      border: 0;
    }
    .cicle-button{
      width: ${o.polished.rem(32)};
      height: ${o.polished.rem(32)};
      border-radius: ${o.polished.rem(16)};
    }
    .w-38{
      width: 38%;
    }
    .w-62{
      width: 62%;
    }
    .mr-10{
      margin-right: ${o.polished.rem(10)};
    }
    .pb-30{
      padding-bottom: ${o.polished.rem(30)};
    }
    .preview-table{
      position: relative;
      padding-left: ${o.polished.rem(30)};
    }
    .setting-table{
      padding-right: ${o.polished.rem(30)};
      border-right-width: 2px;
      border-right-style: solid;
      border-image: linear-gradient(180deg, transparent 0%, ${t.colors.palette.light[500]} 52.08%, transparent 100%) 1;
    }
    .table-container{
      height : 100%;
      overflow-x: auto;
      .table-body{
        overflow-y: auto;
        width: fit-content;
      }
      .table-header{
        position: sticky;
        top: 0;
      }
      tr{
        border-top: 1px solid ${t.colors.palette.light[400]};
      }
      tr:last-child{
        border-bottom: 1px solid ${t.colors.palette.light[400]};
      }
      td, th{
        width: ${o.polished.rem(86)};
        height: ${o.polished.rem(32)};
        display: inline-block !important;
        border-left: 1px solid ${t.colors.palette.light[400]};
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 6px 4px;
      }
      td{
        background-color: ${t.colors.palette.light[200]};
      }
      th{
        background-color: ${t.colors.palette.light[400]};
      }
      td:last-child, th:last-child{
        border-right: 1px solid ${t.colors.palette.light[400]};
      }
    }
    .modal-body{
      height: calc(100% - ${o.polished.rem(150)});
      padding: ${o.polished.rem(30)};
      padding-bottom: ${o.polished.rem(14)};
    }
    &.modal-dialog{
      max-width: ${o.polished.rem(960)};
    }
    .modal-header{
      .close{
        display: none;
      }
      .modal-title{
        width: 100%;
        display: flex !important;
        align-items: center !important;
      }
    }

    .jimu-nav{
      margin-bottom: ${o.polished.rem(20)};
    }

    .label{
      font-size: ${o.polished.rem(13)};
      color: ${t.colors.palette.dark[400]};
    }

    .header{
      height: ${o.polished.rem(54)};
      padding-left: ${o.polished.rem(30)};
      padding-right: ${o.polished.rem(30)};
    }

    .modal-footer{
      padding-left: ${o.polished.rem(30)};
      padding-right: ${o.polished.rem(30)};
    }

    .tab-content{
      height: ${o.polished.rem(426)};
      overflow-y: auto;
    }

    .sql-exp-warning{
      color: ${t.colors.palette.danger[700]};
      font-size: ${t.sizes[3]};
      max-width: ${o.polished.rem(600)};
      .sql-exp-warning-icon{
        color: ${t.colors.palette.danger[700]};
      }
    }

  `}function g(e){const t=e.theme;return o.css`
    &.modal-dialog{
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 480px;
    }
    .modal-content{
      border: 0;
    }
    .modal-header, .modal-body{
      padding-left: 20px;
      padding-right: 20px;
    }
    .modal-footer{
      padding-top: 0;
      padding-bottom: 20px;
    }
    .font-16{
      font-size: ${o.polished.rem(16)};
    }
    .font-14{
      font-size: ${o.polished.rem(14)};
    }
    .font-13{
      font-size: ${o.polished.rem(13)};
    }
    .font-dark-800{
      color: ${t.colors.palette.dark[800]};
    }
    .font-dark-600{
      color: ${t.colors.palette.dark[600]};
    }
    .related-widgets{
      width: 100%;
      height: ${o.polished.rem(160)};
      overflow: auto;
      background-color: ${t.colors.palette.light[200]};
    }
    .related-outputs{
      width: 100%;
      max-height: ${o.polished.rem(80)};
      overflow: auto;
      background-color: ${t.colors.palette.light[200]};
      div.output-ds-label+div.output-ds-label{
        margin-top: ${o.polished.rem(8)};
      }
    }
  `}var f=s(13);const S=Object.assign(Object.assign({},o.DataSourceTypes),f.ArcGISDataSourceTypes);var v=s(1);const D=s(256),b=s(257),w=s(117),y="CLICK_ME_TO_CLEAR_SELECTION";function I(e,t){if(!e||!t)return null;const s={[o.JimuFieldType.Number]:D,[o.JimuFieldType.String]:b,[o.JimuFieldType.Date]:w},a={[o.JimuFieldType.Number]:t.colors.info,[o.JimuFieldType.String]:t.colors.success,[o.JimuFieldType.Date]:t.colors.warning};return{icon:s[e],color:a[e]}}var x;function j(e,t,s=!0){if(!e||!t)return[];const a=M(e,t,s),i=o.DataSourceManager.getInstance().getDataSource(e);if(!i)return a;let r=[];return i.getDataViews().forEach(e=>{r=r.concat(M(e.id,t,s))}),Array.from(new Set(a.concat(r)))}function O(e,t){if(!e||!t)return[];const s=j(e,t),a=o.DataSourceManager.getInstance().getDataSource(e);if(!a)return s;let i=[];return a.isDataSourceSet&&a.getChildDataSources().forEach(e=>{i=i.concat(O(e.id,t))}),Array.from(new Set(s.concat(i)))}function M(e,t,s=!1){if(!e||!t)return[];const a=function(e,t){if(!e||!t)return[];return function(e){if(!e)return[];const t=[];return Object.keys(e).forEach(s=>{t.push(e[s])}),t}(t).filter(t=>t&&!1!==t.useDataSourcesEnabled&&t.useDataSources&&t.useDataSources.some(t=>t.dataSourceId===e)).map(e=>e.id)}(e,t),i=s?function(e,t){if(!e||!t)return[];const s=o.DataSourceManager.getInstance(),a=E(s.getDataSource(e));let i=[],r=[];return a.forEach(e=>{e&&e.id&&(r=j(e.id,t).map(e=>e.id),i=i.concat(r))}),Array.from(new Set(i))}(e,t):[];return Array.from(new Set(a.concat(i))).map(e=>t[e])}function C(e){var t,s;if(!e)return[];const a=o.DataSourceManager.getInstance().getDataSource(e);if(!a)return[e];let i=[e];return null===(t=a.getDataViews())||void 0===t||t.forEach(e=>i=i.concat(e.id)),a.isDataSourceSet&&(null===(s=a.getChildDataSources())||void 0===s||s.forEach(e=>{i=i.concat(C(e.id))})),i}function N(e,t){return!!e&&(!t||e.toLocaleLowerCase().includes(t.toLocaleLowerCase()))}function T(e,t,s){return!(!e||!e.id)&&(!t&&!s||(t?s?t.includes(e.id)&&!s(e):t.includes(e.id):!s(e)))}function E(e){if(!e||!e.id)return[];const t=V(),s=t&&t.dataSources;let a=[];return s&&Object.keys(s).forEach(t=>{s[t]&&s[t].isOutputFromWidget&&s[t].originDataSources&&s[t].originDataSources.some(t=>t.dataSourceId===e.id)&&(a=a.concat(o.DataSourceManager.getInstance().getDataSource(t)))}),a}function V(){const e=window&&window.jimuConfig&&window.jimuConfig.isBuilder?Object(o.getAppStore)().getState().appStateInBuilder:Object(o.getAppStore)().getState();return e&&e.appConfig}function R(e){const t=e&&e.type,a=o.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);switch(function(e,t,s){switch(e){case S.WebMap:case S.WebScene:case S.MapService:case S.FeatureService:case S.GroupLayer:case S.SceneService:case S.SceneLayer:return e;case S.FeatureLayer:return s?`${e}_${o.SupportedLayerServiceTypes.Table}`:t?`${e}_${t}`:e;default:return"UNKNOWN"}}(t,function(e){if(e){if(e.toLowerCase().includes(x.Point.toLowerCase()))return x.Point;if(e.toLowerCase().includes(x.Polyline.toLowerCase()))return x.Polyline;if(e.toLowerCase().includes(x.Polygon.toLowerCase()))return x.Polygon}return null}(a?a.getGeometryType():null==e?void 0:e.geometryType),function(e){var t;if(!e)return!1;const s=o.DataSourceManager.getInstance().getDataSource(e.id);return s&&s.getLayerDefinition&&(null===(t=s.getLayerDefinition())||void 0===t?void 0:t.type)===o.SupportedLayerServiceTypes.Table}(e))){case S.WebMap:return s(169);case S.WebScene:return s(170);case`${S.FeatureLayer}_${x.Point}`:return s(258);case`${S.FeatureLayer}_${x.Polyline}`:return s(259);case`${S.FeatureLayer}_${x.Polygon}`:return s(260);case`${S.FeatureLayer}_${o.SupportedLayerServiceTypes.Table}`:return s(261);case""+S.FeatureLayer:return s(171);case""+S.FeatureService:return s(262);case""+S.MapService:return s(263);case""+S.GroupLayer:return s(264);case S.SceneService:return s(265);case S.SceneLayer:return s(266);default:return s(267)}}function L(e,t){if(!e||!t)return"";switch(e){case S.FeatureLayer:return t.formatMessage({id:"featureLayer",defaultMessage:v.defaultMessages.featureLayer});case S.FeatureService:return t.formatMessage({id:"featureService",defaultMessage:v.defaultMessages.featureService});case S.MapService:return t.formatMessage({id:"mapService",defaultMessage:v.defaultMessages.mapService});case S.GroupLayer:return t.formatMessage({id:"groupLayer",defaultMessage:v.defaultMessages.groupLayer});case S.Map:return t.formatMessage({id:"map",defaultMessage:v.defaultMessages.map});case S.SimpleLocal:return t.formatMessage({id:"simpleLocal",defaultMessage:v.defaultMessages.simpleLocal});case S.WebMap:return t.formatMessage({id:"webMap",defaultMessage:v.defaultMessages.webMap});case S.WebScene:return t.formatMessage({id:"webScene",defaultMessage:v.defaultMessages.webScene});case S.CSV:return t.formatMessage({id:"csv",defaultMessage:v.defaultMessages.csv});case S.SceneService:return t.formatMessage({id:"sceneService",defaultMessage:v.defaultMessages.sceneService});case S.SceneLayer:return t.formatMessage({id:"sceneLayer",defaultMessage:v.defaultMessages.sceneLayer});default:return""}}function A(e,t){if(!e)return!!o.DataSourceManager.getInstance();if(t){if(Object.keys(t).filter(e=>1===e.split("-").length).length>Object.keys(e).length)return!1}return Object.keys(e).every(e=>{var s,a;return(null===(s=t[e])||void 0===s?void 0:s.instanceStatus)===o.DataSourceStatus.Created||(null===(a=t[e])||void 0===a?void 0:a.instanceStatus)===o.DataSourceStatus.CreateError})}function k(e){const t=o.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.id);if(!t||!e)return null;let s=t,a=e;for(;s.parentDataSource;)a=s.parentDataSource.getDataSourceJson().setIn(["childDataSourceJsons",s.jimuChildId],a),s=s.parentDataSource;return function e(t){var s;const a=o.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.id);if(!a||!t)return null;let i=t;const r=!!i.isHidden;a.isDataSourceSet&&(null===(s=a.getChildDataSources())||void 0===s?void 0:s.length)>0&&a.getChildDataSources().forEach(t=>{let s=i.getIn(["childDataSourceJsons",t.jimuChildId])||(null==t?void 0:t.getDataSourceJson());s&&(r&&(s=s.set("isHidden",!0)),i=i.setIn(["childDataSourceJsons",t.jimuChildId],e(s)))});return i}(a)}function U(e){var t,s;if(!e)return null;if(e.itemId&&e.portalUrl)return`${e.portalUrl.replace(/\/$/,"")}/home/item.html?id=${e.itemId}`;if(e.url){if(!!(null===(t=o.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url))||void 0===t?void 0:t.owningSystemUrl)){const t=null===(s=o.SessionManager.getInstance().getSessionByUrl(e.url))||void 0===s?void 0:s.token;return t?`${e.url}?token=${t}`:""+e.url}return""+e.url}return null}function z(e){var t;let s=[];const a=V(),i=null==a?void 0:a.widgets;if(i){const a=null===(t=i[e])||void 0===t?void 0:t.outputDataSources;a&&a.length>0&&(s=s.concat(e),a.forEach(e=>{Object.keys(i).forEach(t=>{var a,o;(null===(o=null===(a=i[t])||void 0===a?void 0:a.useDataSources)||void 0===o?void 0:o.some(t=>t.mainDataSourceId===e))&&(s=s.concat(z(t)))})}))}return s}!function(e){e.Point="POINT",e.Polyline="POLYLINE",e.Polygon="POLYGON"}(x||(x={}));var $=s(12),_=s(37),F=function(e,t){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])})(e,t)};var P=function(){return(P=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function W(e){return Object.keys(e).some((function(t){var s=e[t];if(!s)return!1;switch(s&&s.toParam&&(s=s.toParam()),s.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function B(e){var t={};return Object.keys(e).forEach((function(s){var a,i,o=e[s];if(o&&o.toParam&&(o=o.toParam()),o||0===o||"boolean"==typeof o||"string"==typeof o){var r;switch(o.constructor.name){case"Array":var n=null===(i=null===(a=o[0])||void 0===a?void 0:a.constructor)||void 0===i?void 0:i.name;r="Array"===n?o:"Object"===n?JSON.stringify(o):o.join(",");break;case"Object":r=JSON.stringify(o);break;case"Date":r=o.valueOf();break;case"Function":r=null;break;case"Boolean":r=o+"";break;default:r=o}(r||0===r||"string"==typeof r||Array.isArray(r))&&(t[s]=r)}})),t}function H(e){var t=B(e);return Object.keys(t).map((function(e){return function e(t,s){return Array.isArray(s)&&s[0]&&Array.isArray(s[0])?s.map((function(s){return e(t,s)})).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(s)}(e,t[e])})).join("&")}var J=function(e,t,s,a,i){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=s,this.url=a,this.options=i};J.prototype=Object.create(Error.prototype),J.prototype.constructor=J;var q={httpMethod:"POST",params:{f:"json"}};var G=function(e){function t(t,s,a,i,o){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===s&&(s="AUTHENTICATION_ERROR_CODE");var r=e.call(this,t,s,a,i,o)||this;return r.name="ArcGISAuthError",r.message="AUTHENTICATION_ERROR_CODE"===s?t:s+": "+t,r}return function(e,t){function s(){this.constructor=e}F(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}(t,e),t.prototype.retry=function(e,t){var s=this;void 0===t&&(t=3);var a=0,i=function(o,r){e(s.url,s.options).then((function(e){var t=P(P({},s.options),{authentication:e});return a+=1,Q(s.url,t)})).then((function(e){o(e)})).catch((function(e){"ArcGISAuthError"===e.name&&a<t?i(o,r):"ArcGISAuthError"===e.name&&a>=t?r(s):r(e)}))};return new Promise((function(e,t){i(e,t)}))},t}(J);function Q(e,t){void 0===t&&(t={params:{f:"json"}});var s=P(P(P({httpMethod:"POST"},q),t),{params:P(P({},q.params),t.params),headers:P(P({},q.headers),t.headers)}),a=[],i=[];if(s.fetch||"undefined"==typeof fetch?(a.push("`fetch`"),i.push("`node-fetch`")):s.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(a.push("`Promise`"),i.push("`es6-promise`")),"undefined"==typeof FormData&&(a.push("`FormData`"),i.push("`isomorphic-form-data`")),!s.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+a.join(", ")+". We recommend installing the "+i.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var o=s.httpMethod,r=s.authentication,n=s.rawResponse,l=P({f:"json"},s.params),c=null,d={method:o,credentials:"same-origin"};return s.headers&&s.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(d.credentials="include"),(r?r.getToken(e,{fetch:s.fetch}).catch((function(t){return t.url=e,t.options=s,c=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(l.token=t);var a={};if("GET"===d.method){l.token&&s.hideToken&&"undefined"==typeof window&&(a["X-Esri-Authorization"]="Bearer "+l.token,delete l.token);var i=""===H(l)?e:e+"?"+H(l);s.maxUrlLength&&i.length>s.maxUrlLength||l.token&&s.hideToken?(d.method="POST",t.length&&s.hideToken&&(l.token=t,delete a["X-Esri-Authorization"])):e=i}var o=new RegExp("/items/.+/updateResources").test(e);return"POST"===d.method&&(d.body=function(e,t){var s=W(e)||t,a=B(e);if(s){var i=new FormData;return Object.keys(a).forEach((function(e){if("undefined"!=typeof Blob&&a[e]instanceof Blob){var t=a.fileName||a[e].name||e;i.append(e,a[e],t)}else i.append(e,a[e])})),i}return H(e)}(l,o)),d.headers=P(P({},a),s.headers),"undefined"!=typeof window||d.headers.referer||(d.headers.referer="@esri/arcgis-rest-js"),W(l)||o||(d.headers["Content-Type"]="application/x-www-form-urlencoded"),s.fetch(e,d)})).then((function(t){if(!t.ok){var a=t.status,i=t.statusText;throw new J(i,"HTTP "+a,t,e,s)}if(n)return t;switch(l.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==l.f&&"geojson"!==l.f||n)return t;var a=function(e,t,s,a,i){if(e.code>=400){var o=e.message,r=e.code;throw new J(o,r,e,t,a)}if(e.error){var n=e.error,l=(o=n.message,r=n.code,n.messageCode),c=l||r||"UNKNOWN_ERROR_CODE";if(498===r||499===r||"GWM_0003"===l||400===r&&"Unable to generate token."===o)throw i||new G(o,c,e,t,a);throw new J(o,c,e,t,a)}if("failed"===e.status||"failure"===e.status){o=void 0,r="UNKNOWN_ERROR_CODE";try{o=JSON.parse(e.statusMessage).message,r=JSON.parse(e.statusMessage).code}catch(t){o=e.statusMessage||e.message}throw new J(o,r,e,t,a)}return e}(t,e,0,s,c);if(c){var i=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];s.authentication.trustedServers[i]={token:[],expires:new Date(Date.now()+864e5)},c=null}return a}))}var K,X=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};function Y(e,t){switch(e){case K.SceneLayerWithoutAssociatedLayer:return null==t?void 0:t.formatMessage({id:"addDataErrorInvalidSceneLayer",defaultMessage:v.defaultMessages.addDataErrorInvalidSceneLayer});default:return null==t?void 0:t.formatMessage({id:"invalidResourceItem",defaultMessage:o.defaultMessages.invalidResourceItem})}}function Z(e,t,s){return X(this,void 0,void 0,(function*(){if(!e||!t||!e.type||e.type!==$.ItemTypes.WebMap&&e.type!==$.ItemTypes.WebScene)return yield Promise.reject(K.ItemInaccessible);const a={authentication:o.SessionManager.getInstance().getSessionByUrl(s)};return yield o.esri.restPortal.getItemData(e.id,a).then(a=>X(this,void 0,void 0,(function*(){if(!a)return null;const i=function(e,t,s){if(!e||e.type!==$.ItemTypes.WebMap&&e.type!==$.ItemTypes.WebScene)return null;return Object(o.Immutable)({type:e.type===$.ItemTypes.WebMap?S.WebMap:S.WebScene,itemId:e.id,id:t,portalUrl:s})}(e,t,s);return yield te(i,null,a,e).then(e=>({dsJson:i,dataSchema:e}))})))}))}function ee(e){return"ArcGISFeatureLayer"===(null==e?void 0:e.layerType)||(null==e?void 0:e.type)===_.SupportedLayerServiceTypes.FeatureLayer}function te(e,t,s,a){return X(this,void 0,void 0,(function*(){if(!e||!s)return yield Promise.reject(K.ItemInaccessible);const i={id:e.id,label:a.title,type:e.type,parentSchema:t},r=a.type===_.SupportedItemTypes.WebMap||a.type===_.SupportedItemTypes.WebScene,n=a.type===_.SupportedItemTypes.FeatureCollection,l=function(e,t,s){var a;const i=s.type===_.SupportedItemTypes.WebMap||s.type===_.SupportedItemTypes.WebScene,o=s.type===_.SupportedItemTypes.FeatureCollection;let r=[];e.type===S.WebMap||e.type===S.WebScene?r=t.operationalLayers||[]:e.type===S.GroupLayer&&(r=o?(null===(a=t.layers)||void 0===a?void 0:a.map(e=>e.layerDefinition))||[]:t.layers||[]);const n=Object.values(_.SupportedServiceTypes).concat(Object.values(_.SupportedLayerServiceTypes)).map(e=>e.replace(/\s+/g,"").toLowerCase().replace("server","service"));return r.filter(e=>{var t;return!!(""+(null==e?void 0:e.id)||(null===(t=e)||void 0===t?void 0:t.title)||(null==e?void 0:e.name))&&(ee(e)?i&&(e.type===_.SupportedItemTypes.FeatureCollection&&e.itemId||e.featureCollection)?"route"!==e.featureCollectionType&&"notes"!==e.featureCollectionType:!!o||!!e.url:e.layerType&&n.some(t=>e.layerType.toLowerCase().includes(t)))})}(e,s,a),c=s.tables||[],d=l.concat(c),p={},h={},u={},m={};return d.forEach(e=>{var t,s,a;e.url?p[o.dataSourceUtils.getFixedLayerIdByLayer(e)]=e.url.replace(/^http:/,"https:"):ee(e)?r&&e.itemId?h[o.dataSourceUtils.getFixedLayerIdByLayer(e)]=e.itemId:r&&e.featureCollection?u[o.dataSourceUtils.getFixedLayerIdByLayer(e)]=null===(s=null===(t=e.featureCollection)||void 0===t?void 0:t.layers)||void 0===s?void 0:s.map(e=>e.layerDefinition):n&&(u[o.dataSourceUtils.getFixedLayerIdByLayerDefinition(e)]=[e]):m[o.dataSourceUtils.getFixedLayerIdByLayer(e)]={id:e.id,name:e.title,type:(a=e.layerType,"GroupLayer"===a?_.SupportedLayerServiceTypes.GroupLayer:"ArcGISFeatureLayer"===a?_.SupportedLayerServiceTypes.FeatureLayer:null)}}),0===Object.keys(p).length&&0===Object.keys(m).length&&0===Object.keys(h).length&&0===Object.keys(u).length?Promise.resolve(i):Promise.allSettled([ae(p,e.itemId,e.portalUrl),se(h,e.portalUrl)]).then(([e,t])=>{const s="fulfilled"===e.status?e.value:{};Object.keys(s).forEach(e=>{var t;const a=d.find(t=>o.dataSourceUtils.getFixedLayerIdByLayer(t)===e);s[e].name=(null===(t=a)||void 0===t?void 0:t.title)||s[e].name});const a="fulfilled"===t.status?t.value:{},r={},n={},l=Object.assign(Object.assign({},a),u);Object.keys(l).forEach(e=>{var t,s,a,i;const c=d.find(t=>o.dataSourceUtils.getFixedLayerIdByLayer(t)===e);1===(null===(t=l[e])||void 0===t?void 0:t.length)?r[e]=Object.assign(Object.assign({},l[e][0]),{name:(null===(s=c)||void 0===s?void 0:s.title)||l[e][0].name}):(null===(a=l[e])||void 0===a?void 0:a.length)>1&&(n[e]={id:c.id,name:null===(i=c)||void 0===i?void 0:i.title,type:_.SupportedLayerServiceTypes.GroupLayer})});const c=Object.assign(Object.assign(Object.assign(Object.assign({},r),n),s),m);return Object.keys(c).length>0?(i.childSchemas={},Promise.allSettled(Object.keys(c).map(e=>X(this,void 0,void 0,(function*(){if(p[e])return yield re(ne(e,p[e],c[e]),i,c[e],p[e]);if(h[e]||u[e]){if(r[e]){const t=ne(e,null,r[e]);return yield Promise.resolve({id:t.id,label:r[e].name,type:t.type,parentSchema:i})}if(n[e]){const t=ne(e,null,n[e]),s={id:t.id,label:n[e].name,type:t.type,parentSchema:i,childSchemas:{}};return yield Promise.resolve(s)}}else if(m[e]){return function(e){return X(this,void 0,void 0,(function*(){return(null==e?void 0:e.layers)?yield ie(e.layers.map(e=>{var t;return null===(t=e.url)||void 0===t?void 0:t.replace(/^http:/,"https:")})).then(t=>Object.assign(Object.assign({},e),{layers:e.layers.map(e=>{var s;const a=t[null===(s=e.url)||void 0===s?void 0:s.replace(/^http:/,"https:")],i=o.dataSourceUtils.getFixedLayerIdByLayerDefinition(a)||e.id;return Object.assign(Object.assign({},e),{id:i})})})):Promise.resolve(e)}))}(d.find(t=>o.dataSourceUtils.getFixedLayerIdByLayer(t)===e)).then(t=>X(this,void 0,void 0,(function*(){return yield te(ne(e,p[e],c[e]),i,t,t)})))}})))).then(e=>(e.forEach(e=>{const t="fulfilled"===e.status?e.value:null;t&&(i.childSchemas[t.id]=t)}),i))):i})}))}function se(e,t){return X(this,void 0,void 0,(function*(){if(!e||0===Object.keys(e).length)return yield Promise.resolve({});const s={authentication:o.SessionManager.getInstance().getSessionByUrl(t)},a=Object.keys(e);return yield Promise.allSettled(a.map(t=>X(this,void 0,void 0,(function*(){return yield o.esri.restPortal.getItemData(e[t],s)})))).then(e=>{const t={};return e.forEach((e,s)=>{var i;const o="fulfilled"===e.status?e.value:null;o&&(t[a[s]]=null===(i=o.layers)||void 0===i?void 0:i.map(e=>null==e?void 0:e.layerDefinition))}),t})}))}function ae(e,t,s){return X(this,void 0,void 0,(function*(){if(!e||0===Object.keys(e).length)return yield Promise.resolve({});const a={},i={};Object.keys(e).forEach(t=>{o.dataSourceUtils.isSupportedSingleLayerService(e[t])?a[t]=e[t]:o.dataSourceUtils.isSupportedWholeService(e[t])&&(i[t]=e[t])});const r=Object.assign(Object.assign({},a),i);return Promise.allSettled([o.dataSourceUtils.fetchSupportedLayerDefinitionsFromUrls(Object.values(a),t,s),ie(Object.values(i))]).then(e=>{const t="fulfilled"===e[0].status?e[0].value:{},s="fulfilled"===e[1].status?e[1].value:{},a=Object.assign(Object.assign({},t),s),i={};return Object.keys(r).forEach(e=>{a[r[e]]&&(i[e]=Object.assign(Object.assign({},a[r[e]]),{url:r[e]}))}),i})}))}function ie(e){return X(this,void 0,void 0,(function*(){return e&&0!==e.length?yield Promise.allSettled(e.map(e=>X(this,void 0,void 0,(function*(){return yield o.ServiceManager.getInstance().fetchServiceInfo(e).then(e=>e.definition)})))).then(t=>{const s={};let a;return t.forEach((t,i)=>{const o="fulfilled"===t.status?t.value:null;o&&(a=e[i],s[a]=o)}),s}):yield Promise.resolve({})}))}function oe(e,t,s,a,i){return X(this,void 0,void 0,(function*(){return e&&t?(e=e.replace(/^http:/,"https:"),o.requestUtils.requestWrapper(e,r=>X(this,void 0,void 0,(function*(){return Q(e,{authentication:r,httpMethod:"GET"}).then(r=>X(this,void 0,void 0,(function*(){return yield o.ServiceManager.getInstance().fetchServiceInfo(e).then(r=>X(this,void 0,void 0,(function*(){const n=r.definition;if(!n)return yield Promise.reject(K.ItemInaccessible);let l=ne(t,e,n);return l=le(l,a,i),yield new Promise((e,t)=>l.type===o.DataSourceTypes.SceneLayer?o.dataSourceUtils.fetchAssociatedFeatureLayerUrl(l.url,l.layerId,l.itemId,l.portalUrl).then(s=>s?e(null):t(K.SceneLayerWithoutAssociatedLayer)):e(null)).then(()=>X(this,void 0,void 0,(function*(){return yield re(l,null,n,e,s).then(e=>({dsJson:l,dataSchema:e}))})))})))})))})),1)):yield Promise.reject(K.ItemInaccessible)}))}function re(e,t,s,a,i){return X(this,void 0,void 0,(function*(){if(!e||!s)return yield Promise.reject(K.ItemInaccessible);const r={id:e.id,label:i||s.name||o.dataSourceUtils.getServiceLabelFromUrl(a),type:e.type,parentSchema:t};return yield o.dataSourceUtils.fetchSupportedLayerDefinitions(e.url,s).then(e=>Object.keys(e).length>0?(r.childSchemas={},Promise.allSettled(Object.keys(e).map(t=>X(this,void 0,void 0,(function*(){var s,a;return yield re(ne(o.dataSourceUtils.fixLayerId(""+((null===(s=e[t])||void 0===s?void 0:s.name)||(null===(a=e[t])||void 0===a?void 0:a.id))),t,e[t]),r,e[t],t)})))).then(e=>(e.forEach(e=>{const t="fulfilled"===e.status?e.value:null;t&&(r.childSchemas[t.id]=t)}),r))):r)}))}function ne(e,t,s){if(!e||!s)return null;let a;return(t||s.type!==_.SupportedLayerServiceTypes.GroupLayer)&&(t||s.type!==_.SupportedLayerServiceTypes.FeatureLayer&&s.type!==_.SupportedLayerServiceTypes.Table)?o.dataSourceUtils.isSupportedSingleLayerService(t)?a=o.dataSourceUtils.getSingleDsJsonFromLayerDefinition(e,t,s):o.dataSourceUtils.isSupportedWholeService(t)&&(a=o.dataSourceUtils.getSingleDsJsonFromWholeServiceDefinition(e,t,s)):a=o.dataSourceUtils.getSingleDsJsonFromLayerDefinition(e,t,s),a}function le(e,t,s){return e?(t&&(e=e.set("portalUrl",t)),s&&(e=e.set("itemId",s)),e):null}function ce(e,t){if(!e)return null;t||(t=Object(o.Immutable)({}));let s=t.set("isHidden",!!e.isHidden).set("type",e.type).set("id",function(e){if(!e)return null;let t=e.id;for(;e.parentSchema;)t=o.dataSourceUtils.getChildDataSourceId(e.parentSchema.id,t),e=e.parentSchema;return t}(e));return e.childSchemas&&Object.keys(e.childSchemas).map(t=>{s.getIn(["childDataSourceJsons"])||(s=s.setIn(["childDataSourceJsons"],{}));const a=e.childSchemas[t].id;s=s.setIn(["childDataSourceJsons",a],ce(e.childSchemas[t],null==s?void 0:s.childDataSourceJsons[a]))}),s}function de(e){if(!e)return null;let t=e;for(;t.parentSchema;)t=t.parentSchema;return t}function pe(e,t){if(!e)return null;return ce(de(function e(t,s){if(!t)return null;const a=t;return a.isHidden=!!s,a.childSchemas&&Object.keys(a.childSchemas).map(t=>{a.childSchemas[t]=e(a.childSchemas[t],s)}),a}(e,!0)),t)}function he(e,t){if(!e)return null;return ce(de(function e(t,s){if(!t)return null;const a=t;return a.isHidden=!!s,a.parentSchema&&(a.parentSchema=e(a.parentSchema,s)),a}(e,!1)),t)}!function(e){e.ItemInaccessible="ITEM_INACCESSIBLE",e.SceneLayerWithoutAssociatedLayer="SCENE_LAYER_WITHOUT_ASSOCIATED_LAYER"}(K||(K={}));var ue=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};let me=null;var ge=class extends o.React.PureComponent{constructor(e){super(e),this.__unmounted=!1,this.dataSourceUrlTypes=[{label:this.props.intl.formatMessage({id:"anArcGISServerWebService",defaultMessage:v.defaultMessages.anArcGISServerWebService})}],this.onUrlTypesClicked=e=>{this.setState({selectedDataSourceUrlType:e.target.value})},this.onInputUrl=e=>{this.setState({url:e.target.value})},this.onAdded=()=>ue(this,void 0,void 0,(function*(){if(this.state.url){const e=this.state.url.split("?")[0];if(!e)return;return this.props.toggleLoadStatus(!1),yield oe(e,this.props.getDsId()).then(e=>{this.changeDsJsons(e),this.props.toggleLoadStatus(!0)},e=>{console.error(e),this.props.toggleToastStatus(!0,e),this.props.toggleLoadStatus(!0)})}})),this.changeDsJsons=e=>{(null==e?void 0:e.dsJson)&&this.props.onAdded(e)},this.checkServiceUrl=e=>{let t=!1;return(/^https:\/\//.test(e)||/^\/\//.test(e))&&o.dataSourceUtils.isSupportedService(e)&&(t=!0),{valid:t}},this.state={selectedDataSourceUrlType:this.dataSourceUrlTypes[0],url:"",selectDataHelpUrl:null}}componentDidMount(){this.__unmounted=!1,me||(me=o.moduleLoader.loadModule("jimu-for-builder").then(e=>e.helpUtils).then(e=>e.getBuildAppsHelpLink("select-data"))),me.then(e=>{this.__unmounted||this.setState({selectDataHelpUrl:e})})}componentWillUnmount(){this.__unmounted=!0}render(){return o.React.createElement("div",{className:"external-data-source-url-input"},o.React.createElement("div",{className:"mt-3 ml-2"},o.React.createElement("h5",{className:"url-input-label"},this.props.intl.formatMessage({id:"serviceType",defaultMessage:v.defaultMessages.serviceType})),o.React.createElement(v.Select,{value:this.state.selectedDataSourceUrlType.label,title:this.state.selectedDataSourceUrlType.label,onChange:this.onUrlTypesClicked,className:"url-type-select",buttonProps:{className:"text-truncate"}},this.dataSourceUrlTypes.map(e=>o.React.createElement("option",{key:e.label,value:e.label},e.label)))),o.React.createElement("div",{className:"mt-4 ml-2"},o.React.createElement("h5",{className:"url-input-label"},this.props.intl.formatMessage({id:"url",defaultMessage:v.defaultMessages.url})),o.React.createElement(v.TextInput,{checkValidityOnChange:this.checkServiceUrl,placeholder:"URL",onChange:this.onInputUrl,className:"url-input",value:this.state.url}),o.React.createElement("div",{className:"d-flex"},o.React.createElement("p",{className:"mt-2 hint-label"},this.props.intl.formatMessage({id:"addDataByUrlHint",defaultMessage:v.defaultMessages.addDataByUrlHint})),this.state.selectDataHelpUrl&&o.React.createElement(v.Link,{to:this.state.selectDataHelpUrl,className:"ml-2 font-size-12",target:"_blank"},this.props.intl.formatMessage({id:"details",defaultMessage:v.defaultMessages.details})))),o.React.createElement("div",{className:"mt-3 ml-2"},o.React.createElement(v.Button,{onClick:this.onAdded,type:"primary",disabled:!this.checkServiceUrl(this.state.url).valid,className:"url-input-add-btn px-3"},this.props.intl.formatMessage({id:"add",defaultMessage:v.defaultMessages.add}))))}},fe=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const Se=s(268),ve=s(38),De=s(92),be=s(93);var we=class extends o.React.PureComponent{constructor(e){var t,s;super(e),this.__unmount=!1,this.itemCategory={[$.ItemCategory.MyContent]:this.props.intl.formatMessage({id:"myContent",defaultMessage:v.defaultMessages.myContent}),[$.ItemCategory.MyGroup]:this.props.intl.formatMessage({id:"myGroup",defaultMessage:v.defaultMessages.myGroup}),[$.ItemCategory.MyOrganization]:this.props.intl.formatMessage({id:"myOrganization",defaultMessage:v.defaultMessages.myOrganization}),[$.ItemCategory.Public]:this.props.intl.formatMessage({id:"public",defaultMessage:v.defaultMessages.public}),[$.ItemCategory.LivingAtlas]:this.props.intl.formatMessage({id:"livingAtlas",defaultMessage:v.defaultMessages.livingAtlas})},this.sortField={[$.SortField.Modified]:this.props.intl.formatMessage({id:"modified",defaultMessage:v.defaultMessages.modified}),[$.SortField.Title]:this.props.intl.formatMessage({id:"title",defaultMessage:v.defaultMessages.title}),[$.SortField.Views]:this.props.intl.formatMessage({id:"numViews",defaultMessage:v.defaultMessages.numViews})},this.defaultSelectedFolder={id:null,title:this.props.intl.formatMessage({id:"allMyContent",defaultMessage:v.defaultMessages.allMyContent})},this.rootFolder={id:"root",title:(null===(s=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.user)||void 0===s?void 0:s.username)||this.props.intl.formatMessage({id:"rootFolder",defaultMessage:v.defaultMessages.rootFolder})},this.defaultFolders=[this.defaultSelectedFolder,this.rootFolder],this.defaultSelectedGroup={id:null,title:this.props.intl.formatMessage({id:"allMyGroupsContent",defaultMessage:v.defaultMessages.allMyGroupsContent})},this.onCategoryChange=e=>{this.setState({selectedCategory:e})},this.onSearchInputKeyDown=e=>{13===e.which?this.enterOrSearchIsClicked():this.enterOrSearchIsUnclicked()},this.enterOrSearchIsClicked=()=>{this.setState({isEnterOrSearchIconClicked:!0})},this.enterOrSearchIsUnclicked=()=>{this.setState({isEnterOrSearchIconClicked:!1})},this.clearSearch=()=>{this.setSearchValue(""),this.enterOrSearchIsUnclicked()},this.setSearchValue=e=>{this.setState({searchValue:e})},this.onSearchChange=e=>{this.debounceSetSearchValue(e.target.value)},this.onSortFieldChange=e=>{const t=e.target.value;this.setState({sortField:t})},this.onFolderChange=e=>{const t=e.target.value,s=this.state.folders.find(e=>e.id===t)||this.defaultSelectedFolder;this.setState({selectedFolder:s})},this.onGroupChange=e=>{const t=e.target.value,s=this.state.groups.find(e=>e.id===t)||this.defaultSelectedGroup;this.setState({selectedGroup:s})},this.onSortOrderChange=()=>{this.setState({sortOrder:this.state.sortOrder===$.SortOrder.Desc?$.SortOrder.Asc:$.SortOrder.Desc})},this.onItemAdded=(e,t)=>{this.props.onSelect(e,t)},this.onItemRemoved=(e,t)=>{this.props.onRemove(e,t)},this.debounceSetSearchValue=o.lodash.debounce(e=>this.setSearchValue(e),500),this.state={searchValue:"",sortField:$.SortField.Modified,sortOrder:$.SortOrder.Desc,isEnterOrSearchIconClicked:!1,selectedCategory:$.ItemCategory.MyContent,selectedFolder:this.defaultSelectedFolder,selectedGroup:this.defaultSelectedGroup,appServices:null,folders:this.defaultFolders,groups:[this.defaultSelectedGroup]}}componentDidMount(){this.__unmount=!1,this.setState({groups:this.getGroups()}),o.moduleLoader.loadModule("jimu-for-builder/service").then(e=>{this.__unmount||this.setState({appServices:e.appServices},()=>{this.getFolders().then(e=>!this.__unmount&&this.setState({folders:e}))})})}componentWillUnmount(){this.__unmount=!0}getGroups(){var e,t;const s=null===(t=null===(e=Object(o.getAppStore)())||void 0===e?void 0:e.getState())||void 0===t?void 0:t.user;return(null==s?void 0:s.groups)?[this.defaultSelectedGroup].concat(s.groups.asMutable({deep:!0})):[this.defaultSelectedGroup]}getFolders(){var e,t;return fe(this,void 0,void 0,(function*(){let s=this.defaultFolders;return(null===(t=null===(e=this.state)||void 0===e?void 0:e.appServices)||void 0===t?void 0:t.getFolders)?this.state.appServices.getFolders({num:1}).then(e=>(s=e?s.concat(e):s,s),e=>(console.log("Getting user content failed: ",e),s)):Promise.resolve(s)}))}render(){const e=Object(o.getAppStore)().getState().portalSelf,t=Object.assign({},$.ItemCategory);return(null==e?void 0:e.livingAtlasGroupQuery)||delete t.LivingAtlas,o.React.createElement("div",{className:"external-data-source-item-selector w-100 h-100"},Object.keys(t).map((e,s)=>{var a,i;return o.React.createElement("div",{className:Object(o.classNames)("h-100 w-100",{"d-none":$.ItemCategory[e]!==this.state.selectedCategory}),key:s},o.React.createElement("div",{className:"w-100 d-flex justify-content-between align-items-end"},o.React.createElement(v.Nav,{underline:!0},Object.keys(t).map(e=>o.React.createElement(v.NavItem,{key:e,title:this.itemCategory[$.ItemCategory[e]],className:Object(o.classNames)({"active-tab":this.state.selectedCategory===$.ItemCategory[e]})},o.React.createElement(v.NavLink,{onClick:()=>{this.onCategoryChange($.ItemCategory[e])},active:this.state.selectedCategory===$.ItemCategory[e],className:"w-100 text-truncate"},this.itemCategory[$.ItemCategory[e]])))),o.React.createElement("div",{className:"flex-grow-1 d-flex justify-content-end"},o.React.createElement("div",{className:"item-selector-search"},o.React.createElement(v.TextInput,{prefix:o.React.createElement(v.Button,{type:"tertiary",className:"search-icon",onClick:this.enterOrSearchIsClicked,icon:!0},o.React.createElement(v.Icon,{width:16,height:16,icon:Se})),suffix:o.React.createElement(v.Button,{type:"tertiary",className:Object(o.classNames)("close-icon",{"d-none":!this.state.searchValue}),onClick:this.clearSearch,icon:!0},o.React.createElement(v.Icon,{width:16,height:16,icon:ve})),onKeyDown:this.onSearchInputKeyDown,placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:o.defaultMessages.search}),onChange:this.onSearchChange,className:"search-input",value:this.state.searchValue})))),o.React.createElement("div",{className:"d-flex justify-content-between mt-30 mb-20"},o.React.createElement("div",null,this.state.selectedCategory===$.ItemCategory.MyContent&&o.React.createElement(v.Select,{value:""+this.state.selectedFolder.id,title:this.state.selectedFolder.title,onChange:this.onFolderChange,className:"d-inline-block item-selector-sort-select",buttonProps:{className:"text-truncate"}},this.state.folders.map(e=>o.React.createElement("option",{key:e.id,value:""+e.id},e.title))),this.state.selectedCategory===$.ItemCategory.MyGroup&&o.React.createElement(v.Select,{value:""+this.state.selectedGroup.id,title:this.state.selectedGroup.title,onChange:this.onGroupChange,className:"d-inline-block item-selector-sort-select",buttonProps:{className:"text-truncate"}},this.state.groups.map(e=>o.React.createElement("option",{key:e.id,value:""+e.id},e.title)))),o.React.createElement("div",{className:"d-flex justify-content-between align-items-center item-selector-sort"},o.React.createElement("div",{className:"item-selector-sort-by"},o.React.createElement("div",{className:"d-inline-block mr-2"},this.props.intl.formatMessage({id:"sortBy",defaultMessage:v.defaultMessages.sortBy})),o.React.createElement(v.Select,{value:this.state.sortField,title:this.sortField[$.SortField[this.state.sortField]],onChange:this.onSortFieldChange,className:"d-inline-block item-selector-sort-select",buttonProps:{className:"text-truncate"}},Object.keys($.SortField).map(e=>o.React.createElement("option",{key:$.SortField[e],value:$.SortField[e]},this.sortField[$.SortField[e]])))),o.React.createElement("div",{className:"item-selector-sort-order"},this.state.sortOrder===$.SortOrder.Desc?o.React.createElement(v.Button,{type:"tertiary",onClick:this.onSortOrderChange,title:this.props.intl.formatMessage({id:"decending",defaultMessage:v.defaultMessages.decending})},o.React.createElement(v.Icon,{width:16,height:16,icon:De})):o.React.createElement(v.Button,{type:"tertiary",onClick:this.onSortOrderChange,title:this.props.intl.formatMessage({id:"ascending",defaultMessage:v.defaultMessages.ascending})},o.React.createElement(v.Icon,{width:16,height:16,icon:be}))))),o.React.createElement("div",{className:"w-100 item-selector-container"},o.React.createElement($.ItemSelector,{category:$.ItemCategory[e],portalUrl:this.props.portalUrl,searchValue:this.state.searchValue.length>2||0===this.state.searchValue.length||this.state.isEnterOrSearchIconClicked?this.state.searchValue:"",itemType:this.props.itemType,getDetailPosition:this.props.getItemDetailPosition,selectedItems:this.props.selectedItems,sortField:this.state.sortField,onSelect:this.onItemAdded,onRemove:this.onItemRemoved,isRadio:this.props.isRadio,partSelectedItems:this.props.partSelectedItems,sortOrder:this.state.sortOrder,folderId:null===(a=this.state.selectedFolder)||void 0===a?void 0:a.id,groupId:null===(i=this.state.selectedGroup)||void 0===i?void 0:i.id})))}))}};const ye=s(126),Ie=s(127);class xe extends o.React.PureComponent{constructor(e){super(e),this.__unmounted=!1,this.toggleChildDss=()=>{this.setState({isOpen:!this.state.isOpen}),"boolean"==typeof this.props.isOpen&&this.props.toggle&&this.props.toggle()},this.drawCollapseLine=()=>{o.lodash.defer(()=>{var e,t;if(this.collapseRef&&this.lastNodeInCollapseRef){const s=this.lastNodeInCollapseRef.querySelector("#"+this.getUniqueId())||this.lastNodeInCollapseRef,a=window&&(null===(e=window.getComputedStyle(this.lastNodeInCollapseRef))||void 0===e?void 0:e.paddingTop),i=a?parseFloat(a)+2:0,o=window&&(null===(t=window.getComputedStyle(s))||void 0===t?void 0:t.paddingTop),r=o?parseFloat(o):0;this.__unmounted||this.setState({heightOfCollapseExceptForLastNode:this.collapseRef.offsetHeight-this.lastNodeInCollapseRef.offsetHeight+i,heightOfFirstNodeOfLastNodeInCollapse:s.offsetHeight-r})}this.props.drawCollapseLine&&this.props.drawCollapseLine()})},this.getUniqueId=()=>"first_node_in_collapse-"+xe.count,this.getSelectableChildNodes=e=>{if(!e)return[];return(this.props.getChildDataSources(e)||[]).filter(e=>this.props.isNodeSelectable(e))},this.getChildNodes=e=>{if(!e)return[];return(this.props.getChildDataSources(e)||[]).filter(e=>this.props.isNodeSelectable(e)||this.getChildNodes(e).length>0)},this.getLabel=()=>{const e=this.props.getLabel(this.props.dataSource)||this.props.dataSource.id;return this.props.label?`${this.props.label} / ${e}`:e},this.getHideLineStyle=()=>({height:this.state.heightOfCollapseExceptForLastNode+this.state.heightOfFirstNodeOfLastNodeInCollapse/2+"px"}),this.getWhetherUnselectableParentAndChildNodeCanJoin=()=>{const e=this.getChildNodes(this.props.dataSource);return!(this.getSelectableChildNodes(this.props.dataSource).length>0)&&1===e.length},this.getIsOpen=()=>"boolean"==typeof this.props.isOpen?this.props.isOpen:this.state.isOpen,this.getRenderContent=e=>{if(!this.props.dataSource)return null;const t=this.getChildNodes(this.props.dataSource),s=t.length>0,a=this.props.isNodeSelectable(this.props.dataSource);if(!a&&!s)return null;const i=this.getSelectableChildNodes(this.props.dataSource).length>0,r=this.getLabel(),n=this.getWhetherUnselectableParentAndChildNodeCanJoin(),l=!this.props.isChildTree&&n,c=t&&t.map((e,s)=>e&&e.id?o.React.createElement("div",{key:e.id,ref:e=>s===t.length-1?this.lastNodeInCollapseRef=e:void 0,className:Object(o.classNames)({"pt-3":0!==s})},this.props.getChildDataSources(e).length>0?o.React.createElement(je,Object.assign({},this.props,{dataSource:e,label:n?r:"",drawCollapseLine:this.drawCollapseLine,isChildTree:!l})):o.React.createElement("div",{className:"d-flex align-items-center"},o.React.createElement("div",{className:Object(o.classNames)("collapse-button leaf")}),o.React.createElement("div",{className:Object(o.classNames)("d-flex align-items-center w-100")},this.props.renderSelectableNode&&this.props.renderSelectableNode(e)))):null);return i||a||!n?o.React.createElement("div",null,o.React.createElement("div",{className:"d-flex align-items-center"},o.React.createElement("div",{className:Object(o.classNames)("collapse-button",{root:!this.props.isChildTree})},s&&o.React.createElement(v.Button,{type:"tertiary",icon:!0,size:"sm",onClick:this.toggleChildDss,className:"w-10 px-0 d-flex align-items-center",title:this.getIsOpen()?this.props.intl.formatMessage({id:"close",defaultMessage:o.defaultMessages.close}):this.props.intl.formatMessage({id:"open",defaultMessage:o.defaultMessages.open})},o.React.createElement(v.Icon,{icon:this.getIsOpen()?ye:Ie,size:"12"}))),o.React.createElement("div",{className:Object(o.classNames)("d-flex align-items-center w-100"),id:this.getUniqueId()},a?this.props.renderSelectableNode&&this.props.renderSelectableNode(this.props.dataSource):this.props.renderUnselectableNode&&this.props.renderUnselectableNode(r,this.props.dataSource,e))),s&&o.React.createElement(v.Collapse,{isOpen:this.getIsOpen(),className:"collapse-content",innerRef:e=>this.collapseRef=e,onEntering:this.drawCollapseLine,onExiting:this.drawCollapseLine,onEntered:this.drawCollapseLine,onExited:this.drawCollapseLine},c,o.React.createElement("div",{className:Object(o.classNames)("collapse-line",{root:!this.props.isChildTree}),style:this.getHideLineStyle()}))):s?o.React.createElement("div",null,c):null},xe.count++,this.state={isOpen:!1,heightOfFirstNodeOfLastNodeInCollapse:0,heightOfCollapseExceptForLastNode:0}}componentDidMount(){this.drawCollapseLine()}componentDidUpdate(e){this.props.isNodeSelectable!==e.isNodeSelectable&&this.drawCollapseLine()}componentWillUnmount(){this.__unmounted=!0}render(){const e=this.getWhetherUnselectableParentAndChildNodeCanJoin(),t=!this.props.isChildTree&&e,s=!this.props.isChildTree&&!t;return o.React.createElement("div",{className:Object(o.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className})},o.React.createElement("div",{className:Object(o.classNames)("component-data-source-tree",{bg:this.props.useDefaultBackground&&s&&this.getIsOpen(),"tree-root":s})},this.getRenderContent(s)))}}xe.count=-1;const je=Object(o.injectIntl)(o.themeUtils.withStyles(xe,"DataSourceTree"));var Oe=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const Me=s(269),Ce=s(38),Ne=s(172),Te=s(173),Ee=s(61),Ve=s(94);var Re;!function(e){e.WebMap="Web Map",e.WebScene="Web Scene",e.Layers="Layers",e.Url="URL"}(Re||(Re={}));const Le={[Re.WebMap]:$.ItemTypes.WebMap,[Re.WebScene]:$.ItemTypes.WebScene,[Re.Layers]:[$.ItemTypes.FeatureService,$.ItemTypes.MapService,$.ItemTypes.SceneService,$.ItemTypes.FeatureCollection]},Ae={[S.WebMap]:$.ItemTypes.WebMap,[S.WebScene]:$.ItemTypes.WebScene,[S.FeatureLayer]:[$.ItemTypes.FeatureService,$.ItemTypes.MapService,$.ItemTypes.FeatureCollection],[S.SceneLayer]:$.ItemTypes.SceneService,[S.GroupLayer]:[$.ItemTypes.FeatureService,$.ItemTypes.MapService,$.ItemTypes.SceneService,$.ItemTypes.FeatureCollection],[S.FeatureService]:$.ItemTypes.FeatureService,[S.MapService]:$.ItemTypes.MapService,[S.SceneService]:$.ItemTypes.SceneService},ke={[S.WebMap]:Re.WebMap,[S.WebScene]:Re.WebScene,[S.FeatureLayer]:[Re.Layers,Re.Url],[S.SceneLayer]:[Re.Layers,Re.Url],[S.GroupLayer]:[Re.Layers,Re.Url],[S.FeatureService]:[Re.Layers,Re.Url],[S.MapService]:[Re.Layers,Re.Url],[S.SceneService]:[Re.Layers,Re.Url]},Ue={[Re.WebMap]:s(169),[Re.WebScene]:s(170),[Re.Layers]:s(171),[Re.Url]:s(270)};class ze extends o.React.PureComponent{constructor(e){super(e),this.loadingItemNumber=0,this.tabLabel={[Re.WebMap]:this.props.intl.formatMessage({id:"webMap",defaultMessage:v.defaultMessages.webMap}),[Re.WebScene]:this.props.intl.formatMessage({id:"webScene",defaultMessage:v.defaultMessages.webScene}),[Re.Layers]:this.props.intl.formatMessage({id:"layers",defaultMessage:v.defaultMessages.layers}),[Re.Url]:this.props.intl.formatMessage({id:"url",defaultMessage:v.defaultMessages.url})},this.getTabTypeFromDsType=e=>e?Array.isArray(ke[e])?ke[e]:[ke[e]]:[],this.getTabIcon=e=>e?Ue[e]:null,this.getTabLabel=e=>e?this.tabLabel[e]:null,this.getElementPosition=e=>{if(!e)return null;let t=e.offsetLeft,s=e.offsetTop,a=e.offsetParent;for(;null!==a;)t+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent;return{x:t,y:s}},this.getItemDetailPosition=()=>{var e,t,s;if(!this.rootDom)return null;const a=this.getElementPosition(this.rootDom),i=null===(s=null===(t=null===(e=Object(o.getAppStore)())||void 0===e?void 0:e.getState())||void 0===t?void 0:t.appContext)||void 0===s?void 0:s.isRTL,r=a.x+260;return{t:"0",b:"0",l:""+(i?"auto":r+"px"),r:""+(i?r+"px":"auto"),w:"260px",h:"auto"}},this.getConfigDsId=()=>{const e=Object(o.getAppStore)().getState(),t=e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig;return o.appConfigUtils.getUniqueId(t,"dataSource")},this.getNextDsId=()=>{if(!this.dataSourceId)return this.dataSourceId=this.getConfigDsId(),this.dataSourceId;const e=this.dataSourceId.split("_"),t=e[1]?parseInt(e[1])+1:Object(o.uuidv1)(),s=e[0]||"dataSource";return this.dataSourceId=`${s}_${t}`,this.dataSourceId},this.fetchDataFromItem=e=>Oe(this,void 0,void 0,(function*(){return e?e.type===$.ItemTypes.WebMap||e.type===$.ItemTypes.WebScene?yield Z(e,this.getNextDsId(),e.portalUrl):e.type===$.ItemTypes.FeatureCollection?yield function(e,t,s){return X(this,void 0,void 0,(function*(){if(!e||!t||!e.type||e.type!==$.ItemTypes.FeatureCollection)return yield Promise.reject(K.ItemInaccessible);const a={authentication:o.SessionManager.getInstance().getSessionByUrl(s)};return yield o.esri.restPortal.getItemData(e.id,a).then(a=>X(this,void 0,void 0,(function*(){var i,r;if(!a)return yield Promise.reject(K.ItemInaccessible);let n;return 1===(null===(i=a.layers)||void 0===i?void 0:i.length)?(n=o.dataSourceUtils.getSingleDsJsonFromLayerDefinition(t,null,null===(r=a.layers[0])||void 0===r?void 0:r.layerDefinition),n=n.set("layerId","0"),n=le(n,s,e.id)):n=Object(o.Immutable)({type:o.DataSourceTypes.GroupLayer,itemId:e.id,id:t,portalUrl:s}),yield te(n,null,a,e).then(e=>({dsJson:n,dataSchema:e}))})))}))}(e,this.getNextDsId(),e.portalUrl):yield oe(e.url,this.getNextDsId(),e.title,e.portalUrl,e.id):yield Promise.resolve(null)})),this.onItemAdded=(e=[],t)=>{this.setState({selectedItems:e,partSelectedItems:this.state.partSelectedItems.filter(t=>!e.some(e=>e.id===t.id))}),this.toggleLoadStatus(!1),this.fetchDataFromItem(t).then(e=>{this.onDsJsonAdded(e),this.toggleLoadStatus(!0)},s=>{console.error(s),this.toggleLoadStatus(!0),this.toggleToastStatus(!0,s),this.setState({selectedItems:e.filter(e=>e.id!==t.id)})})},this.onItemRemoved=(e,t)=>{this.setState({selectedItems:e,partSelectedItems:this.state.partSelectedItems.filter(e=>e.id!==t.id)}),this.toggleLoadStatus(!1),this.fetchDataFromItem(t).then(e=>{this.onDsJsonRemoved(e,!0),this.toggleLoadStatus(!0)},e=>{console.error(e),this.toggleLoadStatus(!0),this.toggleToastStatus(!0,e)})},this.onDsJsonAdded=e=>{e.dsJson&&(this.props.onSelect&&this.props.onSelect([e.dsJson]),this.setState({selectedDss:this.state.selectedDss.concat(e.dsJson),dataSchemas:e.dataSchema?Object.assign(Object.assign({},this.state.dataSchemas),{[e.dataSchema.id]:e.dataSchema}):this.state.dataSchemas}))},this.onDsJsonRemoved=(e,t)=>{if(e.dsJson){this.props.onRemove&&this.props.onRemove([e.dsJson]);const s=Object.assign({},this.state.dataSchemas);delete s[e.dsJson.id],this.setState({selectedDss:this.state.selectedDss.filter(s=>t?s.itemId!==e.dsJson.itemId:s.id!==e.dsJson.id),dataSchemas:s,selectedItems:this.state.selectedItems.filter(t=>t.id!==e.dsJson.itemId),partSelectedItems:this.state.partSelectedItems.filter(t=>t.id!==e.dsJson.itemId)})}},this.onDsJsonChange=e=>{const t=this.state.selectedDss.findIndex(t=>t.id===e.id),s=this.state.selectedDss.slice();s.splice(t,1,e);const a=this.state.selectedItems.concat(this.state.partSelectedItems).find(t=>t.id===(null==e?void 0:e.itemId));let i=this.state.selectedItems,o=this.state.partSelectedItems;if(a){this.getWhetherIsPartSelected(e)?(i=this.state.selectedItems.filter(t=>e.itemId&&t.id!==e.itemId),o=this.state.partSelectedItems.concat(a)):(i=this.state.selectedItems.concat(a),o=this.state.partSelectedItems.filter(t=>e.itemId&&t.id!==e.itemId))}this.setState({selectedDss:s,selectedItems:i,partSelectedItems:o})},this.getWhetherIsPartSelected=e=>{let t=!1;if(null==e?void 0:e.childDataSourceJsons){for(let s=0;s<Object.values(e.childDataSourceJsons).length;s++)if(this.getWhetherIsPartSelected(Object.values(e.childDataSourceJsons)[s])){t=!0;break}}else t=e.isHidden;return t},this.getWhetherCurrentDsIsHidden=e=>e&&e.isHidden,this.onAddedDataCollapseClicked=()=>{this.setState({isSelectedDataCollapseOpen:!this.state.isSelectedDataCollapseOpen})},this.onFinish=()=>{this.props.onFinish&&this.props.onFinish(this.state.selectedDss)},this.onActiveTabChange=e=>{this.setState({activeTab:e})},this.toggleLoadStatus=e=>{e?this.loadingItemNumber-=1:this.loadingItemNumber+=1,this.loadingItemNumber>0?this.setState({isLoaded:!1}):this.setState({isLoaded:!0})},this.toggleToastStatus=(e,t)=>{e?this.setState({isToastOpen:e,addDataErrorCode:t},()=>{setTimeout(()=>{this.setState({isToastOpen:!1})},5e3)}):this.setState({isToastOpen:e,addDataErrorCode:t})},this.onToggleData=(e,t)=>{e&&t&&(t.isHidden?this.onDsJsonChange(he(t,e)):t.id!==e.id?this.onDsJsonChange(pe(t,e)):this.onDsJsonRemoved({dsJson:e,dataSchema:t},!1))},this.AddedItem=({rootDsJson:e,dataSchema:t})=>Object(o.jsx)("div",{className:"added-ds-item"},Object(o.jsx)(je,{dataSource:t,isNodeSelectable:()=>!0,renderSelectableNode:t=>this.renderDataItem(t,e),getChildDataSources:this.getChildData,getLabel:this.getDataLabel})),this.getChildData=e=>e&&e.childSchemas?Object.values(e.childSchemas):[],this.getDataLabel=e=>e&&(e.label||e.id),this.getItemTypes=(e,t)=>{const s=Le[t];if(e&&0!==e.length){const t=Array.from(new Set(e.asMutable().reduce((e,t)=>e.concat(Ae[t]),[])));let a=[];return t.forEach(e=>{(Array.isArray(s)?s.some(t=>t===e):e===s)&&(a=a.concat(e))}),Object(o.Immutable)(a)}return Array.isArray(s)?Object(o.Immutable)(s):s},this.renderDataItem=(e,t)=>{if(!e)return null;const s=e,a=Object(o.Immutable)({id:s.id,type:s.type,label:s.label,isHidden:s.isHidden});return Object(o.jsx)("div",{className:"d-flex align-items-center justify-content-between w-100 item"},Object(o.jsx)("div",{className:"d-flex align-items-center flex-grow-1 text-truncate",title:L(null==a?void 0:a.type,this.props.intl)},Object(o.jsx)("div",{className:"d-flex justify-content-center align-items-center flex-shrink-0 ds-thumbnail"},Object(o.jsx)(v.Icon,{icon:R(a),className:"text-dark",size:"12"})),Object(o.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type",title:this.getDataLabel(s)},this.getDataLabel(s))),Object(o.jsx)("div",{className:"d-flex align-items-center flex-shrink-0"},Object(o.jsx)(v.Button,{type:"tertiary",size:"sm",icon:!0,onClick:()=>this.onToggleData(t,s),title:(null==s?void 0:s.isHidden)?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:v.defaultMessages.clickToShow}):(null==s?void 0:s.parentSchema)?this.props.intl.formatMessage({id:"clickToHide",defaultMessage:v.defaultMessages.clickToHide}):this.props.intl.formatMessage({id:"remove",defaultMessage:v.defaultMessages.remove})},Object(o.jsx)(v.Icon,{icon:(null==s?void 0:s.isHidden)?Te:(null==s?void 0:s.parentSchema)?Ne:Ce,size:12}))))},this.state={selectedDss:[],selectedItems:[],partSelectedItems:[],activeTab:this.props.types&&this.getTabTypeFromDsType(this.props.types[0])?this.getTabTypeFromDsType(this.props.types[0])[0]:Re.WebMap,isLoaded:!0,isToastOpen:!1,isSelectedDataCollapseOpen:!1,dataSchemas:{},addDataErrorCode:null}}render(){const e=this.AddedItem,t=this.props.types?Array.from(new Set(Array.prototype.concat.apply([],this.props.types.map(e=>this.getTabTypeFromDsType(e)).filter(e=>!!e)))):Object.keys(Re).map(e=>Re[e]);return(null==t?void 0:t.length)<1?null:Object(o.jsx)("div",{className:Object(o.classNames)("h-100",{[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"w-100 component-external-data-source-selector",ref:e=>this.rootDom=e},Object(o.jsx)("div",{className:"d-flex flex-wrap align-items-stretch w-100 h-100"},Object(o.jsx)("div",{className:"selector-left"},Object(o.jsx)("h3",{className:"selector-left-title"},this.props.isRadio?this.props.intl.formatMessage({id:"selectData",defaultMessage:v.defaultMessages.selectData}):this.props.intl.formatMessage({id:"addData",defaultMessage:v.defaultMessages.addData})),Object(o.jsx)(v.Nav,{underline:!0,vertical:!0,right:!0,className:"selector-left-tabs"},t.map(e=>Object(o.jsx)(v.NavItem,{key:e,className:Object(o.classNames)("w-100 mb-2",{"active-tab":this.state.activeTab===e})},Object(o.jsx)(v.NavLink,{onClick:()=>{this.onActiveTabChange(e)},className:"d-flex"},Object(o.jsx)(v.Icon,{icon:this.getTabIcon(e),size:"16",className:"mr-2 flex-shrink-0"}),Object(o.jsx)("div",{className:"flex-grow-1 text-truncate text-left",title:this.getTabLabel(e)},this.getTabLabel(e))))))),Object(o.jsx)("div",{className:"selector-right h-100"},Object(o.jsx)("div",{className:"selector-right-header w-100 d-flex justify-content-end"},Object(o.jsx)(v.Button,{type:"tertiary",size:"sm",icon:!0,className:"close-icon",onClick:this.props.onCancel},Object(o.jsx)(v.Icon,{width:20,height:20,icon:Me}))),Object(o.jsx)("div",{className:"selector-right-body w-100"},(this.state.activeTab===Re.WebMap||this.state.activeTab===Re.WebScene||this.state.activeTab===Re.Layers)&&[Re.WebMap,Re.WebScene,Re.Layers].map((e,t)=>Object(o.jsx)("div",{className:Object(o.classNames)("inner-item-selector-container h-100 w-100",{"d-none":e!==this.state.activeTab}),key:t},Object(o.jsx)(we,{itemType:this.getItemTypes(this.props.types,e),intl:this.props.intl,portalUrl:this.props.portalUrl,isRadio:this.props.isRadio,onSelect:this.onItemAdded,onRemove:this.onItemRemoved,getItemDetailPosition:this.getItemDetailPosition,selectedItems:this.state.selectedItems,partSelectedItems:this.state.partSelectedItems}))),this.state.activeTab===Re.Url&&Object(o.jsx)(ge,{onAdded:this.onDsJsonAdded,getDsId:this.getNextDsId,intl:this.props.intl,toggleLoadStatus:this.toggleLoadStatus,toggleToastStatus:this.toggleToastStatus})))),Object(o.jsx)("div",null,this.state.selectedDss&&this.state.selectedDss.length>0&&Object(o.jsx)("div",{className:"added-ds-container py-3"},Object(o.jsx)("div",{className:"d-flex justify-content-between align-items-center px-3"},Object(o.jsx)("div",{className:"d-flex align-items-center"},Object(o.jsx)("span",{className:"mr-2"},this.state.selectedDss.length),Object(o.jsx)("span",{className:"mr-2"},this.props.intl.formatMessage({id:"selected",defaultMessage:v.defaultMessages.selected})),Object(o.jsx)(v.Button,{type:"tertiary",size:"sm",icon:!0,onClick:this.onAddedDataCollapseClicked,title:this.state.isSelectedDataCollapseOpen?this.props.intl.formatMessage({id:"down",defaultMessage:v.defaultMessages.down}):this.props.intl.formatMessage({id:"up",defaultMessage:v.defaultMessages.up})},this.state.isSelectedDataCollapseOpen?Object(o.jsx)(v.Icon,{icon:Ee,size:"12"}):Object(o.jsx)(v.Icon,{icon:Ve,size:"12"}))),Object(o.jsx)("div",{className:"small-done-btn"},!this.state.isSelectedDataCollapseOpen&&Object(o.jsx)(v.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100",disabled:!this.state.isLoaded},this.props.intl.formatMessage({id:"done",defaultMessage:v.defaultMessages.done})))),this.state.isSelectedDataCollapseOpen&&Object(o.jsx)("div",{className:"added-ds-items"},Object(o.jsx)("div",null,this.state.selectedDss.map((t,s)=>Object(o.jsx)(e,{key:s,rootDsJson:t,dataSchema:this.state.dataSchemas[t.id]})))),this.state.isSelectedDataCollapseOpen&&Object(o.jsx)("div",{className:"big-done-btn w-100 px-3"},Object(o.jsx)(v.Button,{onClick:this.onFinish,type:"primary",className:"text-truncate w-100"},this.props.intl.formatMessage({id:"done",defaultMessage:v.defaultMessages.done}))))),Object(o.jsx)("div",null,!this.state.isLoaded&&Object(o.jsx)("div",{className:"jimu-primary-loading"})),Object(o.jsx)(v.Toast,{text:Y(this.state.addDataErrorCode,this.props.intl),type:v.ToastType.Error,open:this.state.isToastOpen})))}}const $e=Object(o.injectIntl)(o.themeUtils.withStyles(ze,"ExternalDataSourceSelector"));var _e,Fe=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};function Pe(e,t){return!!e&&t.some(t=>e.type&&t===e.type)}function We(e,t){return Fe(this,void 0,void 0,(function*(){const s={};return 0===t.length?yield Promise.resolve(s):yield Promise.all(e.filter(e=>e&&e.id&&!e.getDataSourceJson().isHidden&&e.isDataSourceSet&&!e.isDataView&&!e.isLocal).map(e=>(s[e.id]||(s[e.id]=[]),function e(t,s,a){t.isDataSourceSet&&t.getChildDataSources().forEach(t=>{t&&t.getDataSourceJson()&&t.id&&(Pe(t.getDataSourceJson(),a)&&s.push(t),e(t,s,a))})}(e,s[e.id],t)))).then(()=>(Object.keys(s).forEach(e=>{0===s[e].length&&delete s[e]}),s))}))}function Be(e,t){let s=e||[];return t&&Object.keys(t).forEach(e=>{if(!s.some(t=>t.id===e)){const t=o.DataSourceManager.getInstance().getDataSource(e);t&&(s=s.concat(t))}}),s}function He(e,t){let s=e||[];return t&&Object.values(t).forEach(e=>{e&&e.length>0&&(s=s.concat(e))}),s}!function(e){e.Added="ADDED",e.Output="OUTPUT"}(_e||(_e={}));class Je extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.getWhetherdisableSelectionType=e=>e.length<=1,this.onTypeSelected=e=>{const t=e.target.value;let s;s="All"===t?null:[t],this.props.onTypeSelected(s)}}render(){const e=this.props.toUseTypes?Object(o.Immutable)(Array.from(new Set(this.props.toUseTypes.asMutable()))):Object(o.Immutable)([]);return o.React.createElement("div",{className:"d-flex justify-content-between align-items-center mb-3 to-use-types"},o.React.createElement("div",{className:"mr-2 w-25 text-truncate",title:this.props.intl.formatMessage({id:"type",defaultMessage:v.defaultMessages.type})},this.props.intl.formatMessage({id:"type",defaultMessage:v.defaultMessages.type})),this.getWhetherdisableSelectionType(e)?o.React.createElement("div",{className:"types-selected text-truncate mr-1",title:L(e[0],this.props.intl)},L(e[0],this.props.intl)):o.React.createElement(v.Select,{value:this.props.selectedTypes&&this.props.selectedTypes[0]||"All",onChange:this.onTypeSelected,className:"flex-shrink-0 to-use-dp",buttonProps:{className:"text-truncate h-100"}},(t=e.asMutable(),t.sort((e,t)=>null==e?void 0:e.localeCompare(t))).map(e=>o.React.createElement("option",{value:e,key:e},L(e,this.props.intl))),e&&e.length>1&&o.React.createElement("option",{value:"All"},this.props.intl.formatMessage({id:"all",defaultMessage:v.defaultMessages.all}))));var t}}var qe=s(18);class Ge extends o.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some(e=>((null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId))===this.props.ds.id),this.getParentWidget=e=>{var t,s,a;const i=null===(s=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig;if(!i||!e)return null;const r=null!==(a=i.widgets)&&void 0!==a?a:Object(o.Immutable)({}),n=Object.values(r).filter(e=>{var t;return e.useDataSources&&e.layouts&&(null===(t=e.manifest.properties)||void 0===t?void 0:t.passDataSourceToChildren)});if(0===n.length)return null;let l=[];return n.find(t=>(l=qe.searchUtils.getChildrenContents(i,t.id,o.LayoutItemType.Widget,!0),l&&l.some(t=>t.id===e)))||null},this.getUseDsWithoutFields=e=>{if(!e)return null;const t={};Object.keys(e).forEach(s=>{"fields"!==s&&(t[s]=e[s])})},this.getUseDs=()=>{let e={dataSourceId:this.props.ds.id,mainDataSourceId:this.props.ds.id};const t=this.getParentWidget(this.props.widgetId),s=((null==t?void 0:t.useDataSources)||[]).find(t=>{const s=o.DataSourceManager.getInstance().getDataSource(t.dataSourceId),a=s&&s.getMainDataSource();return a&&a.id===e.mainDataSourceId});if(s)e=this.getUseDsWithoutFields(s);else{const t=this.props.ds.getRootDataSource&&this.props.ds.getRootDataSource();t&&(e.rootDataSourceId=t.id)}return this.props.ds.getDataSourceJson().isOutputFromWidget&&(e.dataSourceId=o.DataSourceManager.getInstance().getDataViewDataSourceId(this.props.ds.id,o.CONSTANTS.OUTPUT_DATA_VIEW_ID),e.dataViewId=o.CONSTANTS.OUTPUT_DATA_VIEW_ID),e},this.getDsLabel=e=>{if(!e)return"";return e.getLabel()||e.id},this.onItemClick=e=>{if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(this.getUseDs())}else{if(this.props.disableSelection)return;this.onDsSelected(this.getUseDs())}},this.onDsSelected=e=>{if(!e)return;let t;t=this.props.useDataSources&&this.props.isMultiple?this.props.useDataSources.asMutable({deep:!0}).concat(e):[e],this.props.onChange&&this.props.onChange(t)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)!==e.mainDataSourceId);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){var e;if(!this.props.ds||!this.props.ds.getDataSourceJson())return null;const t=this.getWhetherSelected();return o.React.createElement("div",{onClick:this.onItemClick,className:Object(o.classNames)("ds-item",{"ds-item-selected":t,[this.props.className]:!!this.props.className})},o.React.createElement("div",{className:"d-flex align-items-center w-100 item"},o.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:L(null===(e=this.props.ds)||void 0===e?void 0:e.type,this.props.intl)},o.React.createElement(v.Icon,{icon:R(this.props.ds.getDataSourceJson()),className:"text-dark",size:"12"})),o.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},o.React.createElement("div",{className:"text-truncate ds-type-name",title:this.getDsLabel(this.props.ds)},this.getDsLabel(this.props.ds)))))}}const Qe=["widgets/arcgis/query/"];class Ke extends o.React.PureComponent{constructor(e){super(e),this.getRootNode=e=>Qe.some(t=>(null==e?void 0:e.uri)===t)?e:this.getChildNodes(e)[0],this.getChildNodes=e=>{if(e.manifest)return this.props.allToUseRootDss.map(e=>e.getDataSourceJson());{const t=o.DataSourceManager.getInstance().getDataSource(e.id);return(null==t?void 0:t.isDataSourceSet)?t.getChildDataSources().map(e=>e.getDataSourceJson()):[]}},this.getLabel=e=>e.label,this.renderUnselectableNode=(e,t)=>{const s="string"==typeof t.icon?t.icon:t.icon&&t.icon.svg,a="string"==typeof t.icon?null:t.icon&&t.icon.properties&&t.icon.properties.color;return o.React.createElement("div",{className:"d-flex w-100",title:e},o.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},o.React.createElement(v.Icon,{icon:s,color:a,size:"12"})),o.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},o.React.createElement("div",{className:"text-truncate ds-type-name"},e)))},this.renderSelectableNode=e=>{if(!e)return null;const t=o.DataSourceManager.getInstance().getDataSource(e.id);return o.React.createElement(Ge,{useDataSources:this.props.useDataSources,ds:t,widgetId:this.props.widgetId,key:t.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100"})},this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={isNodeSelectable:e=>this.props.allToUseDss.some(t=>t.id===e.id),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss!==this.props.allToUseDss&&this.setState({isNodeSelectable:e=>this.props.allToUseDss.some(t=>t.id===e.id)}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.widgetJson&&this.props.allToUseRootDss?o.React.createElement("div",{className:"mb-3"},o.React.createElement(je,{dataSource:this.getRootNode(this.props.widgetJson),isNodeSelectable:this.state.isNodeSelectable,renderSelectableNode:this.renderSelectableNode,renderUnselectableNode:this.renderUnselectableNode,useDefaultBackground:!0,getChildDataSources:this.getChildNodes,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})):null}}var Xe=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const Ye=s(174);class Ze extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{this.setSelectedType(null);const e=this.props.enableToSelectOutputDsFromSelf?null:this.props.widgetId;this.setToUseDataSources(this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,e)},this.setToUseDataSources=(e,t,s,a,i,o)=>{const r=this.getToUseRootDss(e,t,s,a,i,o);this.getToUseChildDss(e,t,s,a,i).then(e=>{const t=this.getToUseWidgets(r,e);this.__unmount||this.setState({toUseRootDss:r,toUseChildDss:e,toUseWidgets:t})})},this.setSelectedType=e=>{this.setState({selectedTypes:e})},this.getRootDss=()=>{const e=o.DataSourceManager.getInstance().getWidgetGeneratedDataSources();return Object.keys(e).forEach(t=>{e[t]=e[t].filter(e=>e&&e.id&&e.getDataSourceJson())}),e},this.getToUseWidgets=(e,t)=>o.appConfigUtils.getAllWidgets(Object(o.getAppStore)().getState().appStateInBuilder.appConfig).filter(s=>e[s.id]||this.getRootDss()[s.id]&&this.getRootDss()[s.id].some(e=>!!t[e.id])),this.getToUseRootDss=(e,t,s,a,i,o)=>{const r={};if(t)return r;const n=this.getRootDss();Object.keys(n).forEach(t=>{const o=n[t].filter(t=>t&&!t.parentDataSource&&this.props.dataSources&&this.props.dataSources[t.id]&&Pe(t.getDataSourceJson(),e)&&this.isValid(t,s,a,i));o&&o.length>0&&(r[t]||(r[t]=[]),r[t]=r[t].concat(o))});const l=z(o);return Object.keys(r).forEach(e=>{(0===r[e].length||l.some(t=>t===e))&&delete r[e]}),r},this.getToUseChildDss=(e,t,s,a,i)=>Xe(this,void 0,void 0,(function*(){let r=[];if(t)r=t.asMutable().map(e=>o.DataSourceManager.getInstance().getDataSource(e));else{const e=this.getRootDss();Object.keys(e).forEach(t=>{r=r.concat(e[t])})}return We(r,e).then(e=>{const t={};return Object.keys(e).forEach(o=>{e[o].some(e=>this.isValid(e,s,a,i))&&(t[o]=e[o].filter(e=>this.isValid(e,s,a,i)))}),t})})),this.getToUseChildDssByWidgetId=e=>{const t={};return this.getRootDss()[e].forEach(e=>{t[e.id]||(t[e.id]=[]),t[e.id]=this.state.toUseChildDss[e.id]?t[e.id].concat(this.state.toUseChildDss[e.id]):t[e.id]}),Object.keys(t).forEach(e=>{0===t[e].length&&delete t[e]}),t},this.isValid=(e,t,s,a)=>e&&e.getDataSourceJson()&&e.getDataSourceJson().isOutputFromWidget&&!e.isDataView&&!e.isLocal&&!e.getDataSourceJson().isHidden&&N(e.getLabel(),a)&&T(e.getDataSourceJson(),t,s),this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss(),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&Object.keys(this.state.toUseRootDss).length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={toUseRootDss:null,toUseChildDss:null,toUseWidgets:null,selectedTypes:null}}componentDidMount(){this.__unmount=!1,this.props.isDataSourceInited&&this.initData()}componentDidUpdate(e,t){if(this.props.isDataSourceInited){if(t.selectedTypes!==this.state.selectedTypes||e.fromRootDsIds!==this.props.fromRootDsIds||e.fromDsIds!==this.props.fromDsIds||e.searchValue!==this.props.searchValue||e.dataSources!==this.props.dataSources){const e=this.props.enableToSelectOutputDsFromSelf?null:this.props.widgetId,t=this.state.selectedTypes||this.props.types;this.setToUseDataSources(t,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue,e)}e.types===this.props.types&&e.isDataSourceInited&&e.dataSources===this.props.dataSources||this.initData(),this.state.selectedTypes||this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(_e.Output):this.props.removeDataTab(_e.Output))}}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.state.toUseChildDss||!this.state.toUseRootDss||!this.state.toUseWidgets)return null;const s=function(e){return e?e.filter(e=>!!e):Object(o.Immutable)([])}(this.props.types);return o.React.createElement("div",{className:"ds-widget-outputs h-100 w-100"},s&&s.length>0?o.React.createElement("div",{className:"pt-3 h-100"},this.props.hideTypeDropdown?null:o.React.createElement("div",{className:"ds-types"},o.React.createElement(Je,{toUseTypes:s,onTypeSelected:this.setSelectedType,selectedTypes:this.state.selectedTypes,intl:this.props.intl})),this.getWhetherShowList()?o.React.createElement("div",{className:"ds-list px-3"},this.state.toUseWidgets.map(e=>o.React.createElement(Ke,{key:e.id,widgetJson:e,allToUseDss:He(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),allToUseRootDss:Be(this.state.toUseRootDss[e.id],this.getToUseChildDssByWidgetId(e.id)),useDataSources:this.props.useDataSources,isMultiple:this.props.isMultiple,intl:this.props.intl,widgetId:this.props.widgetId,onChange:this.props.onChange,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,isSearching:!!this.props.searchValue}))):o.React.createElement("div",null,(null===(t=null===(e=Object(o.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&o.React.createElement("div",{className:"empty-placeholder w-100"},o.React.createElement("div",{className:"empty-placeholder-icon"},o.React.createElement(v.Icon,{icon:Ye,width:80,height:71})),o.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${this.props.intl.formatMessage({id:"noWidgetOutputCanBeUsed",defaultMessage:v.defaultMessages.noWidgetOutputCanBeUsed})}<br/>${this.props.intl.formatMessage({id:"pleaseAddData",defaultMessage:v.defaultMessages.pleaseAddData})}`}})))):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:v.defaultMessages.noSelectedType}))}}class et extends o.React.PureComponent{constructor(){super(...arguments),this.getWhetherSelected=()=>this.props.useDataSources&&this.props.useDataSources.some(e=>((null==e?void 0:e.mainDataSourceId)||(null==e?void 0:e.dataSourceId))===this.props.dsId),this.getUseDs=()=>({dataSourceId:this.props.dsId,mainDataSourceId:this.props.dsId}),this.onItemClick=()=>{if(this.getWhetherSelected()){if(this.props.disableRemove)return;this.onDsRemoved(this.getUseDs())}else{if(this.props.disableSelection)return;this.onDsSelected(this.getUseDs())}},this.onDsSelected=e=>{if(!e)return;let t;t=this.props.useDataSources&&this.props.isMultiple?this.props.useDataSources.asMutable({deep:!0}).concat(e):[e],this.props.onChange&&this.props.onChange(t)},this.onDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.dataSourceId)!==e.dataSourceId);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))}}render(){if(!this.props.dsId)return null;const e=this.getWhetherSelected(),t=Object(o.getAppStore)()&&Object(o.getAppStore)().getState(),s=t&&t.appStateInBuilder&&t.appStateInBuilder.appConfig&&t.appStateInBuilder.appConfig.dataSources,a=s&&s[this.props.dsId];return o.React.createElement("div",{onClick:this.onItemClick,className:Object(o.classNames)("ds-item ds-error-item",{"ds-item-selected":e,[this.props.className]:!!this.props.className})},o.React.createElement("div",{className:"d-flex align-items-center w-100 item"},o.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},o.React.createElement(v.Icon,{icon:R(a),className:"text-dark",size:"12"})),o.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},o.React.createElement("div",{className:"text-truncate ds-type-name",title:this.props.dsId},this.props.dsId))))}}class tt extends o.React.PureComponent{constructor(e){super(e),this.renderDsItem=e=>o.React.createElement(Ge,{useDataSources:this.props.useDataSources,ds:e,widgetId:this.props.widgetId,key:e.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,intl:this.props.intl,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,className:"w-100"}),this.renderDsLabel=(e,t,s)=>{const a=s?this.props.ds:t;return o.React.createElement("div",{className:"d-flex w-100"},o.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail",title:L(null==a?void 0:a.type,this.props.intl)},o.React.createElement(v.Icon,{icon:R(null==a?void 0:a.getDataSourceJson()),className:"text-dark",size:"12"})),o.React.createElement("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},o.React.createElement("div",{className:"text-truncate ds-type-name",title:e},e)))},this.getChildDataSources=e=>(null==e?void 0:e.isDataSourceSet)?e.getChildDataSources():[],this.getLabel=e=>(null==e?void 0:e.getLabel())||(null==e?void 0:e.id),this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={inAllToUseDss:e=>this.props.allToUseDss.some(t=>t.id===e.id),isOpen:this.props.isSearching}}componentDidUpdate(e){e.allToUseDss!==this.props.allToUseDss&&this.setState({inAllToUseDss:e=>this.props.allToUseDss.some(t=>t.id===e.id)}),this.props.isSearching!==e.isSearching&&this.setState({isOpen:this.props.isSearching})}render(){return this.props.ds?o.React.createElement("div",{className:"mb-3"},o.React.createElement(je,{dataSource:this.props.ds,isNodeSelectable:this.state.inAllToUseDss,renderSelectableNode:this.renderDsItem,renderUnselectableNode:this.renderDsLabel,useDefaultBackground:!0,getChildDataSources:this.getChildDataSources,getLabel:this.getLabel,isOpen:this.props.isSearching?this.state.isOpen:void 0,toggle:this.props.isSearching?this.toggle:void 0})):null}}class st extends o.React.PureComponent{constructor(e){super(e),this.dsManager=o.DataSourceManager.getInstance(),this.getWhetherShowSingleDss=()=>this.props.rootDss&&this.props.rootDss.length>0,this.getSelectedErrorDss=()=>this.props.useDataSources?this.props.useDataSources.asMutable().filter(e=>!(this.dsManager&&this.dsManager.getDataSource(null==e?void 0:e.mainDataSourceId))).map(e=>e.mainDataSourceId):null,this.state={isTypeDropdownOpen:!1,selectedErrorDss:null}}componentDidMount(){if(this.props.showErrorDss){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}componentDidUpdate(e){if(this.props.showErrorDss&&(!this.state.selectedErrorDss||0===this.state.selectedErrorDss.length)&&(!e.useDataSources||0===e.useDataSources.length)&&this.props.useDataSources&&0!==this.props.useDataSources.length){const e=this.getSelectedErrorDss();this.setState({selectedErrorDss:e}),e&&e.length>0?this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!0):this.props.changeHasErrorSelectedDss&&this.props.changeHasErrorSelectedDss(!1)}}render(){return o.React.createElement("div",{className:"ds-list px-3"},this.props.showErrorDss&&this.state.selectedErrorDss&&this.state.selectedErrorDss.map(e=>o.React.createElement(et,{useDataSources:this.props.useDataSources,dsId:e,key:e,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,className:"mb-3 ml-4",widgetId:this.props.widgetId})),this.getWhetherShowSingleDss()?o.React.createElement("div",null,o.dataSourceUtils.getSortedArrayByLabel(this.props.rootDss).map(e=>e&&e.id?o.React.createElement(tt,{useDataSources:this.props.useDataSources,ds:e,key:e.id,onChange:this.props.onChange,isMultiple:this.props.isMultiple,allToUseDss:this.props.allToUseDss,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:this.props.isSearching}):null)):null)}}var at=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const it=s(174);class ot extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.initData=()=>{this.setSelectedType(null),this.setToUseDataSources(this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue)},this.setHasErrorDss=e=>this.setState({hasErrorSelectedDss:e}),this.setToUseDataSources=(e,t,s,a,i)=>{const o=this.getToUseRootDss(e,t,s,a,i);this.getToUseChildDss(e,t,s,a,i).then(e=>{this.__unmount||this.setState({toUseRootDss:o,toUseChildDss:e})})},this.setSelectedType=e=>{this.setState({selectedTypes:e})},this.getRootDss=()=>o.DataSourceManager.getInstance().getConfiguredDataSources().filter(e=>e&&e.id&&e.getDataSourceJson()&&!e.parentDataSource),this.getToUseRootDss=(e,t,s,a,i)=>t?[]:o.DataSourceManager.getInstance().getConfiguredDataSources().filter(t=>t&&!t.parentDataSource&&this.props.dataSources&&this.props.dataSources[t.id]&&Pe(t.getDataSourceJson(),e)&&this.isValid(t,s,a,i)),this.getToUseChildDss=(e,t,s,a,i)=>at(this,void 0,void 0,(function*(){let r;return r=t?t.asMutable().map(e=>o.DataSourceManager.getInstance().getDataSource(e)):this.getRootDss(),We(r,e).then(e=>{const t={};return Object.keys(e).forEach(o=>{e[o].some(e=>this.isValid(e,s,a,i))&&(t[o]=e[o].filter(e=>this.isValid(e,s,a,i)))}),t})})),this.isValid=(e,t,s,a)=>e&&e.getDataSourceJson()&&!e.getDataSourceJson().isOutputFromWidget&&!e.isDataView&&!e.isLocal&&!e.getDataSourceJson().isHidden&&N(e.getLabel(),a)&&T(e.getDataSourceJson(),t,s),this.getWhetherShowList=()=>this.getWhetherShowRootDss()||this.getWhetherShowChildDss()||!(!this.state.hasErrorSelectedDss||!this.props.useDataSources),this.getWhetherShowRootDss=()=>this.state.toUseRootDss&&this.state.toUseRootDss.length>0,this.getWhetherShowChildDss=()=>this.state.toUseChildDss&&Object.keys(this.state.toUseChildDss).length>0,this.state={selectedTypes:null,toUseRootDss:null,toUseChildDss:null,hasErrorSelectedDss:!0}}componentDidMount(){this.__unmount=!1,this.props.isDataSourceInited&&this.initData()}componentDidUpdate(e,t){this.props.isDataSourceInited&&(t.selectedTypes===this.state.selectedTypes&&e.fromRootDsIds===this.props.fromRootDsIds&&e.fromDsIds===this.props.fromDsIds&&e.searchValue===this.props.searchValue&&e.dataSources===this.props.dataSources||(this.state.selectedTypes?this.setToUseDataSources(this.state.selectedTypes,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue):this.setToUseDataSources(this.props.types,this.props.fromRootDsIds,this.props.fromDsIds,this.props.hideDs,this.props.searchValue)),e.types===this.props.types&&e.isDataSourceInited&&e.dataSources===this.props.dataSources||this.initData(),this.state.selectedTypes||this.state.toUseRootDss===t.toUseRootDss&&this.state.toUseChildDss===t.toUseChildDss||(this.getWhetherShowList()?this.props.addDataTab(_e.Added):this.props.removeDataTab(_e.Added)))}componentWillUnmount(){this.__unmount=!0}render(){var e,t;const s=function(e){return e?e.filter(e=>!!e):Object(o.Immutable)([])}(this.props.types);return o.React.createElement("div",{className:"ds-added-data h-100 w-100"},s&&s.length>0?o.React.createElement("div",{className:"pt-3 h-100"},!this.props.hideTypeDropdown&&o.React.createElement("div",{className:"ds-types"},o.React.createElement(Je,{toUseTypes:s,onTypeSelected:this.setSelectedType,selectedTypes:this.state.selectedTypes,intl:this.props.intl})),this.getWhetherShowList()?o.React.createElement(st,{rootDss:Be(this.state.toUseRootDss,this.state.toUseChildDss),allToUseDss:He(this.state.toUseRootDss,this.state.toUseChildDss),onChange:this.props.onChange,isMultiple:this.props.isMultiple,changeHasErrorSelectedDss:this.setHasErrorDss,useDataSources:this.props.useDataSources,showErrorDss:!0,disableRemove:this.props.disableRemove,disableSelection:this.props.disableSelection,intl:this.props.intl,widgetId:this.props.widgetId,isSearching:!!this.props.searchValue}):o.React.createElement("div",null,(null===(t=null===(e=Object(o.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&this.props.isDataSourceInited&&o.React.createElement("div",{className:"empty-placeholder w-100"},o.React.createElement("div",{className:"empty-placeholder-icon"},o.React.createElement(v.Icon,{icon:it,width:80,height:71})),o.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:`${this.props.intl.formatMessage({id:"noAddedDataSourceCanBeUsed",defaultMessage:v.defaultMessages.noAddedDataSourceCanBeUsed})}<br/>${this.props.intl.formatMessage({id:"pleaseAddData",defaultMessage:v.defaultMessages.pleaseAddData})}`}})))):this.props.intl.formatMessage({id:"noSelectedType",defaultMessage:v.defaultMessages.noSelectedType}))}}var rt=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const nt=s(271),lt=s(102);class ct extends o.React.PureComponent{constructor(e){super(e),this.externalDsStyle={width:"100%",height:"100%",maxWidth:"5000px",margin:0},this.__unmount=!1,this.showExternalDs=()=>{this.setState({isExternalDsShown:!0})},this.addDataTab=e=>{this.state.dataTabs.some(t=>t===e)||this.setState({dataTabs:this.state.dataTabs.concat(e)})},this.removeDataTab=e=>{this.state.dataTabs.some(t=>t===e)&&this.setState({dataTabs:this.state.dataTabs.filter(t=>t!==e)})},this.onSelectDataFinished=e=>{if(e)if(this.state.getAppConfigAction){(0,this.state.getAppConfigAction)().addDataSources(e).exec(),e.map(e=>rt(this,void 0,void 0,(function*(){return yield o.DataSourceManager.getInstance().createDataSource(e)}))),this.props.changeInitStatus&&this.props.changeInitStatus(!1),this.setState({isExternalDsShown:!1})}else console.error("Can not load jimu-for-builder");else this.setState({isExternalDsShown:!1})},this.onSelectDataCanceled=()=>{this.setState({isExternalDsShown:!1})},this.onToggleExternalDs=()=>{this.setState({isExternalDsShown:!this.state.isExternalDsShown})},this.onSearchValueChange=e=>{this.setState({searchValue:e.target.value})},this.ExternalDs=Object(o.jsx)($e,{portalUrl:Object(o.getAppStore)().getState().portalUrl,onCancel:this.onSelectDataCanceled,onFinish:this.onSelectDataFinished,types:this.props.types&&this.props.types.some(e=>e===S.FeatureLayer)?null:this.props.types}),this.state={isExternalDsShown:!1,getAppConfigAction:null,searchValue:"",dataTabs:[_e.Added,_e.Output]}}componentDidMount(){this.__unmount=!1,o.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})})}componentWillUnmount(){this.__unmount=!0}render(){const e=Object(o.jsx)(ot,{types:this.props.types,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,widgetId:this.props.widgetId,searchValue:this.state.searchValue,fromDsIds:this.props.fromDsIds,dataSources:this.props.dataSources,hideDs:this.props.hideDs,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab}),t=Object(o.jsx)(Ze,{types:this.props.types,isDataSourceInited:this.props.isDataSourceInited,useDataSources:this.props.useDataSources,onChange:this.props.onChange,isMultiple:this.props.isMultiple,disableSelection:this.props.disableSelection,disableRemove:this.props.disableRemove,intl:this.props.intl,fromRootDsIds:this.props.fromRootDsIds,hideTypeDropdown:this.props.hideTypeDropdown,searchValue:this.state.searchValue,dataSources:this.props.dataSources,widgetId:this.props.widgetId,fromDsIds:this.props.fromDsIds,hideDs:this.props.hideDs,enableToSelectOutputDsFromSelf:this.props.enableToSelectOutputDsFromSelf,removeDataTab:this.removeDataTab,addDataTab:this.addDataTab}),s=Object(o.jsx)(v.Tabs,{type:"pills",fill:!0,className:"mt-3",defaultValue:"added"},Object(o.jsx)(v.Tab,{id:"added",title:this.props.intl.formatMessage({id:"added",defaultMessage:v.defaultMessages.added})},e),Object(o.jsx)(v.Tab,{id:"outputs",title:this.props.intl.formatMessage({id:"outputs",defaultMessage:v.defaultMessages.outputs})},t)),a=1===this.state.dataTabs.length&&this.state.dataTabs[0]===_e.Added,i=1===this.state.dataTabs.length&&this.state.dataTabs[0]===_e.Output;return Object(o.jsx)("div",{className:Object(o.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"component-data-source-list h-100 w-100"},!this.props.hideHeader&&Object(o.jsx)("div",{className:"ds-list-header jimu-widget-setting--header d-flex px-3 py-0",title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:v.defaultMessages.setDataSource})},Object(o.jsx)(v.PanelHeader,{level:1,className:"py-3",showClose:!!this.props.onCloseClick,onClose:this.props.onCloseClick,title:this.props.intl.formatMessage({id:"setDataSource",defaultMessage:v.defaultMessages.setDataSource})})),Object(o.jsx)("div",{className:"w-100 px-3 search"},Object(o.jsx)(v.TextInput,{prefix:Object(o.jsx)(v.Icon,{icon:lt,size:16,className:"search-icon"}),value:this.state.searchValue,onChange:this.onSearchValueChange,className:"search-input",placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:o.defaultMessages.search})})),Object(o.jsx)("div",{className:"w-100 ds-list-container"},Object(o.jsx)("div",{className:"ds-list-tabs h-100"},a?Object(o.jsx)("div",{className:"h-100"},e,Object(o.jsx)("div",{className:"d-none"},t)):Object(o.jsx)("div",{className:"h-100"},i?Object(o.jsx)("div",{className:"h-100"},t,Object(o.jsx)("div",{className:"d-none"},e)):s)),!this.props.disableAddData&&Object(o.jsx)("div",{className:" d-flex align-items-center px-3 ds-add-data",onClick:this.showExternalDs},Object(o.jsx)("div",{className:"add-data-icon-container d-flex align-items-center justify-content-center mr-2"},Object(o.jsx)(v.Icon,{icon:nt,size:12,className:"add-data-icon"})),Object(o.jsx)("div",{className:"text-truncate flex-grow-1"},this.props.intl.formatMessage({id:"addNewData",defaultMessage:v.defaultMessages.addNewData})))),this.props.isDataSourceInited?null:Object(o.jsx)("div",{className:"jimu-secondary-loading"})),this.state.isExternalDsShown?Object(o.jsx)(v.Modal,{isOpen:this.state.isExternalDsShown,style:this.externalDsStyle,toggle:this.onToggleExternalDs,contentClassName:"h-100",className:"widget-ds-setting-add-data-popup"},this.ExternalDs):null)}}const dt=Object(o.injectIntl)(o.themeUtils.withStyles(o.ReactRedux.connect(e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources}))(ct),"DataSourceList"));var pt,ht=function(e,t,s,a){return new(s||(s=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function n(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};!function(e){e.DataSourceRemoved="DATA_SOURCE_REMOVED",e.SourceWidgetRemoved="SOURCE_WIDGET_REMOVED"}(pt||(pt={}));class ut extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.onCloseRemoveOptions=e=>{this.stopPropagation(e),this.props.toggle()},this.onCheckboxBtnClick=(e,t)=>{this.stopPropagation(t);const s=this.state.selectedWidgets.indexOf(e);s<0?this.state.selectedWidgets.push(e):this.state.selectedWidgets.splice(s,1),this.setState({selectedWidgets:[...this.state.selectedWidgets]})},this.onRemove=e=>ht(this,void 0,void 0,(function*(){var t,s,a;if(this.stopPropagation(e),this.state.getAppConfigAction){this.props.beforeRemoving&&this.props.beforeRemoving();const e=this.state.getAppConfigAction();if(this.state.selectedWidgets.length>0&&this.state.selectedWidgets.forEach((t,s)=>{e.removeWidget(t)}),this.props.dataSourceId){const i=o.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId);if(null==i?void 0:i.isDataView){const t=i.getDataSourceJson(),s=i.dataViewId;let a=t.dataViews||Object(o.Immutable)({});a=a.without(s);const r=k(t.setIn(["dataViews"],a));e.editDataSource(r).exec()}else{const r=null===(t=Object(o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig.appProxies;let n={};const l=[],c=[];let d;n=(null===(s=this.state.proxySettingUtils)||void 0===s?void 0:s.traverseToGetNeedProxyDataSources)?yield this.state.proxySettingUtils.traverseToGetNeedProxyDataSources(i):{},Object.keys(n).forEach(e=>{var t;d=null===(t=this.state.proxySettingUtils)||void 0===t?void 0:t.getProxyJsonFromSourceUrl(e,r),d&&(c.push(d.id),l.push(d.proxyId))}),e.removeDataSource(this.props.dataSourceId).exec(),null===(a=this.state.proxySettingUtils)||void 0===a||a.deleteProxies(l,e).then(()=>{c.forEach(t=>{e.removeAppProxy(t)}),e.exec()})}}else e.removeWidget(this.props.widgetId),e.exec();this.props.afterRemoving&&this.props.afterRemoving()}this.props.toggle()})),this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.state={selectedWidgets:[],getAppConfigAction:null,proxySettingUtils:null}}componentDidMount(){this.__unmount=!1,Promise.all([o.moduleLoader.loadModule("jimu-for-builder"),o.moduleLoader.loadModule("jimu-ui/advanced/setting-components")]).then(e=>{const[{getAppConfigAction:t},{proxySettingUtils:s}]=e;this.__unmount||this.setState({getAppConfigAction:t,proxySettingUtils:s})})}componentWillUnmount(){this.__unmount=!0}render(){var e,t;if(!this.props.reason||!this.props.dataSourceId&&!this.props.widgetId)return null;const s=o.DataSourceManager.getInstance().getDataSource(this.props.dataSourceId),a=null===(e=this.props.widgets)||void 0===e?void 0:e[this.props.widgetId],i=this.props.label||(this.props.dataSourceId?(null==s?void 0:s.getLabel())||this.props.dataSourceId:(null==a?void 0:a.label)||this.props.widgetId);let r=[];if(this.props.dataSourceId)r=O(this.props.dataSourceId,this.props.widgets);else{const e=null==a?void 0:a.outputDataSources;(null==e?void 0:e.length)>0&&e.forEach(e=>{O(e,this.props.widgets).forEach(e=>{r.some(t=>e.id===t.id)||(r=r.concat(e))})})}const n=this.props.reason===pt.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:v.defaultMessages.removeDataSource}):this.props.intl.formatMessage({id:"outputDataWillBeRemovedTogether",defaultMessage:v.defaultMessages.outputDataWillBeRemovedTogether}),l=this.props.reason===pt.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataWarningTip",defaultMessage:v.defaultMessages.removeDataWarningTip}):this.props.intl.formatMessage({id:"removeSourceWidgetWarningTip",defaultMessage:v.defaultMessages.removeSourceWidgetWarningTip},{widgetName:i}),c=this.props.reason===pt.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataAffectedWidgets",defaultMessage:v.defaultMessages.removeDataAffectedWidgets}):this.props.intl.formatMessage({id:"removeSourceWidgetAffectedWidgets",defaultMessage:v.defaultMessages.removeSourceWidgetAffectedWidgets}),d=this.props.reason===pt.DataSourceRemoved?this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:v.defaultMessages.removeDataSource}):this.props.intl.formatMessage({id:"delete",defaultMessage:o.defaultMessages.delete});return Object(o.jsx)(v.Modal,{isOpen:this.props.isOpen,className:Object(o.classNames)("bg-light-300 d-flex justify-content-between",{[this.props.className]:!!this.props.className}),onClick:this.stopPropagation},Object(o.jsx)(v.ModalHeader,{className:"d-flex justify-content-between border-color-gray-300 py-3 font-16 font-dark-600",onClick:this.stopPropagation,toggle:this.props.toggle},n),Object(o.jsx)(v.ModalBody,{onClick:this.stopPropagation},Object(o.jsx)("div",{className:"px-2 py-0"},Object(o.jsx)("p",{className:"font-13 font-dark-600","data-testid":"confirmDeleteMessage"},l),this.props.reason===pt.DataSourceRemoved?Object(o.jsx)("p",{className:"font-14 font-dark-800 mt-3"},i):Object(o.jsx)("div",{className:"related-outputs px-2 py-3"},null===(t=null==a?void 0:a.outputDataSources)||void 0===t?void 0:t.map(e=>{var t;return Object(o.jsx)("div",{className:"font-13 font-dark-800 output-ds-label",key:e},(null===(t=o.DataSourceManager.getInstance().getDataSource(e))||void 0===t?void 0:t.getLabel())||e)})),Object(o.jsx)("p",{className:"font-13 font-dark-600 mt-3"},c),Object(o.jsx)("p",{className:"font-14 font-dark-400 mt-3"},this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:v.defaultMessages.relatedWidgets})),Object(o.jsx)("div",{className:"related-widgets px-2 py-3"},Object(o.jsx)("div",null,r.map(e=>e&&e.id?Object(o.jsx)(v.Label,{key:e.id,className:"d-flex"},Object(o.jsx)(v.Checkbox,{className:"mr-2 font-13",onClick:t=>this.onCheckboxBtnClick(e.id,t),checked:this.state.selectedWidgets.includes(e.id)}),Object(o.jsx)(v.Icon,{icon:e.icon,size:"16",className:"mr-1 font-dark-800"}),e.label):null))),Object(o.jsx)("p",{className:"font-13 font-dark-600 mt-2 mb-0"},this.props.intl.formatMessage({id:"howToRemoveWidgetsTip",defaultMessage:v.defaultMessages.howToRemoveWidgetsTip})))),Object(o.jsx)(v.ModalFooter,null,Object(o.jsx)("div",{className:"d-flex justify-content-end mt-10"},Object(o.jsx)(v.Button,{type:"primary",className:"mr-2",onClick:this.onRemove},d),Object(o.jsx)(v.Button,{type:"default",onClick:this.onCloseRemoveOptions},this.props.intl.formatMessage({id:"cancel",defaultMessage:o.defaultMessages.cancel})))))}}const mt=o.ReactRedux.connect((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}})(ut),gt=Object(o.injectIntl)(o.themeUtils.withStyles(mt,"DataSourceRemoveWarningPopup")),ft=s(67),St=s(95),vt=s(272),Dt=s(273);class bt extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.lastScrollTop=0,this.initQueryParams=()=>{this.setState({queryParams:{page:1,pageSize:"number"==typeof this.state.dataView.maximum?Math.min(this.state.dataView.maximum,15):15}})},this.setQueryParams=()=>{const e=this.state.dataView,t="number"==typeof(null==e?void 0:e.maximum)?e.maximum<=15?1:Math.ceil(e.maximum/15):null,s="number"==typeof(null==e?void 0:e.maximum)?Math.min(e.maximum,15):15;let a=this.state.queryParams.page;t?a+1<=t&&(a+=1):a+=1,this.setState({queryParams:{page:a,pageSize:s}})},this.setLocalDataSource=()=>{var e,t,s,a;this.setState({isLocalDataSourceCreated:!1});const i=null===(e=this.state.dataView)||void 0===e?void 0:e.set("orderBy",null===(s=null===(t=this.state.dataView)||void 0===t?void 0:t.orderBy)||void 0===s?void 0:s.filter(e=>!!e.jimuFieldName)),r=this.props.mainDataSource.getDataSourceJson().set("id",this.getLocalLoadId()).set("query",i).set("isHidden",!0).without("dataViews"),n=o.DataSourceManager.getInstance().getDataSource(this.getLocalLoadId());n?(o.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(n,r),o.lodash.defer(()=>{!this.__unmount&&this.props.isOpen&&this.setState({localDataSource:n,isLocalDataSourceCreated:!0})})):o.DataSourceManager.getInstance().createDataSource({id:r.id,dataSourceJson:r,layer:null===(a=this.props.mainDataSource)||void 0===a?void 0:a.layer}).then(e=>{!this.__unmount&&this.props.isOpen&&this.setState({localDataSource:e,isLocalDataSourceCreated:!0})},e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceCreated:!0})})},this.loadLocalDataSource=()=>{if(!this.state.localDataSource)return;this.setState({isLocalDataSourceLoaded:!1});let e=Object.assign({page:1,pageSize:this.state.queryParams.page*this.state.queryParams.pageSize},{outFields:["*"]});if(!this.props.isSettingMainDataSource){const t=this.props.mainDataSource.getConfigQueryParams()||{};delete t.orderByFields,e=this.props.mainDataSource.mergeQueryParams(t,e)}this.state.localDataSource.load(e,{widgetId:this.getLocalLoadId(),scope:o.QueryScope.InConfigView}).then(()=>{!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceLoaded:!0})},e=>{console.error("Preview table error: ",e),!this.__unmount&&this.props.isOpen&&this.setState({isLocalDataSourceLoaded:!0})})},this.getUseDataSource=e=>{if(!e)return null;const t=e.getRootDataSource(),s=e.getMainDataSource();return Object(o.Immutable)({dataSourceId:e.id,rootDataSourceId:t&&t.id,mainDataSourceId:s&&s.id})},this.getNewDataView=e=>{if(!e)return Object(o.Immutable)({});const t=e.getDataSourceJson(),s=(null==t?void 0:t.dataViews)?Object.keys(t.dataViews):null,a=s&&s.map(e=>e.split("_")[1]).filter(e=>this.isNumeric(e)).length>0?Math.max.apply(null,s.map(e=>e.split("_")[1]).filter(e=>this.isNumeric(e)))+1:1;return Object(o.Immutable)({id:this.props.newDataViewId||"dataView_"+a,label:this.props.newDataViewLabel||`${this.props.intl.formatMessage({id:"dataView",defaultMessage:v.defaultMessages.dataView})} ${a}`})},this.getPreviewTable=e=>{var t;const s=null===(t=e)||void 0===t?void 0:t.getRecordsByPage(1,this.state.queryParams.pageSize*this.state.queryParams.page),a=null==e?void 0:e.getSchema(),i=null==a?void 0:a.fields;if(!s||!i)return null;const r=Object.values(i).sort((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)});return Object(o.jsx)("div",{className:"table-container mr-2",onScroll:this.onScroll},Object(o.jsx)("div",{className:"table-header"},Object(o.jsx)("table",null,Object(o.jsx)("thead",null,Object(o.jsx)("tr",{className:"d-flex"},r.map((e,t)=>Object(o.jsx)("th",{key:t,title:e.alias||e.name},e.alias||e.name)))))),Object(o.jsx)("div",{className:"table-body"},Object(o.jsx)("table",null,Object(o.jsx)("tbody",null,s.map((e,t)=>Object(o.jsx)("tr",{className:"d-flex",key:t},r.map((t,s)=>{const a=e.getFormattedFieldValue(t.jimuName,this.props.intl);return Object(o.jsx)("td",{key:s,title:a},a)})))))))},this.isNumeric=e=>!isNaN(parseFloat(e))&&isFinite(e),this.onScroll=e=>{const t=e.target.clientHeight,s=e.target.scrollHeight,a=e.target.scrollTop,i=s-(t+a)<=10,o=a>this.lastScrollTop;this.lastScrollTop=a<=0?0:a,this.state.isLocalDataSourceCreated&&this.state.isLocalDataSourceLoaded&&i&&o&&this.setQueryParams()},this.onDuplicate=()=>{var e;if(!this.props.onDuplicate)return;let t=this.getNewDataView(this.props.mainDataSource);t=this.props.dataView?this.props.dataView.merge(t.asMutable({deep:!0})):t,(null===(e=this.props.dataView)||void 0===e?void 0:e.label)&&(t=t.set("label",this.getDuplicateLabel(this.props.dataView.label))),this.props.onDuplicate(t)},this.onRemove=e=>{var t,s,a;e.stopPropagation(),e.nativeEvent.stopImmediatePropagation();const i=o.DataSourceManager.getInstance().getDataViewDataSourceId(null===(t=this.props.mainDataSource)||void 0===t?void 0:t.id,null===(s=this.props.dataView)||void 0===s?void 0:s.id);0===O(i,this.props.widgets).length?(this.state.getAppConfigAction&&(this.removeDataView(null===(a=this.props.dataView)||void 0===a?void 0:a.id),o.DataSourceManager.getInstance().destroyDataSource(i)),this.props.toggle()):this.setState({isRemoveWarningOpen:!0},()=>this.props.toggle())},this.removeDataView=e=>{var t;if(!e||!this.state.getAppConfigAction)return;const s=null===(t=this.props.mainDataSource)||void 0===t?void 0:t.getDataSourceJson();let a=s.dataViews||Object(o.Immutable)({});a=a.without(e);const i=k(s.setIn(["dataViews"],a));this.state.getAppConfigAction().editDataSource(i).exec()},this.onLabelChange=e=>{let t=this.state.dataView;t=t.set("label",e.target.value),this.setState({dataView:t})},this.onSqlExprBuilderChange=e=>{let t=this.state.dataView;t=t.set("where",e),this.setState({dataView:t})},this.onSortChange=(e,t)=>{let s=this.state.dataView;s=s.set("orderBy",e),this.setState({dataView:s})},this.onPageSizeChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("pageSize",s):t.without("pageSize"),this.setState({dataView:t})},this.onToggleMaximum=(e,t)=>{let s=this.state.dataView;s=t?s.set("maximum",100):s.without("maximum"),this.setState({dataView:s})},this.onMaximumChange=e=>{let t=this.state.dataView;const s="string"==typeof e?parseInt(e):e;t=s&&s>=1?t.set("maximum",s):t.set("maximum",100),this.setState({dataView:t})},this.onApply=()=>{var e;let t=this.state.dataView;t=null==t?void 0:t.set("orderBy",null===(e=null==t?void 0:t.orderBy)||void 0===e?void 0:e.filter(e=>!!e.jimuFieldName)),this.props.onApply(t)},this.toggleTitleInput=()=>{this.setState({isTitleInputShown:!this.state.isTitleInputShown})},this.toggleRemoveWarning=()=>{this.setState({isRemoveWarningOpen:!this.state.isRemoveWarningOpen})},bt.count++;const t=this.props.dataView||this.getNewDataView(this.props.mainDataSource);this.state={dataView:t,localDataSource:null,isTitleInputShown:!1,isRemoveWarningOpen:!1,isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,SqlExpressionBuilder:null,Sort:null,getAppConfigAction:null,isSqlExpressionValid:null,queryParams:{page:1,pageSize:"number"==typeof(null==t?void 0:t.maximum)?Math.min(t.maximum,15):15}}}componentDidMount(){this.__unmount=!1,Promise.all([o.moduleLoader.loadModule("jimu-ui/advanced/sql-expression-builder"),o.moduleLoader.loadModule("jimu-ui/basic/sql-expression-runtime"),o.moduleLoader.loadModule("jimu-for-builder")]).then(e=>{const[t,{isSqlExpressionValid:s},{getAppConfigAction:a}]=e;this.__unmount||this.setState({SqlExpressionBuilder:t.SqlExpressionBuilder,Sort:t.Sort,getAppConfigAction:a,isSqlExpressionValid:s})}),this.props.isOpen&&this.setLocalDataSource()}componentDidUpdate(e,t){var s,a,i,r;o.lodash.isDeepEqual(e.dataView,this.props.dataView)?this.props.isOpen&&(this.state.localDataSource&&e.mainDataSource===this.props.mainDataSource&&o.lodash.isDeepEqual(null===(s=t.dataView)||void 0===s?void 0:s.without("label"),null===(a=this.state.dataView)||void 0===a?void 0:a.without("label"))||this.setLocalDataSource(),(!o.lodash.isDeepEqual(t.queryParams,this.state.queryParams)||!t.isLocalDataSourceCreated&&this.state.isLocalDataSourceCreated)&&this.loadLocalDataSource()):(this.initQueryParams(),this.setState({dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)})),(null===(i=t.dataView)||void 0===i?void 0:i.maximum)!==(null===(r=this.state.dataView)||void 0===r?void 0:r.maximum)&&this.initQueryParams(),e.isOpen&&!this.props.isOpen&&this.destroyLocalDataSource(),t.isTitleInputShown!==this.state.isTitleInputShown&&this.state.isTitleInputShown&&this.titleInput&&(this.titleInput.focus(),this.titleInput.select())}componentWillUnmount(){this.__unmount=!0,this.destroyLocalDataSource()}destroyLocalDataSource(){this.state.localDataSource&&o.DataSourceManager.getInstance().destroyDataSource(this.state.localDataSource.id),this.__unmount||(this.setState({isLocalDataSourceCreated:!1,isLocalDataSourceLoaded:!1,localDataSource:null,dataView:this.props.dataView||this.getNewDataView(this.props.mainDataSource)}),this.initQueryParams())}getLocalLoadId(){return"DATA_VIEW_SETTING-"+bt.count}getDuplicateLabel(e){var t;const s=null===(t=this.props.intl.formatMessage({id:"copy",defaultMessage:v.defaultMessages.copy}))||void 0===t?void 0:t.toLocaleLowerCase();let a=`${e} ${s}`,i=1;for(;this.props.mainDataSource.getDataSourceJson().dataViews&&Object.keys(this.props.mainDataSource.getDataSourceJson().dataViews).find(e=>{var t;return(null===(t=this.props.mainDataSource.getDataSourceJson().dataViews[e])||void 0===t?void 0:t.label)===a});)i++,a=`${e} ${s} ${i}`;return a}render(){var e,t,s,a;if(!this.props.mainDataSource.query)return null;const i=this.state.dataView,r=o.DataSourceManager.getInstance().getDataViewDataSourceId(null===(e=this.props.mainDataSource)||void 0===e?void 0:e.id,null===(t=this.props.dataView)||void 0===t?void 0:t.id),n=this.state.SqlExpressionBuilder,l=this.state.Sort;return Object(o.jsx)("div",null,Object(o.jsx)(v.Modal,{className:Object(o.classNames)({[this.props.className]:!!this.props.className}),isOpen:this.props.isOpen,centered:!0,toggle:this.props.toggle,returnfocusafterclose:"true",contentClassName:"data-view-container",backdrop:"static"},Object(o.jsx)(v.ModalHeader,{className:"d-flex justify-content-between align-items-center header"},Object(o.jsx)("div",{className:"flex-grow-1 text-truncate"},this.props.disableRename?Object(o.jsx)("div",{className:"flex-grow-1 text-truncate",title:null==i?void 0:i.label},null==i?void 0:i.label):Object(o.jsx)("div",{className:"d-flex align-items-center pr-3"},this.state.isTitleInputShown?Object(o.jsx)(v.TextInput,{className:"flex-grow-1",value:null==i?void 0:i.label,onChange:this.onLabelChange,ref:e=>this.titleInput=e,onBlur:this.toggleTitleInput,onKeyUp:this.toggleTitleInput}):Object(o.jsx)("div",{className:"text-truncate",onClick:this.toggleTitleInput},null==i?void 0:i.label),Object(o.jsx)(v.Button,{className:"flex-shrink-0 ml-2",type:"tertiary",size:"sm",icon:!0,onClick:this.toggleTitleInput,title:this.props.intl.formatMessage({id:"edit",defaultMessage:v.defaultMessages.edit})},Object(o.jsx)(v.Icon,{icon:St,size:16})))),Object(o.jsx)("div",{className:"flex-shrink-0"},!this.props.disableDuplicate&&this.props.dataView&&Object(o.jsx)(v.Button,{className:"flex-shrink-0 cicle-button mr-3",type:"default",size:"sm",icon:!0,onClick:this.onDuplicate,title:this.props.intl.formatMessage({id:"duplicate",defaultMessage:v.defaultMessages.duplicate})},Object(o.jsx)(v.Icon,{icon:vt,size:16})),!this.props.disableRemove&&this.props.dataView&&Object(o.jsx)(v.Button,{className:"flex-shrink-0 cicle-button",type:"default",size:"sm",icon:!0,onClick:this.onRemove,title:this.props.intl.formatMessage({id:"delete",defaultMessage:o.defaultMessages.delete})},Object(o.jsx)(v.Icon,{icon:Dt,size:16})))),i?Object(o.jsx)(v.ModalBody,{className:"d-flex"},Object(o.jsx)("div",{className:"w-38 h-100 flex-shrink-0 setting-table"},Object(o.jsx)(v.Tabs,{type:"underline",fill:!0,className:"h-100",defaultValue:"filter"},Object(o.jsx)(v.Tab,{id:"filter",className:"view-tab",title:this.props.intl.formatMessage({id:"filter",defaultMessage:v.defaultMessages.filter})},n&&Object(o.jsx)(n,{dataSource:this.props.mainDataSource,mode:o.SqlExpressionMode.Simple,expression:i.where,onChange:this.onSqlExprBuilderChange,queryScope:this.props.isSettingMainDataSource&&o.QueryScope.InRemoteConfigView})),Object(o.jsx)(v.Tab,{id:"sort",className:"view-tab",title:this.props.intl.formatMessage({id:"sort",defaultMessage:v.defaultMessages.sort})},l&&Object(o.jsx)(l,{onChange:this.onSortChange,value:i.orderBy||Object(o.Immutable)([]),useDataSource:this.getUseDataSource(this.props.mainDataSource)})),Object(o.jsx)(v.Tab,{id:"records",className:"view-tab",title:this.props.intl.formatMessage({id:"records",defaultMessage:v.defaultMessages.records})},Object(o.jsx)("div",null,Object(o.jsx)("div",{className:"d-flex justify-content-between mb-3"},Object(o.jsx)("div",{className:"label"},this.props.intl.formatMessage({id:"pageSize",defaultMessage:v.defaultMessages.pageSize})),Object(o.jsx)(v.NumericInput,{size:"sm",value:i.pageSize||o.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,onAcceptValue:this.onPageSizeChange,showHandlers:!1,precision:0,min:1})),Object(o.jsx)("div",{className:"d-flex justify-content-between mb-2"},Object(o.jsx)("div",{className:"label"},this.props.intl.formatMessage({id:"maximum",defaultMessage:v.defaultMessages.maximum})),Object(o.jsx)(v.Switch,{checked:"number"==typeof i.maximum,onChange:this.onToggleMaximum})),"number"==typeof i.maximum&&Object(o.jsx)("div",{className:"d-flex justify-content-between mb-3"},Object(o.jsx)("div",{className:"label"},this.props.intl.formatMessage({id:"maximumLimitationWarning",defaultMessage:v.defaultMessages.maximumLimitationWarning})),Object(o.jsx)(v.Link,{to:"https://developers.arcgis.com/javascript/latest/api-reference/esri-views-layers-FeatureLayerView.html#maximumNumberOfFeatures",className:"ml-2",target:"_blank"},this.props.intl.formatMessage({id:"details",defaultMessage:v.defaultMessages.details}))),"number"==typeof i.maximum&&Object(o.jsx)("div",{className:"d-flex justify-content-between mb-3"},Object(o.jsx)("div",{className:"label"},this.props.intl.formatMessage({id:"maximumRecordCount",defaultMessage:v.defaultMessages.maximumRecordCount})),Object(o.jsx)(v.NumericInput,{size:"sm",value:i.maximum,onAcceptValue:this.onMaximumChange,precision:0,min:1,showHandlers:!1})))))),Object(o.jsx)("div",{className:"w-62 h-100 flex-grow-1 preview-table"},this.getPreviewTable(this.state.localDataSource),(!this.state.isLocalDataSourceCreated||!this.state.isLocalDataSourceLoaded)&&Object(o.jsx)(v.Loading,{type:v.LoadingType.Primary}))):null,Object(o.jsx)(v.ModalFooter,{className:"d-flex justify-content-between pb-30"},Object(o.jsx)("div",null,this.state.isSqlExpressionValid&&!this.state.isSqlExpressionValid(null===(s=this.state.dataView)||void 0===s?void 0:s.where)&&Object(o.jsx)("div",{className:"sql-exp-warning text-truncate",title:this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:v.defaultMessages.sqlExprIncomplete})},Object(o.jsx)(v.Icon,{icon:ft,size:18,className:"sql-exp-warning-icon mr-2"}),this.props.intl.formatMessage({id:"sqlExprIncomplete",defaultMessage:v.defaultMessages.sqlExprIncomplete}))),Object(o.jsx)("div",null,Object(o.jsx)(v.Button,{className:"mr-10",type:"primary",onClick:this.onApply,disabled:!this.state.isSqlExpressionValid||!this.state.isSqlExpressionValid(null===(a=this.state.dataView)||void 0===a?void 0:a.where)},this.props.intl.formatMessage({id:"applyChanges",defaultMessage:v.defaultMessages.applyChanges})),Object(o.jsx)(v.Button,{type:"default",onClick:this.props.toggle},this.props.intl.formatMessage({id:"cancel",defaultMessage:o.defaultMessages.cancel}))))),Object(o.jsx)(gt,{dataSourceId:r,isOpen:this.state.isRemoveWarningOpen,toggle:this.toggleRemoveWarning,reason:pt.DataSourceRemoved}))}}bt.count=-1;const wt=o.ReactRedux.connect((e,t)=>{var s,a,i,o;return{widgets:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(i=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.widgets}})(bt),yt=Object(o.injectIntl)(o.themeUtils.withStyles(wt,"DataViewSettingPopup")),It=s(38),xt=s(106),jt=s(129);class Ot extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.onRemove=e=>{const{onRemove:t}=this.props;t&&t(this.props.mainDataSourceId)},this.onDataViewChange=e=>{const t=e.target.value;if(!t||"create_a_view"===t)return;const s=this.getAllDataViews()[t],a=Object(o.Immutable)([s.asMutable({deep:!0})]);this.props.onChange(this.props.mainDataSourceId,a)},this.onMultiDataViewChange=(e,t)=>{if(!t||"create_a_view"===t)return;const s=this.getAllDataViews()[t],a=this.props.dataViews||Object(o.Immutable)([]),i=this.props.dataViews&&this.props.dataViews.find(e=>e.id===s.id)?a.filter(e=>e.id!==s.id):a.concat(s);this.props.onChange(this.props.mainDataSourceId,i)},this.formatMessage=(e,t)=>{const s=Object.assign({},v.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.getDsLabel=e=>{const t=o.DataSourceManager.getInstance(),s=e&&t.getDataSource(e);return s&&s.getLabel()||this.formatMessage("none")},this.getWhetherItemError=e=>{const t=o.DataSourceManager.getInstance();return!(e&&t.getDataSource(e))},this.getAllDataViews=()=>{if(!this.props.mainDataSourceId)return null;const e=o.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);if(null==e?void 0:e.isDataSourceSet)return null;const t=e&&e.getDataSourceJson();let s=(null==t?void 0:t.dataViews)||Object(o.Immutable)({});s=s.set(this.props.DefaultDataView.id,(null==t?void 0:t.query)?t.query.merge(this.props.DefaultDataView.asMutable({deep:!0})):this.props.DefaultDataView);const a={id:o.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:v.defaultMessages.selectionDataView})};return s=s.set(o.CONSTANTS.SELECTION_DATA_VIEW_ID,a),s=s.without(o.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION),s=s.without(o.CONSTANTS.OUTPUT_DATA_VIEW_ID),s},this.getMultiSelectItems=e=>{if(!this.props.mainDataSourceId)return Object(o.Immutable)([]);const t=[];e&&Object.keys(e).forEach(s=>{t.push({value:s,label:e[s].label,render:(t,a)=>Object(o.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between"},Object(o.jsx)("div",{className:"d-flex align-items-center"},Object(o.jsx)(v.Checkbox,{checked:this.getSelectedValueForMutiSelect().includes(t.value)}),Object(o.jsx)("span",{className:"ml-2"},e[s].label)),this.getWhetherAllowToChangeViewSetting(s)&&Object(o.jsx)("div",{className:"px-2",onClick:t=>this.onDataViewClick(t,e[s]),title:this.props.intl.formatMessage({id:"settings",defaultMessage:v.defaultMessages.settings})},Object(o.jsx)(v.Icon,{icon:jt,size:12})))})});return this.getWhetherAllowToCreateView()&&t.push({value:"create_a_view",render:()=>this.getCreateViewButton()}),Object(o.Immutable)(t)},this.getCreateViewButton=()=>Object(o.jsx)("div",{onClick:this.onCreateViewClick,className:"create-view-button"},Object(o.jsx)(v.Icon,{icon:xt,size:12,className:"create-view-icon"}),Object(o.jsx)("span",{className:"ml-2"},this.formatMessage("createAView"))),this.getSelectedValueForSingleSelect=()=>{var e;return this.props.dataViews&&this.props.dataViews.length>0?null===(e=this.props.dataViews[0])||void 0===e?void 0:e.id:this.props.DefaultDataView.id},this.getSelectedValueForMutiSelect=()=>this.props.dataViews&&this.props.dataViews.length>0?this.props.dataViews.map(e=>e.id):Object(o.Immutable)([this.props.DefaultDataView.id]),this.getMultiSelectSelectedString=e=>{if(e)return this.formatMessage("numSelected",{number:e.length})},this.onDataViewClick=(e,t)=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.setState({settingDataView:t}),this.toggleViewSetting()},this.onCreateViewClick=()=>{this.setState({settingDataView:null}),this.toggleViewSetting()},this.toggleViewSetting=()=>this.setState({isViewSettingOpen:!this.state.isViewSettingOpen}),this.toggleViewSelect=()=>this.setState({isViewSelectOpen:!this.state.isViewSelectOpen}),this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDataViewSettingApply=e=>{e.id===this.props.DefaultDataView.id?this.editQuery(e):this.editDataView(e)},this.editQuery=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const s=o.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),a=s&&s.getDataSourceJson();if(!a)return;const i=k(a.setIn(["query"],(null==a?void 0:a.query)?a.query.merge(e.without("id").without("label").asMutable({deep:!0})):e.set("id","default").set("label",s.getLabel())));t().editDataSource(i).exec(),s.addSourceVersion(),this.toggleViewSetting()},this.editDataView=e=>{if(!e)return;const t=this.state.getAppConfigAction;if(!t)return;const s=o.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId),a=s&&s.getDataSourceJson();let i=a.dataViews||Object(o.Immutable)({});i=i.set(e.id,e);const r=k(a.setIn(["dataViews"],i));t().editDataSource(r).exec(),s.getDataView(null==e?void 0:e.id)?(this.setState({settingDataView:e}),s.addSourceVersion(),this.toggleViewSetting()):o.DataSourceManager.getInstance().createDataSource(a,e.id).then(()=>{this.__unmount||(this.setState({settingDataView:e}),this.toggleViewSetting())})},this.getWhetherAllowToCreateView=()=>{const e=o.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return e&&!e.isDataSourceSet&&!e.getDataSourceJson().isOutputFromWidget},this.getWhetherAllowToChangeViewSetting=e=>{var t;if(e===o.CONSTANTS.SELECTION_DATA_VIEW_ID)return!1;const s=o.DataSourceManager.getInstance().getDataSource(this.props.mainDataSourceId);return!(null===(t=null==s?void 0:s.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget)},this.onClick=()=>{this.props.onClick&&this.props.onClick(this.props.mainDataSourceId)},this.state={isViewSettingOpen:!1,isViewSelectOpen:!1,settingDataView:null,getAppConfigAction:null}}componentDidMount(){this.__unmount=!1,o.moduleLoader.loadModule("jimu-for-builder").then(e=>{this.__unmount||this.setState({getAppConfigAction:e.getAppConfigAction})})}componentWillUnmount(){this.__unmount=!0}render(){var e,t,s;const a=this.props.mainDataSourceId;if(!a)return null;const i=o.DataSourceManager.getInstance().getDataSource(a),r=i&&i.getDataSourceJson(),n=this.getAllDataViews(),l=Object(o.jsx)(v.Button,{icon:!0,size:"sm",type:"tertiary",title:this.formatMessage("remove"),onClick:this.onRemove,className:"ds-item-close"},Object(o.jsx)(v.Icon,{icon:It,size:"12"})),c=this.getWhetherAllowToCreateView();return Object(o.jsx)("div",{className:this.props.className?"w-100 "+this.props.className:"w-100"},r&&Object(o.jsx)("div",{className:Object(o.classNames)("ds-item",{"ds-error-item":this.getWhetherItemError(a),"disable-cursor":this.props.disableDataSourceList,"ds-item-open":this.props.isOpen}),onClick:this.onClick},Object(o.jsx)("div",{className:"d-flex align-items-center w-100 item"},Object(o.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},Object(o.jsx)(v.Icon,{icon:R(r),className:"text-dark",size:"12"})),Object(o.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},Object(o.jsx)("div",{className:"text-truncate ds-type-name",title:this.getDsLabel(a)},this.getDsLabel(a))),!this.props.hideRemove&&l),!this.props.hideDataView&&n&&Object.keys(n).length>0&&Object(o.jsx)("div",{className:"dv-select-container"},this.props.isMultiple?Object(o.jsx)(v.MultiSelect,{fluid:!0,items:this.getMultiSelectItems(n),onClickItem:this.onMultiDataViewChange,values:this.getSelectedValueForMutiSelect(),buttonProps:{disabled:this.props.disableDataView},displayByValues:this.getMultiSelectSelectedString}):Object(o.jsx)(v.Select,{value:this.getSelectedValueForSingleSelect(),onChange:this.onDataViewChange,onClick:this.stopPropagation,isOpen:this.state.isViewSelectOpen,toggle:this.toggleViewSelect,disabled:this.props.disableDataView},Object.values(n).map((e,t)=>Object(o.jsx)("option",{value:e.id,key:t},Object(o.jsx)("div",{className:"d-flex justify-content-between align-items-center w-100"},Object(o.jsx)("div",null,e.label),this.state.isViewSelectOpen&&this.getWhetherAllowToChangeViewSetting(e.id)&&Object(o.jsx)("div",{className:"px-2 settings-icon",onClick:t=>this.onDataViewClick(t,e),title:this.props.intl.formatMessage({id:"settings",defaultMessage:v.defaultMessages.settings})},Object(o.jsx)(v.Icon,{icon:jt,size:12}))))),c&&Object(o.jsx)("option",{value:"create_a_view"},this.getCreateViewButton())))),c&&Object(o.jsx)(yt,{isOpen:this.state.isViewSettingOpen,toggle:this.toggleViewSetting,onApply:this.onDataViewSettingApply,onDuplicate:this.onDataViewSettingApply,mainDataSource:i,dataView:this.state.settingDataView,disableDuplicate:!this.state.settingDataView||(null===(e=this.state.settingDataView)||void 0===e?void 0:e.id)===this.props.DefaultDataView.id,disableRemove:!this.state.settingDataView||(null===(t=this.state.settingDataView)||void 0===t?void 0:t.id)===this.props.DefaultDataView.id,disableRename:!this.state.settingDataView||(null===(s=this.state.settingDataView)||void 0===s?void 0:s.id)===this.props.DefaultDataView.id}))}}class Mt extends o.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.DefaultDataView=Object(o.Immutable)({id:"USE_MAIN_DATA_SOURCE",label:this.props.intl.formatMessage({id:"default",defaultMessage:v.defaultMessages.default})}),this.sidePopperTrigger=o.React.createRef(),this.changeInitStatus=e=>{this.setState({isDataSourceInited:e})},this.disableSelection=()=>{if(this.props.disableSelection){const e=this.props.useDataSources||Object(o.Immutable)([]);return this.props.disableSelection(e.asMutable({deep:!0}))}return!1},this.disableRemove=()=>{if(this.props.disableRemove){const e=this.props.useDataSources||Object(o.Immutable)([]);return this.props.disableRemove(e.asMutable({deep:!0}))}return!1},this.onModalClose=()=>{this.setState({modalType:"none"})},this.onMainDsChanged=e=>{e&&(this.props.onChange&&this.props.onChange(e),this.props.closeDataSourceListOnChange&&this.setState({modalType:"none"}))},this.onMainDsRemoved=e=>{if(!e||!this.props.useDataSources)return;const t=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)!==e);this.props.onChange&&this.props.onChange(t.asMutable({deep:!0}))},this.onDataViewChanged=(e,t)=>{if(!e||!this.props.useDataSources)return;const s=Object(o.Immutable)(this.props.useDataSources.find(t=>t.mainDataSourceId===e)||{dataSourceId:e,mainDataSourceId:e}),a=t.map(t=>{var a;if("USE_MAIN_DATA_SOURCE"===t.id){const t=o.DataSourceManager.getInstance().getDataSource(e);if(null===(a=null==t?void 0:t.getDataSourceJson())||void 0===a?void 0:a.isOutputFromWidget){const t=o.DataSourceManager.getInstance().getDataViewDataSourceId(e,o.CONSTANTS.OUTPUT_DATA_VIEW_ID),a=o.CONSTANTS.OUTPUT_DATA_VIEW_ID;return s.set("dataSourceId",t).set("dataViewId",a).asMutable({deep:!0})}return s.without("dataViewId").set("dataSourceId",e).asMutable({deep:!0})}return s.set("dataViewId",t.id).set("dataSourceId",o.DataSourceManager.getInstance().getDataViewDataSourceId(e,t.id)).asMutable({deep:!0})}),i=this.props.useDataSources.filter(t=>(null==t?void 0:t.mainDataSourceId)!==e).concat(a);this.props.onChange&&this.props.onChange(i.asMutable({deep:!0}))},this.toggleDsList=()=>{this.props.disableDataSourceList||this.setState({modalType:"ds"===this.state.modalType?"none":"ds"})},this.getWhetherShowPlaceholder=()=>{var e;if(null===(e=this.props.useDataSources)||void 0===e?void 0:e.some(e=>!o.DataSourceManager.getInstance().getDataSource(e.dataSourceId)))return!0;if(this.props.disableSelection){const e=this.props.useDataSources||Object(o.Immutable)([]);return!this.props.disableSelection(e.asMutable({deep:!0}))}return this.props.isMultiple||!this.props.isMultiple&&(!this.props.useDataSources||0===this.props.useDataSources.filter(e=>!!e).length)},this.groupUseDssByMainDataSource=e=>{if(!e||0===e.length)return null;const t={};return e.forEach(e=>{if(t[e.mainDataSourceId]||(t[e.mainDataSourceId]=Object(o.Immutable)([])),e.dataViewId===o.CONSTANTS.SELECTION_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat({id:o.CONSTANTS.SELECTION_DATA_VIEW_ID,label:this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:v.defaultMessages.selectionDataView})});else if(e.dataViewId===o.CONSTANTS.OUTPUT_DATA_VIEW_ID)t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView);else if(e.dataViewId){const s=o.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId),a=s&&s.getDataSourceJson(),i=a&&a.dataViews;(null==i?void 0:i[e.dataViewId])&&(t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(i[e.dataViewId]))}else t[e.mainDataSourceId]=t[e.mainDataSourceId].concat(this.DefaultDataView)}),t},this.onDsItemClick=e=>{this.toggleDsList(),this.setState({clickedMainDsId:e})},this.getIsDsListOpen=()=>"ds"===this.state.modalType&&!o.urlUtils.getAppIdPageIdFromUrl().pageId,this.state={isDataSourceInited:A(this.props.dataSources,this.props.dataSourcesInfo),modalType:"none",SidePopper:null,clickedMainDsId:null}}componentDidMount(){this.__unmount=!1,o.moduleLoader.loadModule("jimu-ui/advanced/setting-components").then(e=>{this.__unmount||this.setState({SidePopper:e.SidePopper})})}componentWillUnmount(){this.__unmount=!0}componentDidUpdate(e){o.lodash.isDeepEqual(this.props.dataSources,e.dataSources)&&o.lodash.isDeepEqual(this.props.dataSourcesInfo,e.dataSourcesInfo)||this.changeInitStatus(A(this.props.dataSources,this.props.dataSourcesInfo))}render(){var e;const t=this.state.SidePopper,s=this.getWhetherShowPlaceholder(),a=this.groupUseDssByMainDataSource(this.props.useDataSources);return Object(o.jsx)("div",{className:"w-100",ref:this.sidePopperTrigger},a&&Object.keys(a).sort((e,t)=>null==e?void 0:e.localeCompare(t)).map((e,t)=>e?Object(o.jsx)(Ot,{key:t,mainDataSourceId:e,onRemove:this.onMainDsRemoved,intl:this.props.intl,hideRemove:this.disableRemove(),theme:this.props.theme,disableDataSourceList:this.props.disableDataSourceList,onClick:this.onDsItemClick,className:this.props.isMultiple&&"mb-3",onChange:this.onDataViewChanged,disableDataView:this.props.disableDataView,disableAddData:this.props.disableAddData,isMultiple:this.props.isMultiple,dataViews:a[e],DefaultDataView:this.DefaultDataView,hideDataView:this.props.hideDataView,isOpen:this.getIsDsListOpen()&&this.state.clickedMainDsId===e}):null),t&&Object(o.jsx)(t,{isOpen:this.getIsDsListOpen(),position:"right",trigger:null===(e=this.sidePopperTrigger)||void 0===e?void 0:e.current,toggle:this.toggleDsList},Object(o.jsx)("div",{className:"bg-light-300 h-100 w-100"},Object(o.jsx)(dt,{types:this.props.types,onChange:this.onMainDsChanged,changeInitStatus:this.changeInitStatus,hideDs:this.props.hideDs,onCloseClick:this.onModalClose,isMultiple:this.props.isMultiple,fromDsIds:this.props.fromDsIds,useDataSources:this.props.useDataSources,isDataSourceInited:this.state.isDataSourceInited,widgetId:this.props.widgetId,disableSelection:this.disableSelection(),disableRemove:this.disableRemove(),fromRootDsIds:this.props.fromRootDsIds,hideHeader:this.props.hideHeader,hideTypeDropdown:this.props.hideTypeDropdown,disableAddData:this.props.disableAddData,enableToSelectOutputDsFromSelf:this.props.enableToSelectOutputDsFromSelf}))),s&&Object(o.jsx)(v.Link,{className:"ds-selector-button w-100 mt-0 d-flex justify-content-center align-items-center px-2",onClick:this.toggleDsList},Object(o.jsx)("div",{className:"text-truncate"},this.props.buttonLabel||this.props.intl.formatMessage({id:"setDataSource",defaultMessage:v.defaultMessages.setDataSource}))))}}var Ct=o.themeUtils.withTheme(Mt),Nt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};class Tt extends o.React.PureComponent{constructor(e){super(e),this.onToggleUseDataEnabled=()=>{this.props.onToggleUseDataEnabled&&this.props.onToggleUseDataEnabled(!this.props.useDataSourcesEnabled)},this.onChange=e=>{this.props.onChange&&this.props.onChange(e)}}render(){const e=this.props,{onChange:t}=e,s=Nt(e,["onChange"]);return Object(o.jsx)("div",{className:Object(o.classNames)("w-100",{[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"component-data-source-selector"},!this.props.mustUseDataSource&&Object(o.jsx)("div",{className:Object(o.classNames)("d-flex justify-content-between w-100 align-items-center",{"mb-3":this.props.useDataSourcesEnabled})},Object(o.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.props.intl.formatMessage({id:"connectToData",defaultMessage:v.defaultMessages.connectToData})),Object(o.jsx)(v.Switch,{checked:!!this.props.useDataSourcesEnabled,onChange:this.onToggleUseDataEnabled})),(this.props.mustUseDataSource||this.props.useDataSourcesEnabled)&&Object(o.jsx)(Ct,Object.assign({types:this.props.types},s,{onChange:this.onChange,intl:this.props.intl,closeDataSourceListOnChange:this.props.closeDataSourceListOnChange,fromDsIds:this.props.fromDsIds,widgetId:this.props.widgetId}))))}}const Et=Object(o.injectIntl)(o.themeUtils.withStyles(Tt,"DataSourceSelector")),Vt=o.ReactRedux.connect(e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo}))(Et),Rt=s(274),Lt=s(275),At=s(276),kt=s(277),Ut=s(172),zt=s(173),$t=s(278);class _t extends o.React.PureComponent{constructor(e){var t,s;super(e),this.onLabelChange=e=>{this.setState({newLabel:e.target.value})},this.onMoreIconClick=e=>{this.stopPropagation(e),this.props.onMoreIconClick&&this.props.onMoreIconClick(this.props.dataSourceJson)},this.onCloseIconClick=e=>{this.stopPropagation(e),this.props.onCloseIconClick&&this.props.onCloseIconClick(this.props.dataSourceJson)},this.onRename=()=>{const e=this.state.newLabel.trim();this.props.onRename&&this.props.onRename(e)},this.onDataSourceItemClick=e=>{this.stopPropagation(e),this.props.onDataSourceItemClick&&this.props.onDataSourceItemClick(this.props.dataSourceJson)},this.onMappingIconClick=e=>{this.stopPropagation(e),this.props.onMappingIconClick&&this.props.onMappingIconClick(this.props.dataSourceJson)},this.onHideIconClick=e=>{this.stopPropagation(e),this.props.onToggleHidden&&this.props.onToggleHidden(this.props.dataSourceJson)},this.onChildDataIconClick=e=>{this.stopPropagation(e),this.props.onChildDataIconClick&&this.props.onChildDataIconClick(this.props.dataSourceJson)},this.onRelatedWidgetsIconClick=e=>{this.stopPropagation(e),this.props.onRelatedWidgetsIconClick&&this.props.onRelatedWidgetsIconClick(this.props.dataSourceJson)},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getWhetherIsSetDs=e=>{if(!e)return!1;const t=o.DataSourceManager.getInstance().getDataSource(e.id);return!!t&&t.isDataSourceSet},this.getChildDssLength=e=>{if(!e)return null;const t=o.DataSourceManager.getInstance().getDataSource(e.id);return t&&t.isDataSourceSet?t.getChildDataSources().length:null};const a=o.DataSourceManager.getInstance().getDataSource(null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.id);this.state={newLabel:a?a.getLabel():(null===(s=this.props.dataSourceJson)||void 0===s?void 0:s.id)||""}}componentDidUpdate(e,t){var s,a;if(e.isRenameInputShown!==this.props.isRenameInputShown&&this.props.isRenameInputShown&&this.renameInput&&(this.renameInput.focus(),this.renameInput.select()),e.dataSourceJson!==this.props.dataSourceJson){const e=o.DataSourceManager.getInstance().getDataSource(null===(s=this.props.dataSourceJson)||void 0===s?void 0:s.id);this.setState({newLabel:e?e.getLabel():(null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.id)||""})}}render(){var e,t,s,a,i,r;if(!this.props.dataSourceJson)return null;const n=j(this.props.dataSourceJson.id,this.props.widgets,!1),l=O(this.props.dataSourceJson.id,this.props.widgets),c=U(this.props.dataSourceJson),d=this.getWhetherIsSetDs(this.props.dataSourceJson);let p;d&&(p=this.getChildDssLength(this.props.dataSourceJson));const h=o.DataSourceManager.getInstance().getDataSource(null===(e=this.props.dataSourceJson)||void 0===e?void 0:e.id),u=L(this.props.dataSourceJson.type,this.props.intl);return Object(o.jsx)("div",{className:Object(o.classNames)({[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:Object(o.classNames)("component-data-source-item",{"component-data-source-item-selected-item":this.props.isSelected,"cursor-pointer":!!this.props.onDataSourceItemClick}),onClick:this.onDataSourceItemClick},Object(o.jsx)("div",{className:"d-flex justify-content-between align-items-center ds-item-header"},Object(o.jsx)("div",{className:"d-flex align-items-center w-100",title:u},Object(o.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},Object(o.jsx)(v.Icon,{icon:R(this.props.dataSourceJson),className:"text-dark",size:"12"})),Object(o.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 ds-type"},Object(o.jsx)("div",{className:"text-truncate ds-type-name"},u))),Object(o.jsx)("div",{className:"d-flex"},Object(o.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-badge"},Object(o.jsx)($.DataBadge,{itemId:null===(t=this.props.dataSourceJson)||void 0===t?void 0:t.itemId,portalUrl:null===(s=this.props.dataSourceJson)||void 0===s?void 0:s.portalUrl,url:null===(a=this.props.dataSourceJson)||void 0===a?void 0:a.url})),this.props.isErrorIconShown?Object(o.jsx)("div",{className:"ml-1 flex-shrink-0 d-flex align-items-center ds-more p-2"},Object(o.jsx)("span",{className:"d-flex justify-content-center",title:this.props.intl.formatMessage({id:"uploadImageError",defaultMessage:v.defaultMessages.uploadImageError})},Object(o.jsx)(v.Icon,{icon:$t,className:"align-baseline warning-icon",size:"12"}))):null,this.props.isHideable?Object(o.jsx)(v.Button,{size:"sm",icon:!0,type:"tertiary",className:"ml-1 flex-shrink-0 ds-more p-2",onClick:this.onHideIconClick},Object(o.jsx)("span",{className:"d-flex justify-content-center",title:(null===(i=this.props.dataSourceJson)||void 0===i?void 0:i.isHidden)?this.props.intl.formatMessage({id:"clickToShow",defaultMessage:v.defaultMessages.clickToShow}):this.props.intl.formatMessage({id:"clickToHide",defaultMessage:v.defaultMessages.clickToHide})},Object(o.jsx)(v.Icon,{icon:(null===(r=this.props.dataSourceJson)||void 0===r?void 0:r.isHidden)?zt:Ut,className:"align-baseline",size:"12"}))):null,this.props.isMoreIconShown?Object(o.jsx)(v.Button,{size:"sm",icon:!0,type:"tertiary",className:"ml-1 flex-shrink-0 ds-more p-2",onClick:this.onMoreIconClick},Object(o.jsx)("span",{className:"d-flex justify-content-center",title:this.props.intl.formatMessage({id:"more",defaultMessage:v.defaultMessages.more})},Object(o.jsx)(v.Icon,{icon:Rt,className:"align-baseline",size:"12"}))):null)),Object(o.jsx)("div",{className:"ds-item-body"},this.props.isRenameInputShown?Object(o.jsx)(v.TextInput,{className:"flex-grow-1 text-truncate p-1 ds-label ds-label-input",ref:e=>this.renameInput=e,onBlur:this.onRename,onKeyUp:this.onRename,onChange:this.onLabelChange,value:this.state.newLabel,onClick:this.stopPropagation}):Object(o.jsx)("div",{className:"flex-grow-1 two-line-truncate ds-label text-left",title:h&&h.getLabel()||this.props.dataSourceJson.id},h&&h.getLabel()||this.props.dataSourceJson.id),Object(o.jsx)("div",{className:Object(o.classNames)("d-flex justify-content-between",{"mt-3":c||this.props.isMappingIconShown})},Object(o.jsx)("div",{className:"d-flex"},d?Object(o.jsx)(v.Button,{type:"tertiary",className:"mr-5 p-0 ds-child-dss",onClick:this.onChildDataIconClick,title:""+this.props.intl.formatMessage({id:"containLayersWithNum",defaultMessage:v.defaultMessages.containLayersWithNum},{layerNum:p})},Object(o.jsx)("span",null,Object(o.jsx)(v.Icon,{icon:At,size:12,className:"mr-1"}),Object(o.jsx)("span",{className:"align-middle"},p))):null,this.props.isRelatedWidgetsShown?Object(o.jsx)(v.Button,{type:"tertiary",className:"p-0 flex-grow-1 text-truncate flex-row ds-related-widgets",onClick:this.onRelatedWidgetsIconClick,title:this.props.intl.formatMessage({id:"relatedWidgetsWithNum",defaultMessage:v.defaultMessages.relatedWidgetsWithNum},{directlyNum:n.length,totalNum:l.length})},Object(o.jsx)("span",null,Object(o.jsx)(v.Icon,{icon:kt,size:12,className:"mr-1"}),Object(o.jsx)("span",{className:"align-middle"},`${n.length} / ${l.length}`))):null),c?Object(o.jsx)(v.Button,{size:"sm",icon:!0,type:"tertiary",className:"ds-origin-label",href:c,target:"_blank",onClick:this.stopPropagation,title:this.props.intl.formatMessage({id:"source",defaultMessage:v.defaultMessages.source},{directlyNum:n.length,totalNum:l.length})},Object(o.jsx)(v.Icon,{icon:Lt,className:"m-0",size:12})):null))))}}const Ft=o.ReactRedux.connect((e,t)=>{if(t.isRelatedWidgetsShown){const t=window&&window.jimuConfig&&window.jimuConfig.isBuilder?e.appStateInBuilder&&e.appStateInBuilder.appConfig:e.appConfig;return{widgets:t&&t.widgets}}return{}})(Object(o.injectIntl)(o.themeUtils.withStyles(_t,"DataSourceItem")));class Pt extends o.React.PureComponent{constructor(e){super(e)}render(){return this.props.dataSourceJson?Object(o.jsx)("div",{className:Object(o.classNames)({[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"component-data-source-error-item"},Object(o.jsx)(Ft,Object.assign({},this.props)))):null}}const Wt=o.themeUtils.withStyles(Pt,"DataSourceErrorItem");class Bt extends o.React.PureComponent{constructor(e){super(e),this.state={isOpen:!1}}render(){const e=this.props.fields;if(!e||!this.props.ds)return null;const t=e[y]?[y]:[];return o.React.createElement("div",{className:"field-list px-3"},e&&t.concat(Object.keys(e).filter(e=>e!==y)).map(t=>{const s=I(e[t].type,this.props.theme);return o.React.createElement("div",{key:t,onClick:()=>{this.props.onFieldClick([e[t]])},className:Object(o.classNames)("field-item mt-2 p-1 d-flex w-100",{"field-item-selected":this.props.selectedFields&&(this.props.isMultiple?this.props.selectedFields.some(e=>e===t):t===this.props.selectedFields[0])})},s&&o.React.createElement(v.Icon,{icon:s.icon,color:s.color,className:"mr-2 flex-shrink-0",size:16}),o.React.createElement("div",{className:"flex-grow-1 text-truncate",title:e[t].alias||e[t].name},e[t].alias||e[t].name))}))}}class Ht extends o.React.PureComponent{constructor(e){super(e),this.onChange=e=>{var t;const s=(null===(t=this.props.selectedFields)||void 0===t?void 0:t.asMutable())||[],a=(null==e?void 0:e.map(e=>e.value))||[];let i=a,o=s;s.length>a.length&&(i=s,o=a);const r=i.filter(e=>!o.some(t=>t===e));this.props.onFieldClick(r.map(e=>this.props.fields[e]))},this.getFields=()=>{if(this.props.fields){const e=[];return(this.props.fields[y]?[y]:[]).concat(Object.keys(this.props.fields).filter(e=>e!==y)).forEach(t=>{const s=this.props.fields[t].alias||this.props.fields[t].name,a=I(this.props.fields[t].type,this.props.theme);e.push({value:t,label:s,render:()=>o.React.createElement(o.React.Fragment,null,a&&o.React.createElement(v.Icon,{icon:a.icon,color:a.color,className:"d-inline-block mr-2",size:16}),o.React.createElement("span",null,s))})}),e}return[]},this.getSelectedFields=()=>{if(this.props.fields&&this.props.selectedFields){const e=[];return this.props.selectedFields.forEach(t=>{var s,a;e.push({value:t,label:(null===(s=this.props.fields[t])||void 0===s?void 0:s.alias)||(null===(a=this.props.fields[t])||void 0===a?void 0:a.name)})}),Object(o.Immutable)(e)}return Object(o.Immutable)([])},this.state={fields:this.getFields()}}componentDidUpdate(e,t){this.props.fields!==e.fields&&this.setState({fields:this.getFields()})}render(){if(!this.props.fields||!this.props.ds)return null;const e=this.props.dropdownProps||{};return o.React.createElement("div",null,o.React.createElement(v.AdvancedSelect,Object.assign({},e,{fluid:!0,codedValues:this.state.fields,values:this.getSelectedFields(),onChange:this.onChange,dataSource:this.props.ds,field:Object.values(this.props.fields)[0],placeholder:this.props.placeholder,isMultiple:this.props.isMultiple,hideSearchInput:this.props.isSearchInputHidden,hideBottomTools:!this.props.useMultiDropdownBottomTools,isEmptyOptionHidden:!0})))}}var Jt;!function(e){e.First="POPULATED_VIEW_SELECTION_DEFAULT",e.Second="VIEW_DEFAULT_SELECTION_POPULATED"}(Jt||(Jt={}));class qt extends o.React.PureComponent{constructor(){super(...arguments),this.getWhetherUseDsIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some((e,s)=>e.dataSourceId!==t[s].dataSourceId)),s},this.isPopulatedView=e=>(null==e?void 0:e.dataViewId)===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID,this.isSelectionView=e=>(null==e?void 0:e.dataViewId)===o.CONSTANTS.SELECTION_DATA_VIEW_ID,this.isDefaultView=e=>"USE_MAIN_DATA_SOURCE"===(null==e?void 0:e.dataViewId)||(null==e?void 0:e.dataViewId)===o.CONSTANTS.OUTPUT_DATA_VIEW_ID,this.isCommonView=e=>(null==e?void 0:e.dataViewId)&&!this.isPopulatedView(e)&&!this.isSelectionView(e)&&!this.isDefaultView(e),this.getOneDefaultUseDs=(e,t,s)=>{const a=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,t,s);let i=[];i=this.props.defaultDataViewPriority===Jt.Second?[this.isCommonView,this.isDefaultView,this.isSelectionView,this.isPopulatedView]:[this.isPopulatedView,this.isCommonView,this.isSelectionView,this.isDefaultView];const o=Object.values(a).find(e=>e.some(e=>i[0](e)))||Object.values(a).find(e=>e.some(e=>i[1](e)))||Object.values(a).find(e=>e.some(e=>i[2](e)))||Object.values(a).find(e=>e.some(e=>i[3](e)))||Object.values(a)[0];return o?o.find(e=>i[0](e))||o.find(e=>i[1](e))||o.find(e=>i[2](e))||o.find(e=>i[3](e))||o[0]:null},this.getSelectedUseDsFromProps=(e,t,s,a,i)=>{var r,n;const l=this.groupUseDataSourcesByMainDsAndAddAutoViews(e,s,i),c=this.getOneDefaultUseDs(e,s,i);return t?a?null===(r=l[t.mainDataSourceId])||void 0===r?void 0:r.find(e=>e.dataViewId===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID):t.dataViewId?t:null===(n=l[t.mainDataSourceId])||void 0===n?void 0:n.find(e=>"USE_MAIN_DATA_SOURCE"===e.dataViewId):c},this.getWhetherUseRepeatedDataSourceContext=(e,t,s,a)=>{var i,r,n,l,c;const d=(null===(i=null===window||void 0===window?void 0:window.jimuConfig)||void 0===i?void 0:i.isBuilder)?null===(n=null===(r=Object(o.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder)||void 0===n?void 0:n.appConfig:null===(l=Object(o.getAppStore)().getState())||void 0===l?void 0:l.appConfig;if(!(d&&e&&t&&0!==t.length&&s&&a))return!1;const p=qe.searchUtils.getParentWidgetIdOfContent(d,e,o.LayoutItemType.Widget,a),h=d.widgets[p],u=h&&(null===(c=h.manifest.properties)||void 0===c?void 0:c.canProvideRepeatDataSource);let m=!1;for(let e=0;e<t.length;e++){const a=this.getRealUseDataSources(t[e],s);if(m=(null==h?void 0:h.useDataSources)&&h.useDataSources.some(e=>(null==a?void 0:a.dataSourceId)===e.dataSourceId),m)break}return u&&m},this.groupUseDataSourcesByMainDsAndAddAutoViews=(e,t,s)=>{if(!s||!t||0===t.length)return{};const a={};return t.forEach(e=>{if(a[e.mainDataSourceId]||(a[e.mainDataSourceId]=[]),!a[e.mainDataSourceId].some(t=>t.dataSourceId===e.dataSourceId)){if(!e.dataViewId&&e.dataSourceId===e.mainDataSourceId){const t=e.set("dataSourceId",o.DataSourceManager.getInstance().getDataViewDataSourceId(e.mainDataSourceId,"USE_MAIN_DATA_SOURCE")).set("dataViewId","USE_MAIN_DATA_SOURCE");a[e.mainDataSourceId]=a[e.mainDataSourceId].concat(t)}else a[e.mainDataSourceId]=a[e.mainDataSourceId].concat(e)}}),Object.keys(a).forEach(i=>{a[i]=a[i].concat(this.getAutoAddedDataViews(e,a[i],t,s))}),a},this.getAutoAddedDataViews=(e,t,s,a)=>{if(!t||0===t.length||!a)return[];const i=o.DataSourceManager.getInstance().getDataSource(t[0].mainDataSourceId);if(!(i&&!i.isDataSourceSet))return[];let r=[];if(this.props.useSelectionDataView&&!t.some(e=>e.dataViewId===o.CONSTANTS.SELECTION_DATA_VIEW_ID)){const e=t[0].set("dataSourceId",o.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,o.CONSTANTS.SELECTION_DATA_VIEW_ID)).set("dataViewId",o.CONSTANTS.SELECTION_DATA_VIEW_ID);r=r.concat(e)}if(this.props.usePopulatedDataView&&this.getWhetherUseRepeatedDataSourceContext(e,t,s,a)){const e=t[0].set("dataSourceId",o.DataSourceManager.getInstance().getDataViewDataSourceId(t[0].mainDataSourceId,o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)).set("dataViewId",o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID);r=r.concat(e)}return r},this.getDsLabel=(e,t)=>{if(t&&t===o.CONSTANTS.SELECTION_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"selectionDataView",defaultMessage:v.defaultMessages.selectionDataView});if(t&&t===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)return this.props.intl.formatMessage({id:"populatedDataView",defaultMessage:v.defaultMessages.populatedDataView});if(t&&("USE_MAIN_DATA_SOURCE"===t||t===o.CONSTANTS.OUTPUT_DATA_VIEW_ID))return this.props.intl.formatMessage({id:"default",defaultMessage:v.defaultMessages.default});const s=o.DataSourceManager.getInstance().getDataSource(e);return s?s.getLabel()||s.id:e},this.getRealUseDataSources=(e,t)=>{if(!e)return null;if("USE_MAIN_DATA_SOURCE"===e.dataViewId)return e.set("dataSourceId",e.mainDataSourceId).without("dataViewId");if(e.dataViewId===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID){const s=t.find(t=>t.mainDataSourceId===e.mainDataSourceId);return s&&Object(o.Immutable)(s)}return e},this.onMainDataChange=e=>{const t=e.target.value;if(t!==this.props.selectedUseDataSource.mainDataSourceId){const e=Object(o.Immutable)(this.props.useDataSources.find(e=>e.mainDataSourceId===t)||{dataSourceId:t,mainDataSourceId:t});this.props.onChange(e,this.props.isSelectedFromRepeatedDataSourceContext)}},this.onDataViewChange=e=>{if(!this.props.selectedUseDataSource)return;const t=e.target.value,s=this.props.selectedUseDataSource.set("dataSourceId",o.DataSourceManager.getInstance().getDataViewDataSourceId(this.props.selectedUseDataSource.mainDataSourceId,t)).set("dataViewId",t);this.props.onChange(this.getRealUseDataSources(s,this.props.useDataSources),(null==s?void 0:s.dataViewId)===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidMount(){if(!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}componentDidUpdate(e){if(e.widgetId!==this.props.widgetId||!this.getWhetherUseDsIsShallowEqual(e.useDataSources,this.props.useDataSources)||e.browserSizeMode!==this.props.browserSizeMode||!this.props.selectedUseDataSource){const e=this.getOneDefaultUseDs(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode);this.props.onChange(this.getRealUseDataSources(e,this.props.useDataSources),(null==e?void 0:e.dataViewId)===o.CONSTANTS.REPEAT_CONTEXT_DATA_VIEW_ID)}}render(){var e;if(!this.props.useDataSources)return null;const t=this.groupUseDataSourcesByMainDsAndAddAutoViews(this.props.widgetId,this.props.useDataSources,this.props.browserSizeMode),s=this.getSelectedUseDsFromProps(this.props.widgetId,this.props.selectedUseDataSource,this.props.useDataSources,this.props.isSelectedFromRepeatedDataSourceContext,this.props.browserSizeMode);return Object(o.jsx)("div",{className:Object(o.classNames)("w-100",{[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"component-main-data-and-view"},!this.props.hideMainDataSourceSelect&&Object(o.jsx)("div",{className:"w-100 text-truncate mb-12 option-label mb-2"},this.props.intl.formatMessage({id:"data",defaultMessage:v.defaultMessages.data})),!this.props.hideMainDataSourceSelect&&Object(o.jsx)("div",{className:"flex-grow-1"},Object(o.jsx)(v.Select,{value:null==s?void 0:s.mainDataSourceId,className:"select-max-width text-truncate",onChange:this.onMainDataChange,size:"sm"},Object.keys(t).sort((e,t)=>null==e?void 0:e.localeCompare(t)).map((e,t)=>Object(o.jsx)("option",{value:e,key:t,className:"select-max-width text-truncate"},this.getDsLabel(e))))),Object(o.jsx)("div",{className:Object(o.classNames)("flex-grow-1",{"mt-2":!this.props.hideMainDataSourceSelect})},Object(o.jsx)(v.Select,{value:null==s?void 0:s.dataViewId,className:"select-max-width text-truncate",onChange:this.onDataViewChange,size:"sm"},null===(e=t[null==s?void 0:s.mainDataSourceId])||void 0===e?void 0:e.sort((e,t)=>{var s;return null===(s=null==e?void 0:e.dataSourceId)||void 0===s?void 0:s.localeCompare(null==t?void 0:t.dataSourceId)}).map((e,t)=>Object(o.jsx)("option",{value:e.dataViewId,key:t,className:"select-max-width text-truncate"},this.getDsLabel(e.dataSourceId,e.dataViewId)))))))}}const Gt=o.ReactRedux.connect((e,t)=>{var s,a;return{browserSizeMode:(null===(s=null==e?void 0:e.appContext)||void 0===s?void 0:s.isBuilder)?null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.browserSizeMode:null==e?void 0:e.browserSizeMode}})(qt),Qt=Object(o.injectIntl)(o.themeUtils.withStyles(Gt,"MainDataAndViewSelector")),Kt=s(102);class Xt extends o.React.PureComponent{constructor(e){super(e),this.getWhetherArrayIsShallowEqual=(e,t)=>{let s=!1;return e&&t&&e.length===t.length&&(s=!e.some((e,s)=>e!==t[s])),s},this.getDefaultSelectedDs=(e,t)=>this.hasSelectedFields()||this.props.isDataSourceDropDownHidden?this.getDsFromSelectedFieldsAndUseDss(this.props.dataSources,this.props.selectedFields):null,this.hasSelectedFields=()=>!!this.props.selectedFields&&(Array.isArray(this.props.selectedFields)?this.props.selectedFields.length>0:"object"==typeof this.props.selectedFields&&Object.values(this.props.selectedFields).every(e=>e&&e.length>0)),this.getDsFromSelectedFieldsAndUseDss=(e,t)=>{let s;if(t&&e){if(this.getAreFromMultipleDss(e,t)){const e=Object.keys(this.props.selectedFields)[0];if(e.split("-").reverse()[0]===o.CONSTANTS.SELECTION_DATA_VIEW_ID){const t=o.DataSourceManager.getInstance().getDataSource(e),a=t&&t.getMainDataSource(),i=a&&a.id;s=this.props.dataSources.some(e=>e&&e.getMainDataSource().id===i)?t:null}else s=this.props.dataSources.find(t=>t&&t.id===e)}else s=e[0]}else e&&(s=e[0]);return s},this.getAreFromMultipleDss=(e,t)=>t?!Array.isArray(t):(null==e?void 0:e.length)>1,this.getDsLabel=e=>e&&e.getDataSourceJson()&&(e.getLabel()||e.id)||"",this.getSelectedFieldsArr=(e,t,s,a)=>{if(!e||!e.id||!s)return Object(o.Immutable)([]);const i=this.getAreFromMultipleDss(t,s)?Object(o.Immutable)(s[e.id]):s;return i?a?i:i.slice(0,1):Object(o.Immutable)([])},this.getSelectedUseDataSource=()=>this.state.selectedDs?this.getUseDataSources([this.state.selectedDs])[0]:null,this.getWhetherJimuNameIsInHiddenFields=e=>{var t;let s=!1;if(this.props.hiddenFields){const a=this.getAreFromMultipleDss(this.props.dataSources,this.props.selectedFields);let i=Object(o.Immutable)([]);i=a?this.props.hiddenFields[null===(t=this.state.selectedDs)||void 0===t?void 0:t.id]:this.props.hiddenFields,s=i.some(t=>t===e)}return s},this.getValidFields=(e,t)=>{const s=this.getAllFields(e);if(!s)return null;let a;if(this.props.types||this.props.hiddenFields||this.state.searchValue){let e,i,r=Object(o.Immutable)({});Object.keys(s).forEach(a=>{e=s[a].type,i=s[a].alias||s[a].name;const o=!this.props.types||e&&this.props.types&&this.props.types.some(t=>t===e),n=this.getWhetherJimuNameIsInHiddenFields(a),l=!this.state.searchValue||this.state.searchValue&&i&&i.toLowerCase().includes(this.state.searchValue.toLowerCase());(t?o&&!n:o&&!n&&l)&&(r=r.setIn([a],s[a]))}),a=r}else a=s;return a&&this.props.noSelectionItem&&(a=a.set(y,this.getNoSelectionItem())),a},this.getNoSelectionItem=()=>Object(o.Immutable)(Object.assign(Object.assign({},this.props.noSelectionItem),{jimuName:y})),this.getUseDataSources=e=>{if(!e)return null;let t=Object(o.Immutable)([]);return e.forEach(e=>{var s;e&&(t=t.concat({dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(s=e.getRootDataSource())||void 0===s?void 0:s.id}))}),t},this.onSelectedUseDsChange=(e,t)=>{const s=o.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(this.setState({selectedDs:s}),this.hasSelectedFields()){const e=this.getSelectedFieldsArr(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple).map(e=>{var t;return s&&(null===(t=this.getAllFields(s))||void 0===t?void 0:t[e])}).filter(e=>!!e);this.props.onChange&&this.props.onChange(e.asMutable(),s,t)}this.setState({selectedDs:s,isFromRepeatedDs:t})},this.onSearchChange=e=>{this.setState({searchValue:e.target.value})},this.onFieldClick=e=>{this.onSelectedFieldsChange(e,this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.state.isFromRepeatedDs,this.props.isMultiple)},this.onSelectedFieldsChange=(e,t,s,a,i,o)=>{if(e.some(e=>(null==e?void 0:e.jimuName)===y))return void(this.props.onChange&&this.props.onChange([],t,i));const r=this.getSelectedFieldsArr(t,s,a,o).asMutable(),n=this.getValidFields(t,o);let l=r.map(e=>null==n?void 0:n[e]);e.forEach(e=>{l=r.some(t=>t===e.jimuName)?this.props.isMultiple?l.filter(t=>t.jimuName!==e.jimuName):[]:o?l.concat(e):[e]}),this.props.onChange&&this.props.onChange(l,t,i)},this.state={selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields),searchValue:"",isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext}}componentDidMount(){this.props.getDefaultField&&this.props.getDefaultField(this.getDefaultFieldFromDs(this.props.dataSources,this.props.selectedFields))}componentDidUpdate(e,t){this.getWhetherArrayIsShallowEqual(this.props.dataSources,e.dataSources)&&this.props.selectedFields===e.selectedFields||this.setState({selectedDs:this.getDefaultSelectedDs(this.props.dataSources,this.props.selectedFields)}),this.getWhetherArrayIsShallowEqual(this.props.dataSources,e.dataSources)||this.props.getDefaultField&&this.props.getDefaultField(this.getDefaultFieldFromDs(this.props.dataSources,this.props.selectedFields)),e.isSelectedFromRepeatedDataSourceContext!==this.props.isSelectedFromRepeatedDataSourceContext&&this.setState({isFromRepeatedDs:!!this.props.isSelectedFromRepeatedDataSourceContext})}getDefaultFieldFromDs(e,t){let s;if(this.getAreFromMultipleDss(e,t))s={},e.forEach(e=>{s[e.id]=this.getOneDefaultFieldFromDs(e)});else{const t=e[0];s=this.getOneDefaultFieldFromDs(t)}return s}getOneDefaultFieldFromDs(e){if(e&&e.getSchema){const t=this.getValidFields(e),s=t&&Object.keys(t)[0];return t&&s?t[s]:null}return null}getAllFields(e){var t;const s=null==e?void 0:e.getSelectedFields(),a=null===(t=null==e?void 0:e.getSchema())||void 0===t?void 0:t.fields,i=a?Object.keys(a).filter(e=>!s.includes(e)):[];return null==a?void 0:a.without(...i)}render(){if(!this.props.dataSources||0===this.props.dataSources.filter(e=>!!e).length)return console.warn("No data sources"),null;const e=this.getSelectedFieldsArr(this.state.selectedDs,this.props.dataSources,this.props.selectedFields,this.props.isMultiple),t=this.props.noSelectionItem&&0===e.length?Object(o.Immutable)([this.getNoSelectionItem().jimuName]):e;return Object(o.jsx)("div",{style:this.props.style,className:Object(o.classNames)("w-100 h-100",{[this.props.className]:!!this.props.className})},Object(o.jsx)("div",{className:"component-field-selector w-100 h-100"},this.props.isDataSourceDropDownHidden?null:Object(o.jsx)("div",{className:"ds-name p-3 d-flex justify-content-between align-items-center"},Object(o.jsx)(Qt,{widgetId:this.props.widgetId,useDataSources:this.getUseDataSources(this.props.dataSources),onChange:this.onSelectedUseDsChange,useSelectionDataView:this.props.useSelectionDataView,usePopulatedDataView:this.props.usePopulatedDataView,selectedUseDataSource:this.getSelectedUseDataSource(),isSelectedFromRepeatedDataSourceContext:this.state.isFromRepeatedDs})),this.props.isSearchInputHidden||this.props.useDropdown?null:Object(o.jsx)("div",{className:"d-inline-block w-100 px-3 mb-2 item-selector-search"},Object(o.jsx)(v.TextInput,{placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:o.defaultMessages.search}),onChange:this.onSearchChange,className:"d-inline-block search-input",value:this.state.searchValue,prefix:Object(o.jsx)(v.Icon,{icon:Kt,color:this.props.theme.colors.dark})})),this.props.useDropdown?Object(o.jsx)(Ht,{placeholder:this.props.placeholder,ds:this.state.selectedDs,fields:this.getValidFields(this.state.selectedDs),selectedFields:t,isMultiple:this.props.isMultiple,isSearchInputHidden:this.props.isSearchInputHidden,onFieldClick:this.onFieldClick,theme:this.props.theme,dropdownProps:this.props.dropdownProps,useMultiDropdownBottomTools:this.props.useMultiDropdownBottomTools}):Object(o.jsx)(Bt,{ds:this.state.selectedDs,fields:this.getValidFields(this.state.selectedDs),selectedFields:t,isMultiple:this.props.isMultiple,onFieldClick:this.onFieldClick,theme:this.props.theme})))}}const Yt=Object(o.injectIntl)(o.themeUtils.withStyles(o.themeUtils.withTheme(Xt),"FieldSelector"));var Zt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};class es extends o.React.PureComponent{render(){const e=this.props,{useDataSources:t,dataSources:s}=e,a=Zt(e,["useDataSources","dataSources"]);return s?o.React.createElement(Yt,Object.assign({},this.props)):1===(null==t?void 0:t.length)?o.React.createElement(o.DataSourceComponent,{useDataSource:t[0]},(e,t)=>o.React.createElement(Yt,Object.assign({},a,{dataSources:[e]}))):o.React.createElement(o.MultipleDataSourceComponent,{useDataSources:t},(e,t)=>o.React.createElement(Yt,Object.assign({},a,{dataSources:e&&Object.values(e)})))}}o.ThemeManager.getInstance().registerJimuThemeStyleModule("jimu-ui/advanced/data-source-selector/",{componentStyles:a})}}))}}}));