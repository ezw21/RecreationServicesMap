System.register(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-layouts/layout-runtime","jimu-layouts/layout-builder","jimu-core/dnd"],(function(e){var t,o,n,i,s,a,r;return{setters:[function(e){t=e},function(e){o=e},function(e){n=e},function(e){i=e},function(e){s=e},function(e){a=e},function(e){r=e}],execute:function(){e(function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=100)}([function(e,o){e.exports=t},function(e,t){e.exports=o},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=s},,function(e,t){e.exports=a},,,function(e,t){e.exports=r},,,function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7 1a6 6 0 100 12A6 6 0 007 1zm0 13a7 7 0 115.621-2.828l-.222.284 3.405 3.404a.668.668 0 01-.944.944L11.456 12.4A6.974 6.974 0 017 14z" fill="#000" fill-rule="evenodd"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M7.745 7l4.1 4.1a.527.527 0 01-.745.746L7 7.746l-4.1 4.1a.527.527 0 01-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 01.746-.746l4.1 4.1 4.1-4.1a.527.527 0 01.746.746L7.746 7z" fill="#000"></path><path d="M1 1h12v12H1z"></path></g></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M9.5 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zm-4.75 0a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zM0 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0z" fill="#000"></path><path d="M0 0h12v12H0z"></path></g></svg>'},,function(e,t){e.exports='<svg viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg"><path d="M2.307 6.479L4.677 4l-2.37-2.479a.517.517 0 010-.708.464.464 0 01.677 0l2.71 2.833a.517.517 0 010 .708l-2.71 2.833a.464.464 0 01-.677 0 .517.517 0 010-.708z"></path><path d="M0 0h8v8H0z" fill="none"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 3.146a.5.5 0 01.708 0L6 8.5l5.146-5.354a.5.5 0 01.708.708l-5.5 5.707a.5.5 0 01-.708 0l-5.5-5.707a.5.5 0 010-.708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},,,,,,,function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M2 5.055V11h2V8a1 1 0 011-1h2a1 1 0 011 1v3h2V4.969L6.043 1 2 5.055zM1 6.058l-.149.15a.497.497 0 01-.705 0 .501.501 0 010-.708L5.338.293a.995.995 0 011.41 0l5.106 5.121a.501.501 0 010 .707.497.497 0 01-.705 0L11 5.971V11a1 1 0 01-1 1H2a1 1 0 01-1-1V6.058zM5 11h2V8H5v3z" fill="#000" fill-rule="nonzero"></path></svg>'},,,function(e,t){e.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M20 18a2 2 0 01-2 2H2a2 2 0 01-2-2V2a2 2 0 012-2h16a2 2 0 012 2v16zm-1-3H1v3a1 1 0 001 1h16a1 1 0 001-1v-3zm0-9H1v8h18V6zm-1-5H2a1 1 0 00-1 1v3h18V2a1 1 0 00-1-1z" fill="#000" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 7V0h16v7H0zm1-6h14v5H1V1zM0 16V9h16v7H0zm1-6h14v5H1v-5z" fill="#000"></path></svg>'},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports='<svg viewBox="0 0 15 17" xmlns="http://www.w3.org/2000/svg"><path d="M10.086 0a1 1 0 01.707.293l3.914 3.914a1 1 0 01.293.707V15a2 2 0 01-2 2H2a2 2 0 01-2-2V2a2 2 0 012-2h8.086zM10 1H2a1 1 0 00-1 1v13a1 1 0 001 1h11a1 1 0 001-1V5h-4V1zM7.5 5a.5.5 0 01.5.5V8h2.5a.5.5 0 010 1H8v2.5a.5.5 0 01-1 0V9H4.5a.5.5 0 010-1H7V5.5a.5.5 0 01.5-.5z" fill="#000" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg"><path d="M6 5.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm0 1a2.5 2.5 0 110-5 2.5 2.5 0 010 5zM6 1c-2.124 0-3.714.967-4.867 3C2.286 6.033 3.876 7 6 7s3.714-.967 4.867-3C9.714 1.967 8.124 1 6 1zm0 7C3.333 8 1.333 6.667 0 4c1.333-2.667 3.333-4 6-4s4.667 1.333 6 4c-1.333 2.667-3.333 4-6 4z"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.62 6.366L4.635 4.379a1.5 1.5 0 001.987 1.987zm.746-.745a1.5 1.5 0 00-1.987-1.987l1.987 1.987zM3.899 3.644l-.825-.825C2.322 3.314 1.678 4.038 1.133 5 2.286 7.033 3.876 8 6 8c.702 0 1.345-.106 1.934-.32L7.356 7.1A2.5 2.5 0 013.9 3.645zm.745-.745A2.5 2.5 0 018.1 6.355l.826.826c.752-.495 1.396-1.219 1.941-2.181C9.714 2.967 8.124 2 6 2c-.702 0-1.345.106-1.934.32l.578.579zM2.354 2.1L1.155.9A.527.527 0 011.9.154l1.4 1.4C4.107 1.184 5.008 1 6 1c2.667 0 4.667 1.333 6 4-.634 1.268-1.419 2.235-2.355 2.9l1.2 1.2a.527.527 0 01-.745.746l-1.4-1.4C7.893 8.816 6.992 9 6 9 3.333 9 1.333 7.667 0 5c.634-1.268 1.419-2.235 2.355-2.9z"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 9.56a.5.5 0 00.708 0L6 4.208l5.146 5.354a.5.5 0 00.708-.708l-5.5-5.707a.5.5 0 00-.708 0l-5.5 5.707a.5.5 0 000 .708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},function(e,t){e.exports='<svg viewBox="0 0 10 12" xmlns="http://www.w3.org/2000/svg"><path d="M1 0h8a1 1 0 011 1v10a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1zm0 1v10h8V1H1zm2 2h4a.5.5 0 010 1H3a.5.5 0 010-1zm0 2.5h4a.5.5 0 010 1H3a.5.5 0 010-1z" fill="#000" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 0c3.314 0 6 2.574 6 5.75S9.314 11.5 6 11.5c-.78 0-1.524-.142-2.207-.402-.395-.15-1.66.151-3.793.902l.198-.52C.784 9.893.967 8.91.747 8.53A5.538 5.538 0 010 5.75C0 2.574 2.686 0 6 0zm0 1C3.23 1 1 3.136 1 5.75c0 .809.212 1.587.613 2.28.282.49.294 1.153.068 2.09l-.08.304.155-.044c1.092-.306 1.81-.391 2.297-.248l.094.031A5.212 5.212 0 006 10.5c2.77 0 5-2.136 5-4.75S8.77 1 6 1zM4 3H3v5h1V6h2v2h1V3H6v2H4V3zm4 2h1v3H8V5zm1-2H8v1h1V3z" fill="#000"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 15 16" xmlns="http://www.w3.org/2000/svg"><path d="M13 0a2 2 0 012 2v9a2 2 0 01-2 2H5l-5 3V2a2 2 0 012-2h11zm0 1H2a1 1 0 00-.993.883L1 2v12.233L4.723 12H13a1 1 0 00.993-.883L14 11V2a1 1 0 00-.883-.993L13 1zM7.5 3a.5.5 0 01.5.5V6h2.5a.5.5 0 010 1H8v2.5a.5.5 0 01-1 0V7H4.5a.5.5 0 010-1H7V3.5a.5.5 0 01.5-.5z" fill="#C5C5C5" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16.572 18.746V32h13.257V18.746H16.572zM0 32h13.257V18.746H0V32zM0 2.179v13.254h13.257V2.179H0zM22.629 0l-9.371 9.377 9.371 9.369L32 9.377 22.629 0z"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12 0a2 2 0 012 2v4h4a2 2 0 012 2v10a2 2 0 01-2 2H8a2 2 0 01-2-2v-4H2a2 2 0 01-2-2V2a2 2 0 012-2h10zm6 7h-4v5a2 2 0 01-2 2H7v4a1 1 0 001 1h10a1 1 0 001-1V8a1 1 0 00-1-1zm-6-6H2a1 1 0 00-1 1v10a1 1 0 001 1h4V8a2 2 0 012-2h5V2a1 1 0 00-1-1zm1 6H8a1 1 0 00-1 1v5h5a1 1 0 001-1V7z" fill="#000" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1 18a1 1 0 001 1v1a2 2 0 01-2-2zm19 0a2 2 0 01-2 2v-1a1 1 0 001-1h1zM5 19v1H3v-1h2zm4 0v1H7v-1h2zm4 0v1h-2v-1h2zm4 0v1h-2v-1h2zM1 15v2H0v-2h1zm19 0v2h-1v-2h1zM1 11v2H0v-2h1zm19 0v2h-1v-2h1zM1 7v2H0V7h1zm19 0v2h-1V7h1zM1 3v2H0V3h1zm19 0v2h-1V3h1zM2 0v1a1 1 0 00-.993.883L1 2H0A2 2 0 011.85.005L2 0zm16 0a2 2 0 012 2h-1a1 1 0 00-1-1zM5 0v1H3V0h2zm4 0v1H7V0h2zm4 0v1h-2V0h2zm4 0v1h-2V0h2z" fill="#000" fill-rule="evenodd"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 1h10v10H1V1zM0 12V0h12v12H0zm3-8h6v4H3V4zM2 9V3h8v6H2z" fill="#C5C5C5"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M1 0h10a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1zm0 1v2h10V1H1zm0 4h2a1 1 0 011 1v5a1 1 0 01-1 1H1a1 1 0 01-1-1V6a1 1 0 011-1zm0 1v5h2V6H1zm5-1h5a1 1 0 011 1v5a1 1 0 01-1 1H6a1 1 0 01-1-1V6a1 1 0 011-1zm0 1v5h5V6H6z" fill="#000" fill-rule="nonzero"></path></svg>'},function(e,t){e.exports='<svg viewBox="0 0 16 4" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 3a.5.5 0 010 1H.5a.5.5 0 010-1h15zm0-3a.5.5 0 010 1H.5a.5.5 0 010-1h15z" fill="#000" fill-rule="evenodd"></path></svg>'},,,function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return Nt}));var n={};o.r(n),o.d(n,"defaultMatcher",(function(){return x})),o.d(n,"findNode",(function(){return w})),o.d(n,"filterTree",(function(){return S})),o.d(n,"expandFilteredNodes",(function(){return j})),o.d(n,"expandNodesByExpandIds",(function(){return O})),o.d(n,"activeNodesByActiveIds",(function(){return C})),o.d(n,"activeAndExpandNodesByActiveIds",(function(){return T})),o.d(n,"fetchAllExpandIds",(function(){return P}));var i={};o.r(i),o.d(i,"getOutlineItemId",(function(){return K})),o.d(i,"getLayoutInfo",(function(){return Q})),o.d(i,"handleRemove",(function(){return ee})),o.d(i,"handleDuplicate",(function(){return te})),o.d(i,"handleRename",(function(){return oe})),o.d(i,"toggleLockLayout",(function(){return ne})),o.d(i,"moveToPending",(function(){return ie})),o.d(i,"sendBackwardByItemJson",(function(){return se})),o.d(i,"bringForwardByItemJson",(function(){return ae})),o.d(i,"sendToBackByItemJson",(function(){return re})),o.d(i,"bringToFrontByItemJson",(function(){return le})),o.d(i,"sinkingActionBytemJson",(function(){return ce})),o.d(i,"floatingActionBytemJson",(function(){return de})),o.d(i,"alignLeftByItemJson",(function(){return pe})),o.d(i,"horizontalCenterByItemJson",(function(){return ue})),o.d(i,"alignRightItemJson",(function(){return ge})),o.d(i,"snapToTopByItemJson",(function(){return he})),o.d(i,"verticalCenterByItemJson",(function(){return me})),o.d(i,"snapToBottomByItemJson",(function(){return fe})),o.d(i,"fullWidthByItemJson",(function(){return ve})),o.d(i,"fullHeightByItemJson",(function(){return be})),o.d(i,"fullSizeByItemJson",(function(){return ye})),o.d(i,"shouldUpdateByWidgets",(function(){return Ie})),o.d(i,"shouldUpdateBySections",(function(){return xe})),o.d(i,"shouldUpdateByViews",(function(){return we})),o.d(i,"shouldUpdateByScreenGroups",(function(){return Se})),o.d(i,"shouldUpdateByScreens",(function(){return je})),o.d(i,"shouldUpdateByLayouts",(function(){return Oe})),o.d(i,"getTotalLines",(function(){return Ce})),o.d(i,"getTotalExpandedNumOverItem",(function(){return Te})),o.d(i,"formatMessage",(function(){return Pe}));var s={};o.r(s),o.d(s,"findParentLayoutItem",(function(){return Re})),o.d(s,"buildLayoutStructure",(function(){return Be})),o.d(s,"findLayoutId",(function(){return ot})),o.d(s,"findLayoutItem",(function(){return Ee})),o.d(s,"findSectionId",(function(){return Je})),o.d(s,"findParentViewId",(function(){return Ne})),o.d(s,"findParentScreenId",(function(){return Fe})),o.d(s,"getContentIdInLayoutItem",(function(){return $e})),o.d(s,"getContentsInLayout",(function(){return He})),o.d(s,"getContentsInLayoutRecursive",(function(){return Ve})),o.d(s,"getContainerLayoutItem",(function(){return Ge})),o.d(s,"getLayoutItemIds",(function(){return Ue})),o.d(s,"getLayoutInfosByType",(function(){return Ze})),o.d(s,"getWidgetIdThatUseTheLayoutId",(function(){return _e})),o.d(s,"getContentContainerInfo",(function(){return qe})),o.d(s,"getContentRootContainerInfo",(function(){return Xe})),o.d(s,"getRelatedLayoutItemsInWidgetByLayoutInfo",(function(){return dt})),o.d(s,"getRelatedLayoutInfosInWidgetByLayoutInfo",(function(){return ct})),o.d(s,"getLayoutInfosHoldcontent",(function(){return nt})),o.d(s,"getBrowserSizeModeByLayoutIdAndWidgetId",(function(){return rt})),o.d(s,"getBrowserSizeModeByLayoutId",(function(){return lt})),o.d(s,"getChildrenContents",(function(){return st})),o.d(s,"getContentLayoutInfosInOneSizeMode",(function(){return at})),o.d(s,"getContentsInView",(function(){return Qe})),o.d(s,"getContentsInPageHeader",(function(){return et})),o.d(s,"getContentsInPageFooter",(function(){return tt})),o.d(s,"getContentsInPageBody",(function(){return Ye})),o.d(s,"getContentsInScreen",(function(){return Ke})),o.d(s,"getContentsInLayoutWithLayoutWidgetOnly",(function(){return We})),o.d(s,"getContentsInTheSameContainer",(function(){return ut})),o.d(s,"getParentWidgetIdOfContent",(function(){return it})),o.d(s,"getBlockAnchorPointsInPage",(function(){return gt})),o.d(s,"getScreenAnchorPointsInPage",(function(){return ht})),o.d(s,"getSectionInfo",(function(){return mt})),o.d(s,"getPendingLayoutItemsInPage",(function(){return ft})),o.d(s,"getPendingLayoutItemsInDialog",(function(){return bt})),o.d(s,"getPendingLayoutItemsInLayoutWithDeep",(function(){return It})),o.d(s,"getPendingLayoutItemsFromOtherSizeMode",(function(){return xt})),o.d(s,"getPendingLayoutItemsFromOtherSizeModeInPage",(function(){return vt})),o.d(s,"getPendingLayoutItemsFromOtherSizeModeInDialog",(function(){return yt}));var a=o(0),r=o(2),l=o(1),c=o(6),d=o(3),p=o(4),u={tocChooseTemplate:"Select a page template",newPage:"New page",pages_upper:"Pages",content_upper:"Content",body_upper:"Body",tocLoading:"Loading",addPage:"Add page",addLink:"Add link",addFolder:"Add folder",addDialog:"Add window",makeHome:"Make homepage",makeSplash:"Set as splash",opendWithPages:"Opend with {pages}.",hideFromMenu:"Hide from menu",showFromMenu:"Show in menu",body:"Body",header:"Header",footer:"Footer",outline:"Outline",tocSetLink:"Set link",certainly:"OK",removePageTip:"There is(are) {subCount} subpage(s) in {label}, do you really want to remove it?",fullScreenApp:"Fullscreen app",fullScreenAppTip:"Best for creating a web app that takes the full area of the browser window.",scrollingPage:"Scrolling page",scrollingPageTip:"Best for creating a web page that scrolls in the browser window.",arrange:"Arrange",align:"Align"},g=o(9);class h extends a.React.Component{constructor(e){super(e),this.formatMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:u[e]}),this.handleArrowClick=e=>{const{onArrowClick:t,itemJson:o}=this.props;t&&t(o),e.stopPropagation()},this.handleClick=e=>{const{itemJson:t,editable:o}=this.props;t.allowEditable&&o&&e.stopPropagation()},this.handleMouseEnter=e=>{e.stopPropagation();const{itemJson:t}=this.props,o=t.id.split("-toc-");o[0]&&o[1]&&r.builderAppSync.publishTocHoverInfoToApp({layoutId:o[0],layoutItemId:o[1]},!0)},this.handleMouseLeave=e=>{e.stopPropagation();const{itemJson:t}=this.props,o=t.id.split("-toc-");o[0]&&o[1]&&r.builderAppSync.publishTocHoverInfoToApp({layoutId:o[0],layoutItemId:o[1]},!1)},this.handleDoubleClickItem=e=>{const{itemJson:t,onDoubleClick:o}=this.props;o&&o(t,e),e.stopPropagation()},this.renameItemClick=e=>{e&&e.stopPropagation(),this.editor.current&&(setTimeout(()=>{let e,t;this.editor.current.focus(),window.getSelection&&document.createRange?(t=document.createRange(),t.selectNodeContents(this.editor.current),e=window.getSelection(),e.removeAllRanges(),e.addRange(t)):(e=document.createRange(),e.setStart(this.editor.current.firstChild,this.editor.current.innerText.length),e.select())},1),this.editor.current.onkeydown=e=>{"Enter"===e.key&&(e.preventDefault(),this.onRenameBlur(null))})},this.onRenameBlur=e=>{if(!this.editor.current)return;const t=this.editor.current.innerText;this.editor.current.innerText="",setTimeout(()=>{this.editor.current.innerText=t},10),setTimeout(()=>{const{renameItem:e}=this.props;e&&this.props.renameItem(this.props.itemJson,t)||(this.editor.current.innerText=this.props.itemJson.label)},30)},this.editor=a.React.createRef()}componentDidMount(){const{editable:e}=this.props;e&&this.renameItemClick()}componentDidUpdate(e){const{itemJson:t,editable:o}=this.props;t.allowEditable&&o!==e.editable&&o&&this.renameItemClick()}}class m extends h{constructor(e){super(e),this.onDropHover=e=>{this.state.dropType!==e&&this.setState({dropType:e})},this.getStyle=()=>{var e,t;const o=Object(a.getAppStore)().getState(),n=null===(e=null==o?void 0:o.appContext)||void 0===e?void 0:e.isRTL,{theme:i,editable:s,itemJson:r,isTocDragging:l}=this.props,{mustShowArrow:c,children:d,level:p,isActive:u,isExpand:g}=r,{isDragging:h,isHovering:m}=this.state;return a.css`
      height: ${30}px;
      width: auto;
      min-width: 100%;
      align-items: center;
      cursor: pointer;
      ${h?"z-index: 100;":""}

      &.drag-move-into {
        border: 1px solid ${i.colors.palette.primary[700]};
      }

      :hover {
        ${u||l?"":`background-color: ${i.colors.palette.light[400]};`}
        .dropDown {
          .btn {
            display: ${l?"none":"inline-flex"};
          }
          z-index: 2;
        }
        .page-item-visible-btn {
          display: ${l?"none":"inline-flex"};
          z-index: 2;
        }
        .page-item-home-btn {
          display: ${r.showDefault?l&&!(null===(t=null==r?void 0:r.data)||void 0===t?void 0:t.isDefault)?"none":"inline-flex":"none"};
          z-index: 2;
        }
      }

      &.active {
        ${l?"":`background-color: ${i.colors.primary};`}
        border: 0;
      }

      .toc-item-dropzone {
        touch-action: none;
        position: relative;

        .toc-item-drag:hover {
          cursor: pointer !important;
        }

        .toc-item-drag {
          pointer-events: ${m?"all":"none"};
          visibility: ${r.allowEditable&&s?"hidden":"visible"};
          z-index: 1;
          position: absolute;
          left: 0;
          top: 0;
          right: 0;
          bottom: 0;
          background-color: ${h?a.polished.rgba(i.colors.palette.light[400],.6):"transparent"};
          box-shadow: ${h?i.boxShadows.lg:i.boxShadows.none};
        }

        .toc-item {
          padding: 0;
          border: 0;
          position: relative;
          .toc-item-content {
            margin-left: ${10*p}px;
            position: relative;
            .toc-arrow {
              z-index: 2;
              padding-right: ${a.polished.rem(1)};
              visibility: ${c||d&&d.length>0?"visible":"hidden"};
              .toc-arrow-icon {
                fill: ${i.colors.black};
                transform-origin: center;
                transform: ${`rotate(${g?90:n?180:0}deg)`};
                transition: transform .5s;
              }
            }

            .left-and-right {
              overflow-x: hidden;
              margin-left: -5px;
              .left-content {
                align-items: center;
                overflow-x: hidden;
                flex: auto;
                .editor {
                  overflow: hidden;
                  text-overflow: ${s?"clip":"ellipsis"};
                  white-space: nowrap;
                  font-size: ${.875}rem;
                  user-select: none;
                  flex: auto;
                  text-align: start;
                }
                [contenteditable="true"] {
                  -webkit-user-select: text;
                  background-color: ${i.colors.white};
                }
                .header-icon {
                  margin-right: 0.3rem;
                  flex: none;
                }
              }
            }
          }

          &.toc-drag-move-last {
            :after{
              content: '';
              position: absolute;
              left: 0;
              top: auto;
              bottom: 0;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${i.colors.palette.primary[700]};
            }
          }

          &.toc-drag-move-first {
            :before {
              content: '';
              position: absolute;
              left: 0;
              top: 0;
              bottom: auto;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${i.colors.palette.primary[700]};
            }
          }

          .drag-move-out-order-bottom {
            :after{
              content: '';
              position: absolute;
              left: 0;
              top: auto;
              bottom: 0;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${i.colors.palette.primary[700]};
            }
          }

          .drag-move-out-order-top {
            :before {
              content: '';
              position: absolute;
              left: 0;
              top: 0;
              bottom: auto;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${i.colors.palette.primary[700]};
            }
          }
        }
      }
    `},this.state={dropType:"none",isDragging:!1,isHovering:!1},this.dropZoneRef=a.React.createRef(),this.dragRef=a.React.createRef()}componentWillUnmount(){this.dragInteractable&&(this.dragInteractable.unset(),this.dragInteractable=null),this.dropZoneInteractable&&(this.dropZoneInteractable.unset(),this.dropZoneInteractable=null)}componentDidMount(){super.componentDidMount();const{canDnd:e,canDragFunc:t,canDropFunc:o,onDidDrop:n,canOrderFunc:i,canDropIntoFunc:s,itemJson:a}=this.props,{index:r}=a;if(e&&this.dropZoneRef.current&&this.dragRef.current){let e=null;this.dragRef.current.setAttribute("itemJson",JSON.stringify(a)),this.dropZoneInteractable=Object(g.interact)(this.dropZoneRef.current).dropzone({accept:".toc-item-drag",overlap:"pointer",ondropmove:e=>{const t=e.relatedTarget,n=e.target,l=JSON.parse(t.getAttribute("itemJson"));if(!o||!o(a.data,l.data))return;const c=n.getBoundingClientRect(),d=c.bottom-c.top,p=2*d/3,u=1*d/3,g=d/2,h=e.dragEvent.client.y-c.top;let m=this.state.dropType;m=i&&i(l.data,a.data)?s&&s(l.data,a.data)?h>p?"bottom":h<u?"top":"moveInto":0===r?h>g?"bottom":"top":"bottom":s&&s(l.data,a.data)?"moveInto":"none",this.onDropHover(m)},ondragleave:e=>{this.onDropHover("none")},ondrop:e=>{const t=this.state.dropType;if("none"===t)return;const o=e.relatedTarget,i=JSON.parse(o.getAttribute("itemJson"));n&&n(i,a,t),this.onDropHover("none")}}),t&&t(a.data)&&(this.dragInteractable=Object(g.interact)(this.dragRef.current).draggable({inertia:!1,modifiers:[],autoScroll:!0,onstart:e=>{this.setState({isDragging:!0});const{onTocDragStatusChage:t}=this.props;t&&t(!0)},onmove:t=>{const{clientX:o,clientY:n,clientX0:i,clientY0:s,target:a}=t,r=parseFloat(a.getAttribute("start-x"))||0,l=parseFloat(a.getAttribute("start-y"))||0;let c=o-i+r,d=n-s+l;const p=-a.clientWidth/2,u=a.clientWidth/2;c<p?c=p:c>u&&(c=u);const{parentBoundBottom:g,parentBoundTop:h}=this.props;if(g>-1&&h>-1){const e=h-s,t=g-s;d<=e?d=e:d>=t&&(d=t)}e&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{a.style.webkitTransform=a.style.transform="translate("+c+"px, "+d+"px)",e=null})},onend:t=>{const{target:o}=t;e&&cancelAnimationFrame(e),o.style.webkitTransform=o.style.transform="translate(0px, 0px)",this.setState({isDragging:!1});const{onTocDragStatusChage:n}=this.props;n&&n(!1)}}))}}componentDidUpdate(e){super.componentDidUpdate(e)}render(){var e,t;const{itemJson:n,renderRightContent:i,editable:s,canDnd:r,theme:c,isFirstItem:d,isLastItem:p,tocDraggingStatus:u,isTocDragging:g}=this.props,{icon:h,isActive:m}=n,{dropType:f,isDragging:v}=this.state;let b;b=h&&h.svg?h:{svg:h};const y="moveInto"===f?"drag-move-into":"",I="drag-move-out-order-"+f;let x="";g&&"on"!==u&&("bottom"===u&&p?x="toc-drag-move-last":"top"===u&&d&&(x="toc-drag-move-first"));const w=null===(t=null===(e=Object(a.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.theme;return Object(a.jsx)("div",{className:`d-flex ${m?"active":""}   ${y}`,css:this.getStyle(),onMouseEnter:e=>this.setState({isHovering:!0}),onMouseLeave:e=>this.setState({isHovering:!1})},Object(a.jsx)("div",{ref:this.dropZoneRef,className:"toc-item-dropzone h-100 w-100"},Object(a.jsx)("div",{className:"d-flex w-100 h-100",onDoubleClick:this.handleDoubleClickItem,onClick:this.handleClick},Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 toc-item "+x},Object(a.jsx)("div",{className:`d-flex toc-item-content ${I} w-100`},Object(a.jsx)(l.Button,{className:"toc-arrow",icon:!0,type:"tertiary",onClick:this.handleArrowClick},Object(a.jsx)(l.Icon,{className:"toc-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},Object(a.jsx)("div",{className:"d-flex left-content "+(i?"pr-0":"pr-2")},h&&Object(a.jsx)(l.Icon,{autoFlip:n.needFlip,className:"header-icon",color:b.properties&&a.themeUtils.color(b.properties.color,w)||c.colors.palette.dark[600],size:12,icon:b.svg}),Object(a.jsx)("div",{title:n.label,className:"item-label editor",ref:this.editor,onBlur:this.onRenameBlur,contentEditable:n.allowEditable&&s,suppressContentEditableWarning:!0},n.label)),i&&i(n)))),r&&Object(a.jsx)("div",{className:"toc-item-drag",ref:this.dragRef},v&&Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 toc-item"},Object(a.jsx)("div",{className:"d-flex toc-item-content w-100"},Object(a.jsx)(l.Button,{icon:!0,type:"tertiary",className:"toc-arrow"},Object(a.jsx)(l.Icon,{className:"toc-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},Object(a.jsx)("div",{className:"d-flex left-content "+(i?"pr-0":"pr-2")},h&&Object(a.jsx)(l.Icon,{className:"header-icon",size:12,icon:h}),Object(a.jsx)("div",{title:n.label,className:"item-label editor"},n.label)),i&&i(n))))))))}}class f extends a.React.PureComponent{constructor(e){super(e),this.onDropDownToggle=e=>{const{isOpen:t}=this.state;e.stopPropagation(),!this.dontDismiss&&this.setState({isOpen:!t}),this.dontDismiss=!1},this.onItemClick=(e,t)=>{t.autoHide||void 0===t.autoHide?this.setState({isOpen:!1}):this.dontDismiss=!0,t.event(e)},this.state={isOpen:!1}}render(){const{items:e,toggleContent:t,direction:n,disabled:i,title:s,icon:r,caret:c}=this.props,{isOpen:d}=this.state;return Object(a.jsx)("div",{className:"d-flex align-items-center"},Object(a.jsx)(l.Dropdown,{direction:n||"down",size:"sm",toggle:this.onDropDownToggle,isOpen:d},Object(a.jsx)(l.DropdownButton,{title:s,arrow:c,icon:r||void 0===r,disabled:i,size:"sm",type:"tertiary"},t||Object(a.jsx)(l.Icon,{size:12,icon:o(14)})),Object(a.jsx)(l.DropdownMenu,null,e.map((e,t)=>{var o;return(e.visible||void 0===e.visible)&&(e.isBtn?Object(a.jsx)(a.React.Fragment,{key:t},e.label):Object(a.jsx)(l.DropdownItem,{key:t,title:null!==(o=e.title)&&void 0!==o?o:"",className:"no-user-select",onClick:t=>this.onItemClick(t,e)},e.label))}))))}}f.defaultProps={caret:!1};class v extends a.React.PureComponent{constructor(e){super(e),this.onItemClick=(e,t)=>{t.event(e)},this.state={}}render(){const{items:e,toggleContent:t,direction:n,disabled:i,title:s,icon:r,caret:c}=this.props;return Object(a.jsx)(l.DropdownSubMenuItem,{direction:n},Object(a.jsx)(l.DropdownButton,{title:s,arrow:c,icon:r||void 0===r,disabled:i,size:"sm",type:"tertiary"},t||Object(a.jsx)(l.Icon,{size:12,icon:o(14)})),Object(a.jsx)(l.DropdownMenu,null,e.map((e,t)=>{var o,n;return(e.visible||void 0===e.visible)&&(e.isBtn?Object(a.jsx)(l.DropdownSubMenuItem,{key:t,title:null!==(o=e.title)&&void 0!==o?o:"",onClick:t=>this.onItemClick(t,e)},e.label):Object(a.jsx)(l.DropdownItem,{key:t,title:null!==(n=e.title)&&void 0!==n?n:"",className:"no-user-select",onClick:t=>this.onItemClick(t,e)},e.label))})))}}class b extends a.React.PureComponent{constructor(){super(...arguments),this.handleArrowClick=e=>{e.stopPropagation();const{handleExpand:t}=this.props;t&&t()},this.getStyle=()=>{const{theme:e,itemJson:t,level:o}=this.props,{mustShowArrow:n,children:i,isActive:s,isExpand:r}=t;return a.css`
      height: ${30}px;
      width: 100%;
      align-items: center;
      border: 0;
      cursor: pointer;

      &.active {
        background-color: ${e.colors.palette.primary[100]};
        border: 0;
      }

      :hover {
        ${s?"":`background-color: ${a.polished.rgba(e.colors.palette.light[400],.4)};`}
      }

      .tree-item-content {
        padding: 0;
        padding-left: ${30*o}px;
        border: 0;

        .tree-arrow {
          visibility: ${n||i&&i.length>0?"visible":"hidden"};
          height: 24px;
          padding-right: 5px;
          padding-left: 5px;
          width: auto;
          display: flex;
          align-self: center;
          align-items: center;
          justify-content: center;
          transform-origin: center;
          transform: ${`rotate(${r?90:0}deg)`};
          transition: transform .5s;
          .tree-arrow-icon {
            fill: ${e.colors.black};
          }
        }

        .left-and-right {
          overflow-x: hidden;
          .left-content {
            align-items: center;
            overflow-x: hidden;
            flex: auto;
            .item-label{
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
              font-size: ${.875}rem;
              text-align: start;
            }
            .header-icon {
              margin-right: 0.5rem;
              fill: ${e.colors.black};
            }
          }
        }
      }
    `}}render(){const{itemJson:e,renderRightContent:t,renderHeaderContent:n,arrowIcon:i}=this.props,{icon:s,isActive:r}=e;return Object(a.jsx)("div",{className:`d-flex ${r?"active":""} tree-item-common`,css:this.getStyle()},Object(a.jsx)("div",{className:"d-flex tree-item-content w-100"},Object(a.jsx)("div",{className:"tree-arrow",onClick:this.handleArrowClick},i?i(e):Object(a.jsx)(l.Icon,{className:"tree-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},n?n(e):Object(a.jsx)("div",{className:"d-flex left-content "+(t?"pr-0":"pr-2")},s&&Object(a.jsx)(l.Icon,{className:"header-icon",size:12,icon:s}),Object(a.jsx)("div",{title:e.label,className:"item-label"},e.label)),t&&t(e))))}}class y extends a.React.PureComponent{constructor(e){super(e),this.handleClickItem=e=>{const{onClickItem:t,itemJson:o}=this.props;t&&t(o,e)},this.getStyle=()=>a.css`
      &.${"jimu"}-tree-item{
        padding: 0;
        margin: 0;
        border: 0;
      }
    `}render(){const{itemJson:e,theme:t,level:o,handleExpand:n}=this.props,{renderItem:i,renderHeaderContent:s,renderRightContent:r,arrowIcon:c,className:d}=e;return Object(a.jsx)(l.ListGroupItem,{css:this.getStyle,onClick:this.handleClickItem,className:Object(a.classNames)("jimu-tree-item","d-flex",d||"")},i?i(e):Object(a.jsx)(b,{itemJson:e,level:o,renderHeaderContent:s,renderRightContent:r,arrowIcon:c,theme:t,handleExpand:n}))}}class I extends a.React.PureComponent{constructor(e){var t;super(e),this.handleSingleClick=(e,t)=>{const{onClickItem:o}=this.props;o&&o(e,t)},this.handleExpand=()=>{const{handleExpand:e}=this.props;let{itemJson:t}=this.props;t=t.set("isExpand",!t.isExpand),e&&e(t)},this.renderSubItemsTimeout=void 0,this.SingleTreeItem=({itemJson:e,level:t})=>a.React.createElement(y,{key:e.id,itemJson:e,level:t,handleExpand:this.handleExpand,onClickItem:this.handleSingleClick,theme:this.props.theme}),this.state={renderSubItems:null===(t=e.itemJson)||void 0===t?void 0:t.isExpand}}componentDidUpdate(e){const{itemJson:t}=this.props,{itemJson:o}=e;(null==t?void 0:t.isExpand)!==(null==o?void 0:o.isExpand)&&(this.renderSubItemsTimeout&&(clearTimeout(this.renderSubItemsTimeout),this.renderSubItemsTimeout=void 0),(null==t?void 0:t.isExpand)?this.setState({renderSubItems:!0}):this.renderSubItemsTimeout=setTimeout(()=>{this.setState({renderSubItems:!1})},1e3))}render(){const{itemJson:e,level:t}=this.props,{SingleTreeItem:o}=this,{renderSubItems:n}=this.state;return a.React.createElement(a.React.Fragment,null,a.React.createElement(o,{key:e.id,itemJson:e,level:t}),e.children&&e.children.length>0&&a.React.createElement("div",{className:"out-container"},a.React.createElement("div",{className:"in-container"},a.React.createElement(l.Collapse,{isOpen:e.isExpand},n&&this.props.children))))}}const x=(e,t)=>t.label.toLocaleLowerCase().includes(e.toLocaleLowerCase()),w=(e,t,o)=>o(t,e)||e.children&&e.children.length&&!!e.children.find(e=>w(e,t,o)),S=(e,t,o=x)=>{if(o(t,e)||!e.children)return e;const n=e.children.filter(e=>w(e,t,o)).map(e=>S(e,t,o));return Object(a.Immutable)(Object.assign({},e,{children:n}))},j=(e,t,o=x)=>{let n=e.children;if(!n||0===n.length)return Object(a.Immutable)(Object.assign({},e,{isExpand:!1}));const i=n.filter(e=>w(e,t,o)),s=i.length>0;return s&&(n=i.map(e=>j(e,t,o))),Object(a.Immutable)(Object.assign({},e,{children:n,isExpand:s}))},O=(e,t)=>{const o=e.children;o&&o.length>0&&o.forEach((o,n)=>{e=e.setIn(["children",n],O(o,t))});const n=t.includes(e.id);return e.set("isExpand",n)},C=(e,t)=>{const o=e.children;o&&o.length>0&&o.forEach((o,n)=>{e=e.setIn(["children",n],C(o,t))});const n=t.includes(e.id);return e.set("isActive",n)},T=(e,t)=>{if(!e)return null;let o=null==e?void 0:e.children;o&&o.length>0&&o.forEach((o,n)=>{e=e.setIn(["children",n],T(o,t))}),o=null==e?void 0:e.children;const n=t.includes(null==e?void 0:e.id),i=(null==e?void 0:e.isExpand)||D(o);return e.set("isActive",n).set("isExpand",i)},P=e=>{if(!e)return[];const t=[],o=null==e?void 0:e.children;return o&&o.length>0&&o.forEach(e=>t.push(...P(e))),(null==e?void 0:e.isExpand)&&t.push(null==e?void 0:e.id),t},D=e=>!!e&&!!e.find(e=>e.isActive||D(e.children));class k extends a.React.PureComponent{constructor(e){super(e),this.handleSingleClick=(e,t)=>{const{onClickItem:o}=this.props;o&&o(e,t)},this.handleExpand=e=>{const{handleExpand:t}=this.props;t&&t(e)},this.renderItemJson=e=>a.React.createElement(I,{key:e.id,handleExpand:this.handleExpand,itemJson:e,onClickItem:this.handleSingleClick,theme:this.props.theme},e.children&&e.children.map(e=>this.renderItemJson(e))),this.state={itemJsons:e.itemJsons}}render(){const{itemJson:e,className:t,hideRoot:o,forwardRef:n}=this.props;return a.React.createElement("div",{className:Object(a.classNames)("jimu-tree",t),ref:n},o?e&&e.children&&e.children.map(e=>this.renderItemJson(e)):this.renderItemJson(e))}}const A=a.themeUtils.withTheme(k);class M extends a.React.PureComponent{constructor(e){super(e),this.handleCloseBtn=()=>{this.isActionClick=!1,this.setState({isOpen:!1});const{toggle:e,isOpen:t}=this.props;void 0!==t&&e&&e()},this.handleActionClick=()=>{this.isActionClick=!0,this.setState({isOpen:!1});const{toggle:e,isOpen:t}=this.props;void 0!==t&&e&&e()},this.handleToggle=()=>{const{isOpen:e,tapBlankClose:t}=this.props;if(!t)return;this.setState({isOpen:!e});const{toggle:o,isOpen:n}=this.props;void 0!==n&&o&&o()},this.onModalClosed=()=>{const{onClosed:e}=this.props;e&&e(this.isActionClick),this.isActionClick=!1},this.formatMessage=e=>{const t=Object.assign({},u,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:t[e]})},this.getStyle=()=>{const e=this.props.theme;return a.css`
      .modal-header {
        .close {
          color: ${e.colors.palette.dark[600]};
          opacity: 1;
          transition: color .15s ease-in-out;
          &:not(:disabled):not(.disabled):hover,
          &:not(:disabled):not(.disabled):focus {
            opacity: 1;
          }
        }
      }
      .modal-body{
        overflow-y: auto;
        max-height: 360px;
      }
      .modal-content{
        width: auto;
      }
      .modal-footer{
        .btn {
          min-width: 80px;
          + .btn {
            margin-left: 10px;
          }
        }
      }
      &.modal-dialog{
        width: auto;
      }
      .choose-template-description{
        width: 100%;
        font-size: ${14/17}rem;
        user-select:none;
      }
    `},this.state={isOpen:!!e.isOpen}}componentDidUpdate(e){const{isOpen:t}=e;void 0!==t&&void 0===this.props.isOpen&&this.setState({isOpen:t})}render(){let{isOpen:e}=this.props;const{isRemove:t}=this.props;return e=void 0===e?this.state.isOpen:e,Object(a.jsx)(l.Modal,{css:this.getStyle(),isOpen:e,onClosed:this.onModalClosed,toggle:this.handleToggle,centered:!0},Object(a.jsx)(l.ModalHeader,{tag:"h4",toggle:this.handleCloseBtn},this.props.title),Object(a.jsx)(l.ModalBody,null,Object(a.jsx)("div",{style:{marginLeft:"10px"}},this.props.children)),Object(a.jsx)(l.ModalFooter,null,Object(a.jsx)(l.Button,{type:t?"danger":"primary",onClick:this.handleActionClick},t?this.formatMessage("delete"):this.formatMessage("certainly")),Object(a.jsx)(l.Button,{onClick:this.handleCloseBtn},this.formatMessage("cancel"))))}}const L=o(85),z=o(17),B=Object(a.jsx)(l.Icon,{className:"add-page-more-icon",size:12,icon:z}),R=Object.assign({},u,a.defaultMessages,p.defaultMessages,l.defaultMessages),E={value:"",openType:d.OpenTypes.NewWindow,linkType:a.LinkType.WebAddress};let J;const N=[{name:"offset",options:{offset:[0,10]}}];class F extends a.React.PureComponent{constructor(e){super(e),this.linkSettingTrigger=a.React.createRef(),this.getTotalLines=()=>{const{itemJson:e}=this.state;let t=0;return e.children&&e.children.forEach(e=>{var o,n;t++,e.isExpand&&(t+=null!==(n=null===(o=e.children)||void 0===o?void 0:o.length)&&void 0!==n?n:0)}),t},this.getTreeContentHeight=()=>30*this.getTotalLines(),this.handleOnTocDragStatusChange=e=>{this.setState({isTocDragging:e,itemJson:this.getItemJsonByPages()})},this.handleOnTocDraggingStatusChange=e=>{this.setState({tocDraggingStatus:e,itemJson:this.getItemJsonByPages()})},this.handleChooseTemplate=e=>{this.setState({isTemplatePopoverOpen:!1}),this.props.addPageWithType("page",e)},this.handleToggleTemplatePopover=()=>{const{isTemplatePopoverOpen:e}=this.state;this.setState({isTemplatePopoverOpen:!e})},this.closeTemplatePopover=()=>{this.state.isTemplatePopoverOpen&&this.setState({isTemplatePopoverOpen:!1})},this.handleRemovePage=e=>{Object(r.getAppConfigAction)().appConfig.pageStructure.find(t=>t[e.id]&&t[e.id].length>0)?(this.setState({willRemovePage:e}),this.handleToggleRemovePopover()):(J===e.id&&this.setState({isShowLinkSetting:!1}),this.props.removePage(e.id))},this.handleToggleRemovePopover=()=>{const{isRemovePopoverOpen:e}=this.state;this.setState({isRemovePopoverOpen:!e})},this.singleAndDoubleClickTimeout=void 0,this.handleClickItem=e=>{e.data.type!==a.PageType.Folder&&e.data.type!==a.PageType.Link&&(this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),this.singleAndDoubleClickTimeout=setTimeout(()=>{this.setState({currentSelectedItemId:e.id,itemJson:n.activeAndExpandNodesByActiveIds(this.state.itemJson,[e.id])},()=>{this.props.onClickPage(e.data.id)})},200))},this.handleOnTocDoubleClick=(e,t)=>{this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),this.props.changeEditablePageItemId(e.id),t.stopPropagation()},this.handleOnSetLinkClick=(e,t)=>{J&&e.data.id===J&&this.state.isShowLinkSetting||(J=e.data.id,this.resetLinkParam(J),this.state.isShowLinkSetting?this.setState({isShowLinkSetting:!1},()=>{this.setState({isShowLinkSetting:!0})}):this.setState({isShowLinkSetting:!0}),t.stopPropagation())},this.handleExpand=e=>{if((!e.children||e.children.length<1)&&!e.mustShowArrow)return;const{expandIds:t}=this;e.isExpand?t.includes(e.id)&&t.splice(t.indexOf(e.id),1):t.includes(e.id)||t.push(e.id),this.setState({itemJson:n.expandNodesByExpandIds(this.state.itemJson,t)})},this.handleArrowClick=e=>{this.handleExpand(e)},this.handleSearchTextChange=e=>{this.setState({filterText:e},()=>{this.setState({itemJson:this.getItemJsonByPages()})})},this.handleSearchSubmit=e=>{this.setState({filterText:e},()=>{this.setState({itemJson:this.getItemJsonByPages()})})},this.handleSearchBtnClick=e=>{e.stopPropagation();const{showSearch:t}=this.state;t?this.handleSearchTextChange(""):this.searchInput&&(this.searchInput.focus(),this.searchInput.select()),this.setState({showSearch:!t})},this.handleSettingLinkConfirm=e=>{this.setState({isShowLinkSetting:!1}),this.changeUrl(e.value,e.openType)},this.changeUrl=(e,t)=>{const{pages:o}=this.props,n=o[J],i=Object(a.Immutable)(n).merge({linkUrl:e||"#",openTarget:t});Object(r.getAppConfigAction)().editPage(i).exec(),E.value=e,E.openType=t},this.renamePage=(e,t)=>(this.props.changeEditablePageItemId(""),!!(t=null==t?void 0:t.trim())&&this.props.renamePage(e.data.id,t)),this.getFirstItemJson=()=>{const{itemJson:e}=this.state;return e.children[0]},this.getLastItemJson=()=>{const{itemJson:e}=this.state;let t=e.children[e.children.length-1];return t.isExpand&&t.children&&t.children.length>0&&(t=t.children[t.children.length-1]),t},this.getLastParentItemJson=()=>{const{itemJson:e}=this.state;return e.children[e.children.length-1]},this.onDidDrop=(e,t,o)=>{a.lodash.defer(()=>{if("moveInto"===o){this.props.movePageIntoPage(e.data.id,t.data.id);const{expandIds:o}=this;o.includes(t.id)||(o.push(t.id),this.setState({itemJson:n.expandNodesByExpandIds(this.state.itemJson,o)}))}else this.props.reOrderPage(e.data.id,t.data.id,o)})},this.canDragFunc=e=>!0,this.canDropFunc=(e,t)=>e.id!==t.id,this.canDropIntoFunc=(e,t)=>{const o=Object(r.getAppConfigAction)().appConfig;return r.appConfigUtils.isFirstLevelPage(o,t.id)&&!r.appConfigUtils.isPageHasSubPage(o,e.id)&&e.type!==a.PageType.Folder},this.canOrderFunc=(e,t)=>{const o=Object(r.getAppConfigAction)().appConfig;return!(e.type===a.PageType.Folder&&!r.appConfigUtils.isFirstLevelPage(o,t.id))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:R[e]},t),this.getItemJsonByPageJson=(e,t,o)=>{const n=e.id,{expandIds:i}=this,{currentPageItemId:s}=this.props,l=i.includes(n),c={id:n,data:e,label:e.label,index:t,level:o,isActive:s===n,isExpand:l,mustShowArrow:e.type===a.PageType.Folder,showDefault:e.type===a.PageType.Normal,allowEditable:!0,renderItem:this.renderPageContent};return c.icon=e.icon,c.icon||(c.icon=r.utils.getDefaultTocPageIcon(e)),c},this.getItemJsonByPages=(e,t)=>{e||(e=this.props.pages),t||(t=this.props.pageStructure);const o={id:"ROOT",children:[],label:""};if(!e||!t)return Object(a.Immutable)(o);let i=t.map((t,o)=>{const n=Object.keys(t)[0],i=e[n],s=this.getItemJsonByPageJson(i,o,0),a=t[n];return s.children=[],a.forEach((t,o)=>{const n=e[t],i=this.getItemJsonByPageJson(n,o,1);s.children.push(i)}),s});if(this.props.isPageTemplateLoading){const e=Object(r.getAppConfigAction)().appConfig,o={id:r.appConfigUtils.getUniqueId(e,"page"),label:r.appConfigUtils.getUniqueLabel(e,"page",this.formatMessage("page")),type:a.PageType.Normal},n=this.getItemJsonByPageJson(o,t.length,0);n.children=[],i=i.asMutable({deep:!0}),i.push(n)}o.children=i;let s=Object(a.Immutable)(o);const{filterText:l}=this.state;if(l&&""!==l){const e=n.filterTree(s,l.trim());s=n.expandFilteredNodes(e,l.trim())}return s},this.getMoreDropDownItems=e=>{const t=e.data,o=[],n=Object(a.Immutable)({label:this.formatMessage("rename"),event:t=>{this.handleOnTocDoubleClick(e,t)},visible:!0});o.push(n);const i=Object(a.Immutable)({label:this.formatMessage("tocSetLink"),event:t=>{this.handleOnSetLinkClick(e,t)},visible:t.type===a.PageType.Link});o.push(i);const s=Object(a.Immutable)({label:this.formatMessage("duplicate"),event:e=>{e.stopPropagation(),this.props.duplicatePage(t.id)},visible:!0});o.push(s);const l=Object(r.getAppConfigAction)().appConfig,c=(l?r.appConfigUtils.getRealPageCountExcludeOnePage(l,t.id):0)<1,d=Object(a.Immutable)({label:this.formatMessage("delete"),event:e=>{this.handleRemovePage(t),e.stopPropagation()},visible:!c});return o.push(d),o},this.getAddPageDropDownItems=()=>{const{addPageWithType:e}=this.props,t=[],o=Object(a.Immutable)({label:this.formatMessage("addLink"),event:t=>{J=e("link").id,this.resetLinkParam(J),this.setState({isShowLinkSetting:!0}),t.stopPropagation()},visible:!0});t.push(o);const n=Object(a.Immutable)({label:this.formatMessage("addFolder"),event:t=>{e("folder"),t.stopPropagation()},visible:!0});return t.push(n),t},this.renderPageItemRightContent=e=>{const{theme:t,onDefaultClick:n}=this.props,{data:i}=e,s=o(86),c=o(87),d=this.getMoreDropDownItems(e),p=a.css`
      margin-right: calc(16px - ${t.components.button.sizes.sm.paddingX});
      .page-item-visible-btn {
        display: ${i.isVisible?"none":"inline-flex"};
      }

      .page-item-home-btn {
        display: ${e.showDefault&&i.isDefault?"inline-flex":"none"};
        color: ${e.showDefault&&i.isDefault?t.colors.black:t.colors.palette.dark[600]};
      }

      .dropDown {
        display: inline-flex;
        .btn {
          display: none;
        }
      }

    `;return Object(a.jsx)("div",{className:"d-flex",css:p},Object(a.jsx)(l.Tooltip,{placement:"bottom",title:this.formatMessage("makeHome")},Object(a.jsx)(l.Button,{size:"sm",icon:!0,type:"tertiary",className:" page-item-home-btn page-item-icon",onClick:e=>{e.stopPropagation(),i.isDefault||n(i.id)}},Object(a.jsx)(l.Icon,{size:12,icon:o(24)}))),Object(a.jsx)(l.Tooltip,{placement:"bottom",title:i.isVisible?this.formatMessage("hideFromMenu"):this.formatMessage("showFromMenu")},Object(a.jsx)(l.Button,{size:"sm",type:"tertiary",className:"page-item-visible-btn page-item-icon",icon:!0,onClick:t=>{t.stopPropagation(),Object(r.getAppConfigAction)().editPageProperty(i.id,"isVisible",!e.data.isVisible).exec()}},Object(a.jsx)(l.Icon,{size:12,icon:i.isVisible?s:c}))),Object(a.jsx)("div",{title:this.formatMessage("more"),className:"dropDown page-item-icon",ref:this.linkSettingTrigger},Object(a.jsx)(f,{modifiers:N,direction:"down",theme:t,items:d})))},this.renderPageContent=e=>{var t,o,n;const{intl:i,theme:s,editablePageItemId:r}=this.props,{isTocDragging:l,tocDraggingStatus:c}=this.state,d=null===(t=this.treeRef)||void 0===t?void 0:t.getBoundingClientRect();return Object(a.jsx)(m,{intl:i,itemJson:e,theme:s,canDnd:!0,isFirstItem:this.getFirstItemJson().id===e.id,editable:r===e.id,onArrowClick:this.handleArrowClick,isLastItem:this.getLastItemJson().id===e.id,isTocDragging:l,onTocDragStatusChage:this.handleOnTocDragStatusChange,tocDraggingStatus:c,parentBoundTop:null!==(o=null==d?void 0:d.top)&&void 0!==o?o:-1,renderRightContent:this.renderPageItemRightContent,renameItem:this.renamePage,parentBoundBottom:null!==(n=null==d?void 0:d.bottom)&&void 0!==n?n:-1,canDropIntoFunc:this.canDropIntoFunc,onDidDrop:this.onDidDrop,canDragFunc:this.canDragFunc,canDropFunc:this.canDropFunc,canOrderFunc:this.canOrderFunc,onDoubleClick:this.handleOnTocDoubleClick})},this.getLinkSettingPopup=(e,t,o)=>{var n,i,s,r,l,c;return e&&(null===(n=null==o?void 0:o.pages)||void 0===n?void 0:n[J])&&!(null===(i=a.urlUtils.getAppIdPageIdFromUrl())||void 0===i?void 0:i.pageId)&&t?Object(a.jsx)(d.LinkSettingPopup,{isOpen:e&&!(null===(s=a.urlUtils.getAppIdPageIdFromUrl())||void 0===s?void 0:s.pageId),isLinkPageSetting:!0,title:null===(l=null===(r=null==o?void 0:o.pages)||void 0===r?void 0:r[J])||void 0===l?void 0:l.label,pisition:"left",linkParam:Object(a.Immutable)(E),onSettingCancel:()=>{this.setState({isShowLinkSetting:!1})},onSettingConfirm:this.handleSettingLinkConfirm,trigger:null===(c=this.linkSettingTrigger)||void 0===c?void 0:c.current}):(!t&&e&&setTimeout(()=>{this.setState({isShowLinkSetting:!1})}),null)},this.getWillRemovePageSubCount=()=>{const e=Object(r.getAppConfigAction)().appConfig,{willRemovePage:t}=this.state;if(!e||!t)return 0;const o=e.pageStructure.find(e=>Object.keys(e)[0]===t.id);return o?o[t.id].length:0},this.onExportClick=e=>{const{currentPageItemId:t}=this.props,o=Object(r.getAppConfigAction)().appConfig,n=[{layout:o.pages[t].layout,layouts:o.layouts,widgets:o.widgets,views:o.views,sections:o.sections,name:"Column layout",description:"Align widgets by columns",thumbnail:"./thumbnails/image2.png"}],i=n[0];i.layouts&&Object.keys(i.layouts).forEach(e=>{let t=i.layouts[e].without("id");t.content&&Object.keys(t.content).forEach(e=>{const o=t.content[e].without("id");t=t.setIn(["content",e],o)}),i.layouts=i.layouts.set(e,t)}),i.widgets&&Object.keys(i.widgets).forEach((e,t)=>{const o=i.widgets[e];i.widgets=i.widgets.set(e,o.without("context","icon","label","manifest","_originManifest","version","useDataSources","useDataSourcesEnabled"))}),i.sections&&Object.keys(i.sections).forEach((e,t)=>{const o=i.sections[e];i.sections=i.sections.set(e,o.without("id","label"))}),i.views&&Object.keys(i.views).forEach((e,t)=>{const o=i.views[e];i.views=i.views.set(e,o.without("id","label"))}),console.log(JSON.stringify({pages:n}))},this.expandIds=[],this.state={currentSelectedItemId:e.currentPageItemId,filterText:"",itemJson:void 0,showSearch:!1,isTemplatePopoverOpen:!1,isTocDragging:!1,isRemovePopoverOpen:!1,willRemovePage:void 0,tocDraggingStatus:"on",isShowLinkSetting:!1},this.addPageDropdownItems=this.getAddPageDropDownItems()}componentWillUnmount(){this.dropZoneInteractable&&(this.dropZoneInteractable.unset(),this.dropZoneInteractable=null)}componentDidUpdate(e){const t=this.props;let o=!1,i={};const{pages:s,pageStructure:a,currentPageItemId:r,editablePageItemId:l,isPageTemplateLoading:c}=e;if(t.currentPageItemId!==r||t.pages!==s||t.pageStructure!==a||t.editablePageItemId!==l||t.isPageTemplateLoading!==c)if(o=!0,t.pages===s&&a===t.pageStructure&&t.editablePageItemId===l||t.currentPageItemId===r)if(t.currentPageItemId!==r){const e=n.activeAndExpandNodesByActiveIds(this.state.itemJson,[t.currentPageItemId]);i={currentSelectedItemId:t.currentPageItemId,itemJson:n.activeAndExpandNodesByActiveIds(this.state.itemJson,[t.currentPageItemId])},this.expandIds=n.fetchAllExpandIds(e)}else i={itemJson:this.getItemJsonByPages(t.pages,t.pageStructure)};else{const e=n.activeAndExpandNodesByActiveIds(this.getItemJsonByPages(t.pages,t.pageStructure),[t.currentPageItemId]);i={currentSelectedItemId:t.currentPageItemId,itemJson:e},this.expandIds=n.fetchAllExpandIds(e)}o&&this.setState(i)}componentDidMount(){this.setState({itemJson:this.getItemJsonByPages()}),this.dropZoneRef&&(this.dropZoneInteractable=Object(g.interact)(this.dropZoneRef).dropzone({accept:".toc-item-drag",overlap:"pointer",ondragenter:e=>{const{itemJson:t}=this.state;if(t&&this.treeRef){const{relatedTarget:t,dragEvent:o}=e,n=this.treeRef.getBoundingClientRect().top,i=this.getTreeContentHeight(),s=JSON.parse(t.getAttribute("itemJson")),a=o.client;if(a.y<=n){this.getFirstItemJson().data.id!==s.data.id&&this.handleOnTocDraggingStatusChange("top")}else if(a.y<=i+n)this.handleOnTocDraggingStatusChange("on");else{this.getLastParentItemJson().data.id!==s.data.id&&this.handleOnTocDraggingStatusChange("bottom")}}},ondragleave:e=>{this.handleOnTocDraggingStatusChange("on")},ondrop:e=>{const t=this.state.tocDraggingStatus;if("on"===t)return;let o;if("bottom"===t){o=this.getLastParentItemJson()}else o=this.getFirstItemJson();const n=e.relatedTarget,i=JSON.parse(n.getAttribute("itemJson"));this.onDidDrop(i,o,t),this.handleOnTocDraggingStatusChange("on")},ondropdeactivate:e=>{}}))}resetLinkParam(e){const{pages:t}=this.props;E.value="",E.openType=d.OpenTypes.NewWindow;const o=t[e];o&&o.linkUrl&&"#"!=o.linkUrl&&(E.value=o.linkUrl),o&&o.openTarget&&(E.openType=o.openTarget)}render(){const{itemJson:e,willRemovePage:t,isShowLinkSetting:o}=this.state,{theme:n,isPageSectionNav:i}=this.props,s=Object(r.getAppConfigAction)().appConfig,c=a.css`
      height: 100%;
      position: relative;
      .toc-dropzone {
        position: absolute;
        pointer-events: none;
      }
      .text-data-600{
        color: ${n.colors.palette.dark[600]};
      }
      .page-list-top {
        position: absolute;
        right: 15px;
        top: -48px;
        .page-top-btns {
          margin-right: -${n.components.button.sizes.sm.paddingX};

          .my-dropdown {
            margin-left: -5px;
            margin-right: 5px;
          }
        }
      }
      .page-tree {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        .toc-item-dropzone {
          .toc-item {
            /* padding-left: ${a.polished.rem(4)}; */
          }
        }
      }
    `;return Object(a.jsx)("div",{css:c},Object(a.jsx)("div",{ref:e=>this.dropZoneRef=e,className:"toc-dropzone h-100 w-100"}),Object(a.jsx)("div",{className:"page-list-top"},Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(a.jsx)("div",{className:"d-flex page-top-btns align-items-center"},Object(a.jsx)("div",{ref:e=>this.addPageRef=e,css:a.css`z-index: 11;`},Object(a.jsx)(l.Tooltip,{placement:"bottom",title:this.formatMessage("addPage")},Object(a.jsx)(l.Button,{icon:!0,disabled:!e,type:"tertiary",onClick:this.handleToggleTemplatePopover,size:"sm",className:"add-page-btn"},Object(a.jsx)(l.Icon,{className:"add-page-icon",width:15,height:17,icon:L})))),this.state.isTemplatePopoverOpen&&Object(a.jsx)(d.PageTemplatePopper,{theme:n,referenceElement:this.addPageRef,formatMessage:this.formatMessage,onItemSelect:this.handleChooseTemplate,onClose:this.closeTemplatePopover}),Object(a.jsx)(l.Tooltip,{placement:"bottom",title:this.formatMessage("more")},Object(a.jsx)(f,{items:this.addPageDropdownItems,theme:n,disabled:!e,direction:"down",toggleContent:B}))))),Object(a.jsx)(A,{forwardRef:e=>{this.treeRef=e},className:"page-tree mt-2",hideRoot:!0,itemJson:e,onClickItem:this.handleClickItem,handleExpand:this.handleExpand}),t&&Object(a.jsx)(M,{isRemove:!0,theme:n,tapBlankClose:!1,toggle:this.handleToggleRemovePopover,onClosed:e=>{J===t.id&&this.setState({isShowLinkSetting:!1}),e&&t&&this.props.removePage(t.id)},title:this.formatMessage("delete"),isOpen:this.state.isRemovePopoverOpen,intl:this.props.intl},this.formatMessage("removePageTip",{subCount:this.getWillRemovePageSubCount(),label:t.label})),this.getLinkSettingPopup(o,i,s))}}var $=a.ReactRedux.connect(e=>{var t,o,n;const i=e.appStateInBuilder&&e.appStateInBuilder.appConfig;return{pages:i&&i.pages,pageStructure:i&&i.pageStructure,isPageSectionNav:"page"===(null===(n=null===(o=null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.sectionNavInfos)||void 0===o?void 0:o["opts-section"])||void 0===n?void 0:n.currentViewId)}})(F);class H extends h{constructor(e){super(e),this.onDropHover=e=>{this.state.dropType!==e&&this.setState({dropType:e})},this.getStyle=()=>{var e;const t=Object(a.getAppStore)().getState(),o=null===(e=null==t?void 0:t.appContext)||void 0===e?void 0:e.isRTL,{theme:n,editable:i,itemJson:s,isTocDragging:r}=this.props,{mustShowArrow:l,children:c,level:d,isActive:p,isExpand:u}=s,{isDragging:g,isHovering:h}=this.state;return a.css`
      height: ${30}px;
      width: auto;
      min-width: 100%;
      align-items: center;
      cursor: pointer;
      ${g?"z-index: 100;":""}

      &.drag-move-into {
        border: 1px solid ${n.colors.palette.primary[700]};
      }

      :hover {
        ${p||r?"":`background-color: ${n.colors.palette.light[400]};`}
        .dialog-item-splash-btn, .dialog-item-page-btn {
          display: inline-flex;
          z-index: 2;
        }
        .dropDown {
          .btn {
            display: inline-flex;
          }
          z-index: 2;
        }
      }

      &.active {
        ${r?"":`background-color: ${n.colors.primary};`}
        border: 0;
      }

      .toc-dialog-dropzone {
        touch-action: none;
        position: relative;

        .toc-dialog-drag:hover {
          cursor: pointer !important;
        }

        .toc-dialog-drag {
          pointer-events: ${h?"all":"none"};
          visibility: ${s.allowEditable&&i?"hidden":"visible"};
          z-index: 1;
          position: absolute;
          left: 0;
          top: 0;
          right: 0;
          bottom: 0;
          background-color: ${g?a.polished.rgba(n.colors.palette.light[400],.6):"transparent"};
          box-shadow: ${g?n.boxShadows.lg:n.boxShadows.none};
        }

        .toc-item {
          padding: 0;
          border: 0;
          position: relative;
          .toc-item-content {
            margin-left: ${10*d}px;
            position: relative;
            .toc-arrow {
              z-index: 2;
              padding-right: ${a.polished.rem(1)};
              visibility: hidden;
               /* ${l||c&&c.length>0?"visible":"hidden"}; */

              .toc-arrow-icon {
                fill: ${n.colors.black};
                transform-origin: center;
                transform: ${`rotate(${u?90:o?180:0}deg)`};
                transition: transform .5s;
              }
            }

            .left-and-right {
              overflow-x: hidden;
              margin-left: -5px;
              .left-content {
                align-items: center;
                overflow-x: hidden;
                flex: auto;
                .editor {
                  overflow: hidden;
                  text-overflow: ${i?"clip":"ellipsis"};
                  white-space: nowrap;
                  font-size: ${.875}rem;
                  user-select: none;
                  flex: auto;
                  text-align: start;
                }
                [contenteditable="true"] {
                  -webkit-user-select: text;
                  background-color: ${n.colors.white};
                }
                .header-icon {
                  margin-right: 0.3rem;
                  flex: none;
                }
              }
            }
          }

          &.toc-drag-move-last {
            :after{
              content: '';
              position: absolute;
              left: 0;
              top: auto;
              bottom: 0;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${n.colors.palette.primary[700]};
            }
          }

          &.toc-drag-move-first {
            :before {
              content: '';
              position: absolute;
              left: 0;
              top: 0;
              bottom: auto;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: red;
              /* ${n.colors.palette.primary[700]}; */
            }
          }

          .drag-move-out-order-bottom {
            :after{
              content: '';
              position: absolute;
              left: 0;
              top: auto;
              bottom: 0;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${n.colors.palette.primary[700]};
            }
          }

          .drag-move-out-order-top {
            :before {
              content: '';
              position: absolute;
              left: 0;
              top: 0;
              bottom: auto;
              right: auto;
              height: 2px;
              width: 100%;
              background-color: ${n.colors.palette.primary[700]};
            }
          }
        }
      }
    `},this.state={dropType:"none",isDragging:!1,isHovering:!1},this.dropZoneRef=a.React.createRef(),this.dragRef=a.React.createRef()}componentWillUnmount(){this.dragInteractable&&(this.dragInteractable.unset(),this.dragInteractable=null),this.dropZoneInteractable&&(this.dropZoneInteractable.unset(),this.dropZoneInteractable=null)}componentDidMount(){super.componentDidMount(),this.initDragEvent()}componentDidUpdate(e){super.componentDidUpdate(e)}initDragEvent(){var e;const{canDnd:t,canDropFunc:o,onDidDrop:n,itemJson:i}=this.props;if(t&&this.dropZoneRef.current&&this.dragRef.current){let t=null;this.dragRef.current.setAttribute("itemJson",JSON.stringify(i));const s=(null===(e=i.data)||void 0===e?void 0:e.mode)===a.DialogMode.Fixed?".toc-fixed-dialog-drag":".toc-anchored-dialog-drag";this.dropZoneInteractable=Object(g.interact)(this.dropZoneRef.current).dropzone({accept:s,overlap:"pointer",ondropmove:e=>{const t=e.relatedTarget,n=e.target,s=JSON.parse(t.getAttribute("itemJson"));if(!o||!o(i.data,s.data))return;const a=n.getBoundingClientRect(),r=a.bottom-a.top,l=2*r/3,c=1*r/3,d=e.dragEvent.client.y-a.top;let p=this.state.dropType;d>l?p="bottom":d<c&&(p="top"),this.onDropHover(p)},ondragleave:e=>{this.onDropHover("none")},ondrop:e=>{const t=this.state.dropType;if("none"===t)return;const o=e.relatedTarget,s=JSON.parse(o.getAttribute("itemJson"));n&&n(s,i,t),this.onDropHover("none")}}),this.dragInteractable=Object(g.interact)(this.dragRef.current).draggable({inertia:!1,modifiers:[],autoScroll:!0,onstart:e=>{this.setState({isDragging:!0});const{onTocDragStatusChage:t}=this.props;t&&t(!0)},onmove:e=>{const{clientX:o,clientY:n,clientX0:i,clientY0:s,target:a}=e,r=parseFloat(a.getAttribute("start-x"))||0,l=parseFloat(a.getAttribute("start-y"))||0;let c=o-i+r,d=n-s+l;const p=-a.clientWidth/2,u=a.clientWidth/2;c<p?c=p:c>u&&(c=u);const{parentBoundBottom:g,parentBoundTop:h}=this.props;if(g>-1&&h>-1){const e=h-s,t=g-s;d<=e?d=e:d>=t&&(d=t)}t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{a.style.webkitTransform=a.style.transform="translate("+c+"px, "+d+"px)",t=null})},onend:e=>{const{target:o}=e;t&&cancelAnimationFrame(t),o.style.webkitTransform=o.style.transform="translate(0px, 0px)",this.setState({isDragging:!1});const{onTocDragStatusChage:n}=this.props;n&&n(!1)}})}}render(){var e,t;const{itemJson:n,renderRightContent:i,editable:s,canDnd:r,theme:c,isFirstItem:d,isLastItem:p,tocDraggingStatus:u,isTocDragging:g,tocDraggingMode:h}=this.props,{icon:m,isActive:f}=n,{dropType:v,isDragging:b}=this.state;let y;y=m&&m.svg?m:{svg:m};const I="moveInto"===v?"drag-move-into":"",x="drag-move-out-order-"+v;let w="";g&&"on"!==u&&h===n.data.mode&&("bottom"===u&&p?w="toc-drag-move-last":"top"===u&&d&&(w="toc-drag-move-first"));const S=null===(t=null===(e=Object(a.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.theme;return Object(a.jsx)("div",{className:`d-flex ${f?"active":""}   ${I}`,css:this.getStyle(),onMouseEnter:e=>this.setState({isHovering:!0}),onMouseLeave:e=>this.setState({isHovering:!1})},Object(a.jsx)("div",{ref:this.dropZoneRef,className:"toc-dialog-dropzone h-100 w-100"},Object(a.jsx)("div",{className:"d-flex w-100 h-100",onDoubleClick:this.handleDoubleClickItem,onClick:this.handleClick},Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 toc-item "+w},Object(a.jsx)("div",{className:`d-flex toc-item-content ${x} w-100`},Object(a.jsx)(l.Button,{className:"toc-arrow",icon:!0,type:"tertiary",onClick:this.handleArrowClick},Object(a.jsx)(l.Icon,{className:"toc-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},Object(a.jsx)("div",{className:"d-flex left-content "+(i?"pr-0":"pr-2")},m&&Object(a.jsx)(l.Icon,{autoFlip:n.needFlip,className:"header-icon",color:y.properties&&a.themeUtils.color(y.properties.color,S)||c.colors.palette.dark[600],size:12,icon:y.svg}),Object(a.jsx)("div",{title:n.label,className:"item-label editor",ref:this.editor,onBlur:this.onRenameBlur,contentEditable:n.allowEditable&&s,suppressContentEditableWarning:!0},n.label)),i&&i(n)))),r&&Object(a.jsx)("div",{className:Object(a.classNames)("toc-dialog-drag",{"toc-fixed-dialog-drag":n.data.mode===a.DialogMode.Fixed,"toc-anchored-dialog-drag":n.data.mode===a.DialogMode.Anchored}),ref:this.dragRef},b&&Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 toc-item"},Object(a.jsx)("div",{className:"d-flex toc-item-content w-100"},Object(a.jsx)(l.Button,{icon:!0,type:"tertiary",className:"toc-arrow"},Object(a.jsx)(l.Icon,{className:"toc-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},Object(a.jsx)("div",{className:"d-flex left-content "+(i?"pr-0":"pr-2")},m&&Object(a.jsx)(l.Icon,{className:"header-icon",size:12,icon:m}),Object(a.jsx)("div",{title:n.label,className:"item-label editor"},n.label)),i&&i(n))))))))}}const V=o(88),W=o(17),G=[{name:"offset",options:{offset:[0,10]}}];class U extends a.React.PureComponent{constructor(e){super(e),this.getTotalLines=()=>{const{itemJson:e}=this.state;let t=0;return e.children&&e.children.forEach(e=>{var o,n;t++,e.isExpand&&(t+=null!==(n=null===(o=e.children)||void 0===o?void 0:o.length)&&void 0!==n?n:0)}),t},this.getTreeContentHeight=()=>30*this.getTotalLines(),this.handleOnTocDragStatusChange=e=>{var t;const o=this.getItemJsonByDialogs();this.setState({isTocDragging:e,tocDraggingMode:null===(t=o.data)||void 0===t?void 0:t.mode,itemJson:o})},this.getFirstItemJson=e=>{const{itemJson:t}=this.state;return t.children.filter(t=>t.data.mode===e&&0===t.data.index)[0]},this.getLastItemJson=e=>{const{itemJson:t}=this.state,o=t.children.filter(t=>t.data.mode===e);return o.filter(e=>e.data.index===o.length-1)[0]},this.getLastParentItemJson=()=>{const{itemJson:e}=this.state;return e.children[e.children.length-1]},this.handleOnTocDraggingStatusChange=e=>{this.setState({tocDraggingStatus:e,itemJson:this.getItemJsonByDialogs()})},this.onDidDrop=(e,t,o)=>{"moveInto"!==o&&this.props.reOrderDialog(e.data.id,t.data.id,o)},this.canDropFunc=(e,t)=>e.id!==t.id,this.handleChooseTemplate=e=>{this.setState({isTemplatePopoverOpen:!1}),this.props.addDialog(e)},this.handleToggleTemplatePopover=()=>{const{isTemplatePopoverOpen:e}=this.state;this.setState({isTemplatePopoverOpen:!e})},this.closeTemplatePopover=()=>{this.state.isTemplatePopoverOpen&&this.setState({isTemplatePopoverOpen:!1})},this.singleAndDoubleClickTimeout=void 0,this.handleClickItem=e=>{this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),this.singleAndDoubleClickTimeout=setTimeout(()=>{this.setState({currentSelectedItemId:e.id,itemJson:n.activeAndExpandNodesByActiveIds(this.state.itemJson,[e.id])},()=>{this.props.onClickDialog(e.data.id)})},200)},this.handleOnTocDoubleClick=(e,t)=>{this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),this.props.changeEditableDialogItemId(e.id),t.stopPropagation()},this.renameDialog=(e,t)=>(this.props.changeEditableDialogItemId(""),!!(t=null==t?void 0:t.trim())&&this.props.renameDialog(e.data.id,t)),this.formatMessage=(e,t)=>{const o=Object.assign({},u,a.defaultMessages,l.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.getItemJsonByDialogJson=e=>{const t=e.id,{currentDialogItemId:o}=this.props,n={id:t,isSplash:!!e.isSplash,data:e,label:e.label,index:e.index,level:0,isActive:o===t,allowEditable:!0,renderItem:this.renderDialogContent};return n.icon=e.icon,n.icon||(n.icon=r.utils.getDefaultTocDialogIcon()),n},this.getItemJsonByDialogs=e=>{e||(e=this.props.dialogs);const t={id:"ROOT",children:[],label:""};if(!e)return Object(a.Immutable)(t);const o=Object.keys(e).map((t,o)=>{const n=this.getItemJsonByDialogJson(e[t]);return n.children=[],n});t.children=o;return Object(a.Immutable)(t)},this.getMoreDropDownItems=e=>{const t=e.data,o=[],n=Object(a.Immutable)({label:this.formatMessage("rename"),event:t=>{this.handleOnTocDoubleClick(e,t)},visible:!0});o.push(n);const i=Object(a.Immutable)({label:this.formatMessage("duplicate"),event:e=>{e.stopPropagation(),this.props.duplicateDialog(t.id)},visible:!0});o.push(i);const s=Object(a.Immutable)({label:this.formatMessage("delete"),event:e=>{this.props.removeDialog(t.id),e.stopPropagation()},visible:!0});return o.push(s),o},this.renderDialogItemRightContent=e=>{const{theme:t,onSplashClick:n}=this.props,{data:i}=e,s=this.getMoreDropDownItems(e),c=a.css`
      margin-right: calc(16px - ${t.components.button.sizes.sm.paddingX});
      .dialog-item-splash-btn {
        display: ${e.isSplash?"inline-flex":"none"};
        color: ${e.isSplash?t.colors.black:t.colors.palette.dark[600]};
      }
      .dropDown {
        display: inline-flex;
        .btn {
          display: none;
        }
      }
    `;let d=null;if(i.mode===a.DialogMode.Fixed){const e=r.utils.getPageListByDialogId(this.props.pages,i.id);e.length&&(d=this.formatMessage("opendWithPages",{pages:e.map(e=>e.label).join(", ")}))}return Object(a.jsx)("div",{className:"d-flex",css:c},d?Object(a.jsx)(l.Tooltip,{placement:"bottom",title:d},Object(a.jsx)(l.Button,{size:"sm",icon:!0,type:"tertiary",style:{cursor:"inherit"},className:"dialog-item-page-btn dialog-item-icon"},Object(a.jsx)(l.Icon,{size:12,icon:o(89)}))):i.mode===a.DialogMode.Fixed&&Object(a.jsx)(l.Tooltip,{placement:"bottom",title:this.formatMessage("makeSplash")},Object(a.jsx)(l.Button,{size:"sm",icon:!0,type:"tertiary",className:"dialog-item-splash-btn dialog-item-icon",onClick:e=>{e.stopPropagation(),n(i.id)}},Object(a.jsx)(l.Icon,{size:12,icon:o(90)}))),Object(a.jsx)("div",{title:this.formatMessage("more"),className:"dropDown dialog-item-icon"},Object(a.jsx)(f,{modifiers:G,direction:"down",theme:t,items:s})))},this.renderDialogContent=e=>{var t,o,n;const{intl:i,theme:s,editableDialogItemId:r}=this.props,{isTocDragging:l,tocDraggingStatus:c,tocDraggingMode:d}=this.state,p=null===(t=e.data.mode===a.DialogMode.Fixed?this.treeRefForFixed:this.treeRefForAnchored)||void 0===t?void 0:t.getBoundingClientRect();return Object(a.jsx)(H,{intl:i,itemJson:e,theme:s,canDnd:!0,tocDraggingMode:d,isFirstItem:0===e.data.index,isLastItem:this.getLastItemJson(e.data.mode).id===e.id,isTocDragging:l,onTocDragStatusChage:this.handleOnTocDragStatusChange,tocDraggingStatus:c,parentBoundTop:null!==(o=null==p?void 0:p.top)&&void 0!==o?o:-1,parentBoundBottom:null!==(n=null==p?void 0:p.bottom)&&void 0!==n?n:-1,editable:r===e.id,renderRightContent:this.renderDialogItemRightContent,onDidDrop:this.onDidDrop,canDropFunc:this.canDropFunc,renameItem:this.renameDialog,onDoubleClick:this.handleOnTocDoubleClick})},this.getItemJsonByMode=e=>{const{itemJson:t}=this.state,o=t?{id:t.id,isActive:t.isActive,isExpand:t.isExpand,label:"",children:[]}:null;if(o){const n={};t.children.map(t=>{var o;(null===(o=t.data)||void 0===o?void 0:o.mode)===e&&(n[t.index]=t)}),Object.keys(n).map(e=>{o.children.push(n[e])})}return o},this.state={currentSelectedItemId:e.currentDialogItemId,itemJson:void 0,isTemplatePopoverOpen:!1,isFixedGroupShown:!0,isAnchoredGroupShown:!0,isTocDragging:!1,tocDraggingMode:null,tocDraggingStatus:"on"}}componentWillUnmount(){this.dropZoneInteractable&&(this.dropZoneInteractable.unset(),this.dropZoneInteractable=null)}componentDidUpdate(e){const t=this.props;let o=!1,i={};const{dialogs:s,currentDialogItemId:a,editableDialogItemId:r,forceRefresh:l}=e;if(t.forceRefresh&&!l||t.currentDialogItemId!==a||t.dialogs!==s||t.editableDialogItemId!==r)if(o=!0,t.dialogs===s&&t.editableDialogItemId===r||t.currentDialogItemId===a)i=t.currentDialogItemId!==a?{currentSelectedItemId:t.currentDialogItemId,itemJson:n.activeAndExpandNodesByActiveIds(this.state.itemJson,[t.currentDialogItemId])}:{itemJson:this.getItemJsonByDialogs(t.dialogs)};else{const e=n.activeAndExpandNodesByActiveIds(this.getItemJsonByDialogs(t.dialogs),[t.currentDialogItemId]);i={currentSelectedItemId:t.currentDialogItemId,itemJson:e}}o&&this.setState(i)}componentDidMount(){this.setState({itemJson:this.getItemJsonByDialogs()}),this.initDragEvent(a.DialogMode.Fixed),this.initDragEvent(a.DialogMode.Anchored)}initDragEvent(e){const t=e===a.DialogMode.Fixed?".toc-fixed-dialog-drag":".toc-anchored-dialog-drag",o=e===a.DialogMode.Fixed?this.dropZoneRefForFixed:this.dropZoneRefForAnchored,n=e===a.DialogMode.Fixed?this.treeRefForFixed:this.treeRefForAnchored;o&&(this.dropZoneInteractable=Object(g.interact)(o).dropzone({accept:t,overlap:"pointer",ondragenter:t=>{const{itemJson:o}=this.state;if(o&&n){const{relatedTarget:o,dragEvent:i}=t,s=n.getBoundingClientRect().top,a=this.getTreeContentHeight(),r=JSON.parse(o.getAttribute("itemJson")),l=i.client;if(l.y<=s){this.getFirstItemJson(e).data.id!==r.data.id&&this.handleOnTocDraggingStatusChange("top")}else l.y<=a+s&&this.handleOnTocDraggingStatusChange("on")}},ondragleave:e=>{this.handleOnTocDraggingStatusChange("on")},ondrop:e=>{const t=e.relatedTarget,o=JSON.parse(t.getAttribute("itemJson")),n=this.state.tocDraggingStatus;if("on"===n)return;const i="bottom"===n?this.getLastParentItemJson():this.getFirstItemJson(o.data.mode);this.onDidDrop(o,i,n),this.handleOnTocDraggingStatusChange("on")},ondropdeactivate:e=>{}}))}render(){const{itemJson:e}=this.state,{theme:t}=this.props,n=a.css`
      height: 100%;
      position: relative;
      .toc-dropzone {
        position: absolute;
        pointer-events: none;
      }
      .text-data-600{
        color: ${t.colors.palette.dark[600]};
      }
      .dialog-list-top {
        position: absolute;
        right: 16px;
        top: -44px;
        .dialog-top-btns {
          margin-right: -${t.components.button.sizes.sm.paddingX};

          .my-dropdown {
            margin-left: -5px;
            margin-right: 5px;
          }
        }
      }
      .dialog-list-content{
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;

        .dialog-group{
          display: flex;
          align-items: center;
          padding: 0.25rem 0.575rem 0.25rem 1rem;
          .dialog-group-title{
            font-size: 14px;
            color: ${t.colors.palette.dark[600]};
            flex-grow: 1;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
          }
        }

        .dialog-tree {
          overflow: hidden;
        }
      }
    `,i=this.getItemJsonByMode(a.DialogMode.Fixed),s=this.getItemJsonByMode(a.DialogMode.Anchored);return Object(a.jsx)("div",{css:n},Object(a.jsx)("div",{className:"dialog-list-top"},Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(a.jsx)("div",{className:"d-flex dialog-top-btns align-items-center"},Object(a.jsx)("div",{ref:e=>this.addDialogRef=e,css:a.css`z-index: 11;`},Object(a.jsx)(l.Tooltip,{placement:"bottom",title:this.formatMessage("addDialog")},Object(a.jsx)(l.Button,{icon:!0,disabled:!e,type:"tertiary",onClick:this.handleToggleTemplatePopover,size:"sm",className:"add-dialog-btn mt-1"},Object(a.jsx)(l.Icon,{className:"add-dialog-icon",width:15,height:17,icon:o(91)})))),this.state.isTemplatePopoverOpen&&Object(a.jsx)(d.DialogTemplatePopper,{theme:t,showList:!0,referenceElement:this.addDialogRef,formatMessage:this.formatMessage,onItemSelect:this.handleChooseTemplate,onClose:this.closeTemplatePopover})))),Object(a.jsx)("div",{className:"dialog-list-content"},Object(a.jsx)("div",null,Object(a.jsx)("div",{className:"dialog-group"},Object(a.jsx)("div",{className:"dialog-group-title"},this.formatMessage("fixedWindows")),Object(a.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disabled:!((null==i?void 0:i.children.length)>0),onClick:e=>this.setState({isFixedGroupShown:!this.state.isFixedGroupShown})},Object(a.jsx)(l.Icon,{size:"12",icon:this.state.isFixedGroupShown?V:W}))),Object(a.jsx)(l.Collapse,{isOpen:this.state.isFixedGroupShown},Object(a.jsx)("div",{ref:e=>this.dropZoneRefForFixed=e,className:"toc-dropzone toc-dialog-dropzone w-100",style:{height:30*(null==i?void 0:i.children.length)+"px"}}),Object(a.jsx)(A,{forwardRef:e=>{this.treeRefForFixed=e},className:"dialog-tree",hideRoot:!0,itemJson:Object(a.Immutable)(i),onClickItem:this.handleClickItem})),Object(a.jsx)("div",{className:"dialog-group"},Object(a.jsx)("div",{className:"dialog-group-title"},this.formatMessage("anchoredWindows")),Object(a.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disabled:!((null==s?void 0:s.children.length)>0),onClick:e=>this.setState({isAnchoredGroupShown:!this.state.isAnchoredGroupShown})},Object(a.jsx)(l.Icon,{size:"12",icon:this.state.isAnchoredGroupShown?V:W}))),Object(a.jsx)(l.Collapse,{isOpen:this.state.isAnchoredGroupShown},Object(a.jsx)("div",{ref:e=>this.dropZoneRefForAnchored=e,className:"toc-dropzone toc-dialog-dropzone w-100",style:{height:30*(null==s?void 0:s.children.length)+"px"}}),Object(a.jsx)(A,{forwardRef:e=>{this.treeRefForAnchored=e},className:"dialog-tree",hideRoot:!0,itemJson:Object(a.Immutable)(s),onClickItem:this.handleClickItem})))))}}var Z,_=a.ReactRedux.connect(e=>{const t=e.appStateInBuilder&&e.appStateInBuilder.appConfig;return{pages:t&&t.pages,dialogs:t&&t.dialogs}})(U);!function(e){e.Widget="WIDGET",e.Section="SECTION",e.View="View",e.ScreenGroup="SCREEN_GROUP",e.Screen="SCREEN",e.ScreenMainStage="SCREEN_MAIN_STAGE",e.ScreenSrollingPanel="SCREEN_SCROLLING_PANEL",e.Layout="LAYOUT",e.Label="Label"}(Z||(Z={}));class q extends h{constructor(){super(...arguments),this.getStyle=()=>{var e;const t=Object(a.getAppStore)().getState(),o=null===(e=null==t?void 0:t.appContext)||void 0===e?void 0:e.isRTL,{theme:n,editable:i,itemJson:s}=this.props,{mustShowArrow:r,children:l,level:c,isActive:d,isExpand:p}=s;return a.css`
      height: ${30}px;
      width: auto;
      min-width: 100%;
      align-items: center;
      cursor: pointer;

      :hover {
        ${d?"":`background-color: ${n.colors.palette.light[400]};`}
        .dropDown {
          z-index: 2;
          .btn {
            visibility: visible;
          }
        }
        .editor {
          color: ${n.colors.black};
        }
      }

      .item-action-button {
        display: none;
      }

      &.active {
        background-color: ${n.colors.primary};
        border: 0;
        .editor {
          color: ${n.colors.black};
        }

        &:hover {
          .item-action-button {
            display: block;
          }
        }
      }

      .toc-item {
        padding: 0;
        border: 0;
        .toc-item-content {
          margin-left: ${10*c}px;
          position: relative;
          .toc-arrow {
            z-index: 2;
            padding-right: ${a.polished.rem(1)};
            visibility: ${r||l&&l.length>0?"visible":"hidden"};
            .toc-arrow-icon {
              fill: ${n.colors.black};
              transform-origin: center;
                transform: ${`rotate(${p?90:o?180:0}deg)`};
                transition: transform .5s;
            }
          }

          .left-and-right {
            overflow-x: hidden;
            margin-left: -5px;
            /* margin-left: calc(8px - ${n.components.button.sizes.sm.paddingX} - 0.6875rem + ${a.polished.rem(4)}); */
            .left-content {
              align-items: center;
              overflow-x: hidden;
              flex: auto;
              .editor {
                overflow: hidden;
                text-overflow: ${i?"clip":"ellipsis"};
                white-space: nowrap;
                font-size: ${.875}rem;
                user-select: none;
                flex: auto;
                text-align: start;
              }
              [contenteditable="true"] {
                -webkit-user-select: text;
                background-color: ${n.colors.white};
              }
              .header-icon {
                margin-right: 0.3rem;
                flex: none;
              }
            }
          }
        }
      }
    `}}componentDidMount(){super.componentDidMount()}componentDidUpdate(e){super.componentDidUpdate(e)}render(){var e,t;const{itemJson:n,renderRightContent:i,editable:s,theme:r}=this.props,{icon:c,isActive:d}=n;let p;p=c&&c.svg?c:{svg:c};const u=null===(t=null===(e=Object(a.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.theme;return Object(a.jsx)("div",{className:"d-flex "+(d?"active":""),css:this.getStyle()},Object(a.jsx)("div",{className:"d-flex w-100 h-100",onDoubleClick:this.handleDoubleClickItem,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 toc-item"},Object(a.jsx)("div",{className:"d-flex toc-item-content w-100"},Object(a.jsx)(l.Button,{className:"toc-arrow",icon:!0,type:"tertiary",onClick:this.handleArrowClick},Object(a.jsx)(l.Icon,{className:"toc-arrow-icon",icon:o(16),size:8})),Object(a.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},Object(a.jsx)("div",{className:"d-flex left-content "+(i?"pr-0":"pr-2")},c&&Object(a.jsx)(l.Icon,{autoFlip:n.needFlip,className:"header-icon",color:p.properties&&a.themeUtils.color(p.properties.color,u)||r.colors.palette.dark[600],size:12,icon:p.svg}),Object(a.jsx)("div",{title:n.label,className:"item-label editor",ref:this.editor,onBlur:this.onRenameBlur,contentEditable:n.allowEditable&&s,suppressContentEditableWarning:!0},n.label)),i&&i(n))))))}}const X=o(13);class Y extends a.React.PureComponent{constructor(e){super(e),this.handleChange=e=>{const t=(null==e?void 0:e.target.value)||"";this.setState({searchText:t},()=>{const{onSearchTextChange:e}=this.props;e&&e(t)})},this.handleSubmit=e=>{const{onSubmit:t}=this.props;t&&t(e)},this.onKeyUp=e=>{e&&e.target&&13===e.keyCode&&this.handleSubmit(e.target.value)},this.handleClear=e=>{this.setState({searchText:""}),e.stopPropagation()},this.getStyle=()=>a.css`
      position: relative;
      .toc-search-input {
        .search-close-icon {
          padding: 0.125rem;
        }
      }
    `,this.state={searchText:e.searchText||""}}componentDidUpdate(e){if(this.props.searchText!==e.searchText&&this.props.searchText!==this.state.searchText){const{searchText:e}=this.props;this.setState({searchText:e})}}render(){const{placeholder:e,className:t,showClear:n,inputRef:i,onFocus:s,onBlur:r}=this.props,{searchText:c}=this.state;return Object(a.jsx)("div",{css:this.getStyle(),className:t},Object(a.jsx)(l.TextInput,{className:"toc-search-input",type:"text",ref:i,placeholder:e,onChange:this.handleChange,suffix:Object(a.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",className:"search-close-icon "+(this.state.searchText?"":"d-none"),onClick:this.handleChange},Object(a.jsx)(l.Icon,{size:12,icon:X})),onBlur:r,onFocus:s,value:c,onKeyDown:e=>this.onKeyUp(e)}),n&&Object(a.jsx)(l.Button,{color:"tertiary",icon:!0,size:"sm",onClick:this.handleSubmit},Object(a.jsx)(l.Icon,{size:12,icon:o(13)})))}}function K(e,t){let o=e.id;return t===Z.Widget||t===Z.Section||t===Z.ScreenGroup?o=e.layoutId+"-toc-"+e.layoutItemId+"-toc-"+e.id:t!==Z.View&&t!==Z.Screen&&t!==Z.ScreenMainStage&&t!==Z.ScreenSrollingPanel||(o=e.layoutId+"-toc-"+e.layoutItemId+"-toc-"+(e.sectionId||e.screenGroupId)+"-toc-"+e.id,t!==Z.ScreenMainStage&&t!==Z.ScreenSrollingPanel||(o=o+"-toc-"+t)),o}function Q(e){var t;const o=null===(t=null==e?void 0:e.id)||void 0===t?void 0:t.split("-toc-");return!o||o.length<2?null:{layoutId:o[0],layoutItemId:o[1]}}function ee(e){const t=e.id.split("-toc-"),o=t[0],n=t[1];if(e.type===Z.View){if(e.id.indexOf("-toc-")<0)return;Object(r.getAppConfigAction)().removeView(e.data.id,e.id.split("-toc-")[2]).exec()}else if(e.type===Z.Screen){if(e.id.indexOf("-toc-")<0)return;Object(r.getAppConfigAction)().removeScreen(e.data.id,e.id.split("-toc-")[2]).exec()}else Object(a.getAppStore)().dispatch(r.builderActions.confirmDeleteContentChanged({layoutId:o,layoutItemId:n}))}function te(e){const t=e.id.split("-toc-"),o=t[0],n=t[1],i=Object(r.getAppConfigAction)();e.type===Z.Widget||e.type===Z.Section||e.type===Z.ScreenGroup?Object(c.duplicateLayoutItem)({layoutId:o,layoutItemId:n}):e.type===Z.View?(i.duplicateView(t[3],t[2],!0),i.exec()):e.type===Z.Screen&&(i.duplicateScreen(t[3],t[2],!0),i.exec())}function oe(e,t){return!(!t||""===t||""===t.replace(/(\r\n|\n|\r)/g,""))&&(e.type===Z.Widget?Object(r.getAppConfigAction)().editWidgetProperty(e.data.id,"label",t).exec():e.type===Z.Section?Object(r.getAppConfigAction)().editSectionProperty(e.data.id,"label",t).exec():e.type===Z.View?Object(r.getAppConfigAction)().editView(e.data.set("label",t)).exec():e.type===Z.ScreenGroup?Object(r.getAppConfigAction)().editScreenGroupProperty(e.data.id,"label",t).exec():e.type===Z.Screen&&Object(r.getAppConfigAction)().editScreen(e.data.set("label",t)).exec(),!0)}function ne(e){const t=Q(e);t&&c.fixedLayoutActions.toggleLockLayout(t)}function ie(e){const t=Q(e);Object(c.pendLayoutItem)(t)}function se(e){const t=Q(e);t&&c.fixedLayoutActions.sendBackward(t)}function ae(e){const t=Q(e);t&&c.fixedLayoutActions.bringForward(t)}function re(e){const t=Q(e);t&&c.fixedLayoutActions.sendToBack(t)}function le(e){const t=Q(e);t&&c.fixedLayoutActions.bringToFront(t)}function ce(e){if(e){const t=document.querySelector(`iframe[name="${a.APP_FRAME_NAME_IN_BUILDER}"]`),o=(t.contentDocument||t.contentWindow.document).querySelector(`div.exb-rnd[data-layoutid="${e.layoutId}"][data-layoutitemid="${e.layoutItemId}"]`);o&&Object(c.sinkingLayoutItem)(e,o.getBoundingClientRect())}}function de(e,t){const o=Q(e);if(o){const e=document.querySelector(`iframe[name="${a.APP_FRAME_NAME_IN_BUILDER}"]`),n=(e.contentDocument||e.contentWindow.document).querySelector(`div.exb-rnd[data-layoutid="${o.layoutId}"][data-layoutitemid="${o.layoutItemId}"]`);if(n){const e={TL:1,TC:2,TR:3,ML:4,MC:5,MR:6,BL:7,BC:8,BR:9};Object(c.floatingLayoutItem)(o,n.getBoundingClientRect(),e[t])}}}function pe(e){const t=Q(e);t&&c.fixedLayoutActions.alignTo(t,"left")}function ue(e){const t=Q(e);t&&c.fixedLayoutActions.alignHorizontalCenter(t)}function ge(e){const t=Q(e);t&&c.fixedLayoutActions.alignTo(t,"right")}function he(e){const t=Q(e);t&&c.fixedLayoutActions.alignTo(t,"top")}function me(e){const t=Q(e);t&&c.fixedLayoutActions.alignVerticalCenter(t)}function fe(e){const t=Q(e);t&&c.fixedLayoutActions.alignTo(t,"bottom")}function ve(e){const t=Q(e);t&&c.fixedLayoutActions.alignFullWidth(t)}function be(e){const t=Q(e);t&&c.fixedLayoutActions.alignFullHeight(t)}function ye(e){const t=Q(e);t&&c.fixedLayoutActions.alignFullSize(t)}function Ie(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:Object.keys(e).some(n=>{const i=e[n],s=t[n];return s?i.label!==s.label||i.icon!==s.icon?(o=!0,!0):void 0:(o=!0,!0)}),o}function xe(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:Object.keys(e).some(n=>{const i=e[n],s=t[n];return s?i.label!==s.label||i.icon!==s.icon||s.views!==i.views?(o=!0,!0):void 0:(o=!0,!0)}),o}function we(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:Object.keys(e).some(n=>{const i=e[n],s=t[n];return s?i.label!==s.label?(o=!0,!0):void 0:(o=!0,!0)}),o}function Se(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:Object.keys(e).some(n=>{const i=e[n],s=t[n];return s?i.label!==s.label||i.icon!==s.icon||s.screens!==i.screens?(o=!0,!0):void 0:(o=!0,!0)}),o}function je(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:Object.keys(e).some(n=>{const i=e[n],s=t[n];return s?i.label!==s.label?(o=!0,!0):void 0:(o=!0,!0)}),o}function Oe(e,t){let o=!1;return Object.keys(e).length!==Object.keys(t).length?o=!0:e&&Object.keys(e).some(n=>{const i=e[n],s=t[n];if(i!==s){if(i&&!s||!i&&s)return o=!0,!0;const e=i.content,t=s.content,n=i.order,a=s.order;if((e!==t||n!==a)&&(n!==a||e&&!t||Object.keys(e||{}).length!==Object.keys(t||{}).length))return o=!0,!0;if(e&&Object.keys(e).some(n=>{var i,s;const a=e[n],r=t[n];if(a&&!r||(null===(i=null==a?void 0:a.setting)||void 0===i?void 0:i.lockLayout)!==(null===(s=null==r?void 0:r.setting)||void 0===s?void 0:s.lockLayout)||(null==a?void 0:a.isPending)!==(null==r?void 0:r.isPending))return o=!0,!0}),o)return!0}}),o}function Ce(e){const{total:t}=Te(null,e);return t}function Te(e,t){let o=0,n=!1;if(t.id===e)return{isFind:!0,total:o};const{children:i,isExpand:s}=t;return s&&i&&i.find(t=>{o++;const{isFind:i,total:s}=Te(e,t);if(o+=s,i)return n=!0,!0}),{isFind:n,total:o}}function Pe(e,t){const o=Object.assign({},u,a.defaultMessages,p.defaultMessages,l.defaultMessages);return e.formatMessage({id:t,defaultMessage:o[t]})}function De(e,t){const{theme:o}=e,{showSearch:n}=t;return a.css`
    height: 100%;
    padding-bottom: 10px;
    position: relative;
    .toc-dropzone {
      position: absolute;
      pointer-events: none;
    }
    .outline-list-top {
      height: ${n?82:44}px;
      padding: 10px ${16}px;
      padding-top: 0;
      .outline-title {
        user-select: none;
        color: ${o.colors.palette.dark[600]};
        font-weight: ${o.typography.weights.extraBold};
      }
      .outline-top-btns {
        margin-right: -${o.components.button.sizes.sm.paddingX};
        // .btn:hover {
        //   svg {
        //     color: ${o.colors.black};
        //   }
        // }
      }
      .toc-search-input {
        margin-top: calc(12px - ${o.components.button.sizes.sm.paddingY});
      }
    }
    .outline-tree-container {
      color: ${o.colors.palette.dark[600]};
      height: calc(100% - ${n?82:44}px);
      overflow-y: auto;
      .outline-tree {
        >div {
          overflow: hidden;
          >div {
            overflow-x: auto;
            >.collapse {
              min-width: fit-content;
            }
          }
        }
        .tree-item-common {
          padding-left: ${16}px;
          .tree-arrow {
            display: none;
          }
        }
        .outline-title-item {
          margin-top: ${a.polished.rem(6)};
          .tree-item-common {
            .left-content {
              font-weight: ${o.typography.weights.extraBold};
              color: ${o.colors.palette.dark[600]};
            }
          }
          .tree-item-common:hover {
            background-color:${a.polished.rgba(o.colors.palette.light[400],.6)};
          }
        }
        .toc-item-dropzone {
          .toc-item {
            padding-left: ${a.polished.rem(4)};
          }
        }
      }
    }

  `}var ke,Ae;!function(e){e[e.BringForward=0]="BringForward",e[e.SendBackward=1]="SendBackward",e[e.BringToFront=2]="BringToFront",e[e.SendToBack=3]="SendToBack"}(ke||(ke={})),function(e){e.Page="PAGE",e.Widget="WIDGET",e.View="VIEW",e.Screen="SCREEN"}(Ae||(Ae={}));var Me,Le;function ze(e,t){const o=e.layouts[t];if(null!=o)switch(o.parentType){case Ae.Widget:return e.widgets[o.parent].parent;case Ae.View:{const t=e.views[o.parent].parent;return e.sections[t].parent}case Ae.Screen:{const t=e.screens[o.parent].parent;return e.screenGroups[t].parent}}return null}function Be(e,t,o,n,i,s){var r;let l=null!=s?s:Object(a.Immutable)({});const c=e.layouts[t];return null!=c&&(l=l.setIn(["layouts",t],{id:t,parent:o,parentType:n}),Object.keys(null!==(r=c.content)&&void 0!==r?r:{}).forEach(o=>{const n=c.content[o];switch(n.type){case a.LayoutItemType.Widget:l=function(e,t,o,n,i){let s=i;const a=e.widgets[o];null!=a&&(s=s.setIn(["widgets",o],{id:o,parent:n}),null!=a.layouts&&Object.keys(a.layouts).forEach(n=>{const i=a.layouts[n][t];s=Be(e,i,o,Ae.Widget,t,s)}));return s}(e,i,n.widgetId,t,l);break;case a.LayoutItemType.Section:l=function(e,t,o,n,i){let s=i;const a=e.sections[o];null!=a&&(s=s.setIn(["sections",o],{id:o,parent:n}),a.views.forEach(n=>{s=s.setIn(["views",n],{id:n,parent:o});const i=e.views[n].layout[t];s=Be(e,i,n,Ae.View,t,s)}));return s}(e,i,n.sectionId,t,l);break;case a.LayoutItemType.ScreenGroup:l=function(e,t,o,n,i){let s=i;const a=e.screenGroups[o];null!=a&&(s=s.setIn(["screenGroups",o],{id:o,parent:n}),a.screens.forEach(n=>{var i;s=s.setIn(["screens",n],{id:n,parent:o});const a=e.screens[n],r=a.main.layout[t];if(s=Be(e,r,n,Ae.Screen,t,s),null!=(null===(i=a.panel)||void 0===i?void 0:i.layout)){const o=a.panel.layout[t];s=Be(e,o,n,Ae.Screen,t,s)}}));return s}(e,i,n.screenGroupId,t,l)}})),l}function Re(e,t,o,n){var i;const{layoutId:s}=e,r=Be(t,o,"",Ae.Page,n),l=r.layouts[s];let c;if(l.parentType===Ae.Widget)c=l.parent;else if(l.parentType===Ae.View){const e=l.parent;c=r.views[e].parent}else if(l.parentType===Ae.Screen){const e=l.parent;c=r.screens[e].parent}const d=ze(r,s);if(null!=d){const e=t.layouts[d];return{layoutId:d,layoutItemId:Object.keys(null!==(i=e.content)&&void 0!==i?i:{}).find(t=>{const o=e.content[t];return o.type===a.LayoutItemType.Widget&&o.widgetId===c||o.type===a.LayoutItemType.Section&&o.sectionId===c||o.type===a.LayoutItemType.ScreenGroup&&o.screenGroupId===c})}}return null}function Ee(e,t){var o,n,i;if(!t)return null;const{layoutId:s,layoutItemId:a}=t;return null===(i=null===(n=null===(o=e.layouts)||void 0===o?void 0:o[s])||void 0===n?void 0:n.content)||void 0===i?void 0:i[a]}function Je(e,t){if(e.sections)for(const o in e.sections){if(e.sections[o].views.includes(t))return o}return null}function Ne(e,t){let o=t.layouts[e];for(;null!=(null==o?void 0:o.parent);){if(o.parentType===Ae.View){const e=o.parent;return{viewId:e,sectionId:t.views[e].parent}}const e=ze(t,o.id);o=t.layouts[e]}return{viewId:null,sectionId:null}}function Fe(e,t){let o=t.layouts[e];for(;null!=(null==o?void 0:o.parent);){if(o.parentType===Ae.Screen){const e=o.parent;return{screenId:e,screenGroupId:t.screens[e].parent}}const e=ze(t,o.id);o=t.layouts[e]}return{screenId:null,screenGroupId:null}}function $e(e){switch(e.type){case a.LayoutItemType.Widget:return"string"==typeof e.widgetId?e.widgetId:null;case a.LayoutItemType.Section:return"string"==typeof e.sectionId?e.sectionId:null;case a.LayoutItemType.ScreenGroup:return"string"==typeof e.screenGroupId?e.screenGroupId:null;default:return null}}function He(e,t,o=!1){return(null==e?void 0:e.content)?Object.keys(e.content).filter(n=>e.content[n].type===t&&!!$e(e.content[n])&&(o||!e.content[n].isPending)).map(t=>$e(e.content[t])):[]}function Ve(e,t,o,n,i=!1){let s=[];const r=He(e.layouts[t],a.LayoutItemType.Widget,i),l=He(e.layouts[t],a.LayoutItemType.Section,i),c=He(e.layouts[t],a.LayoutItemType.ScreenGroup,i);o===a.LayoutItemType.Widget?s=s.concat(r):o===a.LayoutItemType.Section?s=s.concat(l):o===a.LayoutItemType.ScreenGroup&&(s=s.concat(c));return r.filter(t=>{var o,n,i,s,r;return(null===(n=null===(o=e.widgets[t])||void 0===o?void 0:o.manifest)||void 0===n?void 0:n.widgetType)===a.WidgetType.Layout||(null===(r=null===(s=null===(i=e.widgets[t])||void 0===i?void 0:i.manifest)||void 0===s?void 0:s.properties)||void 0===r?void 0:r.hasEmbeddedLayout)}).forEach(t=>{var a;Object.keys(null!==(a=e.widgets[t].layouts)&&void 0!==a?a:{}).forEach(a=>{const r=e.widgets[t].layouts[a][n];s=s.concat(Ve(e,r,o,n,i))})}),l.forEach(t=>{var a,r;null===(r=null===(a=e.sections)||void 0===a?void 0:a[t])||void 0===r||r.views.forEach(t=>{e.views[t]&&e.views[t].layout[n]&&(s=s.concat(Ve(e,e.views[t].layout[n],o,n,i)))})}),c.forEach(t=>{var a,r;null===(r=null===(a=e.screenGroups)||void 0===a?void 0:a[t])||void 0===r||r.screens.forEach(t=>{var a,r,l,c,d,p,u;(null===(l=null===(r=null===(a=e.screens)||void 0===a?void 0:a[t])||void 0===r?void 0:r.main.layout)||void 0===l?void 0:l[n])&&(s=s.concat(Ve(e,e.screens[t].main.layout[n],o,n,i))),(null===(u=null===(p=null===(d=null===(c=e.screens)||void 0===c?void 0:c[t])||void 0===d?void 0:d.panel)||void 0===p?void 0:p.layout)||void 0===u?void 0:u[n])&&(s=s.concat(Ve(e,e.screens[t].panel.layout[n],o,n,i)))})}),s}function We(e,t,o,n,i=!1){let s=[];const r=He(e.layouts[t],a.LayoutItemType.Widget,i),l=He(e.layouts[t],a.LayoutItemType.Section,i),c=He(e.layouts[t],a.LayoutItemType.ScreenGroup,i);s=o===a.LayoutItemType.Widget?s.concat(r):o===a.LayoutItemType.ScreenGroup?s.concat(c):s.concat(l);return r.filter(t=>e.widgets&&e.widgets[t]&&e.widgets[t].manifest.widgetType===a.WidgetType.Layout).forEach(t=>{Object.keys(e.widgets[t].layouts).forEach(a=>{const r=ot(e.widgets[t].layouts[a],n,e.mainSizeMode);s=s.concat(We(e,r,o,n,i))})}),s}function Ge(e,t,o){if(!(null==e?void 0:e.content))return null;const n=Object.keys(e.content).find(n=>e.content[n].type===o&&(e.content[n].widgetId===t||e.content[n].sectionId===t||e.content[n].screenGroupId===t)&&!e.content[n].isPending);return e.content[n]}function Ue(e,t,o=!1){const n=e.layouts[t];return(null==n?void 0:n.content)?o?Object.keys(n.content):Object.keys(n.content).filter(e=>!n.content[e].isPending):[]}function Ze(e,t,o=!1){return(null==e?void 0:e.content)?Object.keys(e.content).filter(n=>e.content[n].type===t&&!!$e(e.content[n])&&(o||!e.content[n].isPending)).map(t=>({layoutId:e.id,layoutItemId:t})):[]}function _e(e,t){return Object.keys(e.widgets).find(o=>{const n=e.widgets[o];if(n.layouts)return Object.keys(n.layouts).some(e=>void 0!==Object.keys(n.layouts[e]).find(o=>n.layouts[e][o]===t))})}function qe(e,t,o,n){const i=e.pages&&Object.keys(e.pages).find(i=>{const s=ot(e.pages[i].layout,n,e.mainSizeMode);return We(e,s,o,n).includes(t)});if(i)return{type:a.ContainerType.Page,id:i};const s=e.dialogs&&Object.keys(e.dialogs).find(i=>{const s=ot(e.dialogs[i].layout,n,e.mainSizeMode);return We(e,s,o,n).includes(t)});if(s)return{type:a.ContainerType.Dialog,id:s};if(e.header){const i=ot(e.header.layout,n,e.mainSizeMode);if(We(e,i,o,n).includes(t))return{type:a.ContainerType.Header,id:"header"}}if(e.footer){const i=ot(e.footer.layout,n,e.mainSizeMode);if(We(e,i,o,n).includes(t))return{type:a.ContainerType.Footer,id:"footer"}}const r=e.views&&Object.keys(e.views).find(i=>{const s=ot(e.views[i].layout,n,e.mainSizeMode);return We(e,s,o,n).includes(t)});if(r)return{type:a.ContainerType.View,id:r};if(e.screens){const i=Object.keys(e.screens).find(i=>{const s=ot(e.screens[i].main.layout,n,e.mainSizeMode);return We(e,s,o,n).includes(t)});if(i)return{type:a.ContainerType.ScreenMain,id:i};const s=Object.keys(e.screens).find(i=>{var s;const a=ot(null===(s=e.screens[i].panel)||void 0===s?void 0:s.layout,n,e.mainSizeMode);return We(e,a,o,n).includes(t)});if(s)return{type:a.ContainerType.ScreenPanel,id:s}}}function Xe(e,t,o,n){const i=e.pages&&Object.keys(e.pages).find(i=>{const s=ot(e.pages[i].layout,n,e.mainSizeMode);return Ve(e,s,o,n).includes(t)});if(i)return{type:a.RootContainerType.Page,id:i};const s=e.dialogs&&Object.keys(e.dialogs).find(i=>{const s=ot(e.dialogs[i].layout,n,e.mainSizeMode);return Ve(e,s,o,n).includes(t)});if(s)return{type:a.RootContainerType.Dialog,id:s};if(e.header){const i=ot(e.header.layout,n,e.mainSizeMode);if(Ve(e,i,o,n).includes(t))return{type:a.RootContainerType.Header,id:"header"}}if(e.footer){const i=ot(e.footer.layout,n,e.mainSizeMode);if(Ve(e,i,o,n).includes(t))return{type:a.RootContainerType.Footer,id:"footer"}}}function Ye(e,t,o,n){return We(e,ot(e.pages[t].layout,n,e.mainSizeMode),o,n)}function Ke(e,t,o,n){var i;const s=We(e,ot(e.screens[t].main.layout,n,e.mainSizeMode),o,n);if(e.screens[t].panel){const a=We(e,ot(null===(i=e.screens[t].panel)||void 0===i?void 0:i.layout,n,e.mainSizeMode),o,n);return s.concat(a)}return s}function Qe(e,t,o,n){var i;return We(e,ot(null===(i=e.views[t])||void 0===i?void 0:i.layout,n,e.mainSizeMode),o,n)}function et(e,t,o){return We(e,ot(e.header.layout,o,e.mainSizeMode),t,o)}function tt(e,t,o){return We(e,ot(e.footer.layout,o,e.mainSizeMode),t,o)}function ot(e,t,o){return e?e[t]||e[o]:null}function nt(e,t,o,n){if(n){const i=it(e,o,t,n);if(i)return pt(e,o,t,i,n);{const i=qe(e,o,t,n);if(!i)return[];const s=function(e,t,o){var n;return t.type===a.ContainerType.Footer?e.footer.layout[o]:t.type===a.ContainerType.Header?e.header.layout[o]:t.type===a.ContainerType.ScreenMain?e.screens[t.id].main.layout[o]:t.type===a.ContainerType.ScreenPanel?null===(n=e.screens[t.id].panel)||void 0===n?void 0:n.layout[o]:e[t.type][t.id].layout[o]}(e,i,n);return[{layoutId:s,layoutItemId:Ge(e.layouts[s],o,t).id}]}}{const n=[];return Object.keys(e.layouts).forEach(i=>{Ue(e,i,!0).forEach(s=>{const a=e.layouts[i].content[s];t!==a.type||a.widgetId!==o&&a.sectionId!==o&&a.screenGroupId!==o||n.push({layoutId:i,layoutItemId:s})})}),n}}function it(e,t,o,n){return Object.keys(e.widgets).find(i=>{const s=e.widgets[i];if(s.layouts)return Object.keys(s.layouts).some(i=>{const a=s.layouts[i][n],r=e.layouts[a];return r&&r.content&&void 0!==Object.keys(r.content).find(e=>r.content[e].type===o&&(r.content[e].widgetId===t||r.content[e].sectionId===t))})})}function st(e,t,o,n){const i=e.widgets[t];if(!i.layouts)return[];let s=[];return Object.keys(i.layouts).forEach(t=>{Object.keys(i.layouts[t]).forEach(a=>{const r=e.layouts[i.layouts[t][a]];s=s.concat(He(r,o,n))})}),Array.from(new Set(s))}function at(e,t,o,n){const i=[];let s=!1;const a=(e,t,o,a)=>{const r=ot(o,n,void 0),l=Ge(e.layouts[r],t,a);let c;return l&&(c={layoutId:r,layoutItemId:l.id},i.push(c),s=!0),c};return e.pages&&Object.keys(e.pages).find(n=>{const i=e.pages[n];return!(!i.layout||!a(e,t,i.layout,o))}),s?i:(e.views&&Object.keys(e.views).find(n=>{const i=e.views[n];return!!a(e,t,i.layout,o)}),s?i:(e.dialogs&&Object.keys(e.dialogs).find(n=>{const i=e.dialogs[n];return!!a(e,t,i.layout,o)}),s?i:(e.header&&a(e,t,e.header.layout,o),s?i:(e.footer&&a(e,t,e.footer.layout,o),s||e.widgets&&Object.keys(e.widgets).find(n=>{const i=e.widgets[n];return i.layouts&&Object.keys(i.layouts).forEach(n=>{a(e,t,i.layouts[n],o)}),!!s}),i))))}function rt(e,t,o){const n=e.widgets[o];if(!n)return;let i;return Object.keys(n.layouts).find(e=>{if(Object.keys(n.layouts[e]).find(o=>{if(n.layouts[e][o]===t)return i=o,!0}))return!0}),i}function lt(e,t){var o,n;let i=null;const s=e=>e?Object.keys(e).find(o=>e[o]===t):null;return Object.keys(e.widgets||{}).some(t=>Object.keys(e.widgets[t].layouts||{}).some(o=>{if(i)return!0;i=s(e.widgets[t].layouts[o])})),i||(Object.keys(e.views||{}).some(t=>{if(i)return!0;i=s(e.views[t].layout)}),i||(Object.keys(e.pages||{}).some(t=>{if(i)return!0;i=s(e.pages[t].layout)}),i||(Object.keys(e.dialogs||{}).some(t=>{if(i)return!0;i=s(e.dialogs[t].layout)}),i||(Object.keys(e.screens||{}).some(t=>{var o,n;return!!i||(i=s(null===(o=e.screens[t].main)||void 0===o?void 0:o.layout),!!i||void(i=s(null===(n=e.screens[t].panel)||void 0===n?void 0:n.layout)))}),i||(i=s(null===(o=e.header)||void 0===o?void 0:o.layout),i||(i=s(null===(n=e.footer)||void 0===n?void 0:n.layout),i||null))))))}function ct(e,t,o,n){if(!e.widgets[o])return[];const i=e.layouts[t.layoutId]&&e.layouts[t.layoutId].content&&e.layouts[t.layoutId].content[t.layoutItemId];if(!i)return[];const s=i.type;let r;return s===a.LayoutItemType.Section?r=i.sectionId:s===a.LayoutItemType.Widget&&(r=i.widgetId),r?pt(e,r,s,o,n):function(e,t,o){const n=e.widgets[t];if(!n)return!1;let i=!1;return n.layouts&&Object.keys(n.layouts).forEach(t=>{i||Object.keys(n.layouts[t]).forEach(s=>{if(i)return;const a=n.layouts[t][s];Ue(e,a,!0).forEach(e=>{i||o.layoutId===a&&o.layoutItemId===e&&(i=!0)})})}),i}(e,o,t)?[t]:[]}function dt(e,t,o,n){return ct(e,t,o,n).map(t=>e.layouts[t.layoutId][t.layoutItemId])}function pt(e,t,o,n,i){const s=e.widgets[n];if(!s||!t)return[];const r=[];return s.layouts&&Object.keys(s.layouts).forEach(n=>{const l=s.layouts[n][i],c=e.layouts[l];c&&c.content&&Object.keys(c.content).forEach(n=>{const s=c.content[n];if(s.type!==o||s.widgetId!==t&&s.sectionId!==t&&s.screenGroupId!==t){if(s.type===a.LayoutItemType.Widget){const n=e.widgets[s.widgetId];n&&n.manifest.widgetType===a.WidgetType.Layout&&r.push(...pt(e,t,o,n.id,i))}}else r.push({layoutId:c.id,layoutItemId:s.id})})}),r}function ut(e,t,o,n,i){const s=qe(e,t,o,i);if(!s)return[];switch(s.type){case a.ContainerType.Page:return Ye(e,s.id,n,i);case a.ContainerType.Header:return et(e,n,i);case a.ContainerType.Footer:return tt(e,n,i);case a.ContainerType.View:return Qe(e,s.id,n,i);case a.ContainerType.Dialog:return function(e,t,o,n){return We(e,ot(e.dialogs[t].layout,n,e.mainSizeMode),o,n)}(e,s.id,n,i);case a.ContainerType.ScreenMain:case a.ContainerType.ScreenPanel:return Ke(e,s.id,n,i)}}function gt(e,t,o){var n,i;const s=e.pages[t],r=null===(n=null==s?void 0:s.layout)||void 0===n?void 0:n[o],l=e.layouts[r],c=[];return(null==l?void 0:l.type)===a.LayoutType.FlowLayout&&Object.keys(null!==(i=l.content)&&void 0!==i?i:{}).sort().forEach(t=>{var o;const n=l.content[t];if(!n.isPending&&!(null===(o=n.setting)||void 0===o?void 0:o.isFloating)&&n.type===a.LayoutItemType.Widget){const o=function(e,t){const{layoutId:o,layoutItemId:n}=t,i=e.layouts[o].content[n],s=e.widgets[i.widgetId];if(s)return{label:s.label,id:`${o}_block_${n}`};return null}(e,{layoutId:r,layoutItemId:t});o&&c.push(o)}}),c}function ht(e,t,o){var n,i;const s=e.pages[t],r=null===(n=null==s?void 0:s.layout)||void 0===n?void 0:n[o],l=e.layouts[r],c=[];return(null==l?void 0:l.type)===a.LayoutType.FlowLayout&&Object.keys(null!==(i=l.content)&&void 0!==i?i:{}).sort().forEach(t=>{var o;const n=l.content[t];if(!n.isPending&&!(null===(o=n.setting)||void 0===o?void 0:o.isFloating)&&n.type===a.LayoutItemType.ScreenGroup){const t=e.screenGroups[n.screenGroupId],o=[];null==t||t.screens.forEach(t=>{const n=function(e,t,o){const n=e.screens[o];if(n)return{label:n.label,id:`${t}_screen_${o}`};return null}(e,r,t);n&&o.push(n)}),c.push({id:t.id,label:t.label,screens:o})}}),c}function mt(e,t){var o;const n=e.appConfig.sections[t];if(!n||!n.views)return null;const i=null===(o=e.appRuntimeInfo.sectionNavInfos)||void 0===o?void 0:o[n.id];let s;if(!i){const t=n.views[0];s=e.appConfig.views[t]}return{sectionId:t,navInfo:i,activeView:s,views:n.views,sectionStyle:n.style,transition:n.transition,autoPlay:n.autoPlay,interval:n.interval,loop:n.loop}}function ft(e,t,o,n){const i=e.pages[t];return i?n===a.PagePart.Header?i.header&&e.header?It(e,e.header.layout[o],o):[]:n===a.PagePart.Footer?i.footer&&e.footer?It(e,e.footer.layout[o],o):[]:n===a.PagePart.Body?It(e,i.layout[o],o):[]:[]}function vt(e,t,o,n){const i=e.pages[t];return i?n===a.PagePart.Header?i.header&&e.header?xt(e,e.header.layout,o):[]:n===a.PagePart.Footer?i.footer&&e.footer?xt(e,e.footer.layout,o):[]:n===a.PagePart.Body?xt(e,i.layout,o):[]:[]}function bt(e,t,o){const n=e.dialogs[t];return n?It(e,n.layout[o],o):[]}function yt(e,t,o){const n=e.dialogs[t];return n?xt(e,n.layout,o):[]}function It(e,t,o){let n=[];Ze(e.layouts[t],a.LayoutItemType.Widget,!0).forEach(t=>{const i=e.layouts[t.layoutId].content[t.layoutItemId];i.isPending?n.push(t):e.widgets[i.widgetId].layouts&&Object.keys(e.widgets[i.widgetId].layouts).forEach(t=>{n=n.concat(It(e,e.widgets[i.widgetId].layouts[t][o],o))})});Ze(e.layouts[t],a.LayoutItemType.Section,!0).forEach(t=>{const i=e.layouts[t.layoutId].content[t.layoutItemId];i.isPending?n.push(t):e.sections[i.sectionId].views&&e.sections[i.sectionId].views.forEach(t=>{n=n.concat(It(e,e.views[t].layout[o],o))})});return Ze(e.layouts[t],a.LayoutItemType.ScreenGroup,!0).forEach(t=>{var i,s;const a=e.layouts[t.layoutId].content[t.layoutItemId].screenGroupId;null===(s=null===(i=e.screenGroups)||void 0===i?void 0:i[a].screens)||void 0===s||s.forEach(t=>{const i=null==e?void 0:e.screens[t];i.main&&(n=n.concat(It(e,i.main.layout[o],o))),i.panel&&(n=n.concat(It(e,i.panel.layout[o],o)))})}),n}function xt(e,t,o,n=null,i=null){const s=[];n||(n=Ve(e,t[o],a.LayoutItemType.Widget,o,!0)),i||(i=Ve(e,t[o],a.LayoutItemType.Section,o,!0));return Object.keys(a.BrowserSizeMode).filter(e=>a.BrowserSizeMode[e]!==o).map(e=>a.BrowserSizeMode[e]).forEach(r=>{Ze(e.layouts[t[r]],a.LayoutItemType.Widget,!0).forEach(t=>{const r=e.layouts[t.layoutId].content[t.layoutItemId];e.widgets[r.widgetId].manifest.widgetType!==a.WidgetType.Layout&&n.indexOf(r.widgetId)<0?!wt(e,s,t)&&s.push(t):e.widgets[r.widgetId].layouts&&Object.keys(e.widgets[r.widgetId].layouts).forEach(t=>{xt(e,e.widgets[r.widgetId].layouts[t],o,n,i).forEach(t=>{!wt(e,s,t)&&s.push(t)})})});Ze(e.layouts[t[r]],a.LayoutItemType.Section,!0).forEach(t=>{const a=e.layouts[t.layoutId].content[t.layoutItemId];i.indexOf(a.sectionId)<0?!wt(e,s,t)&&s.push(t):e.sections[a.sectionId].views&&e.sections[a.sectionId].views.forEach(t=>{xt(e,e.views[t].layout,o,n,i).forEach(t=>{!wt(e,s,t)&&s.push(t)})})});Ze(e.layouts[t[r]],a.LayoutItemType.ScreenGroup,!0).forEach(t=>{var a,r;const l=e.layouts[t.layoutId].content[t.layoutItemId];(null===(r=null===(a=e.screenGroups)||void 0===a?void 0:a[l.screenGroupId])||void 0===r?void 0:r.screens)&&e.screenGroups[l.screenGroupId].screens.forEach(t=>{var a;const r=null===(a=e.screens)||void 0===a?void 0:a[t];(null==r?void 0:r.main)&&xt(e,r.main.layout,o,n,i).forEach(t=>{!wt(e,s,t)&&s.push(t)}),(null==r?void 0:r.panel)&&xt(e,r.panel.layout,o,n,i).forEach(t=>{!wt(e,s,t)&&s.push(t)})})})}),s}function wt(e,t,o){const n=e.layouts[o.layoutId].content[o.layoutItemId];return!!t.find(t=>{const o=e.layouts[t.layoutId].content[t.layoutItemId];return o.type===n.type&&(o.type===a.LayoutItemType.Widget&&o.widgetId===n.widgetId||o.type===a.LayoutItemType.Section&&o.sectionId===n.sectionId)})}!function(e){e.Auto="auto",e[e.Normal=0]="Normal",e[e.BoundaryDropArea=10]="BoundaryDropArea",e[e.DragMoveTip=20]="DragMoveTip",e[e.HandlerTools=30]="HandlerTools",e[e.DraggingItem=40]="DraggingItem"}(Me||(Me={})),function(e){e.Auto="AUTO",e.Stretch="STRETCH",e.Custom="CUSTOM"}(Le||(Le={}));var St=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const jt=o(27);var Ot;function Ct(e,t,n,i){var s,r;let l;const{appConfig:c}=t,{id:d,layoutId:p,layoutItemId:u,type:g,sectionId:h,screenGroupId:m}=e,f=St(e,["id","layoutId","layoutItemId","type","sectionId","screenGroupId"]);g===Z.Widget?l=c.widgets[d]:g===Z.Section?l=c.sections[d]:g===Z.View?l=c.views[d]:g===Z.ScreenGroup?l=c.screenGroups[d]:g!==Z.Screen&&g!==Z.ScreenMainStage&&g!==Z.ScreenSrollingPanel||(l=c.screens[d]);const{currentSelectedItemId:v}=n,b={layoutId:p,layoutItemId:u,id:d};g===Z.View&&(b.sectionId=h),g!==Z.Screen&&g!==Z.ScreenMainStage&&g!==Z.ScreenSrollingPanel||(b.screenGroupId=m);const y=K(b,g),{expandIds:I,renderOutlineContent:x}=Ot,w=I.includes(y),S=function(e,t){let o;o=e===a.PagePart.Header?t.allowEditableForHeader:e===a.PagePart.Footer?t.allowEditableForFooter:e===a.PagePart.Body?t.allowEditable:t.allowEditableForDialog;return o}(e.pagePart,t),j=Object.assign({id:y,data:l,label:null!=i?i:l.label,type:g,allowEditable:S,isExpand:w,isActive:v===y,renderItem:x},f);if(j.icon=l.icon,"string"==typeof l.icon){const t=null===(s=null==c?void 0:c.layouts)||void 0===s?void 0:s[e.layoutId];if((null==t?void 0:t.type)===a.LayoutType.FlowLayout){const o=null===(r=null==t?void 0:t.content)||void 0===r?void 0:r[e.layoutItemId];(null==o?void 0:o.widgetId)&&(j.icon=jt)}}return j.icon||(g===Z.Widget?j.icon={svg:o(92)}:g===Z.Section?j.icon={svg:o(93)}:g===Z.View?j.icon={svg:o(94)}:g===Z.ScreenGroup?j.icon={svg:o(28)}:g===Z.Screen&&(j.icon={svg:o(95)})),j}function Tt(e,t,o){const{appConfig:n}=t,{level:i,pagePart:s,layoutId:r,layoutItemId:l,id:c}=e,d=Ct(e,t,o),p=n.sections[e.id];return p.views&&(d.children=p.views.asMutable().map((e,n)=>function(e,t,o){const n=Ct(e,t,o),{widgets:i,sections:s}=Mt(a.ContainerType.View,e.id,t);return n.children=Lt(s,i,n.level+1,n.pagePart,t,o),n}({id:e,sectionId:c,layoutId:r,layoutItemId:l,index:n,level:i+1,pagePart:s,type:Z.View},t,o))),d}function Pt(e,t,o){const{appConfig:n}=t,{level:i,pagePart:s,layoutId:a,layoutItemId:r,id:l}=e,c=Ct(e,t,o),d=n.screenGroups[e.id];return d.screens&&(c.children=d.screens.asMutable().map((e,n)=>function(e,t,o){const n=Ct(e,t,o);e.level=n.level+1,e.type=Z.ScreenMainStage;const i=Ct(e,t,o,Pe(t.intl,"mainStage"));e.type=Z.ScreenSrollingPanel;const s=Ct(e,t,o,Pe(t.intl,"scrollingPanel")),{widgets:a,sections:r}=Mt("screens",e.id,t,["main","layout"]),{widgets:l,sections:c}=Mt("screens",e.id,t,["panel","layout"]);return i.children=Lt(r,a,n.level+2,n.pagePart,t,o),s.children=Lt(c,l,n.level+2,n.pagePart,t,o),i.allowEditable=!1,s.allowEditable=!1,n.children=[i,s],n}({id:e,screenGroupId:l,layoutId:a,layoutItemId:r,index:n,level:i+1,pagePart:s,type:Z.Screen},t,o))),c}function Dt(e,t,n,i,r,l){var c;const{appConfig:d,browserSizeMode:p}=r,u=s.findLayoutId(e,p,d.mainSizeMode);if(!u)return;const g=null===(c=null==d?void 0:d.layouts)||void 0===c?void 0:c[u],{currentSelectedItemId:h}=l,{expandIds:m,renderOutlineContent:f}=Ot,v=m.includes(u),b={id:u,label:g.label,index:t,level:n,pagePart:i,icon:o(96),type:Z.Layout,isExpand:v,isActive:h===u,renderItem:f},y=At(a.LayoutItemType.Widget,d.layouts[u])||[],I=At(a.LayoutItemType.Section,d.layouts[u])||[];return b.children=Lt(I,y,b.level+1,i,r,l),b}function kt(e,t,o){var n,i,s,a;const{appConfig:r}=t,l=Ct(e,t,o);l.needFlip=null===(s=null===(i=null===(n=null==l?void 0:l.data)||void 0===n?void 0:n.manifest)||void 0===i?void 0:i.properties)||void 0===s?void 0:s.flipIcon;const c=r.widgets[e.id];if(c.layouts){const e=Object.keys(c.layouts).filter(e=>0!==e.indexOf("_"));if(1===e.length){const e=c.layouts[Object.keys(c.layouts)[0]];l.children=null===(a=Dt(e,0,l.level,l.pagePart,t,o))||void 0===a?void 0:a.children}else l.children=[],e.forEach((e,n)=>{const i=Dt(c.layouts[e],n,l.level+1,l.pagePart,t,o);i&&l.children.push(i)})}return l}function At(e,t){let o;return e===a.LayoutItemType.Widget?o="widgetId":e===a.LayoutItemType.Section?o="sectionId":e===a.LayoutItemType.ScreenGroup&&(o="screenGroupId"),t&&t.content&&t.order?t.order.asMutable().filter(n=>t.content[n].type===e&&t.content[n][o]&&!t.content[n].isPending).map(e=>({id:t.content[e][o],layoutId:t.id,layoutItemId:e})):[]}function Mt(e,t,o,n){var i;let r=[],l=[],c=[];const{appConfig:d,browserSizeMode:p}=o;if(e===a.ContainerType.Header||e===a.ContainerType.Footer){if(d[e]){const t=s.findLayoutId(d[e].layout,p,d.mainSizeMode);r=At(a.LayoutItemType.Widget,d.layouts[t])||[],l=At(a.LayoutItemType.Section,d.layouts[t])||[]}}else if(d[e]&&d[e][t]){const o=d[e][t],u=s.findLayoutId(n?null===(i=o[n[0]])||void 0===i?void 0:i[n[1]]:o.layout,p,d.mainSizeMode);r=At(a.LayoutItemType.Widget,d.layouts[u])||[],l=At(a.LayoutItemType.Section,d.layouts[u])||[],c=At(a.LayoutItemType.ScreenGroup,d.layouts[u])||[]}return{widgets:r,sections:l,screens:c}}function Lt(e,t,o,n,i,s){const a=[];return a.push(...e.map((e,t)=>(e.index=t,e.level=o,e.pagePart=n,e.type=Z.Section,Tt(e,i,s)))),a.push(...t.map((e,t)=>(e.index=t,e.level=o,e.pagePart=n,e.type=Z.Widget,kt(e,i,s)))),a}function zt(e,t,o,n,i,s,a){var r;let l=[];if(e.length){let t=[];if(o.length){const n=null===(r=o[0]||e[0])||void 0===r?void 0:r.layoutId,i=s.appConfig.layouts[n].order.asMutable(),a={};o.map(e=>{e.type=Z.Widget,a[e.layoutItemId]=e}),e.map(e=>{a[e.layoutItemId]=e}),i.map(e=>{a[e]&&t.push(a[e])})}else t=e;l.push(...t.map((e,t)=>(e.index=t,e.level=n,e.pagePart=i,e.type===Z.Widget?kt(e,s,a):(e.type=Z.ScreenGroup,Pt(e,s,a)))))}else l=Lt(t,o,n,i,s,a);return l}const Bt=[{name:"offset",options:{offset:[0,10]}}];class Rt extends a.React.Component{constructor(e){super(e),this.singleAndDoubleClickTimeout=void 0,this.handleOnTocDoubleClick=(e,t)=>{this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),this.checkIfReadOnly(e)||this.setState({editableItemId:e.id})},this.handleRename=(e,t)=>(this.setState({editableItemId:""}),oe(e,t)),this.checkIfReadOnly=e=>{var t,o;const n=e.id.split("-toc-");let i;return i=e.type===Z.ScreenGroup||e.type===Z.Section?n[0]===(null===(t=this.props.selection)||void 0===t?void 0:t.layoutId)&&n[1]===(null===(o=this.props.selection)||void 0===o?void 0:o.layoutItemId):this.state.currentSelectedItemId===e.id,!(i&&e.allowEditable&&e.pagePart===this.props.activePagePart)},this.handleClickItem=(e,t)=>{this.singleAndDoubleClickTimeout&&(clearTimeout(this.singleAndDoubleClickTimeout),this.singleAndDoubleClickTimeout=void 0),e.allowEditable&&(this.singleAndDoubleClickTimeout=setTimeout(()=>{if(e.type===Z.Label||e.type===Z.Layout)return void this.handleExpand(e);const{currentSelectedItemId:t,itemJson:o}=this.state;t!==e.id?e.type===Z.Label||e.type===Z.Layout?(this.setState({itemJson:Object.assign({},o)}),this.props.onClickItem(e)):(this.setState({currentSelectedItemId:e.id,itemJson:n.activeNodesByActiveIds(o,[e.id])}),this.props.onClickItem(e)):this.handleExpand(e)},200))},this.handleExpand=e=>{const{expandIds:t}=this;e.isExpand?t.includes(e.id)&&t.splice(t.indexOf(e.id),1):t.includes(e.id)||t.push(e.id),this.setState({itemJson:n.expandNodesByExpandIds(this.state.itemJson,t)})},this.handleArrowClick=e=>{this.handleExpand(e)},this.handleSearchTextChange=e=>{this.setState({filterText:e},()=>{this.setState({itemJson:this.getItemJsonByAppConfig()})})},this.handleSearchSubmit=e=>{this.setState({filterText:e},()=>{this.setState({itemJson:this.getItemJsonByAppConfig()})})},this.handleSearchBtnClick=e=>{e.stopPropagation();this.state.showSearch&&this.handleSearchTextChange(""),this.setState({showSearch:!this.state.showSearch})},this.handleSearchOpened=()=>{this.searchInput&&(this.searchInput.select(),this.searchInput.focus())},this.formatMessage=e=>{const{intl:t}=this.props;return Pe(t,e)},this.getItemJsonByAppConfig=e=>function(e,t,o){var s;const l=[],{intl:d,appConfig:p,currentPageId:u,currentDialogId:g}=e,{filterText:h,currentSelectedItemId:m}=t,{formatMessage:f}=i,v=[f(d,"header"),f(d,"footer"),f(d,"body")],b=[a.PagePart.Header,a.PagePart.Footer,a.PagePart.Body];Ot=o;const{expandIds:y,renderTitleRightContent:I,lastPageId:x}=Ot,w={id:"ROOT",type:Z.Label,children:l,label:""};if(!p)return Object(a.Immutable)(w);if(g){const{widgets:o,sections:n}=Mt(a.ContainerType.Dialog,g,e);w.children=Lt(n,o,0,null,e,t)}else for(let o=0;o<3;o++){if(0===o&&!e.enableHeader||1===o&&!e.enableFooter)continue;const n=o+"-"+v[o],i=m===n;i&&(y.includes(n)||y.push(n));const g=y.includes(n),h={label:v[o],pagePart:b[o],id:n,index:o,level:0,mustShowArrow:!0,isActive:i,isExpand:g,type:Z.Label,className:"outline-title-item",allowEditable:!0,renderRightContent:I,arrowIcon:e=>a.React.createElement("div",null)};let w,S,j=!0;if(h.label===f(d,"header")?(w=a.ContainerType.Header,S="header",e.enableHeader||(j=!1)):h.label===f(d,"body")?(w=a.ContainerType.Page,S=u,r.appConfigUtils.isRealPage(p,u)?Ot.lastPageId=u:S=x):(w=a.ContainerType.Footer,S="footer",e.enableFooter||(j=!1)),j){const{widgets:o,sections:n,screens:i}=Mt(w,S,e),r=zt(i,n,o,h.level,h.pagePart,e,t),l=h.pagePart===a.PagePart.Body&&(null===(s=e.appConfig.pages[e.currentPageId])||void 0===s?void 0:s.mode)===a.PageMode.AutoScroll;h.children=l?r.filter(e=>{var t;const o=e.id.split("-toc-");return Object(c.supportSinking)({layoutId:o[0],layoutItemId:o[1]})||(null===(t=e.children)||void 0===t?void 0:t.length)>0}):r,h.children&&h.children.length>0&&(h.isExpand=!0,y.includes(h.id)||y.push(h.id))}l.push(h)}let S=Object(a.Immutable)(w);if(h&&""!==h){const e=n.filterTree(S,h.trim());S=n.expandFilteredNodes(e,h.trim()),Ot.expandIds=n.fetchAllExpandIds(S),r.builderAppSync.publishChangeSelectionToApp(null)}return S}(null!=e?e:this.props,this.state,this),this.getAlignmentsDropDownItems=e=>[{label:this.formatMessage("snapToLeft"),event:t=>{pe(e),t.stopPropagation()}},{label:this.formatMessage("alignHCenter"),event:t=>{ue(e),t.stopPropagation()}},{label:this.formatMessage("snapToRight"),event:t=>{ge(e),t.stopPropagation()}},{label:this.formatMessage("snapToTop"),event:t=>{he(e),t.stopPropagation()}},{label:this.formatMessage("alignVCenter"),event:t=>{me(e),t.stopPropagation()}},{label:this.formatMessage("snapToBottom"),event:t=>{fe(e),t.stopPropagation()}},{label:this.formatMessage("fullWidth"),event:t=>{ve(e),t.stopPropagation()}},{label:this.formatMessage("fullHeight"),event:t=>{be(e),t.stopPropagation()}},{label:this.formatMessage("fullSize"),event:t=>{ye(e),t.stopPropagation()}}],this.getPinDropDownItems=e=>{const t=[];return["TL","TC","TR","ML","MC","MR","BL","BC","BR"].map(o=>{t.push({label:this.formatMessage(o),event:t=>{de(e,o),t.stopPropagation()}})}),t},this.getArrangementsDropDownItems=e=>[{label:this.formatMessage("sendBackward"),event:t=>{se(e),t.stopPropagation()}},{label:this.formatMessage("bringForward"),event:t=>{ae(e),t.stopPropagation()}},{label:this.formatMessage("sendToBack"),event:t=>{re(e),t.stopPropagation()}},{label:this.formatMessage("bringToFront"),event:t=>{le(e),t.stopPropagation()}}],this.isOnlyOneViewOrScreen=e=>{const{appConfig:t}=this.props,o=e.id.split("-toc-")[2];return e.type===Z.View&&1===t.sections[o].views.length||e.type===Z.Screen&&1===t.screenGroups[o].screens.length},this.getDropdwnItemsForSpecialCases=(e,t)=>{const{browserSizeMode:o,lockLayout:n,runMode:i}=this.props;if(i||n){if(e.type===Z.Section||e.type===Z.View||e.type===Z.ScreenGroup||e.type===Z.Screen||e.type===Z.Widget&&e.data.manifest.widgetType===a.WidgetType.Layout)return t.slice(0,1)}else if(e.type===Z.View||e.type===Z.Screen||e.type===Z.ScreenGroup)return e.type!==Z.ScreenGroup&&e.type!==Z.Screen||o===a.BrowserSizeMode.Large?this.isOnlyOneViewOrScreen(e)?t.slice(0,2):t:t.slice(0,1);return null},this.isSupportDropDown=e=>e===Z.Section||e===Z.View||e===Z.ScreenGroup||e===Z.Screen||e===Z.Widget,this.getDropDownItems=e=>{var t;if(!this.isSupportDropDown(e.type))return[];const{theme:o,appConfig:n,currentPageId:i,lockLayout:s,runMode:r}=this.props,l=[{label:this.formatMessage("rename"),event:t=>{this.handleOnTocDoubleClick(e,t)}},{label:this.formatMessage("duplicate"),event:t=>{te(e),t.stopPropagation()}},{label:this.formatMessage("delete"),event:t=>{ee(e),t.stopPropagation()}}],d=this.getDropdwnItemsForSpecialCases(e,l);if(d)return d;if(r)return l.slice(0,1);if(s)return l.splice(1,1),l;const p=Q(e),u=n.layouts[p.layoutId],g=u.content[p.layoutItemId];if(((null==u?void 0:u.type)!==a.LayoutType.FlowLayout||Object(c.supportFloating)(p)||Object(c.supportSinking)(p))&&l.push({label:this.formatMessage("pendingTip"),event:t=>{ie(e),t.stopPropagation()}}),(null==u?void 0:u.type)===a.LayoutType.FixedLayout){const n=[{label:(null===(t=null==g?void 0:g.setting)||void 0===t?void 0:t.lockLayout)?this.formatMessage("unlockLayout"):this.formatMessage("lockLayout"),event:t=>{ne(e),t.stopPropagation()}},{label:Object(a.jsx)(v,{toggleContent:this.formatMessage("arrange"),modifiers:Bt,direction:"right",theme:o,items:this.getArrangementsDropDownItems(e),icon:!1}),isBtn:!0},{label:Object(a.jsx)(v,{toggleContent:this.formatMessage("align"),modifiers:Bt,direction:"right",theme:o,items:this.getAlignmentsDropDownItems(e),icon:!1}),isBtn:!0}];l.push(...n)}else null==u||u.type,a.LayoutType.FlowLayout;return this.props.lockLayout||(null==n?void 0:n.pages[i].mode)!==a.PageMode.AutoScroll||e.pagePart!==a.PagePart.Body||(Object(c.supportFloating)(p)?l.push({label:Object(a.jsx)(v,{toggleContent:this.formatMessage("floating"),modifiers:Bt,direction:"right",theme:o,items:this.getPinDropDownItems(e),icon:!1}),isBtn:!0}):Object(c.supportSinking)(p)&&l.push({label:this.formatMessage("sinking"),event:e=>{ce(p),e.stopPropagation()}})),l},this.renderTitleRightContent=e=>{const t=function(e,t){const{theme:o}=t;return a.css`
    margin-right:calc(14px - ${o.components.button.sizes.sm.paddingX});
    .title-arrow {
      transform-origin: center;
      transform: ${`rotate(${e.isExpand?180:0}deg)`};
      transition: transform .5s;
    }

  `}(e,this.props);return Object(a.jsx)("div",{css:t},Object(a.jsx)(l.Button,{icon:!0,type:"tertiary",size:"sm"},Object(a.jsx)(l.Icon,{className:"title-arrow",icon:o(17),size:12})))},this.renderCommonRightContent=e=>{const{theme:t}=this.props,o=this.getDropDownItems(e);if(o.length<1)return Object(a.jsx)("div",null);const n=function(e){const{theme:t}=e;return a.css`
    margin-right:calc(16px - ${t.components.button.sizes.sm.paddingX});
    .dropDown {
      visibility: visible;
      .btn {
        visibility: hidden;
        color: ${t.colors.palette.dark[600]};
      }
      .btn:hover {
        color: ${t.colors.black};
      }
    }
  `}(this.props);return Object(a.jsx)("div",{className:"d-flex item-action-button",css:n},Object(a.jsx)("div",{title:this.formatMessage("more"),className:"dropDown"},Object(a.jsx)(f,{modifiers:Bt,direction:"down",theme:t,items:o})))},this.renderOutlineContent=e=>{const{intl:t,theme:o}=this.props,n=!this.checkIfReadOnly(e),{editableItemId:i}=this.state,{type:s}=e,r=[Z.Section,Z.View,Z.ScreenGroup,Z.Screen,Z.Widget];return Object(a.jsx)(q,{intl:t,itemJson:e,onArrowClick:this.handleArrowClick,editable:i===e.id,onDoubleClick:n&&this.handleOnTocDoubleClick,renderRightContent:n&&r.includes(s)&&this.renderCommonRightContent,renameItem:this.handleRename,theme:o})},this.state={editableItemId:e.editableItemId,currentSelectedItemId:e.currentSelectedItemId,filterText:"",itemJson:void 0,showSearch:!1,showAlign:!1,showArrange:!1},this.expandIds=[],this.alignRef=a.React.createRef(),this.arrangeRef=a.React.createRef(),this.tocItemCss=function(e){const{theme:t}=e;return a.css`
    :hover {
      .dropDown {
        z-index: 2;
        .btn {
          display: inline-flex;
        }
      }
      .editor {
        color: ${t.colors.black};
      }
    }
    &.active {
      .editor {
        color: ${t.colors.black};
      }
    }
  `}(e)}componentDidMount(){this.setState({itemJson:this.getItemJsonByAppConfig()})}shouldComponentUpdate(e,t){var o,n,i,s,a,r;const{appConfig:l}=this.props;let c=!1;if(e&&Object.keys(e).some(t=>this.props?"appConfig"!==t&&e[t]!==this.props[t]?(c=!0,!0):void 0:(c=!0,!0)),c)return!0;if(t&&Object.keys(t).some(e=>this.state?t[e]!==this.state[e]?(c=!0,!0):void 0:(c=!0,!0)),c)return!0;if(e.appConfig&&l&&e.appConfig!==l){const t=null==l?void 0:l.layouts,c=null===(o=e.appConfig)||void 0===o?void 0:o.layouts;if(t&&c&&t!==c&&Oe(t,c))return!0;const d=null==l?void 0:l.widgets,p=null===(n=e.appConfig)||void 0===n?void 0:n.widgets;if(d&&p&&d!==p&&Ie(d,p))return!0;const u=null==l?void 0:l.sections,g=null===(i=e.appConfig)||void 0===i?void 0:i.sections;if(u&&g&&u!==g&&xe(u,g))return!0;const h=null==l?void 0:l.views,m=null===(s=e.appConfig)||void 0===s?void 0:s.views;if(h&&m&&h!==m&&we(h,m))return!0;const f=null==l?void 0:l.screenGroups,v=null===(a=e.appConfig)||void 0===a?void 0:a.screenGroups;if(f&&v&&f!==v&&Se(f,v))return!0;const b=null==l?void 0:l.screens,y=null===(r=e.appConfig)||void 0===r?void 0:r.screens;if(b&&y&&b!==y&&je(b,y))return!0}return!1}componentDidUpdate(e,t){const o=this.props,{itemJson:i,currentSelectedItemId:s,editableItemId:a}=this.state;let r,l=!1;if(o.currentSelectedItemId!==this.state.currentSelectedItemId||a!==t.editableItemId||o.enableFooter!==e.enableFooter||o.enableHeader!==e.enableHeader||o.appConfig!==e.appConfig||o.currentPageId!==e.currentPageId||o.currentDialogId!==e.currentDialogId||o.browserSizeMode!==e.browserSizeMode){if(l=!0,o.appConfig===e.appConfig&&o.currentPageId===e.currentPageId&&o.currentDialogId===e.currentDialogId&&o.browserSizeMode===e.browserSizeMode||o.currentSelectedItemId===this.state.currentSelectedItemId)if(o.currentSelectedItemId!==s){const e=n.activeAndExpandNodesByActiveIds(i,[o.currentSelectedItemId]);r={currentSelectedItemId:o.currentSelectedItemId,itemJson:e},this.expandIds=n.fetchAllExpandIds(e)}else{if(void 0!==e.lockLayout&&this.props.lockLayout!==e.lockLayout)return;r={itemJson:this.getItemJsonByAppConfig(o)}}else{const e=n.activeAndExpandNodesByActiveIds(this.getItemJsonByAppConfig(o),[o.currentSelectedItemId]);r={currentSelectedItemId:o.currentSelectedItemId,itemJson:e},this.expandIds=n.fetchAllExpandIds(e)}l&&this.setState(r)}}render(){const{itemJson:e,showSearch:t}=this.state,{theme:n}=this.props;return Object(a.jsx)("div",{css:De(this.props,this.state)},Object(a.jsx)("div",{className:"outline-list-top"},Object(a.jsx)("div",{className:"w-100 d-flex justify-content-center mt-1 mb-2"},Object(a.jsx)(l.Icon,{color:n.colors.palette.dark[400],icon:o(97),width:16,height:4})),Object(a.jsx)("div",{className:"d-flex justify-content-between align-items-end"},Object(a.jsx)("div",{className:"outline-title h5 mb-0 text-truncate"},this.formatMessage("outline")),Object(a.jsx)("div",{className:"d-flex outline-top-btns"},Object(a.jsx)(l.Button,{title:this.formatMessage("search"),size:"sm",type:"tertiary",icon:!0,className:"search-btn",onClick:this.handleSearchBtnClick},Object(a.jsx)(l.Icon,{className:"search-icon",size:16,icon:o(12)})))),Object(a.jsx)(l.Collapse,{isOpen:t,onEntered:this.handleSearchOpened},Object(a.jsx)(Y,{theme:n,placeholder:this.formatMessage("search"),searchText:this.state.filterText,onSearchTextChange:this.handleSearchTextChange,onSubmit:this.handleSearchSubmit,inputRef:e=>this.searchInput=e}))),Object(a.jsx)("div",{className:"w-100 outline-tree-container"},Object(a.jsx)(A,{hideRoot:!0,className:"outline-tree",itemJson:e,onClickItem:this.handleClickItem,handleExpand:this.handleExpand})))}}var Et=a.ReactRedux.connect((e,t)=>{var o,n,i,s,r,l,c,d,p,u,g,h,m,f,v,b,y,I,x,w,S,j,O,C,T,P,D,k,A,M,L,z,B,R,E;const J=t.currentPageId,N=e.appStateInBuilder&&e.appStateInBuilder.appRuntimeInfo&&e.appStateInBuilder.appRuntimeInfo.selection,F=e.appStateInBuilder&&e.appStateInBuilder.appConfig,$=N&&F.layouts[N.layoutId]&&F.layouts[N.layoutId].content&&F.layouts[N.layoutId].content[N.layoutItemId];let H,V,W;if($)if($.type===a.LayoutItemType.Section){const t=null===(i=null===(n=null===(o=e.appStateInBuilder)||void 0===o?void 0:o.appRuntimeInfo)||void 0===n?void 0:n.sectionNavInfos)||void 0===i?void 0:i[$.sectionId],a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig.sections[$.sectionId];V=null!==(r=null==t?void 0:t.currentViewId)&&void 0!==r?r:null==a?void 0:a.views[0],H=V?K(Object.assign(Object.assign({},N),{id:V,sectionId:$.sectionId}),Z.View):K(Object.assign({id:$.sectionId},N),Z.Section)}else if($.type===a.LayoutItemType.ScreenGroup){const t=null===(d=null===(c=null===(l=e.appStateInBuilder)||void 0===l?void 0:l.appRuntimeInfo)||void 0===c?void 0:c.screenGroupNavInfos)||void 0===d?void 0:d[$.screenGroupId],o=e.appStateInBuilder.appConfig.screenGroups[$.screenGroupId].screens[null!==(p=null==t?void 0:t.activeIndex)&&void 0!==p?p:0],n=null===(u=e.appStateInBuilder)||void 0===u?void 0:u.appConfig.screens[o];W=null==n?void 0:n.id,H=W?K(Object.assign(Object.assign({},N),{id:W,screenGroupId:$.screenGroupId}),Z.Screen):K(Object.assign({id:$.screenGroupId},N),Z.ScreenGroup)}else $.type===a.LayoutItemType.Widget&&(H=K(Object.assign({id:$.widgetId},N),Z.Widget));const G=!!(null===(h=null===(g=null==F?void 0:F.pages)||void 0===g?void 0:g[J])||void 0===h?void 0:h.header),U=!!(null===(f=null===(m=null==F?void 0:F.pages)||void 0===m?void 0:m[J])||void 0===f?void 0:f.footer);return{currentSelectedItemId:H,selection:N,activePagePart:null===(b=null===(v=null==e?void 0:e.appStateInBuilder)||void 0===v?void 0:v.appRuntimeInfo)||void 0===b?void 0:b.activePagePart,allowEditableForDialog:!!(null===(w=null===(x=null===(I=null===(y=null==e?void 0:e.appStateInBuilder)||void 0===y?void 0:y.appConfig)||void 0===I?void 0:I.dialogs)||void 0===x?void 0:x[t.currentDialogId])||void 0===w?void 0:w.layout[t.browserSizeMode]),allowEditableForHeader:!(!G||!(null===(O=null===(j=null===(S=null==e?void 0:e.appStateInBuilder)||void 0===S?void 0:S.appConfig)||void 0===j?void 0:j.header)||void 0===O?void 0:O.layout[t.browserSizeMode])),allowEditableForFooter:!(!U||!(null===(P=null===(T=null===(C=null==e?void 0:e.appStateInBuilder)||void 0===C?void 0:C.appConfig)||void 0===T?void 0:T.footer)||void 0===P?void 0:P.layout[t.browserSizeMode])),allowEditable:!!(null===(M=null===(A=null===(k=null===(D=null==e?void 0:e.appStateInBuilder)||void 0===D?void 0:D.appConfig)||void 0===k?void 0:k.pages)||void 0===A?void 0:A[J])||void 0===M?void 0:M.layout[t.browserSizeMode]),appConfig:F,lockLayout:null===(B=null===(z=null===(L=null==e?void 0:e.appStateInBuilder)||void 0===L?void 0:L.appConfig)||void 0===z?void 0:z.forBuilderAttributes)||void 0===B?void 0:B.lockLayout,enableHeader:G,enableFooter:U,runMode:(null===(E=null===(R=null==e?void 0:e.appStateInBuilder)||void 0===R?void 0:R.appRuntimeInfo)||void 0===E?void 0:E.appMode)===a.AppMode.Run}})(Rt),Jt=function(e,t,o,n){return new(o||(o=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};class Nt extends a.React.PureComponent{constructor(e){super(e),this.lastResizeCall=null,this.emptyLayout={},this.getUniqueIds=(e,t,o)=>{const n=[];for(let i=0;i<o;i++){const o=a.appConfigUtils.getUniqueId(e,t);n.push(o),e=e.setIn([t+"s",o],{id:o})}return n},this.getUniqueLabels=(e,t,o)=>{const n=[];for(let i=0;i<o;i++){const o=a.appConfigUtils.getUniqueId(e,t),i=a.appConfigUtils.getUniqueLabel(e,t,t);n.push(i),e=e.setIn([t+"s",o],{id:o,label:i})}return n},this.changeSelection=e=>{r.builderAppSync.publishChangeSelectionToApp(e)},this.changeContent=e=>{const t=e.id.split("-toc-");this.changeSelection({layoutId:t[0],layoutItemId:t[1],autoScroll:!0})},this.changeView=e=>{const t=e.id.split("-toc-");this.changeSelection({layoutId:t[0],layoutItemId:t[1],autoScroll:!0}),r.builderAppSync.publishSectionNavInfoToApp(t[2],{currentViewId:t[3],useProgress:!1})},this.changeScreen=e=>{const t=e.id.split("-toc-");this.changeSelection({layoutId:t[0],layoutItemId:t[1],autoScroll:!0}),r.builderAppSync.publishScreenGroupNavInfoToApp(t[2],e.index)},this.changeLayout=e=>{},this.getCurrentPageId=()=>{let e;const t=Object(r.getAppConfigAction)().appConfig;return t.pageStructure.some((o,n)=>{const i=Object.keys(o)[0];if(r.appConfigUtils.isRealPage(t,i))return e=i,!0}),e||t.pageStructure.some((o,n)=>o[Object.keys(o)[0]].some(o=>{if(r.appConfigUtils.isRealPage(t,o))return e=o,!0})),r.builderAppSync.publishPageChangeToApp(e),e},this.renderActionBtn=(e,t,o)=>Object(a.jsx)(l.Button,{title:e,size:"sm",color:"link",className:" rounded icon page-action-btn",onClick:o},Object(a.jsx)(l.Icon,{size:12,icon:t})),this.PageListWrapper=()=>Object(a.jsx)($,{onDefaultClick:this.setHomePage,addPageWithType:this.addPageWithType,isPageTemplateLoading:this.state.isPageTemplateLoading,editablePageItemId:this.state.editablePageItemId,theme:this.props.theme,changeEditablePageItemId:this.changeEditablePageId,currentPageItemId:this.props.currentDialogId?null:this.props.currentPageId,removePage:this.removePage,intl:this.props.intl,duplicatePage:this.duplicatePage,renamePage:this.renamePage,reOrderPage:this.orderPageBelowPage,onClickPage:this.changeCurrentPage,movePageIntoPage:this.movePageIntoPage,browserSizeMode:this.props.browserSizeMode}),this.DialogListWrapper=()=>Object(a.jsx)(_,{forceRefresh:"dialog"===this.state.selectedTabId,onSplashClick:this.setSplashDialog,theme:this.props.theme,intl:this.props.intl,currentDialogItemId:this.props.currentDialogId,addDialog:this.addDialog,removeDialog:this.removeDialog,duplicateDialog:this.duplicateDialog,renameDialog:this.renameDialog,editableDialogItemId:this.state.editableDialogItemId,changeEditableDialogItemId:this.changeEditableDialogId,reOrderDialog:this.orderDialogBelowDialog,onClickDialog:this.changeCurrentDialog}),this.getStyle=e=>{const{pageTocH:t}=this.state;return a.css`
      overflow: hidden;

      .page-toc {
        background-color: ${e.colors.palette.light[300]};
        height: ${t>0?t+"px":"33%"};

        .page-list,
        .dialog-list{
          height: calc(100% - 10px);
        }
      }

      .outline-toc {
        background-color: ${e.colors.palette.light[300]};
        border: 0;
        border-top: 2px solid ${e.colors.palette.light[800]};
        height: calc(100% - ${t>0?t+"px":"33%"});
      }

    `},this.onTabSelect=e=>{"page"===e&&Object(d.changeCurrentPage)(this.props.currentPageId),this.setState({selectedTabId:e})},this.state={editablePageItemId:"",editableDialogItemId:"",editableOutlineItemId:"",isTemplatePopoverOpen:!1,pageTocH:-1,selectedTabId:null,isPageTemplateLoading:!1},this.resizeRef=a.React.createRef(),this.pageTocRef=a.React.createRef(),this.popoverRef=a.React.createRef(),this.changeEditablePageId=this.changeEditablePageId.bind(this),this.addPageWithType=this.addPageWithType.bind(this),this.handleOutlineItemClick=this.handleOutlineItemClick.bind(this),this.changeCurrentPage=this.changeCurrentPage.bind(this),this.movePageIntoPage=this.movePageIntoPage.bind(this),this.removePage=this.removePage.bind(this),this.setHomePage=this.setHomePage.bind(this),this.formatMessage=this.formatMessage.bind(this),this.loadPageTemplate=this.loadPageTemplate.bind(this),this.parsePageTemplate=this.parsePageTemplate.bind(this),this.duplicatePage=this.duplicatePage.bind(this),this.renamePage=this.renamePage.bind(this),this.orderPageBelowPage=this.orderPageBelowPage.bind(this),this.changeEditableDialogId=this.changeEditableDialogId.bind(this),this.addDialog=this.addDialog.bind(this),this.removeDialog=this.removeDialog.bind(this),this.renameDialog=this.renameDialog.bind(this),this.duplicateDialog=this.duplicateDialog.bind(this),this.setSplashDialog=this.setSplashDialog.bind(this),this.changeCurrentDialog=this.changeCurrentDialog.bind(this),this.loadDialogTemplate=this.loadDialogTemplate.bind(this),this.parseDialogTemplate=this.parseDialogTemplate.bind(this),this.orderDialogBelowDialog=this.orderDialogBelowDialog.bind(this)}componentDidMount(){this.resizeRef&&this.resizeRef.current&&(this.interactable=Object(g.interact)(this.resizeRef.current).resizable({edges:{top:!0,left:!1,bottom:!1,right:!1},modifiers:[g.interact.modifiers.restrictEdges({outer:"parent",endOnly:!0}),g.interact.modifiers.restrictSize({min:{width:20,height:100}})],inertia:!1,onstart:e=>{e.stopPropagation()},onmove:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall);const t=e.rect;let o=0;this.pageTocRef.current&&(o=this.pageTocRef.current.getBoundingClientRect().top);const n=t.top-o;n<100||(this.lastResizeCall=requestAnimationFrame(()=>{this.setState({pageTocH:n})}))},onend:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.lastResizeCall=requestAnimationFrame(()=>{const t=e.rect;let o=0;this.pageTocRef.current&&(o=this.pageTocRef.current.getBoundingClientRect().top),this.lastResizeCall=requestAnimationFrame(()=>{this.setState({pageTocH:t.top-o})})})}}))}componentWillUnmount(){this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.interactable&&(this.interactable.unset(),this.interactable=null)}handleOutlineItemClick(e){e.type!==Z.Label&&(e.type===Z.ScreenGroup||e.type===Z.Section||e.type===Z.Widget?this.changeContent(e):e.type===Z.View?this.changeView(e):[Z.Screen,Z.ScreenMainStage,Z.ScreenSrollingPanel].includes(e.type)?this.changeScreen(e):e.type===Z.Layout&&this.changeLayout(e),e.pagePart&&r.builderAppSync.publichActivePagePartChangeToApp(e.pagePart))}changeCurrentPage(e){Object(d.changeCurrentPage)(e)}changeEditablePageId(e){e!==this.state.editablePageItemId&&this.setState({editablePageItemId:e})}movePageIntoPage(e,t){if(e===t)return;const o=Object(r.getAppConfigAction)().appConfig;Object(r.getAppConfigAction)().movePageIntoPage(e,t).exec();o.pages[e].type===a.PageType.Normal&&this.changeCurrentPage(e)}removePage(e){const t=Object(r.getAppConfigAction)().appConfig,o=t.pages[e];let n;if(t.pageStructure.some((o,i)=>{const s=Object.keys(o)[0];return s!==e&&(r.appConfigUtils.isRealPage(t,s)?(n=s,!0):void 0)}),n||t.pageStructure.some((o,i)=>{const s=Object.keys(o)[0];if(s===e)return!1;return!!o[s].some(o=>o!==e&&(r.appConfigUtils.isRealPage(t,o)?(n=o,!0):void 0))}),!n)return;let i=o.isDefault;i||t.pageStructure.some((o,n)=>{if(Object.keys(o)[0]===e){return t.pageStructure[n][e].some(e=>{if(t.pages[e].isDefault)return i=!0,!0}),!0}}),r.builderAppSync.publishPageChangeToApp(n),Object(r.getAppConfigAction)().removePage(e,i?n:null).exec()}setHomePage(e){Object(r.getAppConfigAction)().replaceHomePage(e).exec()}duplicatePage(e){const t=Object(r.getAppConfigAction)().appConfig,o=Object(r.getAppConfigAction)(),n=o.duplicatePage(e);o.exec();const i=t.pages[e];i.type!==a.PageType.Folder&&i.type!==a.PageType.Link&&this.changeCurrentPage(n.id)}duplicateDialog(e){const t=Object(r.getAppConfigAction)(),o=t.duplicateDialog(e);t.exec(),this.changeCurrentDialog(o.id)}renamePage(e,t){return!(!t||""===t)&&(Object(r.getAppConfigAction)().editPageProperty(e,"label",t).exec(),this.changeEditablePageId(""),!0)}orderPageBelowPage(e,t,o){Object(r.getAppConfigAction)().orderPageToPage(e,t,o).exec()}formatMessage(e){const{intl:t}=this.props,o=Object.assign({},u,l.defaultMessages);return t.formatMessage({id:e,defaultMessage:o[e]})}addPageWithType(e,t){let o;const n=Object(r.getAppConfigAction)().appConfig;switch(e){case"page":this.setState({isPageTemplateLoading:!0}),this.loadPageTemplate(t).then(e=>{this.setState({isPageTemplateLoading:!1}),o=e,o&&(r.builderAppSync.publishChangeBrowserSizeModeToApp(Object(r.getAppConfigAction)().appConfig.mainSizeMode),this.changeEditablePageId(o.id))});break;case"link":o=Object(a.Immutable)({}).merge({id:a.appConfigUtils.getUniqueId(n,"page"),type:a.PageType.Link,label:a.appConfigUtils.getUniqueLabel(n,"page",this.formatMessage("link")),linkUrl:"#",isVisible:!0}),Object(r.getAppConfigAction)().addPage(o).exec();break;case"folder":o=Object(a.Immutable)({}).merge({id:a.appConfigUtils.getUniqueId(n,"page"),type:a.PageType.Folder,label:a.appConfigUtils.getUniqueLabel(n,"page",this.formatMessage("folder")),isVisible:!0}),Object(r.getAppConfigAction)().addPage(o).exec()}return o&&this.changeEditablePageId(o.id),o}loadPageTemplate(e){return Jt(this,void 0,void 0,(function*(){const t=Object(r.getAppConfigAction)().appConfig;return yield this.parsePageTemplate(e,t)}))}parsePageTemplate(e,t){return Jt(this,void 0,void 0,(function*(){return e?(Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!0,a.LoadingType.Primary)),yield Object(c.createPageFromTemplate)(t,e,{}).then(({appConfig:e,newPageId:t})=>{const o=e.pages[t];if(!o)return;const n=e.set("pageStructure",e.pageStructure.concat([{[o.id]:[]}]));return Object(r.getAppConfigAction)(n).exec(),this.changeCurrentPage(o.id),this.changeEditablePageId(o.id),Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!1)),o}).catch(()=>Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!0,a.LoadingType.Secondary)))):yield Promise.resolve()}))}changeCurrentDialog(e){Object(d.changeCurrentDialog)(e)}changeEditableDialogId(e){e!==this.state.editableDialogItemId&&this.setState({editableDialogItemId:e})}removeDialog(e){let t=null;const o=Object(r.getAppConfigAction)().appConfig,n=o.dialogs,i=n[e],{currentDialogId:s}=this.props;if(e===s){let o=null;Object.keys(n).some((e,s)=>{const a=n[e];if(a.mode===i.mode){if(a.index===i.index-1)return t=a.id,!0;a.index===i.index+1&&(o=a.id)}}),t||(t=o||Object.keys(n).filter(t=>n[t].mode===i.mode&&0===n[t].index&&n[t].id!==e)[0]||Object.keys(n).filter(e=>n[e].mode!==i.mode&&0===n[e].index)[0]);const s=Object(d.handelDialogInfos)(t);r.builderAppSync.publishDialogInfosChangeToApp(s),r.builderAppSync.publishDialogChangeToApp(t)}if(Object(r.getAppConfigAction)().removeDialog(e).exec(),!i.isSplash&&i.mode===a.DialogMode.Fixed){r.utils.getPageListByDialogId(o.pages,e).map(e=>{Object(r.getAppConfigAction)().editPageProperty(e.id,"autoOpenDialogId","").exec()})}}setSplashDialog(e){Object(r.getAppConfigAction)().replaceSplashDialog(e).exec()}renameDialog(e,t){return!(!t||""===t)&&(Object(r.getAppConfigAction)().editDialogProperty(e,"label",t).exec(),this.changeEditableDialogId(""),!0)}orderDialogBelowDialog(e,t,o){Object(r.getAppConfigAction)().orderDialogToDialog(e,t,o).exec()}addDialog(e){const t=this.loadDialogTemplate(e);return r.builderAppSync.publishChangeBrowserSizeModeToApp(Object(r.getAppConfigAction)().appConfig.mainSizeMode),t}loadDialogTemplate(e){const t=Object(r.getAppConfigAction)().appConfig;this.parseDialogTemplate(e,t)}parseDialogTemplate(e,t){e&&(Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!0,a.LoadingType.Secondary)),Object(c.createDialogFromTemplate)(t,e,{}).then(({appConfig:e,newDialogId:t})=>{const o=e.dialogs[t];return Object(r.getAppConfigAction)(e).exec(),this.changeCurrentDialog(o.id),this.changeEditableDialogId(o.id),Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!1)),o}).catch(()=>Object(a.getAppStore)().dispatch(a.appActions.setIsBusy(!0))))}render(){const{PageListWrapper:e,DialogListWrapper:t}=this,{currentPageId:o,currentDialogId:n,browserSizeMode:i}=this.props;let s;return s=n||"dialog"===this.state.selectedTabId?"dialog":"page",Object(a.jsx)("div",{css:this.getStyle(this.props.theme),className:"jimu-widget widget-builder-toc bg-white w-100 h-100"},Object(a.jsx)("div",{className:"page-toc",ref:this.pageTocRef},Object(a.jsx)(l.Tabs,{value:s,type:"underline",css:a.css`
          height: 100%;
          .jimu-nav {
            border-bottom: none;
            padding:12px 1px 5px 1px;
            width: calc(100% - 60px);
            overflow: hidden;
          }
          .tab-content{
            height: calc(100% - 50px);
            .tab-pane{
              width: 100%;
            }
          }
          .nav-item {
            margin: 0 1rem;
            &:last-of-type{
              margin-right: 0;
            }
            .nav-link{
              padding: 9px 0;
            }
          }
        `,onChange:this.onTabSelect},Object(a.jsx)(l.Tab,{id:"page",title:this.formatMessage("page")},Object(a.jsx)("div",{className:"page-list"},Object(a.jsx)(e,null))),Object(a.jsx)(l.Tab,{id:"dialog",title:this.formatMessage("dialog")},Object(a.jsx)("div",{className:"dialog-list"},Object(a.jsx)(t,null))))),Object(a.jsx)("div",{className:"outline-toc",ref:this.resizeRef},Object(a.jsx)(Et,{currentPageId:o,currentDialogId:n,browserSizeMode:i,onClickItem:this.handleOutlineItemClick,editableOutlineItemId:this.state.editableOutlineItemId,theme:this.props.theme,intl:this.props.intl})))}}Nt.mapExtraStateProps=e=>{var t,o,n,i,s,a,r;return{currentPageId:null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===o?void 0:o.currentPageId,currentDialogId:null===(i=null===(n=null==e?void 0:e.appStateInBuilder)||void 0===n?void 0:n.appRuntimeInfo)||void 0===i?void 0:i.currentDialogId,browserSizeMode:null===(s=null==e?void 0:e.appStateInBuilder)||void 0===s?void 0:s.browserSizeMode,dialogInfos:null===(r=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appRuntimeInfo)||void 0===r?void 0:r.dialogInfos}}}]))}}}));