System.register(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/basic/item-selector"],(function(e){var t,s,i,a,o,n;return{setters:[function(e){t=e},function(e){s=e},function(e){i=e},function(e){a=e},function(e){o=e},function(e){n=e}],execute:function(){e(function(e){var t={};function s(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(i,a,function(t){return e[t]}.bind(null,a));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=101)}({0:function(e,s){e.exports=t},1:function(e,t){e.exports=s},101:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return Te}));var i=s(0),a=s(1),o=s(3),n=s(5),r=s(37),l=s(2);class c extends i.React.PureComponent{constructor(e){super(e),this.onRemove=e=>{if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),!this.props.toggle)return;const t=this.props.dsJson&&this.props.dsJson.id;0===n.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t,this.props.widgets).length?(Object(l.getAppConfigAction)().removeDataSource(t).exec(),i.DataSourceManager.getInstance().destroyDataSource(t),this.props.toggle()):this.setState({isRemoveOptionsShown:!0})},this.onRename=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),this.props.onRenameItem&&(this.props.onRenameItem&&this.props.onRenameItem(),this.props.toggle())},this.hideRemovePopup=()=>{this.setState({isRemoveOptionsShown:!1})},this.togglePopper=()=>{this.hideRemovePopup(),this.props.toggle()},this.getStyle=e=>i.css`
      .ds-more-options{
        position: fixed;
        background-color: ${e.colors.secondary};
        color: ${e.colors.dark};
        z-index: 3;
        user-select: none;
        font-size: 13px;
        border: 1px solid ${e.colors.palette.light[600]};
        box-shadow: 0 0 6px 0 ${i.polished.rgba(e.colors.white,.2)};
        margin-left: ${i.polished.rem(-32)};
        border-radius: 2px;
        .ds-more-option{
          word-wrap: break-word;
          white-space: nowrap;
          line-height: ${i.polished.rem(26)};
          border-bottom: 1px;
          cursor: pointer;
          padding-left: 12px;
          padding-right: 12px;
        }
        .ds-more-option:hover{
          background-color: ${e.colors.primary};
        }
        .ds-more-option:active.ds-more-option:hover{
          background-color: ${e.colors.palette.primary[600]};
        }
      }
    `,this.state={isRemoveOptionsShown:!1,selectedWidgets:[]}}render(){var e;return this.props.reference&&this.props.dsJson?Object(i.jsx)(a.Popper,{css:this.getStyle(this.props.theme),reference:this.props.reference,open:this.props.isOpen,placement:"right-start",offset:this.props.offset||[25,0],toggle:this.togglePopper},Object(i.jsx)("div",{className:"ds-more-options py-2"},this.props.onRenameItem&&Object(i.jsx)("div",{className:"ds-more-option",onClick:this.onRename},this.props.intl.formatMessage({id:"rename",defaultMessage:a.defaultMessages.rename})),this.props.onRemoveItem&&Object(i.jsx)("div",{className:"ds-more-option",onClick:this.onRemove},this.props.intl.formatMessage({id:"remove",defaultMessage:a.defaultMessages.remove})),Object(i.jsx)(n.DataSourceRemoveWarningPopup,{dataSourceId:null===(e=this.props.dsJson)||void 0===e?void 0:e.id,isOpen:this.state.isRemoveOptionsShown,toggle:this.hideRemovePopup,reason:n.DataSourceRemoveWaringReason.DataSourceRemoved}))):null}}class p extends i.React.PureComponent{constructor(e){super(e),this.onRemoveItem=()=>{this.toggleMoreOptions()},this.onRenameItem=()=>{this.toggleMoreOptions(),this.setState({isRenameShown:!0})},this.toggleMoreOptions=()=>{this.props.toggleMoreOptions&&this.props.toggleMoreOptions(this.props.ds.id)},this.onChildDataIconClick=()=>{this.props.onChildDataIconClick&&this.props.onChildDataIconClick(this.props.ds)},this.onRelatedWidgetsIconClick=()=>{this.props.onRelatedWidgetsIconClick&&this.props.onRelatedWidgetsIconClick(this.props.ds)},this.onRename=e=>{if(!e)return void this.setState({isRenameShown:!1});const t=this.props.ds.getDataSourceJson().setIn(["label"],e),s=n.dataComponentsUtils.editDataSourceJson(t);Object(l.getAppConfigAction)().editDataSource(s).exec(),this.setState({isRenameShown:!1})},this.onDataSourceItemClick=()=>{this.props.onDataSourceItemClick(this.props.ds)},this.onMappingIconClick=()=>{this.props.onMappingIconClick(this.props.ds)},this.state={isRenameShown:!1}}render(){if(!this.props.ds)return null;const e=!this.props.ds.parentDataSource;return i.React.createElement("div",{className:"m-3 list-item",ref:e=>{this.rootDom=e}},i.React.createElement(n.DataSourceItem,{dataSourceJson:this.props.ds.getDataSourceJson().merge({label:this.props.ds.getLabel()}),isMappingIconShown:!1,onDataSourceItemClick:this.onDataSourceItemClick,isMoreIconShown:e,isRenameInputShown:this.state.isRenameShown&&e,isRelatedWidgetsShown:!0,onMoreIconClick:this.toggleMoreOptions,onMappingIconClick:this.onMappingIconClick,onRename:this.onRename,onChildDataIconClick:this.onChildDataIconClick,onRelatedWidgetsIconClick:this.onRelatedWidgetsIconClick,onToggleHidden:this.props.onToggleHidden,isHideable:this.props.isHideable}),i.React.createElement(c,{isOpen:this.props.isMoreOptionsShown,reference:this.rootDom,intl:this.props.intl,widgets:this.props.widgets,dsJson:this.props.ds&&this.props.ds.getDataSourceJson(),onRemoveItem:this.onRemoveItem,onRenameItem:this.onRenameItem,theme:this.props.theme,toggle:this.toggleMoreOptions}))}}var h=i.ReactRedux.connect((e,t)=>{var s;return{dataSourceJson:null===(s=t.ds)||void 0===s?void 0:s.getDataSourceJson()}})(p),d=class extends i.React.PureComponent{constructor(e){super(e),this.onRemoveItem=()=>{this.toggleMoreOptions()},this.toggleMoreOptions=()=>{this.props.toggleMoreOptions&&this.props.toggleMoreOptions(this.props.dsJson.id)}}render(){return this.props.dsJson?i.React.createElement("div",{className:"m-3 list-item list-error-item",ref:e=>{this.rootDom=e}},i.React.createElement(n.DataSourceErrorItem,{dataSourceJson:this.props.dsJson,isErrorIconShown:this.props.isDataSourceInited&&this.props.isErrorIconShown,isMoreIconShown:this.props.isMoreIconShown,isRelatedWidgetsShown:!0,onMoreIconClick:this.toggleMoreOptions,isHideable:this.props.isHideable,onToggleHidden:this.props.onToggleHidden}),i.React.createElement(c,{isOpen:this.props.isMoreOptionsShown,reference:this.rootDom,intl:this.props.intl,dsJson:this.props.dsJson,onRemoveItem:this.onRemoveItem,widgets:this.props.widgets,theme:this.props.theme,toggle:this.toggleMoreOptions})):null}},m="Failed to create data!",u="No supported data available.",g="No in use fields need to be mapped.",S="No child data needs to be mapped.",f="In use",D="No related widget",w="No used field",v="No layer",b="No data in the experience.<br/>Please add your data.",x="Data views",R="Source",M="Auto refresh",I="Refresh settings",y="Interval",C="Honor layer's settings",E="minutes",O="Allow export",N="For hosted feature layers, the app will also verify that the end user's role and item settings allow exporting the data.";const j=s(18);var k=class extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.getInUseAndOthers=()=>{const e={hidden:[],visible:[]},t={hidden:[],visible:[]};return this.state.childDataSources&&this.state.childDataSources.forEach(s=>{var i,a;s&&s.id&&(n.dataComponentsUtils.getWidgetsUsingDsOrItsViews(s.id,this.props.widgets,!1).length>0?(null===(i=null==s?void 0:s.getDataSourceJson())||void 0===i?void 0:i.isHidden)?e.hidden.push(s):e.visible.push(s):(null===(a=null==s?void 0:s.getDataSourceJson())||void 0===a?void 0:a.isHidden)?t.hidden.push(s):t.visible.push(s))}),{inUseDss:e,otherDss:t}},this.onToggleHidden=e=>{if(!e)return;const t=!e.isHidden;let s=e.setIn(["isHidden"],t);t||(s=this.traversUnhideChildDss(s));const i=n.dataComponentsUtils.editDataSourceJson(s);Object(l.getAppConfigAction)().editDataSource(i).exec()},this.traversUnhideChildDss=e=>{if(!e)return;let t=e;return t=t.setIn(["isHidden"],!1),e.childDataSourceJsons&&Object.keys(e.childDataSourceJsons).forEach(e=>{t=t.setIn(["childDataSourceJsons",e],this.traversUnhideChildDss(t.getIn(["childDataSourceJsons",e])))}),t},this.state={isMapping:!1,childDataSources:null}}componentDidMount(){this.__unmount=!1,this.props.ds&&this.setState({childDataSources:this.props.ds.getChildDataSources()})}componentDidUpdate(e,t){e.ds!==this.props.ds&&(this.props.ds?this.setState({childDataSources:this.props.ds.getChildDataSources()}):this.setState({childDataSources:null}))}componentWillUnmount(){this.__unmount=!0}render(){if(!this.props.ds)return i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}));const e=this.getInUseAndOthers();return 0===e.inUseDss.visible.length&&0===e.inUseDss.hidden.length&&0===e.otherDss.visible.length&&0===e.otherDss.hidden.length?i.React.createElement("div",{className:"empty-placeholder w-100"},i.React.createElement("div",{className:"empty-placeholder-icon"},i.React.createElement(a.Icon,{icon:j,width:80,height:71})),i.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:this.props.intl.formatMessage({id:"noLayer",defaultMessage:v})}})):i.React.createElement(i.React.Fragment,null,e.inUseDss.visible.length>0||e.inUseDss.hidden.length>0?i.React.createElement("div",null,i.React.createElement("h5",{className:"m-3 data-setting-secondary-title"},this.props.intl.formatMessage({id:"inUse",defaultMessage:f})),i.React.createElement("div",null,i.dataSourceUtils.getSortedArrayByLabel(e.inUseDss.visible).map((e,t)=>e&&e.id?i.React.createElement(h,{ds:e,key:t,onDataSourceItemClick:this.props.onDataSourceItemClick,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets,theme:this.props.theme,isHideable:!1,onChildDataIconClick:this.props.onChildDataIconClick,onRelatedWidgetsIconClick:this.props.onRelatedWidgetsIconClick,onToggleHidden:this.onToggleHidden}):null),i.dataSourceUtils.getSortedArrayByLabel(e.inUseDss.hidden).map((e,t)=>e&&e.id?i.React.createElement(d,{dsJson:e.getDataSourceJson(),key:t,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets,theme:this.props.theme,isHideable:!1,onToggleHidden:this.onToggleHidden}):null))):null,e.otherDss.visible.length>0||e.otherDss.hidden.length>0?i.React.createElement("div",null,(e.inUseDss.visible.length>0||e.inUseDss.hidden.length>0)&&i.React.createElement("h5",{className:"m-3 data-setting-secondary-title"},this.props.intl.formatMessage({id:"others",defaultMessage:a.defaultMessages.others})),i.React.createElement("div",null,i.dataSourceUtils.getSortedArrayByLabel(e.otherDss.visible).map((e,t)=>e&&e.id?i.React.createElement(h,{ds:e,key:t,onDataSourceItemClick:this.props.onDataSourceItemClick,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets,theme:this.props.theme,isHideable:!0,onChildDataIconClick:this.props.onChildDataIconClick,onRelatedWidgetsIconClick:this.props.onRelatedWidgetsIconClick,onToggleHidden:this.onToggleHidden}):null),i.dataSourceUtils.getSortedArrayByLabel(e.otherDss.hidden).map((e,t)=>e&&e.id?i.React.createElement(d,{dsJson:e.getDataSourceJson(),key:t,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets,theme:this.props.theme,isHideable:!0,onToggleHidden:this.onToggleHidden}):null))):null)}};class A extends i.React.PureComponent{constructor(e){super(e),this.getStyle=e=>i.css`
    .list-refresh-setting-popup{
      width: ${i.polished.rem(240)};
      .interval-label{
        .jimu-widget-setting--section-header>*, .jimu-widget-setting--row>*{
          font-size: ${i.polished.rem(13)};
          font-weight: normal;
          color: ${e.colors.palette.dark[400]};
        }
      }
      .interval-custom{
        position: relative;
      }
      .interval-custom-input{
        height: ${i.polished.rem(26)};
        input{
          height: ${i.polished.rem(26)};
          padding-right: ${i.polished.rem(80)};
        }
      }
      .interval-custom-placeholder{
        position: absolute;
        right: 8px;
        color: ${e.colors.palette.dark[400]};
      }
      .disabled-label{
        color: ${e.colors.palette.light[800]};
      }
      .disabled{
        border-color: ${e.colors.palette.light[800]} !important;
      }
    }
    `,this.onToggleAutoRefresh=(e,t)=>{t?this.props.hasOriginalDataRefreshInterval?this.props.onChange(null):this.props.onChange(600):this.props.onChange(0)},this.onToggleCustom=()=>{"number"==typeof this.props.refreshInterval?this.props.onChange(null):this.props.onChange(600)},this.onIntervalChange=e=>{this.setState({interval:"number"==typeof e?e:600})},this.onIntervalDone=()=>{this.props.onChange(60*this.state.interval)},this.getWhetherAutoRefresh=()=>this.props.refreshInterval>0||0!==this.props.refreshInterval&&this.props.hasOriginalDataRefreshInterval,this.getWhetherHonorLayerSetting=()=>"number"!=typeof this.props.refreshInterval&&this.props.hasOriginalDataRefreshInterval,this.state={interval:(this.props.refreshInterval||600)/60}}componentWillUnmount(){const e=this.getWhetherAutoRefresh(),t=this.getWhetherHonorLayerSetting();e&&!t&&this.onIntervalDone()}render(){if(!this.props.reference)return null;const e=this.getWhetherAutoRefresh(),t=this.getWhetherHonorLayerSetting();return Object(i.jsx)(a.Popper,{css:this.getStyle(this.props.theme),reference:this.props.reference,open:this.props.isOpen,placement:"bottom",toggle:this.props.toggle,showArrow:!0},Object(i.jsx)("div",{className:"list-refresh-setting-popup"},Object(i.jsx)(o.SettingSection,{className:"border-0"},Object(i.jsx)(o.SettingRow,{label:this.props.intl.formatMessage({id:"autoRefresh",defaultMessage:M}),className:"interval-label"},Object(i.jsx)(a.Switch,{checked:e,onChange:this.onToggleAutoRefresh}))),e&&Object(i.jsx)(o.SettingSection,{className:"pt-0 interval-label",title:this.props.intl.formatMessage({id:"interval",defaultMessage:y})},this.props.canOriginalDataSetRefreshInterval&&Object(i.jsx)("div",null,Object(i.jsx)(o.SettingRow,null,Object(i.jsx)("div",{className:"align-items-center d-flex"},Object(i.jsx)(a.Radio,{id:"honor-layer-setting",onChange:this.onToggleCustom,checked:t,className:"mr-2",disabled:!this.props.hasOriginalDataRefreshInterval}),Object(i.jsx)(a.Label,{for:"honor-layer-setting",disabled:!this.props.hasOriginalDataRefreshInterval,className:!this.props.hasOriginalDataRefreshInterval&&"disabled-label"},this.props.intl.formatMessage({id:"honorLayer",defaultMessage:C})))),Object(i.jsx)(o.SettingRow,null,Object(i.jsx)("div",{className:"align-items-center d-flex"},Object(i.jsx)(a.Radio,{id:"custom",onChange:this.onToggleCustom,checked:!t,className:"mr-2"}),Object(i.jsx)(a.Label,{for:"custom"},this.props.intl.formatMessage({id:"custom",defaultMessage:a.defaultMessages.custom}))))),(!t||!this.props.canOriginalDataSetRefreshInterval)&&Object(i.jsx)(o.SettingRow,{className:"mt-3 interval-custom"},Object(i.jsx)(a.NumericInput,{className:"w-100 interval-custom-input",value:this.state.interval,min:.1,max:999,precision:1,showHandlers:!1,onChange:this.onIntervalChange,onAcceptValue:this.onIntervalDone}),Object(i.jsx)("span",{className:"interval-custom-placeholder"},this.props.intl.formatMessage({id:"minutes",defaultMessage:E}))))))}}function T(e,t){const s=J(e);if(!s)return null;let a;if(e.isDataSourceSet){a={childSchemas:{}};const o=function(){const e=function(){const e=i.appConfigUtils.getAllWidgets(n.dataComponentsUtils.getAppConfig()).filter(e=>{var t;return null===(t=e.useDataSourcesEnabled)||void 0===t||t});return H(e)}(),t=function(){const e=n.dataComponentsUtils.getAppConfig(),t=e&&e.messageConfigs?Object.keys(e.messageConfigs).map(t=>e.messageConfigs[t]):[];return H(t)}(),s=function(){const e=n.dataComponentsUtils.getAppConfig(),t=e&&e.dataSources;let s=[];return t&&Object.keys(t).forEach(e=>{t[e]&&!t[e].isOutputFromWidget&&t[e].originDataSources&&t[e].originDataSources.length>0&&(s=s.concat(t[e].originDataSources.asMutable().map(e=>e.dataSourceId)))}),s}(),a=e.concat(t).concat(s);return Array.from(new Set(a))}();Object.keys(s.childSchemas).filter(t=>o.some(s=>e.getChildDataSourceId(t)===s)).forEach(s=>a.childSchemas[s]=Object.assign({},T(e.getChildDataSource(s),t)))}else{a=Object.assign(Object.assign({},J(e)),{fields:{}});const i=function(e){if(!e)return[];const t=e.getDataSourceJson()&&e.getDataSourceJson().useFields&&e.getDataSourceJson().useFields.asMutable()||[],s=_(e.id),i=function(e){const t=n.dataComponentsUtils.getAppConfig(),s=t&&t.messageConfigs?Object.keys(t.messageConfigs).map(e=>t.messageConfigs[e]):[];return V(s,e)}(e.id),a=function(e){if(!e)return[];const t=n.dataComponentsUtils.getOutputDssFromOriginDs(e).map(t=>function(e,t){if(!t||!e)return[];const s=_(t.id),i=t.getSchema(),a=i&&i.fields;let o,n,r,l=[];return s.forEach(t=>{o=a[t],n=o&&o.originFields&&o.originFields.asMutable()||[],n.length>0?(r=n.some(t=>t.split(e.id+".").length>1),r&&(n=n.filter(t=>t.split(e.id+".").length>1).map(t=>t.split(e.id+".")[1]))):n=[t],l=l.concat(n)}),l}(e,t)),s=Array.prototype.concat.apply([],t);return Array.from(new Set(s))}(e),o=t.concat(s).concat(i).concat(a);return Array.from(new Set(o))}(e);s.fields&&Object.keys(s.fields).filter(e=>i.some(t=>e===t)).forEach(e=>{a.fields[e]=Object.assign({},s.fields[e]),"function"==typeof t&&(a.fields[e]=t(a.fields[e]))})}return a}function H(e){if(!e)return[];let t=[];return e.forEach(e=>e.useDataSources&&e.useDataSources.forEach(e=>{t=t.concat(e.dataSourceId)})),t}function _(e){return V(i.appConfigUtils.getAllWidgets(n.dataComponentsUtils.getAppConfig()).filter(e=>{var t;return null===(t=e.useDataSourcesEnabled)||void 0===t||t}),e)}function V(e,t){if(!e)return[];let s=[];return e.forEach(e=>e.useDataSources&&e.useDataSources.forEach(e=>{e.fields&&e.mainDataSourceId&&e.mainDataSourceId===t&&(s=s.concat(e.fields))})),s}function W(e,t){return!(!e||!t)&&(L(e)?Object.keys(e.childSchemas).every(s=>W(e.childSchemas[s],t.childSchemas[s])):e.fields&&Object.keys(e.fields).every(e=>!(!t.fields||!t.fields[e])))}function L(e){return!!e&&!!e.childSchemas}function J(e){return e&&e.getSchema?e.getSchema():null}function U(e,t,s){let a=t.merge({});return a=a.set("id",e.id),a=a.set("schema",Object(i.Immutable)(s)),a}function P(e,t,s){let i={};if(!e||!t)return e&&L(e)&&(i.childSchemas={}),i;if(L(e)&&L(t)){let a,o;i={childSchemas:{}},Object.keys(e.childSchemas).forEach(n=>{a=e.childSchemas[n].childId,o=s&&s.childSchemas&&s.childSchemas[n],i.childSchemas[n]=t.childSchemas[a]?P(e.childSchemas[n],t.childSchemas[a],o):null})}else L(e)||L(t)?console.error("types of data sources are not matched"):i=Object.assign(Object.assign({},t),{fields:z(e,t,s),jimuChildId:e.jimuChildId});return i}function z(e,t,s){const i={};if(!(e&&e.fields&&t&&t.fields))return i;let a,o,n,r;return Object.keys(e.fields).forEach(l=>{n=e.fields[l],a=n.jimuName,o=n.name,r=t.fields[o],r&&r.esriFieldType===n.esriFieldType&&(i[a]=$(n,r,s))}),i}function $(e,t,s){let i;return s&&s.fields&&s.fields[e.jimuName]?(i=s.asMutable({deep:!0}).fields[e.jimuName],i.name=t.name):(i=function(e){if(!e)return null;const t=Object.assign({},e);t.alias&&delete t.alias;return t}(Object.assign({},t)),i.jimuName=e.jimuName),i}function F(e,t){return!!(e&&t&&t.childSchemas)&&Object.keys(t.childSchemas).some(s=>t.childSchemas[s].childId===e)}function B(e,t){if(!e||!t)return null;const s=Object.assign({},e),i=t.jimuChildId,a=t.childId;let o,n,r,l;return function(e,t){return!!(e&&t&&t.childSchemas)&&Object.keys(t.childSchemas).some(t=>t===e)}(i,e)&&!F(a,e)&&(o=`${i}-$${function(e,t){let s,i=0;if(!t||!e)return i;const a=e.split("-$")[0];return Object.keys(t.childSchemas).forEach(e=>{s=e.split("-$")||[],s.length>1&&s[0]===a&&parseInt(s[1])>i&&(i=parseInt(s[1]))}),i+1}(i,e)}`,n=L(t)?Object.assign(Object.assign({},t),{jimuChildId:o}):Object.assign(Object.assign({},t),{fields:{},jimuChildId:o}),s.childSchemas[o]=P(n,n,null)),l=Object.keys(e.childSchemas).filter(t=>e.childSchemas[t].childId===a),l.forEach(i=>{r=e.childSchemas[i],r&&(L(t)&&L(r)?Object.keys(t.childSchemas).forEach(e=>{s.childSchemas[i]=B(r,t.childSchemas[e])}):L(t)||L(r)?console.error("types of data sources are not matched"):Object.keys(t.fields).forEach(e=>{s.childSchemas[i]=q(r,t.fields[e])}))}),s}function q(e,t){const s=Object.assign({},e),i=t.jimuName;let a,o;var n,r;return!function(e,t){return!!(e&&t&&t.fields)&&!!t.fields[e]}(i,s)||(n=t.name,r=s,n&&r&&r.fields&&Object.keys(r.fields).some(e=>r.fields[e].name===n))||(a=`${i}-$${function(e,t){let s,i=0;if(!t||!t.fields)return i;const a=e.split("-$")[0];return Object.keys(t.fields).forEach(e=>{s=t.fields[e].jimuName?t.fields[e].jimuName.split("-$"):[],s.length>1&&s[0]===a&&parseInt(s[1])>i&&(i=parseInt(s[1]))}),i+1}(i,s)}`,o=Object.assign(Object.assign({},t),{jimuName:a}),s.fields[a]=$(o,o,null)),s}function Q(e){return Object.keys(e).sort((e,t)=>null==e?void 0:e.localeCompare(t))}function K(e,t,s){const i=T(t),a=J(e);return F(a.childId,i)?Object.keys(i.childSchemas).filter(e=>i.childSchemas[e].childId!==a.childId).every(e=>s.some(t=>J(t).childId===i.childSchemas[e].childId)):(console.warn("data source is not child of ",t),!1)}function G(e){return e.getDataSourceJson().itemId||J(e)&&J(e).childId}const X=s(14),Y=s(15),Z=s(19),ee=s(45);class te extends i.React.PureComponent{constructor(e){var t;super(e),this.__unmounted=!1,this.onRemoveItem=()=>{this.setState({isMoreOptionsShown:!1})},this.onShowDetailClick=()=>{this.props.onShowDetailClick(this.props.ds)},this.onRenameItem=()=>{this.setState({isMoreOptionsShown:!1,isRenameShown:!0})},this.onRename=()=>{const e=this.state.newName.trim();if(!e)return void this.setState({isRenameShown:!1});const t=this.props.ds.getDataSourceJson().setIn(["label"],e),s=n.dataComponentsUtils.editDataSourceJson(t);Object(l.getAppConfigAction)().editDataSource(s).exec(),this.setState({isRenameShown:!1})},this.onRenameChange=e=>{this.setState({newName:e.target.value})},this.onQueryApply=e=>{if(this.toggleViewSetting(),!e)return;const t=n.dataComponentsUtils.editDataSourceJson(this.props.ds.getDataSourceJson().setIn(["query"],e));Object(l.getAppConfigAction)().editDataSource(t).exec(),this.props.ds.addSourceVersion()},this.onAutoRefreshChange=e=>{var t;let s=this.props.ds.getDataSourceJson();(null===(t=s.query)||void 0===t?void 0:t.id)||(s=s.setIn(["query"],{id:s.id,label:this.props.ds.getLabel()})),s=s.setIn(["query","refreshInterval"],e);const i=n.dataComponentsUtils.editDataSourceJson(s);Object(l.getAppConfigAction)().editDataSource(i).exec()},this.toggleMoreOptions=()=>this.setState({isMoreOptionsShown:!this.state.isMoreOptionsShown}),this.toggleViewSetting=()=>this.setState({isViewSettingShown:!this.state.isViewSettingShown}),this.toggleAutoRefresh=()=>this.setState({isAutoRefreshShown:!this.state.isAutoRefreshShown}),this.onMappingIconClick=()=>{this.props.onMappingIconClick(this.props.ds)},this.getOriginalLabel=()=>{var e;let t;const s=this.props.intl.formatMessage({id:"originalDsLabel",defaultMessage:R});if(this.props.ds.map)t=null===(e=this.props.ds.map.portalItem)||void 0===e?void 0:e.title;else if(this.props.ds.layer)t=this.props.ds.layer.title;else if(this.props.ds.layerDefinition)t=this.props.ds.layerDefinition.name;else if(this.props.ds.serviceDefinition){const e=this.props.ds.getDataSourceJson(),s=null==e?void 0:e.url;t=i.dataSourceUtils.getServiceLabelFromUrl(s)}return t||s},this.onExportDataActionChange=(e,t)=>{let s=this.props.ds.getDataSourceJson();s=s.setIn(["disableExport"],!t);const i=n.dataComponentsUtils.editDataSourceJson(s);Object(l.getAppConfigAction)().editDataSource(i).exec()};const s=null===(t=this.props.ds)||void 0===t?void 0:t.getDataSourceJson().url;this.state={isMoreOptionsShown:!1,isMappingDetailShown:!1,isRenameShown:!1,isViewSettingShown:!1,isAutoRefreshShown:!1,newName:this.props.ds?this.props.ds.getLabel()||this.props.ds.id:"",isSubscriberOrPremium:i.dataSourceUtils.isOriginDataSubscriber(null,s)||i.dataSourceUtils.isOriginDataPremium(null,s)}}componentDidMount(){this.setIsCurrentDataSourceSubscriber()}componentDidUpdate(e,t){t.isRenameShown!==this.state.isRenameShown&&this.state.isRenameShown&&this.renameInput&&(this.renameInput.focus(),this.renameInput.select()),e.ds!==this.props.ds&&(this.setState({newName:this.props.ds?this.props.ds.getLabel()||this.props.ds.id:""}),this.setIsCurrentDataSourceSubscriber())}componentWillUnmount(){this.__unmounted=!0}setIsCurrentDataSourceSubscriber(){this.props.ds&&i.dataSourceUtils.isDataSourceSubscriberOrPremium(this.props.ds.getDataSourceJson()).then(e=>{this.__unmounted||this.setState({isSubscriberOrPremium:e})})}render(){var e,t,s;if(!this.props.ds)return null;const o=!!this.props.ds.query,r=n.dataComponentsUtils.getOriginalDataUrl(this.props.ds.getDataSourceJson()),l=null===(e=this.props.ds.getSchema())||void 0===e?void 0:e.refreshInterval,p="number"==typeof l,h=!this.props.ds.parentDataSource,d=!this.state.isSubscriberOrPremium&&!this.props.ds.getDataSourceJson().disableExport;return i.React.createElement("div",{className:"px-3 pb-3 ds-info"},i.React.createElement("div",{className:"d-flex justify-content-between ds-thumbnail-type-label w-100"},i.React.createElement("div",{className:"d-flex align-items-center ds-thumbnail-type"},i.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},i.React.createElement(a.Icon,{icon:n.dataComponentsUtils.getDsIcon(this.props.ds.getDataSourceJson()),className:"text-dark",size:12})),i.React.createElement("div",{className:"d-flex pl-2 ds-type"},i.React.createElement("div",{className:"flex-shrink-0 text-dark-600 text-truncate w-100 ds-type-name"},n.dataComponentsUtils.getDsTypeString(this.props.ds.type,this.props.intl)))),i.React.createElement("div",{className:"d-flex justify-content-between"},G(this.props.ds)&&i.React.createElement(a.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.onShowDetailClick},i.React.createElement("span",{title:this.props.intl.formatMessage({id:"details",defaultMessage:a.defaultMessages.details})},i.React.createElement(a.Icon,{icon:Y,size:12}))),o&&i.React.createElement(a.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.toggleViewSetting},i.React.createElement("span",{title:this.props.intl.formatMessage({id:"settings",defaultMessage:a.defaultMessages.settings})},i.React.createElement(a.Icon,{icon:Z,size:12}))),i.React.createElement(a.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.toggleMoreOptions,ref:e=>this.moreOptionsRef=e},i.React.createElement("span",{title:this.props.intl.formatMessage({id:"more",defaultMessage:a.defaultMessages.more})},i.React.createElement(a.Icon,{icon:X,size:12}))))),this.state.isRenameShown?i.React.createElement(a.TextInput,{className:"my-3 flex-grow-1 text-truncate ds-label-input ds-label",ref:e=>this.renameInput=e,onBlur:this.onRename,onKeyUp:this.onRename,onChange:this.onRenameChange,value:this.state.newName}):i.React.createElement("div",{className:"my-3 flex-grow-1 three-line-truncate ds-label text-left",title:this.props.ds.getLabel()||this.props.ds.id},this.props.ds.getLabel()||this.props.ds.id),r&&i.React.createElement("div",{className:"ds-origin-label flex-grow-1 d-flex align-items-center",title:this.props.intl.formatMessage({id:"source",defaultMessage:a.defaultMessages.source})},i.React.createElement(a.Link,{to:r,className:"p-0 ds-origin-label-link w-100 d-flex",themeStyle:{type:"link"},target:"_blank"},i.React.createElement("span",{className:"align-middle text-truncate ds-origin-label-link-text"},this.getOriginalLabel()))),o&&i.React.createElement("div",{className:"d-flex align-items-center my-3"},i.React.createElement("div",{className:"mr-2 flex-grow-1 refresh-last-update-label"},this.props.intl.formatMessage({id:"refreshSetting",defaultMessage:I})),i.React.createElement(a.Button,{size:"sm",icon:!0,type:"tertiary",onClick:this.toggleAutoRefresh,ref:e=>this.autoRefreshRef=e,className:Object(i.classNames)({"highlight-refresh-icon":!!this.props.ds.getAutoRefreshInterval()})},i.React.createElement("span",{title:this.props.intl.formatMessage({id:"refreshSetting",defaultMessage:I})},i.React.createElement(a.Icon,{icon:ee,size:12})))),o&&i.React.createElement("div",{className:"d-flex align-items-center mt-3"},i.React.createElement("div",{className:"mr-2 flex-grow-1",title:this.props.intl.formatMessage({id:"exportNotice",defaultMessage:N})},i.React.createElement(a.Label,{className:"refresh-last-update-label",for:"export-switch"},this.props.intl.formatMessage({id:"allowExport",defaultMessage:O})),i.React.createElement(a.Button,{size:"sm",icon:!0,type:"tertiary",className:"cursor-default"},i.React.createElement("span",null,i.React.createElement(a.Icon,{icon:Y,size:12})))),i.React.createElement(a.Switch,{id:"export-switch",checked:d,onChange:this.onExportDataActionChange,title:this.props.intl.formatMessage({id:"allowExport",defaultMessage:O}),disabled:this.state.isSubscriberOrPremium})),i.React.createElement(c,{isOpen:this.state.isMoreOptionsShown,reference:this.moreOptionsRef,intl:this.props.intl,widgets:this.props.widgets,dsJson:this.props.ds.getDataSourceJson(),onRemoveItem:h?this.onRemoveItem:null,onRenameItem:this.onRenameItem,theme:this.props.theme,offset:[25,0],toggle:this.toggleMoreOptions}),o&&i.React.createElement(n.DataViewSettingPopup,{isOpen:this.state.isViewSettingShown,toggle:this.toggleViewSetting,onApply:this.onQueryApply,mainDataSource:this.props.ds,dataView:this.props.ds.getDataSourceJson().query,disableRename:!0,disableRemove:!0,disableDuplicate:!0,isSettingMainDataSource:!0,newDataViewLabel:this.props.ds.getLabel(),newDataViewId:"default"}),o&&this.state.isAutoRefreshShown&&i.React.createElement(A,{isOpen:this.state.isAutoRefreshShown,intl:this.props.intl,theme:this.props.theme,reference:this.autoRefreshRef,refreshInterval:null===(s=null===(t=this.props.ds.getDataSourceJson())||void 0===t?void 0:t.query)||void 0===s?void 0:s.refreshInterval,onChange:this.onAutoRefreshChange,toggle:this.toggleAutoRefresh,canOriginalDataSetRefreshInterval:p,hasOriginalDataRefreshInterval:p&&l>0}))}}const se=s(18);class ie extends i.React.PureComponent{constructor(e){super(e),this.Item=({widgetJson:e})=>{const t="string"==typeof e.icon?e.icon:e.icon&&e.icon.svg,s="string"==typeof e.icon?null:e.icon&&e.icon.properties&&e.icon.properties.color;return i.React.createElement("div",{className:"d-flex align-content-center mb-3 mx-3",key:e.id},i.React.createElement("div",{className:"widget-icon"},i.React.createElement(a.Icon,{icon:t,color:s})),i.React.createElement("div",{className:"flex-grow-1 text-truncate px-2",title:e.label},e.label))}}render(){if(!this.props.ds)return i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}));const e=n.dataComponentsUtils.getWidgetsUsingDsOrItsViews(this.props.ds.id,this.props.widgets,!1);if(!e||0===e.length)return i.React.createElement("div",{className:"empty-placeholder w-100"},i.React.createElement("div",{className:"empty-placeholder-icon"},i.React.createElement(a.Icon,{icon:se,width:80,height:71})),i.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:this.props.intl.formatMessage({id:"noRelatedWidget",defaultMessage:D})}}));const t=this.Item;return i.React.createElement(i.React.Fragment,null,i.React.createElement("h5",{className:"m-3 data-setting-secondary-title"},this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:a.defaultMessages.relatedWidgets})),(s=e,s.sort((e,t)=>{var s;return null===(s=e.label)||void 0===s?void 0:s.localeCompare(t.label)})).map(e=>i.React.createElement(t,{widgetJson:e,key:e.id})));var s}}class ae extends i.React.PureComponent{constructor(e){super(e)}componentDidMount(){this.props.ds||this.props.backToHomePage()}componentDidUpdate(e,t){e.ds!==this.props.ds&&(this.props.ds||this.props.backToHomePage())}render(){return this.props.ds?i.React.createElement("div",{className:"ds-list"},i.React.createElement(te,{ds:this.props.ds,onMappingIconClick:this.props.onMappingIconClick,widgets:this.props.widgets,theme:this.props.theme,onShowDetailClick:this.props.onShowDetailClick,intl:this.props.intl,isDataSourceInited:this.props.isDataSourceInited,dsInfo:this.props.dsInfo}),i.React.createElement(a.Tabs,{type:"pills",fill:!0,defaultValue:this.props.defaultActive},i.React.createElement(a.Tab,{id:"layers",title:this.props.intl.formatMessage({id:"layers",defaultMessage:a.defaultMessages.layers})},i.React.createElement("div",{className:"tab-scroll"},i.React.createElement(k,{dataSourceJson:this.props.dataSourceJson,ds:this.props.ds,key:this.props.ds.id,intl:this.props.intl,dispatch:this.props.dispatch,onDataSourceItemClick:this.props.onDsItemClicked,isDataSourceInited:this.props.isDataSourceInited,onChildDataIconClick:this.props.onChildDataIconClick,onRelatedWidgetsIconClick:this.props.onRelatedWidgetsIconClick,widgets:this.props.widgets,theme:this.props.theme}))),i.React.createElement(a.Tab,{id:"widgets",title:this.props.intl.formatMessage({id:"widgets",defaultMessage:a.defaultMessages.widgets})},i.React.createElement("div",{className:"tab-scroll"},i.React.createElement(ie,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets}))))):null}}var oe=i.ReactRedux.connect((e,t)=>{var s;return{dataSourceJson:null===(s=t.ds)||void 0===s?void 0:s.getDataSourceJson()}})(ae),ne=class extends i.React.PureComponent{constructor(e){super(e),this.onRemove=()=>{this.props.onRemove(this.props.field)}}render(){if(!this.props.field)return null;const e=this.props.field;return i.React.createElement("div",{className:"pl-3 mb-3 d-flex field-item"},i.React.createElement("div",{className:"flex-grow-1 text-truncate field-label",title:e&&(e.alias||e.name)},e&&(e.alias||e.name)))}};const re=s(18);var le=class extends i.React.PureComponent{constructor(e){super(e),this.getFields=e=>{const t=T(e);return t&&t.fields},this.onRemove=e=>{},this.hideRemovePopup=()=>{this.setState({isRemoveOptionsShown:!1})},this.state={isRemoveOptionsShown:!1}}render(){var e;if(!this.props.ds)return i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}));const t=this.getFields(this.props.ds);return t&&0!==Object.keys(t).length?i.React.createElement(i.React.Fragment,null,i.React.createElement("h5",{className:"m-3 data-setting-secondary-title"},this.props.intl.formatMessage({id:"inUse",defaultMessage:f})),t&&Q(t).map((e,s)=>i.React.createElement(ne,{field:t[e],key:s,onRemove:this.onRemove,isDataSourceInited:this.props.isDataSourceInited})),i.React.createElement(n.DataSourceRemoveWarningPopup,{dataSourceId:null===(e=this.props.ds)||void 0===e?void 0:e.id,isOpen:this.state.isRemoveOptionsShown,toggle:this.hideRemovePopup,reason:n.DataSourceRemoveWaringReason.DataSourceRemoved})):i.React.createElement("div",{className:"empty-placeholder w-100"},i.React.createElement("div",{className:"empty-placeholder-icon"},i.React.createElement(a.Icon,{icon:re,width:80,height:71})),i.React.createElement("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:this.props.intl.formatMessage({id:"noUsedField",defaultMessage:w})}}))}};const ce=s(19),pe=s(46);class he extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.Item=({dataView:e,label:t})=>{var s;const o=i.DataSourceManager.getInstance().getDataViewDataSourceId(null===(s=this.props.ds)||void 0===s?void 0:s.id,e.id),r=n.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(o,this.props.widgets),l=this.props.intl.formatMessage({id:"relatedWidgetsWithDirectlyNum",defaultMessage:a.defaultMessages.relatedWidgetsWithDirectlyNum},{num:null==r?void 0:r.length});return i.React.createElement("div",{className:"d-flex align-items-center justify-content-start mb-2 mx-3 data-view-item"},i.React.createElement("div",{className:"flex-grow-1 text-truncate px-2",title:l},t),i.React.createElement(a.Button,{type:"tertiary",icon:!0,size:"sm",onClick:()=>this.onDataViewClick(e),title:this.props.intl.formatMessage({id:"settings",defaultMessage:a.defaultMessages.settings})},i.React.createElement(a.Icon,{size:12,icon:ce})))},this.toggleViewSetting=()=>this.setState({isViewSettingOpen:!this.state.isViewSettingOpen}),this.toggleDataViewForNoSelection=(e,t)=>{if(t){const e=Object(i.Immutable)({id:i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION,label:this.props.intl.formatMessage({id:"dataViewForNoSelection",defaultMessage:a.defaultMessages.dataViewForNoSelection})});this.editDataView(e,!1)}else this.removeDataView(i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION)},this.onDataViewClick=e=>{this.setState({selectedDataView:e}),this.toggleViewSetting()},this.onCreateViewClick=()=>{this.setState({selectedDataView:null}),this.toggleViewSetting()},this.onApply=e=>{this.editDataView(e,!0)},this.onDuplicate=e=>{this.editDataView(e,!1)},this.removeDataView=e=>{if(!e)return;const t=this.props.ds.getDataSourceJson();let s=t.dataViews||Object(i.Immutable)({});s=s.without(e);const a=n.dataComponentsUtils.editDataSourceJson(t.setIn(["dataViews"],s));Object(l.getAppConfigAction)().editDataSource(a).exec(),this.updateSelectionView(e)},this.editDataView=(e,t)=>{if(!e)return;const s=this.props.ds.getDataSourceJson();let a=s.dataViews||Object(i.Immutable)({});a=a.set(e.id,e);const o=n.dataComponentsUtils.editDataSourceJson(s.setIn(["dataViews"],a));Object(l.getAppConfigAction)().editDataSource(o).exec(),i.lodash.defer(()=>{i.DataSourceManager.getInstance().createDataSource(s,e.id).then(t=>{var s;return t.dataViewId===i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION&&(null===(s=t)||void 0===s?void 0:s.load)?this.loadNoSelectionView(t).then(()=>(this.updateSelectionView(e.id),Promise.resolve(null))):(this.changeVersionToLetWidgetsUpdate(),Promise.resolve(null))}).then(()=>{this.__unmount||(this.setState({selectedDataView:e}),t&&this.toggleViewSetting())},e=>{console.error("Failed to add data view, ",e),this.__unmount||(this.setState({selectedDataView:null}),t&&this.toggleViewSetting())})})},this.loadNoSelectionView=e=>Promise.all([e.load({},{widgetId:i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION}),e.loadCount({},{widgetId:i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION})]),this.updateSelectionView=e=>{var t;e===i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION&&0===(null===(t=this.props.ds.getMainDataSource())||void 0===t?void 0:t.getSelectedRecordIds().filter(e=>!!e).length)&&this.clearSelectionView()},this.clearSelectionView=()=>{i.lodash.defer(()=>{var e,t,s,a,o;null===(t=null===(e=this.props.ds.getMainDataSource())||void 0===e?void 0:e.getDataView(i.CONSTANTS.SELECTION_DATA_VIEW_ID))||void 0===t||t.clearRecords(),null===(o=null===(a=null===(s=this.props.ds.getMainDataSource())||void 0===s?void 0:s.getDataView(i.CONSTANTS.SELECTION_DATA_VIEW_ID))||void 0===a?void 0:a.getAllDerivedDataSources())||void 0===o||o.forEach(e=>{null==e||e.clearRecords()}),this.changeVersionToLetWidgetsUpdate()})},this.changeVersionToLetWidgetsUpdate=()=>{var e;null===(e=this.props.ds.getMainDataSource())||void 0===e||e.addSourceVersion()},this.state={isViewSettingOpen:!1,selectedDataView:null}}componentWillUnmount(){this.__unmount=!0}render(){var e,t,s,o;if(!this.props.ds)return i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}));const r=null===(t=null===(e=this.props.ds.getDataSourceJson())||void 0===e?void 0:e.dataViews)||void 0===t?void 0:t.without(i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION),l=(null===(s=this.props.ds.getDataSourceJson())||void 0===s?void 0:s.dataViews)&&this.props.ds.getDataSourceJson().dataViews[i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION],c=this.Item;return i.React.createElement("div",{className:"tab-scroll-with-bottom-fix"},i.React.createElement(a.Button,{className:"m-3 d-flex justify-content-center align-items-center font-size-13 create-a-view-btn",onClick:this.onCreateViewClick,title:this.props.intl.formatMessage({id:"createAView",defaultMessage:a.defaultMessages.createAView})},i.React.createElement(a.Icon,{icon:pe,size:12,className:"flex-shrink-0"}),i.React.createElement("div",{className:"text-truncate text-left"},this.props.intl.formatMessage({id:"createAView",defaultMessage:a.defaultMessages.createAView}))),i.React.createElement("div",{className:"data-view-container"},r&&Object.values(r).map((e,t)=>i.React.createElement(c,{dataView:e,label:e.label,key:t}))),i.React.createElement("div",{className:"d-flex align-items-center justify-content-between p-3 no-selection-view-item bg-light-300",title:this.props.intl.formatMessage({id:"dataViewForNoSelectionHint",defaultMessage:a.defaultMessages.dataViewForNoSelectionHint})},i.React.createElement("div",{className:"d-flex w-85"},i.React.createElement(a.Checkbox,{checked:!!l,onChange:this.toggleDataViewForNoSelection,className:"mr-2",id:"no-selection-view-setting"}),i.React.createElement(a.Label,{className:"flex-grow-1 text-truncate mb-0",for:"no-selection-view-setting",title:this.props.intl.formatMessage({id:"dataViewForNoSelection",defaultMessage:a.defaultMessages.dataViewForNoSelection})},this.props.intl.formatMessage({id:"dataViewForNoSelection",defaultMessage:a.defaultMessages.dataViewForNoSelection}))),!!l&&i.React.createElement(a.Button,{type:"tertiary",icon:!0,size:"sm",onClick:()=>this.onDataViewClick(l),title:this.props.intl.formatMessage({id:"settings",defaultMessage:a.defaultMessages.settings})},i.React.createElement(a.Icon,{size:12,icon:ce}))),i.React.createElement(n.DataViewSettingPopup,{isOpen:this.state.isViewSettingOpen,toggle:this.toggleViewSetting,onApply:this.onApply,onDuplicate:this.onDuplicate,mainDataSource:this.props.ds,dataView:this.state.selectedDataView,disableRename:(null===(o=this.state.selectedDataView)||void 0===o?void 0:o.id)===i.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION}))}}var de=i.ReactRedux.connect((e,t)=>{var s;return{dataSourceJson:null===(s=t.ds)||void 0===s?void 0:s.getDataSourceJson()}})(he),me=class extends i.React.PureComponent{constructor(e){super(e)}componentDidMount(){this.props.ds||this.props.backToHomePage()}componentDidUpdate(e,t){e.ds!==this.props.ds&&(this.props.ds||this.props.backToHomePage())}render(){if(!this.props.ds)return null;const e=!!this.props.ds.query;return i.React.createElement("div",{className:"field-list"},i.React.createElement(te,{ds:this.props.ds,onMappingIconClick:this.props.onMappingIconClick,widgets:this.props.widgets,theme:this.props.theme,onShowDetailClick:this.props.onShowDetailClick,intl:this.props.intl,isDataSourceInited:this.props.isDataSourceInited,dsInfo:this.props.dsInfo}),i.React.createElement(a.Tabs,{type:"pills",fill:!0,defaultValue:this.props.defaultActive},e&&i.React.createElement(a.Tab,{id:"dataViews",title:this.props.intl.formatMessage({id:"dataViews",defaultMessage:x})},i.React.createElement("div",{className:"h-100"},i.React.createElement(de,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets}))),i.React.createElement(a.Tab,{id:"fields",title:this.props.intl.formatMessage({id:"fields",defaultMessage:a.defaultMessages.fields})},i.React.createElement("div",{className:"tab-scroll"},i.React.createElement(le,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets}))),i.React.createElement(a.Tab,{id:"widgets",title:this.props.intl.formatMessage({id:"widgets",defaultMessage:a.defaultMessages.widgets})},i.React.createElement("div",{className:"tab-scroll"},i.React.createElement(ie,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets})))))}};const ue=s(47),ge=s(48),Se=[{name:"applyStyle",enabled:!0,fn:({state:e})=>Object.assign(Object.assign({},e),{styles:Object.assign(Object.assign({},e.styles),{zIndex:"1050"})})}];var fe=class extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.toggleDropdown=()=>{this.setState({isNewDsDropdownOpen:!this.state.isNewDsDropdownOpen})},this.setNewChildDss=e=>{e&&this.setState({newDss:e.getChildDataSources()})},this.getSelectedDsLabel=e=>e&&(e.getLabel()||e.id),this.onSelectedNewDsChange=e=>{this.props.updateMappedSchema(this.props.curDs,e)},this.DsInfo=({curDs:e,selectedNewDs:t})=>{if(!e)return null;const s=n.dataComponentsUtils.getWidgetsUsingDsOrItsViews(e.id,this.props.widgets,!1);return i.React.createElement("div",null,i.React.createElement("div",{className:"d-flex align-items-center m-2"},i.React.createElement("div",{className:"d-flex align-items-center justify-content-center mr-1 flex-shrink-0 border-light-500 ds-thumbnail"},i.React.createElement(a.Icon,{icon:n.dataComponentsUtils.getDsIcon(e.getDataSourceJson()),className:"text-dark",size:"22"})),i.React.createElement("div",{className:"flex-grow-1 text-truncate p-1",title:e.getLabel()||e.id},e.getLabel()||e.id),this.props.isDone?null:i.React.createElement("div",{className:"d-flex align-items-center justify-content-center mb-3"},i.React.createElement(a.Icon,{icon:ue,className:"text-danger",size:"12"}))),i.React.createElement("div",{className:"d-flex m-2"},i.React.createElement("div",{className:"w-100 d-flex"},i.React.createElement("div",{className:"d-flex bg-light-300 ds-type h6 pl-1 pr-1"},i.React.createElement("div",{className:"flex-shrink-0 text-dark-600 mr-1 text-truncate ds-type-name"},n.dataComponentsUtils.getDsTypeString(e.type,this.props.intl)))),i.React.createElement("div",{className:"flex-shrink-0 d-flex flex-row ds-related-widgets"},i.React.createElement(a.Icon,{icon:ge,className:"mr-1 text-dark"}),i.React.createElement("span",{className:"align-middle"},s&&s.length))))},this.state={isNewDsDropdownOpen:!1,newDss:null}}componentDidMount(){this.__unmount=!1,this.setNewChildDss(this.props.newParentDs)}componentDidUpdate(e){e.newParentDs!==this.props.newParentDs&&this.setNewChildDss(this.props.newParentDs)}componentWillUnmount(){this.__unmount=!0}render(){if(!this.props.curDs)return null;const e=this.props.selectedNewDs,t=this.DsInfo;return i.React.createElement("div",{className:"border-light-500 bg-white m-2 p-2 list-item ds-mapping-ds-item"},i.React.createElement(t,{curDs:this.props.curDs,selectedNewDs:e}),i.React.createElement("div",{className:"align-items-center"},i.React.createElement("div",{className:"ds-mapping-drop-down p-2"},i.React.createElement(a.Dropdown,{isOpen:this.state.isNewDsDropdownOpen,className:"w-100 drop-down",toggle:this.toggleDropdown},i.React.createElement(a.DropdownToggle,{caret:!0,outline:!0,className:"w-100 text-truncate",disabled:!this.state.newDss},this.getSelectedDsLabel(e)||""),this.state.newDss?i.React.createElement(a.DropdownMenu,{className:"text-truncate",modifiers:Se},i.dataSourceUtils.getSortedArrayByLabel(this.state.newDss).map((e,t)=>e&&e.id?i.React.createElement(a.DropdownItem,{key:t,onClick:()=>{this.onSelectedNewDsChange(e)},title:e.getLabel()||e.id,style:{width:"220px"}},i.React.createElement("div",{className:"text-truncate"},e.getLabel()||e.id)):null)):null))))}};const De=[{name:"applyStyle",enabled:!0,fn:({state:e})=>Object.assign(Object.assign({},e),{styles:Object.assign(Object.assign({},e.styles),{zIndex:"1050"})})}];var we=class extends i.React.PureComponent{constructor(e){super(e),this.toggleDropdown=()=>{this.setState({isDropdownOpen:!this.state.isDropdownOpen})},this.onDropDownItemClicked=e=>{this.props.updateMappedSchema(this.props.curField,e)},this.state={isDropdownOpen:!1}}render(){if(!this.props.curField||!this.props.newSchema)return null;const e=this.props.newSchema,t=this.props.selectedNewField;return i.React.createElement("div",{className:"m-2 filed-mapping-item"},i.React.createElement("div",null,this.props.curField.alias||this.props.curField.name),i.React.createElement("div",{className:"ds-mapping-drop-down p-2"},i.React.createElement(a.Dropdown,{isOpen:this.state.isDropdownOpen,className:"w-100 drop-down",toggle:this.toggleDropdown},i.React.createElement(a.DropdownToggle,{caret:!0,outline:!0,className:"w-100 text-truncate",disabled:!e||!e.fields},t&&(t.alias||t.name)||""),e&&e.fields?i.React.createElement(a.DropdownMenu,{className:"text-truncate",modifiers:De},Q(e.fields).map((t,s)=>e.fields[t]&&e.fields[t].esriType===this.props.curField.esriType?i.React.createElement(a.DropdownItem,{key:s,onClick:()=>this.onDropDownItemClicked(e.fields[t]),style:{width:"220px"}},i.React.createElement("div",{className:"text-truncate"},e.fields[t].alias||e.fields[t].name)):null)):null)))}};const ve=s(49),be=s(50);class xe extends i.React.PureComponent{constructor(e){super(e),this.onToggleExternalDsClicked=()=>{this.props.toggleExternalDs(!this.props.isExternalDsShown)},this.onCancelClicked=()=>{this.props.hideMapping()}}render(){if(!this.props.curDs)return i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}));const e=this.props.newDs||this.props.curDs;return i.React.createElement("div",{className:"mapping-info"},i.React.createElement("div",{className:"border-color-gray-300 m-2 ds-mapping-header"},this.props.isMappingReady&&i.React.createElement("div",{className:"d-inline-block ds-mapping-header-back",onClick:this.onCancelClicked},i.React.createElement(a.Icon,{icon:be,autoFlip:!0}),i.React.createElement("span",{className:"align-middle ml-2"},this.props.intl.formatMessage({id:"cancel",defaultMessage:i.defaultMessages.cancel})))),i.React.createElement("div",{className:"border-color-gray-300 ds-mapping-cur-info"},i.React.createElement("div",{className:"flex-grow-1 m-2 align-self-center text-truncate ds-label",title:this.props.curDs.getLabel()||this.props.curDs.id},this.props.curDs.getLabel()||this.props.curDs.id),i.React.createElement("div",{className:"d-flex m-2"},i.React.createElement("div",{className:"d-flex bg-light-300 ds-type h6"},i.React.createElement("div",{className:"ml-1 mr-1 bg-success ds-type-icon"}),i.React.createElement("div",{className:"flex-shrink-0 text-dark-600 mr-1 text-truncate ds-type-name"},n.dataComponentsUtils.getDsTypeString(this.props.curDs.type,this.props.intl))))),i.React.createElement("div",{className:"m-2 d-flex flex-column ds-mapping-collapse"},i.React.createElement("div",{className:"mt-1 d-flex justify-content-between"},i.React.createElement("span",{className:"align-middle ml-1"},"Source"),this.props.isOpenSelectDataBtnHide?null:i.React.createElement("span",{className:"inline-block mr-1 bg-light-300 ds-mapping-source",onClick:this.onToggleExternalDsClicked},i.React.createElement(a.Icon,{icon:ve,size:"12",className:"text-dark"}))),i.React.createElement("div",{className:Object(i.classNames)("text-truncate pl-1 mt-2 w-100 ds-origin-label",{"border border-primary":!!this.props.newDs},{"border-light-500":!this.props.newDs}),title:e.getLabel()||e.id},i.React.createElement("span",{className:"align-middle"},e.getLabel()||e.id))))}}class Re extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.updateMappedSchema=(e,t)=>{const s=Object.assign({},this.state.mappedSchema),i=$(e,t,this.props.curDs&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson().schema);s.fields[i.jimuName]=i,this.setState({mappedSchema:s})},this.getIsDoneStatus=()=>{let e;return e=!(!W(this.state.curSchema,this.state.mappedSchema)||!this.props.newDs),e},this.getCanSelectNewDs=()=>!this.props.newDs||this.props.newDs.id===this.props.curDs.id,this.getSelectedNewField=(e,t)=>{if(!(this.state.newSchema&&this.state.newSchema.fields&&this.state.mappedSchema&&this.state.mappedSchema.fields&&this.state.mappedSchema.fields[e]))return null;const s=this.state.newSchema.fields[this.state.mappedSchema.fields[e].name];return s&&s.esriType===t?s:null},this.onNextClicked=()=>{let e=Object.assign({},this.state.mappedSchema);this.state.newSchema&&this.state.newSchema.fields&&Object.keys(this.state.newSchema.fields).forEach(t=>{e=q(e,this.state.newSchema.fields[t])}),this.setState({mappedSchema:e},()=>{this.props.onMappingFinished(this.props.curDs,this.state.mappedSchema,this.props.isLast)})},this.onPreviousClicked=()=>{this.props.backToPreviouseMapping()},this.state={curSchema:T(this.props.curDs),newSchema:J(this.props.newDs),mappedSchema:this.props.defaultMappedSchema&&this.props.defaultMappedSchema.fields?Object(i.Immutable)(this.props.defaultMappedSchema).asMutable({deep:!0}):null,isDone:!1}}componentDidMount(){if(this.__unmount=!1,this.getCanSelectNewDs()?this.props.toggleExternalDs(!0):this.props.toggleExternalDs(!1),!this.state.mappedSchema||!this.state.mappedSchema.fields||0===Object.keys(this.state.mappedSchema.fields).length){const e=this.props.curDs&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson().schema;this.setState({mappedSchema:{fields:z(this.state.curSchema,this.state.newSchema,e)}})}this.setState({isDone:this.getIsDoneStatus()})}componentDidUpdate(e,t){if((e.curDs!==this.props.curDs||this.getWhetherJsonRelatedDataChange(e,this.props))&&this.setState({curSchema:T(this.props.curDs)}),(e.newDs!==this.props.newDs||this.getWhetherJsonRelatedDataChange(e,this.props))&&this.setState({newSchema:J(this.props.newDs)}),t.newSchema!==this.state.newSchema||t.curSchema!==this.state.curSchema)if(this.props.defaultMappedSchema&&this.props.defaultMappedSchema.fields&&Object.keys(this.props.defaultMappedSchema.fields).length>0)this.setState({mappedSchema:Object(i.Immutable)(this.props.defaultMappedSchema).asMutable({deep:!0})});else{const e=this.props.curDs&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson().schema,t={fields:z(this.state.curSchema,this.state.newSchema,e)};this.setState({mappedSchema:t})}t.curSchema===this.state.curSchema&&t.mappedSchema===this.state.mappedSchema&&t.newSchema===this.state.newSchema||this.setState({isDone:this.getIsDoneStatus()})}componentWillMount(){this.__unmount=!0}getWhetherJsonRelatedDataChange(e,t){return e.dataSources!==t.dataSources||e.widgets!==t.widgets||e.messages!==t.messages}render(){return this.props.curDs?i.React.createElement("div",{className:"ds-mapping-field"},i.React.createElement(xe,{curDs:this.props.curDs,newDs:this.props.newDs,hideMapping:this.props.hideMapping,isOpenSelectDataBtnHide:!this.getCanSelectNewDs(),toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,isExternalDsShown:this.props.isExternalDsShown,intl:this.props.intl}),this.state.curSchema&&this.state.curSchema.fields&&Object.keys(this.state.curSchema.fields).length>0?Q(this.state.curSchema.fields).map((e,t)=>i.React.createElement(we,{curField:this.state.curSchema.fields[e],newSchema:this.state.newSchema,updateMappedSchema:this.updateMappedSchema,selectedNewField:this.getSelectedNewField(e,this.state.curSchema.fields[e].esriType),key:t})):i.React.createElement("div",{className:"ml-4 mt-2"},this.props.intl.formatMessage({id:"noUsedFieldToMap",defaultMessage:g})),i.React.createElement("div",{className:"fixed-bottom ds-mapping-buttons"},this.props.curDs.parentDataSource&&i.React.createElement(a.Button,{onClick:this.onPreviousClicked,disabled:!this.props.isMappingReady||this.props.isWarning},this.props.intl.formatMessage({id:"previous",defaultMessage:a.defaultMessages.previous})),i.React.createElement(a.Button,{disabled:!this.state.isDone||!this.props.isMappingReady||this.props.isWarning,onClick:this.onNextClicked,className:"bg-primary ml-2"},this.props.isLast?this.props.intl.formatMessage({id:"done",defaultMessage:a.defaultMessages.done}):this.props.intl.formatMessage({id:"next",defaultMessage:a.defaultMessages.next})))):i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}))}}class Me extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.updateMappedChildSchema=(e,t)=>{const s=Object.assign({},this.state.mappedSchema),i=J(e),a=i&&i.jimuChildId,o=e&&e.getDataSourceJson()&&e.getDataSourceJson()&&e.getDataSourceJson().schema,n=P(T(e),J(t),o);s.childSchemas[a]=n,this.setState({mappedSchema:s})},this.updateMappedSchema=(e,t)=>{const s=Object.assign({},this.state.mappedSchema),i=J(t),a=i&&i.jimuChildId;s.childSchemas[a]=Object.assign(Object.assign({},s.childSchemas[a]),e),this.setState({mappedSchema:s})},this.setChildDs=(e,t)=>{this.setState({curChildDs:e,newChildDs:t})},this.getIsDoneStatus=()=>{let e;return e=!!W(this.state.curSchema,this.state.mappedSchema),e},this.getIsChildMappingDoneStatus=()=>{let e;var t,s;return t=this.state.curSchema,s=this.state.mappedSchema,e=!!(t&&s&&(L(t)?Object.keys(t.childSchemas).every(e=>!(!s.childSchemas||!s.childSchemas[e])):t.fields&&Object.keys(t.fields).every(e=>!(!s.fields||!s.fields[e])))),e},this.getSelectedNewDs=e=>{if(!(this.state.mappedSchema&&this.state.mappedSchema.childSchemas&&this.state.mappedSchema.childSchemas[e]&&this.props.newDs))return null;const t=this.state.mappedSchema.childSchemas[e].childId;return t?this.props.newDs.getChildDataSource(t):null},this.getDefaultMappedFieldSchema=()=>{const e=J(this.props.curDs);return this.props.defaultMappedSchema&&e?this.props.defaultMappedSchema.childSchemas[e.jimuChildId]:null},this.getWhetherHaveChildDssToMap=()=>this.state.curSchema&&this.state.curSchema.childSchemas&&0!==Object.keys(this.state.curSchema.childSchemas).length,this.onFieldMappingFinished=(e,t,s)=>{const i=Object.assign({},t);this.props.updateMappedSchema&&this.props.updateMappedSchema(i,this.props.curDs),s?this.props.onDsMappingFinished():this.props.traverseParentDsMapping&&this.props.traverseParentDsMapping()},this.onDsMappingFinished=()=>{if(!this.props.newDs)return;let e=Object.assign({},this.state.mappedSchema);this.props.newDs.getChildDataSources().forEach(t=>{e=B(e,J(t))}),this.setState({mappedSchema:e},()=>{if(this.props.isRoot){const e=U(this.props.curDs.getDataSourceJson(),this.props.newDs.getDataSourceJson(),this.state.mappedSchema);this.props.onMappingFinished&&this.props.onMappingFinished(e)}else this.props.updateMappedSchema&&this.props.updateMappedSchema(this.state.mappedSchema,this.props.curDs);this.props.hideMapping()})},this.traverseDsMapping=()=>{const e=Q(this.state.curSchema.childSchemas).find(e=>this.props.mappingHistory.every(t=>!J(t).jimuChildId||J(t).jimuChildId!==e)),t=this.props.curDs.getChildDataSource(e),s=this.getSelectedNewDs(e);t?(this.setChildDs(t,s),this.props.updateMappingHistory(this.props.mappingHistory.concat(t))):this.props.traverseParentDsMapping?this.props.traverseParentDsMapping():(this.setChildDs(null,null),this.onDsMappingFinished())},this.reverseTraverseDsMapping=()=>{const e=this.props.mappingHistory.length>1?this.props.mappingHistory.slice(this.props.mappingHistory.length-2)[0]:null,t=J(e)&&J(e).jimuChildId,s=this.getSelectedNewDs(t);e&&(this.setChildDs(e,s),this.props.updateMappingHistory(this.props.mappingHistory.slice(0,this.props.mappingHistory.length-1)))},this.state={newChildDs:null,curChildDs:null,curSchema:this.props.curDs&&this.props.curDs.isDataSourceSet?T(this.props.curDs):null,newSchema:this.props.newDs&&this.props.newDs.isDataSourceSet?J(this.props.newDs):null,mappedSchema:this.props.defaultMappedSchema||null,isDone:!1,isChildMappingDone:!1}}componentDidMount(){if(this.__unmount=!1,!this.state.mappedSchema||0===Object.keys(this.state.mappedSchema).length){const e=this.props.curDs&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson().schema;this.setState({mappedSchema:P(this.state.curSchema,this.state.newSchema,e)})}this.setState({isDone:this.getIsDoneStatus(),isChildMappingDone:this.getIsChildMappingDoneStatus()})}componentDidUpdate(e,t){if((e.curDs!==this.props.curDs&&this.props.curDs&&this.props.curDs.isDataSourceSet||this.getWhetherJsonRelatedDataChange(e,this.props))&&this.setState({curSchema:T(this.props.curDs)}),(e.newDs!==this.props.newDs&&this.props.newDs&&this.props.newDs.isDataSourceSet||this.getWhetherJsonRelatedDataChange(e,this.props))&&this.setState({newSchema:J(this.props.newDs)}),t.newSchema!==this.state.newSchema){const e=this.props.curDs&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson()&&this.props.curDs.getDataSourceJson().schema;this.setState({mappedSchema:P(this.state.curSchema,this.state.newSchema,e)})}t.curSchema===this.state.curSchema&&t.mappedSchema===this.state.mappedSchema&&t.newSchema===this.state.newSchema||this.setState({isDone:this.getIsDoneStatus(),isChildMappingDone:this.getIsChildMappingDoneStatus()}),e.isRoot!==this.props.isRoot&&this.props.isRoot&&this.props.toggleExternalDs(!0)}componentWillMount(){this.__unmount=!0}getWhetherJsonRelatedDataChange(e,t){return e.dataSources!==t.dataSources||e.widgets!==t.widgets||e.messages!==t.messages}render(){return this.props.curDs?i.React.createElement(i.React.Fragment,null,this.state.curChildDs&&this.state.newChildDs?i.React.createElement(Me,{newDs:this.state.newChildDs,curDs:this.state.curChildDs,defaultMappedSchema:this.state.mappedSchema,isRoot:!1,isExternalDsShown:this.props.isExternalDsShown,isMappingReady:this.props.isMappingReady,hideMapping:this.props.hideMapping,toggleExternalDs:this.props.toggleExternalDs,isWarning:this.props.isWarning,mappingHistory:this.props.mappingHistory,updateMappedSchema:this.updateMappedSchema,traverseParentDsMapping:this.traverseDsMapping,updateMappingHistory:this.props.updateMappingHistory,widgets:this.props.widgets,dataSources:this.props.dataSources,messages:this.props.messages,reverseTraverseParentDsMapping:this.reverseTraverseDsMapping,onDsMappingFinished:this.onDsMappingFinished,intl:this.props.intl}):i.React.createElement("div",{className:"w-100 h-100 ds-mapping-ds"},this.props.curDs.isDataSourceSet?i.React.createElement("div",null,i.React.createElement(xe,{curDs:this.props.curDs,newDs:this.props.newDs,hideMapping:this.props.hideMapping,toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,isExternalDsShown:this.props.isExternalDsShown,intl:this.props.intl}),this.getWhetherHaveChildDssToMap()?i.React.createElement("div",null,i.React.createElement("h5",{className:"m-3 data-setting-secondary-title"},this.props.intl.formatMessage({id:"inUse",defaultMessage:f})),Q(this.state.curSchema.childSchemas).map((e,t)=>i.React.createElement(fe,{curDs:this.props.curDs.getChildDataSource(e),selectedNewDs:this.getSelectedNewDs(e),key:t,newParentDs:this.props.newDs,updateMappedSchema:this.updateMappedChildSchema,isDone:W(this.state.curSchema.childSchemas[e],this.state.mappedSchema.childSchemas[e]),widgets:this.props.widgets,intl:this.props.intl}))):i.React.createElement("div",{className:"p-2"},this.props.intl.formatMessage({id:"noChildDssToMap",defaultMessage:S})),i.React.createElement("div",{className:"fixed-bottom ds-mapping-buttons"},i.React.createElement(a.Button,{disabled:1===this.props.mappingHistory.length||!this.props.isMappingReady||this.props.isWarning,type:"secondary",onClick:this.reverseTraverseDsMapping},this.props.intl.formatMessage({id:"previous",defaultMessage:a.defaultMessages.previous})),i.React.createElement(a.Button,{type:"secondary",onClick:this.traverseDsMapping,disabled:!this.state.isChildMappingDone||!this.props.isMappingReady||this.props.isWarning,className:"bg-primary ml-2"},this.getWhetherHaveChildDssToMap()?this.props.intl.formatMessage({id:"next",defaultMessage:a.defaultMessages.next}):this.props.intl.formatMessage({id:"done",defaultMessage:a.defaultMessages.done})))):i.React.createElement("div",{className:"ds-mapping-field-container"},i.React.createElement(Re,{curDs:this.props.curDs,newDs:this.props.newDs,onMappingFinished:this.onFieldMappingFinished,defaultMappedSchema:this.getDefaultMappedFieldSchema(),isExternalDsShown:this.props.isExternalDsShown,hideMapping:this.props.hideMapping,isLast:K(this.props.curDs,this.props.curDs.parentDataSource,this.props.mappingHistory),toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,mappingHistory:this.props.mappingHistory.concat(this.props.curDs),isWarning:this.props.isWarning,backToPreviouseMapping:this.props.reverseTraverseParentDsMapping,intl:this.props.intl,widgets:this.props.widgets,dataSources:this.props.dataSources,messages:this.props.messages})))):i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}))}}class Ie extends i.React.PureComponent{constructor(e){super(e),this.contentStyle={position:"fixed",bottom:"50px",top:"auto",left:"0",right:"auto",width:"280px",height:"90px",backgroundColor:this.props.theme.colors.palette.light[400],borderColor:this.props.theme.colors.danger,borderWidth:"1px",borderStyle:"solid",zIndex:5}}render(){return this.props.warning?Object(i.jsx)(a.Popper,{open:!0,style:this.contentStyle,disablePortal:!0,reference:null},this.props.warning):null}}var ye=i.themeUtils.withTheme(Ie),Ce=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};class Ee extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.createSameDsWithDiffId=e=>Ce(this,void 0,void 0,(function*(){if(!e||!e.id)return yield Promise.reject("Pass a wrong data source");const t=this.getTempDsId(e.id),s=e.set("id",t).without("schema");return this.creatingDsId=t,yield i.DataSourceManager.getInstance().createDataSource(s).then(e=>(this.creatingDsId=null,e))})),this.destoryDs=e=>{e&&e!==this.props.ds.id&&i.DataSourceManager.getInstance().destroyDataSource(e)},this.updateMappingHistory=e=>{this.setState({mappingHistory:e})},this.hideMapping=()=>{this.state.newDs&&this.destoryDs(this.state.newDs.id),this.creatingDsId&&this.destoryDs(this.creatingDsId),this.props.hideMapping()},this.hideExternalDs=()=>{this.setState({isExternalDsShown:!1})},this.getTempDsId=e=>`${e}-${Object(i.uuidv1)()}`,this.toggleExternalDs=e=>{this.setState({isExternalDsShown:e})},this.onSelectExternalDs=e=>{const t=e[0];t?(this.setState({isMappingReady:!1}),this.createSameDsWithDiffId(t).then(e=>{this.__unmount||this.setState({newDs:e,isMappingReady:!0,isWarning:!1})},e=>{this.__unmount||(console.error(e),this.setState({isMappingReady:!0,isWarning:!0}))})):this.setState({isWarning:!0})},this.onRemoveExternalDs=e=>{e[0]||this.setState({isWarning:!0}),this.setState({newDs:null})},this.state={newDs:null,mappedSchema:this.props.ds&&this.props.ds.isDataSourceSet?{childSchemas:{}}:{},mappingHistory:this.props.ds?[this.props.ds]:[],isExternalDsShown:!0,isDone:!1,isMappingReady:!1,isWarning:!1}}componentDidMount(){this.__unmount=!1,this.rootDom&&this.dataSelector&&this.moveDataSelector(),this.props.ds&&this.createSameDsWithDiffId(this.props.ds.getDataSourceJson()).then(e=>{this.__unmount||this.setState({newDs:e,mappedSchema:T(e,e=>(delete e.alias,e)),isMappingReady:!0,isWarning:!1})},e=>{this.__unmount||(console.error(e),this.setState({isMappingReady:!0,isWarning:!0}))})}componentDidUpdate(e,t){this.rootDom&&this.dataSelector&&this.moveDataSelector(),t.newDs!==this.state.newDs&&t.newDs&&this.destoryDs(t.newDs.id),this.state.newDs||this.creatingDsId||!this.props.ds||(this.setState({isMappingReady:!1}),this.createSameDsWithDiffId(this.props.ds.getDataSourceJson()).then(e=>{this.__unmount||this.setState({newDs:e,mappedSchema:T(e,e=>(delete e.alias,e)),isMappingReady:!0,isWarning:!1})},e=>{this.__unmount||(console.error(e),this.setState({isMappingReady:!0,isWarning:!0}))}))}componentWillUnmount(){this.__unmount=!0,this.state.newDs&&this.destoryDs(this.state.newDs.id),this.creatingDsId&&this.destoryDs(this.creatingDsId)}moveDataSelector(){const e=function(e){if(!e)return null;let t=e.offsetLeft,s=e.offsetTop,i=e.offsetParent;for(;null!==i;)t+=i.offsetLeft,s+=i.offsetTop,i=i.offsetParent;return{x:t,y:s}}(this.rootDom);this.dataSelector&&e&&(this.dataSelector.style.left=e.x+this.rootDom.offsetWidth+"px",this.dataSelector.style.top="40px",this.dataSelector.style.bottom="0px",this.dataSelector.style.right="0px")}onMappingFinished(e,t){if(!e||!this.state.newDs)return;let s;e.getDataSourceJson?e.getDataSourceJson&&t&&(s=U(this.props.ds.getDataSourceJson(),this.state.newDs.getDataSourceJson(),t)):s=e,Object(l.getAppConfigAction)().editDataSource(s).exec(),i.DataSourceManager.getInstance().createDataSource(s),this.setState({mappedSchema:s.schema}),this.hideMapping()}render(){return this.props.ds?i.React.createElement("div",{className:"ds-mapping",ref:e=>this.rootDom=e},this.props.ds.isDataSourceSet?i.React.createElement("div",{className:"ds-mapping-ds-container"},i.React.createElement(Me,{curDs:this.props.ds,newDs:this.state.newDs,isRoot:!0,intl:this.props.intl,onMappingFinished:this.onMappingFinished.bind(this),defaultMappedSchema:this.state.mappedSchema,hideMapping:this.hideMapping,toggleExternalDs:this.toggleExternalDs,isWarning:this.state.isWarning,isExternalDsShown:this.state.isExternalDsShown,isMappingReady:this.state.isMappingReady,mappingHistory:this.state.mappingHistory,updateMappingHistory:this.updateMappingHistory,widgets:this.props.widgets,dataSources:this.props.dataSources,messages:this.props.messages})):null,this.props.ds.isDataSourceSet?null:i.React.createElement("div",{className:"ds-mapping-field-container"},i.React.createElement(Re,{curDs:this.props.ds,newDs:this.state.newDs,onMappingFinished:this.onMappingFinished.bind(this),defaultMappedSchema:this.state.mappedSchema,hideMapping:this.hideMapping,isWarning:this.state.isWarning,isMappingReady:this.state.isMappingReady,isExternalDsShown:this.state.isExternalDsShown,isLast:!0,toggleExternalDs:this.toggleExternalDs,mappingHistory:this.state.mappingHistory,intl:this.props.intl,widgets:this.props.widgets,dataSources:this.props.dataSources,messages:this.props.messages})),this.state.isMappingReady?null:i.React.createElement("div",{className:"jimu-secondary-loading"}),this.state.isExternalDsShown?i.React.createElement("div",{className:"ds-mapping-external-data",ref:e=>this.dataSelector=e},i.React.createElement(n.ExternalDataSourceSelector,{portalUrl:this.props.portalUrl,onSelect:this.onSelectExternalDs,onRemove:this.onRemoveExternalDs,onCancel:this.hideExternalDs,isRadio:!0,types:this.props.ds?Object(i.Immutable)([this.props.ds.type]):Object(i.Immutable)([])})):null,this.state.isWarning?i.React.createElement(ye,{warning:this.props.intl.formatMessage({id:"createFailedWarning",defaultMessage:m})}):null):i.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:u}))}}var Oe=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};const Ne=s(24),je=s(51),ke=s(18),Ae=s(12);class Te extends i.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.externalDsStyle={width:"100%",height:"100%",maxWidth:"5000px",margin:0},this.sidePopperTrigger=i.React.createRef(),this.addToDsHistory=e=>{this.setState({dsHistory:this.state.dsHistory.concat(e)})},this.onDsItemClick=e=>{const t=[e],s=0===this.state.dsHistory.length,i=this.state.isSearchInputShown&&!!this.state.searchValue;if(s&&i){let s=e.parentDataSource;for(;s;)t.unshift(s),s=s.parentDataSource}this.addToDsHistory(t),this.resetDefaultActiveTab()},this.onChildDataIconClick=e=>{this.addToDsHistory([e]),this.setState({dsListActiveTab:"layers",fieldListActiveTab:"dataViews"})},this.onRelatedWidgetsIconClick=e=>{this.addToDsHistory([e]),e.isDataSourceSet?this.setState({dsListActiveTab:"widgets",fieldListActiveTab:"dataViews"}):this.setState({dsListActiveTab:"layers",fieldListActiveTab:"widgets"})},this.resetDefaultActiveTab=()=>{this.setState({dsListActiveTab:"layers",fieldListActiveTab:"dataViews"})},this.removeFromDsHistory=e=>{if(this.resetDefaultActiveTab(),!e)return void this.setState({dsHistory:[],detailedItem:null});let t=[];const s=this.state.dsHistory.findIndex(t=>t.id===e.id);this.state.dsHistory.length>0&&(t=this.state.dsHistory.slice(0,s+1)),this.setState({dsHistory:t,detailedItem:null})},this.getSearch=e=>{const t=G(e);if(!t)return null;const s=e.getDataSourceJson().portalUrl;return{q:"id: "+t,authentication:i.SessionManager.getInstance().getSessionByUrl(s)}},this.getDsById=e=>e?i.DataSourceManager.getInstance().getDataSource(e):null,this.getListUsedDs=e=>e?this.state.isDataSourceInited?this.getDsById(e.id):e:null,this.backToHomePage=()=>{this.removeFromDsHistory(null)},this.onNavClicked=e=>{this.removeFromDsHistory(e)},this.onSelectDataFinished=e=>{e?(Object(l.getAppConfigAction)().addDataSources(e).exec(),e.forEach(e=>Oe(this,void 0,void 0,(function*(){return yield i.DataSourceManager.getInstance().createDataSource(e)}))),this.setState({isExternalDsShown:!1,isDataSourceInited:!1})):this.setState({isExternalDsShown:!1})},this.onSelectDataCanceled=()=>{this.setState({isExternalDsShown:!1})},this.onMappingIconClick=e=>{this.setState({mappingDs:e})},this.onShowDetailClick=e=>{const t=this.getSearch(e);t&&(this.setState({isDataSourceInited:!1}),t&&i.esri.restPortal.searchItems(t).then(t=>{this.__unmount||this.setState({detailedItem:{item:t.results[0],portalUrl:e.getDataSourceJson().portalUrl},isDataSourceInited:!0})},e=>{this.__unmount||(console.error(e),this.setState({isDataSourceInited:!0}))}))},this.onCloseDetailClicked=()=>{this.setState({detailedItem:null})},this.toggleMoreOptions=e=>{this.setState({moreOptionsDsId:this.state.moreOptionsDsId===e?null:e})},this.onToggleExternalDs=()=>{this.setState({isExternalDsShown:!this.state.isExternalDsShown})},this.hideMapping=()=>{this.setState({mappingDs:null})},this.showExternalDs=()=>{this.setState({isExternalDsShown:!0})},this.onSearchIconClick=e=>{this.setState({isSearchInputShown:!this.state.isSearchInputShown})},this.onSearchValueChange=e=>{this.setState({searchValue:e.target.value})},this.ExternalDs=Object(i.jsx)(n.ExternalDataSourceSelector,{portalUrl:this.props.portalUrl,onCancel:this.onSelectDataCanceled,onFinish:this.onSelectDataFinished}),this.AddDataSourceBtn=Object(i.jsx)("div",{className:"d-flex mx-3 mb-1 mt-3"},Object(i.jsx)(a.Button,{type:"primary",className:"flex-grow-1 text-center add-data",onClick:this.showExternalDs},Object(i.jsx)("div",{className:"w-100 px-2 text-truncate"},Object(i.jsx)(a.Icon,{icon:je,size:12,className:"add-data-icon"}),this.props.intl.formatMessage({id:"addData",defaultMessage:a.defaultMessages.addData})))),this.getValidDsJsons=()=>{let e=[];if(!this.props.dataSources)return e;const t=i.dataSourceUtils.getSortedArrayByLabel(Object.keys(this.props.dataSources).map(e=>this.getDsById(e)).filter(e=>e&&!e.getDataSourceJson().isOutputFromWidget&&!e.parentDataSource));return e=this.state.isSearchInputShown&&this.state.searchValue?function e(t,s){let i=[];return(null==t?void 0:t.length)>0&&t.forEach(t=>{n.dataComponentsUtils.isFuzzySearch(null==t?void 0:t.getLabel(),s)&&(i=i.concat(t)),(null==t?void 0:t.isDataSourceSet)&&(i=i.concat(e(t.getChildDataSources(),s)))}),i}(t,this.state.searchValue):t.map(e=>e.getDataSourceJson()).concat(Object.values(this.props.dataSources).filter(e=>!this.getDsById(null==e?void 0:e.id)&&!(null==e?void 0:e.isOutputFromWidget))),e},this.state={isDataSourceInited:n.dataComponentsUtils.getWhetherDataSourceIsInited(this.props.dataSources,this.props.dataSourcesInfo),isExternalDsShown:!1,isSearchInputShown:!1,mappingDs:null,detailedItem:null,dsHistory:[],moreOptionsDsId:null,searchValue:"",dsListActiveTab:"layers",fieldListActiveTab:"dataViews"}}componentDidMount(){this.__unmount=!1}componentDidUpdate(e,t){i.lodash.isDeepEqual(this.props.dataSources,e.dataSources)&&i.lodash.isDeepEqual(this.props.dataSourcesInfo,e.dataSourcesInfo)||this.setState({isDataSourceInited:n.dataComponentsUtils.getWhetherDataSourceIsInited(this.props.dataSources,this.props.dataSourcesInfo),moreOptionsDsId:null}),t.isSearchInputShown!==this.state.isSearchInputShown&&this.state.isSearchInputShown&&this.searchInput&&(this.searchInput.focus(),this.searchInput.select())}componentWillUnmount(){this.__unmount=!0}render(){var e,t,s,n,l,c,p,m,u;const g=this.getValidDsJsons();return Object(i.jsx)("div",{css:(S=this.props.theme,i.css`
    .widget-ds-setting{
      width: 100%;
      height: 100%;
      background-color: ${S.colors.palette.light[200]};
      transform: translate(0, 0);

      .cursor-default{
        cursor: default;
      }

      .tab-scroll{
        height: 100%;
        overflow: auto;
        position: relative;
      }

      .tab-scroll-with-bottom-fix{
        height: calc(100% - 50px);
        overflow: auto;
      }

      .w-85{
        width: 85%;
      }

      .font-size-13{
        font-size: ${i.polished.rem(13)};
      }

      .highlight-refresh-icon{
        svg{
          color: ${S.colors.palette.primary[700]};
        }
      }

      .refresh-last-update-label{
        font-size: ${i.polished.rem(13)};
        color: ${S.colors.palette.dark[600]};
      }

      .data-view-item{
        width: ${i.polished.rem(228)};
        height: ${i.polished.rem(32)};
        background-color: ${S.colors.palette.light[500]};
        font-size: ${i.polished.rem(13)};
      }

      .create-a-view-btn{
        width: ${i.polished.rem(228)};
        height: ${i.polished.rem(32)};
        position: sticky;
      }

      .data-view-container{
        overflow: auto;
        height: calc(100% - 65px);
      }

      .no-selection-view-item{
        width: ${i.polished.rem(260)};
        height: ${i.polished.rem(40)};
        border-top: 1px solid ${S.colors.palette.light[800]};
        position: fixed;
        bottom: 0;
      }

      .empty-placeholder{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        .empty-placeholder-text, .empty-placeholder-icon{
          display: table;
          margin: 0 auto;
        }
        .empty-placeholder-text{
          color: ${S.colors.palette.dark[400]};
          font-size: ${i.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon{
          color: ${S.colors.palette.secondary[800]};
        }
      }

      .title{
        padding: 18px 16px 2px 16px !important;
        font-size: 1rem;
        font-weight: 500;
        .search-icon{
          cursor: pointer;
          width: 30px;
        }
      }
      .search-input{
        height: 26px;
        border-radius: 2px;
      }

      .list-container{
        height: calc(100% - 80px);
        overflow: auto;
        padding-bottom: 20px;
      }

      .with-search-input.list-container{
        height: calc(100% - 120px);
      }

      .text-data-600{
        color: ${S.colors.palette.dark[600]};
      }

      .border-color-gray-300{
        border-color: ${S.colors.palette.light[500]} !important;
      }

      .data-setting-secondary-title{
        font-size: 14px;
        color: ${S.colors.palette.dark[400]};
        margin-top: 16px !important;
        margin-bottom: 16px !important;
        font-weight: 400;
      }

      .widget-icon{
        >img{
          vertical-align: text-top;
          width: ${i.polished.rem(16)};
          height: ${i.polished.rem(16)};
        }
      }

      .drop-down{
        button{
          background-color: ${S.colors.white};
        }
      }

      .setting-header{
        border-bottom: 1px;
      }

      .ds-nav{
        .max-width-1{
          max-width: ${i.polished.rem(200)};
        }
        .max-width-2{
          max-width: ${i.polished.rem(90)};
        }
        .max-width-3{
          max-width: ${i.polished.rem(58)};
        }
        a, .current-ds-link{
          font-size: ${i.polished.rem(12)} !important;
          padding: 0 !important;
          svg{
            margin: 0 0 5px 0 !important;
          }
        }
        .current-ds-link{
          color: ${S.colors.palette.dark[800]};
        }
      }

      .add-data{
        height: ${i.polished.rem(30)};
        line-height: ${i.polished.rem(30)};
        width: 228px;
        padding: 0;
        border-radius: 2px;
        cursor: pointer;
        .add-data-icon{
          vertical-align: baseline;
        }
      }
      button.add-data:hover{
        color: ${S.colors.black} !important;
      }

      .two-line-truncate{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        word-break: break-word;
        word-wrap: break-word;
      }

      .three-line-truncate{
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        word-break: break-word;
        word-wrap: break-word;
      }

      .ds-info{
        .ds-more, .ds-detail{
          cursor: pointer;
        }
        .ds-more{
          margin-right: ${i.polished.rem(-8)};
        }
      }

      .ds-origin-label{
        max-width: 100%;
        .ds-origin-label-link, .ds-origin-label-link:hover, .ds-origin-label-link:focus, .ds-origin-label-link:active{
          color: ${S.colors.palette.primary[700]};
          outline: none;
          box-shadow: 0 0 0 !important;
          border: 0 !important;
        }
        .ds-origin-label-link-text{
          display: inline-block;
          font-size: ${i.polished.rem(12)};
          max-width: 100%;
          text-decoration: underline;
        }
      }

      .mapping-info{
        .ds-label{
          cursor: default;
        }
      }

      .ds-mapping-collapse{
        padding: ${i.polished.rem(10)} ${i.polished.rem(10)} 0  ${i.polished.rem(10)};
        .ds-origin-label{
          max-width: 170px;
          height:  ${i.polished.rem(25)};
          line-height:  ${i.polished.rem(25)};
          border-radius: 2px;
        }
      }

      .ds-thumbnail{
        width:  ${i.polished.rem(18)};
        height:  ${i.polished.rem(18)};
        background-color: ${S.colors.palette.info[400]};
      }

      .mapping-info{
        .ds-mapping-collapse{
          border: 0;
        }
      }

      .ds-list{
        .jimu-tab{
          height: calc(100% - 120px);
          .tab-content{
            height: calc(100% - 50px);
          }
          .jimu-nav.nav-pills{
            margin: 0 ${i.polished.rem(16)} !important;
          }
        }
      }

      .field-list{
        .jimu-tab{
          height: calc(100% - 200px);
          .tab-content{
            height: calc(100% - 50px);
          }
          .jimu-nav.nav-pills{
            margin: 0 ${i.polished.rem(16)} !important;
          }
        }
      }

      .field-list, .ds-list{
        height: calc(100% - 60px);

        .ds-info{
          width: 100%;
          .ds-thumbnail-type{
            width: calc(100% - ${i.polished.rem(35)});
          }
          .ds-label{
            font-size: ${i.polished.rem(14)};
            color: ${S.colors.palette.dark[800]};
          }
          .ds-type{
            font-size: ${i.polished.rem(13)};
            color: ${S.colors.palette.dark[600]};
          }
        }
        .tab-pane{
          width: 100%;
        }
      }

      .field-item{
        font-size: ${i.polished.rem(13)};
        color: ${S.colors.dark};
      }

      .ds-mapping{
        .ds-mapping-header{
          height:  ${i.polished.rem(42)};
          line-height:  ${i.polished.rem(42)};
          border-bottom: 1px solid;
          .ds-mapping-header-back{
            cursor: pointer;
          }
        }

        .ds-mapping-cur-info{
          border-bottom: 1px solid;
        }

        .ds-mapping-external-data{
          position: fixed;
          z-index: 4;
        }

        .ds-mapping-set-item{
          .ds-mapping-drop-down{
            .btn-group{
              width: 100%;
              button{
                width: 100%;
              }
            }
          }
        }

        .ds-mapping-buttons{
          left:  ${i.polished.rem(65)};
          bottom:  ${i.polished.rem(10)};
        }

        .ds-mapping-source{
          width:  ${i.polished.rem(20)};
          height:  ${i.polished.rem(20)};
          border-radius:  ${i.polished.rem(10)};
          line-height:  ${i.polished.rem(20)};
          text-align: center;
          cursor: pointer;
        }

        .ds-mapping-ds{
          .ds-origin-label{
            max-width: 100%;
          }
        }

      }
    }

    .widget-ds-setting-add-data-popup{
      .modal-content{
        height: 100%;
      }
    }

  `),className:"w-100 h-100"},Object(i.jsx)("div",{className:"jimu-widget widget-ds-setting setting-pane bg-light-300",ref:this.sidePopperTrigger},this.state.mappingDs?Object(i.jsx)(Ee,{portalUrl:this.props.portalUrl,ds:this.state.mappingDs,widgets:this.props.widgets,dispatch:this.props.dispatch,hideMapping:this.hideMapping,intl:this.props.intl,dataSources:this.props.dataSources,messages:this.props.messages}):Object(i.jsx)("div",{className:"h-100"},this.state.dsHistory.length>0?Object(i.jsx)("div",{className:"d-flex flex-wrap p-3 ds-nav"},Object(i.jsx)(a.Link,{title:this.props.intl.formatMessage({id:"home",defaultMessage:a.defaultMessages.home}),onClick:this.backToHomePage},Object(i.jsx)(a.Icon,{icon:Ne,size:12})),this.state.dsHistory.map((e,t)=>t===this.state.dsHistory.length-1?Object(i.jsx)("div",{className:"d-flex align-items-center",key:t},Object(i.jsx)("span",{className:"mx-1"},"/"),Object(i.jsx)("div",{title:e.getLabel(),className:Object(i.classNames)("current-ds-link text-left text-truncate",{"max-width-1":1===this.state.dsHistory.length,"max-width-3":this.state.dsHistory.length>1&&this.state.dsHistory.length%2!=0,"max-width-2":this.state.dsHistory.length>1&&this.state.dsHistory.length%2==0})},e.getLabel())):Object(i.jsx)("div",{className:"d-flex align-items-center",key:t},Object(i.jsx)("span",{className:"mx-1"},"/"),Object(i.jsx)(a.Link,{title:e.getLabel(),onClick:()=>this.onNavClicked(e),className:Object(i.classNames)("text-left text-truncate",{"max-width-1":1===this.state.dsHistory.length,"max-width-3":this.state.dsHistory.length>1&&this.state.dsHistory.length%2!=0,"max-width-2":this.state.dsHistory.length>1&&this.state.dsHistory.length%2==0})},e.getLabel())))):null,0===this.state.dsHistory.length?Object(i.jsx)("div",{className:"h-100"},Object(i.jsx)("div",{className:"jimu-builder-panel--header d-flex flex-row text-data-600 title justify-content-between"},Object(i.jsx)("div",{className:"mb-0 w-100 text-truncate text-left"},this.props.intl.formatMessage({id:"data",defaultMessage:a.defaultMessages.data})),Object(i.jsx)("div",{className:"search-icon d-flex align-items-start justify-content-end",onClick:this.onSearchIconClick,title:this.props.intl.formatMessage({id:"search",defaultMessage:i.defaultMessages.search})},Object(i.jsx)(a.Button,{size:"sm",icon:!0,type:"tertiary"},Object(i.jsx)(a.Icon,{icon:Ae,size:16})))),Object(i.jsx)("div",{className:"w-100 px-3"},this.state.isSearchInputShown&&Object(i.jsx)(a.TextInput,{value:this.state.searchValue,onChange:this.onSearchValueChange,className:"search-input my-3",placeholder:this.props.intl.formatMessage({id:"search",defaultMessage:i.defaultMessages.search}),ref:e=>this.searchInput=e})),Object(i.jsx)("div",{className:"w-100"},this.AddDataSourceBtn),this.props.dataSources&&Object.keys(this.props.dataSources).length>0?Object(i.jsx)("div",{className:Object(i.classNames)("list-container",{"with-search-input":this.state.isSearchInputShown})},Object(i.jsx)("div",null,g.map((e,t)=>{const s=this.getDsById(null==e?void 0:e.id);return(null==e?void 0:e.id)?s&&s.id?Object(i.jsx)(h,{ds:s,key:t,onDataSourceItemClick:this.onDsItemClick,intl:this.props.intl,widgets:this.props.widgets,onMappingIconClick:this.onMappingIconClick,isMoreOptionsShown:this.state.moreOptionsDsId===s.id,onChildDataIconClick:this.onChildDataIconClick,onRelatedWidgetsIconClick:this.onRelatedWidgetsIconClick,toggleMoreOptions:this.toggleMoreOptions,isDataSourceInited:this.state.isDataSourceInited,theme:this.props.theme}):Object(i.jsx)(d,{dsJson:e,key:t,intl:this.props.intl,widgets:this.props.widgets,isMoreOptionsShown:this.state.moreOptionsDsId===e.id,theme:this.props.theme,isMoreIconShown:!0,isDataSourceInited:this.state.isDataSourceInited,toggleMoreOptions:this.toggleMoreOptions,isErrorIconShown:!0}):null}))):Object(i.jsx)("div",null,(null===(t=null===(e=Object(i.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)&&Object(i.jsx)("div",{className:"empty-placeholder w-100"},Object(i.jsx)("div",{className:"empty-placeholder-icon"},Object(i.jsx)(a.Icon,{icon:ke,width:80,height:71})),Object(i.jsx)("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:this.props.intl.formatMessage({id:"noDataNotice",defaultMessage:b})}})))):null,this.props.dataSources&&this.state.dsHistory.length>0&&!this.state.dsHistory[this.state.dsHistory.length-1].isDataSourceSet?Object(i.jsx)(me,{onShowDetailClick:this.onShowDetailClick,isDataSourceInited:this.state.isDataSourceInited,backToHomePage:this.backToHomePage,ds:this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]),widgets:this.props.widgets,onMappingIconClick:this.onMappingIconClick,intl:this.props.intl,theme:this.props.theme,defaultActive:this.state.fieldListActiveTab,dsInfo:null===(s=this.props.dataSourcesInfo)||void 0===s?void 0:s[null===(n=this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]))||void 0===n?void 0:n.id]}):null,this.props.dataSources&&this.state.dsHistory.length>0&&this.state.dsHistory[this.state.dsHistory.length-1].isDataSourceSet?Object(i.jsx)(oe,{onDsItemClicked:this.onDsItemClick,dispatch:this.props.dispatch,ds:this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]),theme:this.props.theme,onMappingIconClick:this.onMappingIconClick,isDataSourceInited:this.state.isDataSourceInited,onShowDetailClick:this.onShowDetailClick,intl:this.props.intl,widgets:this.props.widgets,backToHomePage:this.backToHomePage,onChildDataIconClick:this.onChildDataIconClick,onRelatedWidgetsIconClick:this.onRelatedWidgetsIconClick,defaultActive:this.state.dsListActiveTab,dsInfo:null===(l=this.props.dataSourcesInfo)||void 0===l?void 0:l[null===(c=this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]))||void 0===c?void 0:c.id]}):null),this.state.isDataSourceInited?null:Object(i.jsx)(a.Loading,{type:a.LoadingType.Secondary})),Object(i.jsx)(o.SidePopper,{position:"left",isOpen:!!this.state.detailedItem,toggle:this.onCloseDetailClicked,trigger:null===(p=this.sidePopperTrigger)||void 0===p?void 0:p.current},Object(i.jsx)(r.ItemDetail,{item:null===(m=this.state.detailedItem)||void 0===m?void 0:m.item,portalUrl:null===(u=this.state.detailedItem)||void 0===u?void 0:u.portalUrl,onClose:this.onCloseDetailClicked})),this.state.isExternalDsShown?Object(i.jsx)(a.Modal,{isOpen:this.state.isExternalDsShown,style:this.externalDsStyle,toggle:this.onToggleExternalDs,contentClassName:"border-0 h-100",className:"widget-ds-setting-add-data-popup"},this.ExternalDs):null);var S}}Te.mapExtraStateProps=e=>{var t,s,i,a,o,n,r;return{dataSources:null===(s=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===s?void 0:s.dataSources,widgets:null===(a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===a?void 0:a.widgets,messages:null===(n=null===(o=e.appStateInBuilder)||void 0===o?void 0:o.appConfig)||void 0===n?void 0:n.messageConfigs,dataSourcesInfo:null===(r=e.appStateInBuilder)||void 0===r?void 0:r.dataSourcesInfo}}},12:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7 1a6 6 0 100 12A6 6 0 007 1zm0 13a7 7 0 115.621-2.828l-.222.284 3.405 3.404a.668.668 0 01-.944.944L11.456 12.4A6.974 6.974 0 017 14z" fill="#000" fill-rule="evenodd"></path></svg>'},14:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M9.5 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zm-4.75 0a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0zM0 6.25a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0z" fill="#000"></path><path d="M0 0h12v12H0z"></path></g></svg>'},15:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 3.5a1 1 0 11-2 0 1 1 0 012 0zM5 5.5a.5.5 0 000 1h.5v2H5a.5.5 0 000 1h2a.5.5 0 000-1h-.5v-3H5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6A6 6 0 110 6a6 6 0 0112 0zm-1 0A5 5 0 111 6a5 5 0 0110 0z" fill="#000"></path></svg>'},18:function(e,t){e.exports='<svg viewBox="0 0 80 71" xmlns="http://www.w3.org/2000/svg"><path d="M63.86 24a4 4 0 013.327 1.781l12.141 18.211a4 4 0 01.672 2.22V67a4 4 0 01-4 4H4a4 4 0 01-4-4V46.211a4 4 0 01.672-2.219l12.14-18.21A4 4 0 0116.142 24h47.718zm0 4H16.14L4.808 44.999H29a2 2 0 012 2V47c0 .687.077 1.357.223 2l-27.224-.001L4 67h72l-.001-18.001H48.777A9.03 9.03 0 0049 47a2 2 0 012-2.001h23.585L63.859 28zM31.222 49a9.003 9.003 0 0017.554 0h4.07C51.885 55.23 46.499 60 40 60c-6.5 0-11.885-4.77-12.847-11h4.07zm36.42-42.128a2.5 2.5 0 01.307 3.522l-7.07 8.426a2.5 2.5 0 01-3.83-3.214l7.07-8.426a2.5 2.5 0 013.522-.308zM15.88 7.18l7.07 8.426a2.5 2.5 0 01-3.83 3.214l-7.07-8.426a2.5 2.5 0 013.83-3.214zM40 0a2.5 2.5 0 012.5 2.5v14a2.5 2.5 0 11-5 0v-14A2.5 2.5 0 0140 0z" fill="#6A6A6A" fill-rule="evenodd"></path></svg>'},19:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M7.185 0c.105 0 .195.118.232.24l.013.062.245 1.567c.294.145.588.29.85.465l.19.138 1.53-.603c.154-.05.264-.016.332.031l.036.03 1.224 2.11c.051.1.06.201-.01.302l-.05.06-1.286 1.025c.061.181.061.362.061.603 0 .181-.034.328-.052.467l-.01.136 1.409.965c.105.052.12.192.083.307l-.022.055-1.224 2.11c-.053.104-.195.163-.312.14l-.056-.019-1.53-.603a4.796 4.796 0 01-.82.494l-.22.109-.245 1.568c0 .103-.135.207-.25.234L7.246 12H4.798c-.157 0-.27-.089-.298-.19l-.253-1.619c-.293-.145-.587-.29-.85-.465l-.19-.138-1.53.603c-.153.05-.264.017-.332-.03l-.036-.03L.085 8.02c-.05-.101-.06-.202.01-.302l.051-.06 1.286-1.026c-.061-.18-.061-.362-.061-.603 0-.18.034-.328.051-.466l.01-.137-1.286-.965c-.104-.103-.164-.25-.14-.329L1.247 1.99c.102-.1.204-.16.342-.141l.087.02 1.469.603.419-.281c.135-.09.268-.17.407-.236l.214-.086.245-1.628c0-.103.135-.207.25-.234L4.738 0h2.448zm-.658 1h-1.2l-.243 1.627-.586.192a1.42 1.42 0 00-.3.154l-.503.335-.441.29-1.439-.593-.59 1.017 1.207.905v.5c0 .088-.003.147-.013.228l-.044.31a.577.577 0 00-.004.065l.005.26.005.027.223.66L1.258 8.05l.581 1.001 1.536-.604.45.356c.162.126.334.226.712.416l.618.304.23 1.476h1.274l.23-1.476.751-.371c.206-.106.342-.182.453-.258l.126-.091.451-.356 1.506.595.587-1.01-1.272-.872v-.607l.009-.117.048-.341.003-.035v-.18l-.003-.098-.004-.034-.225-.665 1.345-1.073-.581-1.002-1.535.605-.451-.355-.126-.092a5.312 5.312 0 00-.59-.326l-.614-.303L6.527 1zM6 3.75a2.25 2.25 0 110 4.5 2.25 2.25 0 010-4.5zm0 1a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5z" fill="#000" fill-rule="nonzero"></path></svg>'},2:function(e,t){e.exports=i},24:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M2 5.055V11h2V8a1 1 0 011-1h2a1 1 0 011 1v3h2V4.969L6.043 1 2 5.055zM1 6.058l-.149.15a.497.497 0 01-.705 0 .501.501 0 010-.708L5.338.293a.995.995 0 011.41 0l5.106 5.121a.501.501 0 010 .707.497.497 0 01-.705 0L11 5.971V11a1 1 0 01-1 1H2a1 1 0 01-1-1V6.058zM5 11h2V8H5v3z" fill="#000" fill-rule="nonzero"></path></svg>'},3:function(e,t){e.exports=a},37:function(e,t){e.exports=n},45:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M13.444 3.582A7.011 7.011 0 008 1 7.014 7.014 0 001.05 7.03c-.017.122-.031.281-.044.477A.525.525 0 01.481 8 .48.48 0 010 7.492c.01-.195.024-.354.039-.476C.526 3.062 3.904 0 8 0c2.482 0 4.7 1.124 6.172 2.89l.19-1.356a.502.502 0 01.994.138l-.441 3.126-3.03-.425a.5.5 0 01.14-.99l1.419.199zM1.936 13.236l-.163 1.322a.502.502 0 01-.996-.121l.387-3.133 3.036.371a.5.5 0 01-.122.993l-1.463-.179A7.01 7.01 0 008 15a7.014 7.014 0 006.947-6c.019-.128.034-.297.048-.507A.526.526 0 0115.519 8a.48.48 0 01.48.507 7.579 7.579 0 01-.042.505C15.458 12.952 12.087 16 8 16a8.01 8.01 0 01-6.064-2.764z" fill="#000" fill-rule="nonzero"></path></svg>'},46:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 5.5v-5a.5.5 0 011 0v5h5a.5.5 0 010 1h-5v5a.5.5 0 01-1 0v-5h-5a.5.5 0 010-1h5z" fill="#000" fill-rule="nonzero"></path></svg>'},47:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 32"><path d="M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 11.001 3.999 2 2 0 01-.001-3.999zm0-2.666a2 2 0 01-2-2v-8a2 2 0 114 0v8a2 2 0 01-2 2z"></path></svg>'},48:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 32"><path d="M11.742 1.623a3.228 3.228 0 001.204 4.384A3.21 3.21 0 0016.15.443a3.204 3.204 0 00-4.408 1.18zm16.86 22.929a3.204 3.204 0 00-4.32-4.435 3.204 3.204 0 00-1.532 3.591 3.179 3.179 0 001.493 1.951 3.204 3.204 0 004.36-1.108zm-3.95-7.081a5.47 5.47 0 012.409 0V9.065l-7.226-4.143a5.366 5.366 0 01-1.204 2.095l6.021 3.444v7.009zM.446 21.301a3.204 3.204 0 001.181 4.384 3.204 3.204 0 004.384-1.181 3.204 3.204 0 00-2.77-4.818A3.227 3.227 0 00.447 21.3zm4.07-3.806v-7.033l5.901-3.468a5.594 5.594 0 01-1.204-2.071L2.108 9.066v8.43a5.5 5.5 0 012.409 0zm15.945 7.033l-5.925 3.42-5.925-3.42c-.119.428-.289.84-.506 1.228a5.69 5.69 0 01-.626.891l7.081 4.095 7.105-4.095a5.604 5.604 0 01-1.204-2.12z"></path></svg>'},49:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39 32"><path d="M38.784 9.778v2.962H3.236V9.778h.074L13.086.002l2.111 2.111-7.702 7.665h31.29zM3.236 21.628h31.327l-7.702 7.702 2.111 2.111 9.776-9.813h.037v-2.962H3.237v2.962z"></path></svg>'},5:function(e,t){e.exports=o},50:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 32"><path d="M18.568 27.566c.873.913.873 2.392 0 3.305s-2.288.913-3.16 0L2.766 17.652a2.413 2.413 0 010-3.305L15.408 1.128c.873-.913 2.288-.913 3.16 0s.873 2.392 0 3.305L7.507 15.999l11.061 11.566z"></path></svg>'},51:function(e,t){e.exports='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 4.5h4a.5.5 0 010 1h-4v4a.5.5 0 01-1 0v-4h-4a.5.5 0 010-1h4v-4a.5.5 0 011 0v4z" fill="#000" fill-rule="nonzero"></path></svg>'}}))}}}));