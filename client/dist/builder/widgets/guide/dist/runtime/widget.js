System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime","jimu-for-builder/service","jimu-ui/basic/guide"],(function(e){var t,i,u,s,d;return{setters:[function(e){t=e},function(e){i=e},function(e){u=e},function(e){s=e},function(e){d=e}],execute:function(){e(function(e){var t={};function i(u){if(t[u])return t[u].exports;var s=t[u]={i:u,l:!1,exports:{}};return e[u].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,u){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:u})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(u,s,function(t){return e[t]}.bind(null,s));return u},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=71)}({0:function(e,i){e.exports=t},10:function(e,t){e.exports=d},2:function(e,t){e.exports=i},4:function(e,t){e.exports=u},71:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var u=i(0),s=i(10),d=i(8),n=i(4),r=i(2);class o extends u.React.PureComponent{constructor(e){super(e),this.handleChange=({status:e,index:t,isInjected:i,step:u})=>{if(e===s.STATUS.FINISHED||e===s.STATUS.SKIPPED||e===s.STATUS.ERROR){if(e===s.STATUS.FINISHED&&i)return this.setState({guideModule:this._masterGuide.guideModule,stepIndex:this._masterGuide.stepIndex+1,run:!0}),void this.reset();e!==s.STATUS.SKIPPED&&e!==s.STATUS.FINISHED||!s.COMMON_GUIDE_MODULES.includes(this.state.activeGuide)&&d.userServices.updateUserResource({showGuides:{[this.state.activeGuide]:!1}}),this.reset(!0),this.props.dispatch(r.builderActions.stopGuide())}else e===s.STATUS.INJECTED&&(this._masterGuide.guideModule||(this._masterGuide=this._masterGuide.set("guideModule",this.state.guideModule)),this._masterGuide=this._masterGuide.set("stepIndex",t),this.props.dispatch(r.builderActions.startGuide(u.injectedGuide)),this.setState({widgetName:u.widgetName}))},this.state={stepIndex:0,run:!1,guideModule:null,widgetName:null,activeGuide:null},this.guideManager=r.GuideManager.getInstance(),this.reset()}componentDidUpdate(e){var t,i,u,s;(null==e?void 0:e.activeGuide)!==(null===(t=this.props)||void 0===t?void 0:t.activeGuide)&&(null===(i=this.props)||void 0===i?void 0:i.activeGuide)?this.guideManager.getGuideModule(this.props.activeGuide).then(e=>{this.setState({guideModule:e,run:!0,stepIndex:0,activeGuide:this.props.activeGuide})}):e.totalWidgetCount<this.props.totalWidgetCount&&(null===(u=e.selectedWidget)||void 0===u?void 0:u.uri)!==(null===(s=this.props.selectedWidget)||void 0===s?void 0:s.uri)&&this.props.selectedWidget&&(this._addedWidget=this.props.selectedWidget)}componentDidMount(){d.userServices.initUserResource().then(e=>{(null==e?void 0:e.success)&&d.userServices.getUserResource().then(e=>{var t;void 0===(null===(t=null==e?void 0:e.showGuides)||void 0===t?void 0:t["opening-tour"])&&this.props.dispatch(r.builderActions.startGuide("opening-tour"))})})}reset(e=!1){e&&(this.setState({run:!1,stepIndex:0,guideModule:null,widgetName:null,activeGuide:null}),this._addedWidget=null),this._masterGuide=Object(u.Immutable)({guideModule:null,stepIndex:0})}render(){const{isAppBusy:e}=this.props,{stepIndex:t,run:i}=this.state,s=this.state.guideModule;return!e&&i?Object(u.jsx)("div",{className:"widget-guide"},s&&Object(u.jsx)(s,{run:i,stepIndex:t,widgetName:this.state.widgetName,widgetJson:this._addedWidget,onStepChange:this.handleChange})):""}}o.defaultProps={totalWidgetCount:0},o.mapExtraStateProps=(e,t)=>{var i,s,d,r;const o=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig,l=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appRuntimeInfo.selection;let a;if(l){const e=n.searchUtils.findLayoutItem(o,l);e&&e.type===u.LayoutItemType.Widget&&e.widgetId&&(a=o.widgets[e.widgetId])}return{activeGuide:null===(d=null==e?void 0:e.builder)||void 0===d?void 0:d.currentGuideId,isAppBusy:!(null===(r=null==e?void 0:e.appStateInBuilder)||void 0===r?void 0:r.appRuntimeInfo.currentPageId),selectedWidget:a,totalWidgetCount:(null==o?void 0:o.widgets)?Object.keys(o.widgets).length:0}}},8:function(e,t){e.exports=s}}))}}}));