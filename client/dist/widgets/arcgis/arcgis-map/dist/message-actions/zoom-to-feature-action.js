System.register(["jimu-core","jimu-arcgis"],(function(e){var t,r;return{setters:[function(e){t=e},function(e){r=e}],execute:function(){e(function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=198)}({0:function(e,r){e.exports=t},198:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));var n=r(0),o=r(4),i=r(35);class a extends n.AbstractMessageAction{constructor(){super(...arguments),this.NoLockTriggerLayerWidgets=["Map"]}filterMessageType(e,t){return e===n.MessageType.DataRecordSetChange||e===n.MessageType.DataRecordsSelectionChange||e===n.MessageType.ExtentChange}filterMessage(e){return!0}getSettingComponentUri(e,t){return e===n.MessageType.DataRecordsSelectionChange?"message-actions/zoom-to-feature-action-setting":null}onExecute(e,t){return Object(o.loadArcGISJSAPIModules)(["esri/Graphic"]).then(r=>{let o=null;switch([o]=r,e.type){case n.MessageType.DataRecordSetChange:const r=e;if(r.changeType===n.RecordSetChangeType.Create||r.changeType===n.RecordSetChangeType.Update){let e={};if(r.dataRecordSet&&r.dataRecordSet.records){const t=[];for(let e=0;e<r.dataRecordSet.records.length;e++)r.dataRecordSet.records[e].feature&&t.push(Object(i.f)(r.dataRecordSet.records[e].feature,o));e={features:t,type:"zoom-to-graphics"}}n.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",e)}break;case n.MessageType.DataRecordsSelectionChange:const a=Object(n.getAppStore)().getState().appConfig.widgets[e.widgetId].manifest.label;if(t){const r=e;let s={};const u=[];let l=null;if(r.records){if(r.records[0]&&(r.records[0].dataSource.layer&&(l=r.records[0].dataSource.layer.id),this.NoLockTriggerLayerWidgets.includes(a)&&(!t.useDataSource||r.records[0].dataSource.getMainDataSource().id!==t.useDataSource.mainDataSourceId)))break;for(let e=0;e<r.records.length;e++)r.records[e].feature&&u.push(Object(i.f)(r.records[e].feature,o))}s={features:u,layerId:l,zoomToOption:t&&t.isUseCustomZoomToOption&&t.zoomToOption.scale?t.zoomToOption:null,type:"zoom-to-graphics"},n.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",s);break}{const r=e;let s={};const u=[];let l=null;if(r.records){if(r.records[0]&&(r.records[0].dataSource.layer&&(l=r.records[0].dataSource.layer.id),this.NoLockTriggerLayerWidgets.includes(a)&&(!t.useDataSource||r.records[0].dataSource.getMainDataSource().id!==t.useDataSource.mainDataSourceId)))break;for(let e=0;e<r.records.length;e++)r.records[e].feature&&u.push(Object(i.f)(r.records[e].feature,o))}s={features:u,layerId:l,zoomToOption:null,type:"zoom-to-graphics"},n.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",s);break}case n.MessageType.ExtentChange:const s=e;if(s.getRelatedWidgetIds().includes(this.widgetId))break;const u={value:{features:[s.extent],type:"zoom-to-extent"},relatedWidgets:s.getRelatedWidgetIds()};n.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue",u)}return!0})}}},35:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"l",(function(){return s})),r.d(t,"k",(function(){return c})),r.d(t,"g",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return v})),r.d(t,"f",(function(){return M})),r.d(t,"i",(function(){return x})),r.d(t,"h",(function(){return I})),r.d(t,"a",(function(){return T})),r.d(t,"e",(function(){return j})),r.d(t,"j",(function(){return V}));var n=r(0),o=r(4),i=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};function a(e,t){return i(this,void 0,void 0,(function*(){const r=[];return t&&Object.keys(t).forEach(n=>{e.map.layers.find(e=>e.id===n)?console.warn("the feature layer is already created"):r.push(u(e,t[n],n))}),0===r.length?null:Promise.all(r)}))}function s(e,t){return i(this,void 0,void 0,(function*(){const r=[];return t&&Object.keys(t).forEach(n=>{const o=e.map.layers.find(e=>e.id===n);o&&(e.map.remove(o),r.push(u(e,t[n],n)))}),0===r.length?null:Promise.all(r)}))}function u(e,t,r){return i(this,void 0,void 0,(function*(){return yield new Promise((n,i)=>Object(o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then(o=>{if(t.features.length<1)return n(null);{let i;[i]=o;const a=t.features[0].layer,s=[],u={};for(let e=0;e<a.fields.length;e++){const t=l(a.fields[e]);u[a.fields[e].name]=t.name,s.push(t)}const c=[];for(const e in t.features[0].attributes)if(u[e]){const t={fieldName:u[e],label:e};c.push(t)}const d=[];t.features.forEach((e,t)=>{const r=e;if(r.attributes){for(const e in r.attributes)r.attributes[u[e]]=r.attributes[e];r.attributes.exbfid=t}else r.attributes={exbfid:t};d.push(r)});const f=new i({id:r,title:a.title,source:d,fields:s,outFields:["*"],objectIdField:"exbfid",renderer:a.renderer,popupEnabled:!0,popupTemplate:{title:"information",content:[{type:"fields",fieldInfos:c}]}});e.map.add(f),f.on("layerview-create",e=>n(null))}}))}))}function l(e){return{name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}}function c(e,t,r){let n=r,o=null,i=null;if(n||(i=t instanceof Array?t[0]:t,i&&(n=i.layer&&i.layer.id)),n){const r=e.allLayerViews;for(let e=0;e<r.length;e++)r.getItemAt(e).layer.id===n&&(o=r.getItemAt(e));return o?{layerId:n,handle:o.highlight(t)}:null}}function d(e,t){return i(this,void 0,void 0,(function*(){const r=t,n=e;if(r instanceof Array){if(0===r.length)return yield Promise.resolve();if(r[0].geometry){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].geometry);return yield f(e).then(e=>n.goTo(e.center))}return f(r).then(e=>n.goTo(e.center))}if(r.geometry){const e=r.geometry;return n.goTo(w(e))}return n.goTo(w(r))}))}function f(e){return i(this,void 0,void 0,(function*(){return yield Object(o.loadArcGISJSAPIModules)(["esri/geometry/Extent"]).then(t=>i(this,void 0,void 0,(function*(){let r;if([r]=t,!e||!e.length)return yield Promise.resolve(null);let n,o=null;const i=e.length;for(n=0;n<i;n++){const t=e[n];if(!t)continue;let i=t.extent;if(!i&&"point"===t.type){const e=t;e.x&&e.y&&(i=new r({xmax:e.x,xmin:e.x,ymax:e.y,ymin:e.y,zmax:e.z,zmin:e.z,spatialReference:e.spatialReference}))}i&&(o=o?o.union(i):i)}return o.width<0&&o.height<0?yield Promise.resolve(null):yield Promise.resolve(o)})))}))}function p(e,t,r){if(t){const n=e.jimuLayerViews,i=Object.keys(n);for(let e=0;e<i.length;e++){let a=n[i[e]];a&&a.layer&&a.layerDataSourceId===t&&(a.type===o.LayerTypes.FeatureLayer||a.type===o.LayerTypes.SceneLayer)&&a.setLocalDefinitionExpression(r)}}}function y(e,t){return Object(o.loadArcGISJSAPIModules)(["esri/tasks/support/Query"]).then(r=>{let n;[n]=r;const o=new n;return o.where=t,o.outFields=["*"],o.returnGeometry=!0,e.queryFeatures(o).then(e=>e)})}function g(e,t,r){if(r.view){let n=r.view;if(!n)return null;y(n.layer,t).then(t=>{if(t&&t.features&&t.features.length>0){const r=b(n.layer.geometryType);S(e.view,t.features,r)}})}else Object(o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then(o=>{let i;[i]=o;let a=new i({url:n.dataSourceUtils.getUrlByLayer(r.layer)});a.load().then(()=>{y(a,t).then(t=>{if(t&&t.features&&t.features.length>0){const r=b(t.features[0].geometry.type);S(e.view,t.features,r)}})})})}let h=null;function m(e,t,r){var n;if(r.view){let o=r.view;y(null===(n=null==o?void 0:o.layer)||void 0===n?void 0:n.associatedLayer,t).then(t=>{if(t&&t.features&&t.features.length>0){const r=o.layer.objectIdField,n=t.features.map(e=>e.attributes[r]);let i=0;const a=6;let s=[255,255,0,.8];const u=e.view.highlightOptions,l=function(){i<a?(i++,s?(s=null,e.view.highlightOptions={color:[0,0,0,0]},h&&h.remove(),h=o.highlight(n)):(s=[255,255,0,.8],e.view.highlightOptions={color:s},h&&h.remove(),h=o.highlight(n)),setTimeout(l,500)):(e.view.highlightOptions=u,h&&h.remove())};setTimeout(l,500)}})}}function v(e,t,r){if(t){const n=e.jimuLayerViews,i=Object.keys(n);for(let a=0;a<i.length;a++){let s=n[i[a]];s&&s.layer&&s.layerDataSourceId===t&&(s.type===o.LayerTypes.FeatureLayer?g(e,r,s):s.type===o.LayerTypes.SceneLayer&&m(e,r,s))}}}function S(e,t,r){Object(o.loadArcGISJSAPIModules)(["esri/Graphic"]).then(n=>{let o;[o]=n;!function(t,n){const i=[];let a=0;for(let e=0;e<t.length;e++){const n=new o({geometry:t[e].geometry,symbol:r,attributes:t[e].attributes});i.push(n)}const s=function(){e.graphics.addMany(i),setTimeout(()=>{e.graphics.removeMany(i),a+=1,a<n&&setTimeout(()=>{s()},500)},500)};s()}(t,3)})}function b(e){return["point","multipoint"].includes(e)?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].includes(e)?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].includes(e)?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].includes(e)?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}function w(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}function M(e,t){let r=null;return e.clone?r=e.clone():(r=t.fromJSON(Object.assign({},e)),r.attributes=Object.assign({},e.attributes)),r}function x(e,t){return i(this,void 0,void 0,(function*(){return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?t.isWebMercator&&e[0].spatialReference.isWGS84||t.isWGS84&&e[0].spatialReference.isWebMercator?yield Promise.resolve(e):yield o.geometryUtils.projectToSpatialReference(e,t):yield Promise.resolve(e)}))}function I(e,t,r){return i(this,void 0,void 0,(function*(){return e&&"3d"===e.type&&t&&t.queryFeatures&&r?yield Object(o.loadArcGISJSAPIModules)(["esri/tasks/support/Query"]).then(e=>{const[n]=e,o=new n;return o.returnGeometry=!0,o.outFields=["*"],o.objectIds=r.map(e=>e.attributes[t.objectIdField]),t.queryFeatures(o).then(e=>i(this,void 0,void 0,(function*(){return e&&e.features&&e.features.length===r.length?yield Promise.resolve(e.features):yield Promise.resolve(r)})),()=>i(this,void 0,void 0,(function*(){return yield Promise.resolve(r)})))}):yield Promise.resolve(r)}))}function T(e){return!window.jimuConfig.isInBuilder||e!==n.AppMode.Design}function j(e){return{mapContainer:e.mapContainer,state:e.state,MapView:e.MapView,SceneView:e.SceneView,Extent:e.Extent,Viewpoint:e.Viewpoint,mapView:e.mapView,sceneView:e.sceneView,extentWatch:e.extentWatch,fatalErrorWatch:e.fatalErrorWatch,dsManager:e.dsManager,highLightHandles:e.highLightHandles,mapBaseViewEventHandles:e.mapBaseViewEventHandles,Color:e.Color,isRequestingMap:e.isRequestingMap}}function V(e,t){e.mapContainer=t.mapContainer,e.state=t.state,e.MapView=t.MapView,e.SceneView=t.SceneView,e.Extent=t.Extent,e.Viewpoint=t.Viewpoint,e.mapView=t.mapView,e.sceneView=t.sceneView,e.extentWatch=t.extentWatch,e.fatalErrorWatch=t.fatalErrorWatch,e.dsManager=t.dsManager,e.highLightHandles=t.highLightHandles,e.mapBaseViewEventHandles=t.mapBaseViewEventHandles,e.Color=t.Color,e.isRequestingMap=t.isRequestingMap}},4:function(e,t){e.exports=r}}))}}}));