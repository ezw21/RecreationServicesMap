System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/advanced/data-source-selector"],(function(e){var t,o,a,i,s;return{setters:[function(e){t=e},function(e){o=e},function(e){a=e},function(e){i=e},function(e){s=e}],execute:function(){e(function(e){var t={};function o(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=199)}({0:function(e,o){e.exports=t},1:function(e,t){e.exports=o},14:function(e,t){e.exports=s},199:function(e,t,o){"use strict";o.r(t);var a=o(0),i=o(1),s=o(2),n=o(4),r=o(14),c=o(27);const u=Object(a.Immutable)([r.AllDataSourceTypes.FeatureLayer,r.AllDataSourceTypes.SceneLayer]);class l extends a.React.PureComponent{constructor(e){super(e),this.NoLockTriggerLayerWidgets=["Map"],this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{const e=this.props.messageWidgetId,t=Object(a.getAppStore)().getState().appStateInBuilder.appConfig,o=t.widgets[e];let i=null;if(this.props.config.useDataSource)i=this.checkAndGetInitUseDataSource(this.props.messageWidgetId,this.props.config.useDataSource);else if(o&&o.useDataSources&&o.useDataSources[0]&&1===o.useDataSources.length){const e=t.dataSources[o.useDataSources[0].dataSourceId];i=!e||e.type!==n.ArcGISDataSourceTypes.WebMap&&e.type!==n.ArcGISDataSourceTypes.WebScene?Object(a.Immutable)({dataSourceId:o.useDataSources[0].dataSourceId,mainDataSourceId:o.useDataSources[0].mainDataSourceId,rootDataSourceId:o.useDataSources[0].rootDataSourceId}):null}return{useDataSource:i}},this.checkAndGetInitUseDataSource=(e,t)=>{const o=Object(a.getAppStore)().getState().appStateInBuilder.appConfig,i=o.widgets[e];let s=null,r=!1;const c=i.useDataSources&&i.useDataSources[0]&&i.useDataSources[0].dataSourceId;if(!c)return null;const u=o.dataSources[c];if(!u||u.type!==n.ArcGISDataSourceTypes.WebMap&&u.type!==n.ArcGISDataSourceTypes.WebScene||(r=!0),r){let e=!1;if(i&&i.useDataSources)for(let o=0;o<i.useDataSources.length;o++)if(i.useDataSources[o].dataSourceId===t.rootDataSourceId){e=!0;break}s=e?t:null}else{let e=!1;if(i&&i.useDataSources)for(let o=0;o<i.useDataSources.length;o++)if(i.useDataSources[o].dataSourceId===t.dataSourceId){e=!0;break}s=e?t:i&&i.useDataSources&&1===i.useDataSources.length?Object(a.Immutable)({dataSourceId:i.useDataSources[0].dataSourceId,rootDataSourceId:i.useDataSources[0].rootDataSourceId}):null}return s},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",e)})},this.handleRemoveLayerForTriggerLayer=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",null)})},this.handleIsUseCustomZoomToOption=e=>{!e||this.props.config.zoomToOption&&this.props.config.zoomToOption.scale?this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("isUseCustomZoomToOption",e)}):this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3)})},this.handleSetCustomZoomScale=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.setIn(["zoomToOption","scale"],e)})},this.getTriggerLayerContent=()=>{const e=this.getDsSelectorSourceData(this.props.messageWidgetId,this.props.config.useDataSource);return Object(a.jsx)(r.DataSourceSelector,{types:u,useDataSources:e.useDataSources,fromRootDsIds:e.fromRootDsIds,fromDsIds:e.fromDsIds,closeDataSourceListOnChange:!0,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>e.isReadOnly,disableDataSourceList:e.isReadOnly,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId)})},this.getDsRootIdsByWidgetId=e=>{var t,o,i,s;const r=null===(o=null===(t=Object(a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,c=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[e],u=[],l=a.DataSourceManager.getInstance();return null===(s=null==c?void 0:c.useDataSources)||void 0===s||s.forEach(e=>{const t=l.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==n.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==n.ArcGISDataSourceTypes.WebScene||u.push(e.dataSourceId)}),u.length>0?Object(a.Immutable)(u):void 0},this.getDsIdsByWidgetId=e=>{var t,o,i,s,n;const r=null===(o=null===(t=Object(a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,c=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[e];return Object(a.Immutable)(null!==(n=null===(s=null==c?void 0:c.useDataSources)||void 0===s?void 0:s.map(e=>e.dataSourceId))&&void 0!==n?n:[])},this.getDsSelectorSourceData=(e,t)=>{var o,i,s;const n=null===(i=null===(o=Object(a.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===i?void 0:i.appConfig,r=null===(s=null==n?void 0:n.widgets)||void 0===s?void 0:s[e];let c=!1;const u=this.getDsRootIdsByWidgetId(e);u&&0===u.length&&r&&r.useDataSources&&1===r.useDataSources.length&&(c=!0),!u&&r&&r.useDataSources&&1===r.useDataSources.length&&(c=!0);return{isReadOnly:c,useDataSources:t&&t.dataSourceId?Object(a.Immutable)([t]):Object(a.Immutable)([]),fromRootDsIds:u,fromDsIds:u?void 0:this.getDsIdsByWidgetId(e)}},this.checkIsDisableDataView=e=>{var t,o,i,s;if(this.props.messageType===a.MessageType.DataRecordsSelectionChange)return!0;const n=null===(o=null===(t=Object(a.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.appConfig,r=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e];if(r){return"Map"===(null===(s=null==r?void 0:r.manifest)||void 0===s?void 0:s.label)}return!1},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",e.useDataSource)})}getStyle(e){return a.css`
      .setting-header {
        padding: ${a.polished.rem(10)} ${a.polished.rem(16)} ${a.polished.rem(0)} ${a.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}render(){return Object(a.jsx)("div",{css:this.getStyle(this.props.theme)},Object(a.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:c.a.mapAction_TriggerLayer})},this.getTriggerLayerContent()),Object(a.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:c.a.mapZoomToAction_ZoomScale})},Object(a.jsx)(s.SettingRow,null,Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(a.jsx)("div",{className:"align-items-center d-flex"},Object(a.jsx)(i.Radio,{style:{cursor:"pointer"},checked:!this.props.config.isUseCustomZoomToOption,onChange:()=>this.handleIsUseCustomZoomToOption(!1)}),Object(a.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:c.a.mapZoomToAction_Automatic}))))),Object(a.jsx)(s.SettingRow,null,Object(a.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},Object(a.jsx)("div",{className:"align-items-center d-flex"},Object(a.jsx)(i.Radio,{style:{cursor:"pointer"},checked:this.props.config.isUseCustomZoomToOption,onChange:()=>this.handleIsUseCustomZoomToOption(!0)}),Object(a.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:c.a.mapZoomToAction_Custom}))))),this.props.config.isUseCustomZoomToOption&&Object(a.jsx)(s.SettingRow,null,Object(a.jsx)(i.NumericInput,{className:"w-100",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:c.a.mapZoomToAction_TypeScale}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:this.handleSetCustomZoomScale}))))}}l.defaultProps={config:Object(a.Immutable)({useDataSource:null})},t.default=a.themeUtils.withTheme(l)},2:function(e,t){e.exports=a},27:function(e,t,o){"use strict";t.a={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Modify initial view",defaultView:"Default",defaultViewTip:"Initial position of the map inherited from the web map or web scene",customView:"Custom",customViewTip:"Create a new position of the map",customViewSet:"Modify",toolLabel:"Tools",options:"Options",selectionHighlightColor:"Selection highlight",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",sceneQualityMode:"Scene quality mode",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger data",mapAction_SetData:"Select data",mapAction_ActionLayer:"Action data",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select data",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No data.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},4:function(e,t){e.exports=i}}))}}}));