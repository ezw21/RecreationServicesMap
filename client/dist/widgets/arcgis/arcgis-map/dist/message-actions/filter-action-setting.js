System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"],(function(e){var t,a,o,i,s,n;return{setters:[function(e){t=e},function(e){a=e},function(e){o=e},function(e){i=e},function(e){s=e},function(e){n=e}],execute:function(){e(function(e){var t={};function a(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(o,i,function(t){return e[t]}.bind(null,i));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=203)}({0:function(e,a){e.exports=t},1:function(e,t){e.exports=a},118:function(e,t){e.exports='<svg viewBox="0 0 12 40" xmlns="http://www.w3.org/2000/svg"><path d="M6 30v10H0v-1h5v-9h1zM3.162 18.582a.5.5 0 010 .71l-1.416 1.421a2.497 2.497 0 00-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 01.712.713L6 24.968a3.502 3.502 0 01-4.967 0 3.501 3.501 0 010-4.967l1.416-1.422a.504.504 0 01.713.003zm4.967-.71a.5.5 0 010 .71L4.58 22.129a.504.504 0 01-.713-.712l3.548-3.548a.504.504 0 01.713.003zm2.838-2.838a3.501 3.501 0 010 4.967l-1.42 1.419a.504.504 0 01-.713-.712l1.423-1.417a2.5 2.5 0 000-3.547 2.502 2.502 0 00-3.547 0l-1.42 1.419a.504.504 0 01-.713-.712l1.42-1.42a3.506 3.506 0 014.97.003zM6 0v10H5V1H0V0h6z" fill="#A8A8A8" fill-rule="evenodd"></path></svg>'},14:function(e,t){e.exports=s},2:function(e,t){e.exports=o},203:function(e,t,a){"use strict";a.r(t);var o=a(0),i=a(1),s=a(2),n=a(14),r=a(4),c=a(50),l=a(27),u=a(67);const d=Object(o.Immutable)([n.AllDataSourceTypes.FeatureLayer,n.AllDataSourceTypes.SceneLayer]);class p extends o.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.initOutputDataSources=e=>{var t;const a=null!==(t=null==e?void 0:e.map(e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null})))&&void 0!==t?t:[];return Object(o.Immutable)(a)},this.getInitConfig=()=>{const e=this.props.messageWidgetId,t=Object(o.getAppStore)().getState().appStateInBuilder.appConfig,a=t.widgets[e];let i=null,s=null;if(this.props.config.messageUseDataSource)i=this.checkAndGetInitUseDataSource(this.props.messageWidgetId,this.props.config.messageUseDataSource);else{const s=u.a(e,this.props.messageType)?this.initOutputDataSources(null==a?void 0:a.outputDataSources):null==a?void 0:a.useDataSources;if((null==s?void 0:s[0])&&1===(null==s?void 0:s.length)){const e=t.dataSources[s[0].dataSourceId];i=!e||e.type!==r.ArcGISDataSourceTypes.WebMap&&e.type!==r.ArcGISDataSourceTypes.WebScene?Object(o.Immutable)({dataSourceId:s[0].dataSourceId,mainDataSourceId:s[0].mainDataSourceId,dataViewId:s[0].dataViewId,rootDataSourceId:s[0].rootDataSourceId}):null}}const n=this.props.widgetId,c=t.widgets[n];if(this.props.config.actionUseDataSource)s=this.checkAndGetInitUseDataSource(this.props.widgetId,this.props.config.actionUseDataSource);else if(c&&c.useDataSources&&c.useDataSources[0]&&1===c.useDataSources.length){const e=t.dataSources[c.useDataSources[0].dataSourceId];s=!e||e.type!==r.ArcGISDataSourceTypes.WebMap&&e.type!==r.ArcGISDataSourceTypes.WebScene?Object(o.Immutable)({dataSourceId:c.useDataSources[0].dataSourceId,mainDataSourceId:c.useDataSources[0].mainDataSourceId,dataViewId:c.useDataSources[0].dataViewId,rootDataSourceId:c.useDataSources[0].rootDataSourceId}):null}const l=this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.dataSourceId;return(s&&s.dataSourceId)!==l?{messageUseDataSource:i,actionUseDataSource:s,sqlExprObj:null}:{messageUseDataSource:i,actionUseDataSource:s,sqlExprObj:this.props.config.sqlExprObj}},this.checkAndGetInitUseDataSource=(e,t)=>{var a,i;const s=Object(o.getAppStore)().getState().appStateInBuilder.appConfig,n=s.widgets[e];let c=null,l=!1;const d=u.a(e,this.props.messageType),p=d?this.initOutputDataSources(null==n?void 0:n.outputDataSources):null==n?void 0:n.useDataSources,g=p&&p[0]&&p[0].dataSourceId;if(!g)return null;const S=s.dataSources[g];if(!S||S.type!==r.ArcGISDataSourceTypes.WebMap&&S.type!==r.ArcGISDataSourceTypes.WebScene||(l=!0),l){let e=!1;if(p)for(let a=0;a<p.length;a++)if(p[a].dataSourceId===t.rootDataSourceId){e=!0;break}c=e?t:null}else{let e=!1;if(p)for(let o=0;o<p.length;o++){const s=d?null==t?void 0:t.mainDataSourceId:null==t?void 0:t.dataSourceId;if((d?null===(a=p[o])||void 0===a?void 0:a.mainDataSourceId:null===(i=p[o])||void 0===i?void 0:i.dataSourceId)===s){e=!0;break}}c=e?t:1===(null==p?void 0:p.length)?Object(o.Immutable)({dataSourceId:null==p?void 0:p[0].dataSourceId,mainDataSourceId:null==p?void 0:p[0].mainDataSourceId,dataViewId:null==p?void 0:p[0].dataViewId,rootDataSourceId:null==p?void 0:p[0].rootDataSourceId}):null}return c},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleActionLayerChange=e=>{e&&e.length>0?this.handleActionLayerSelected(e[0]):this.handleRemoveLayerForActionLayer()},this.handleTriggerLayerSelected=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",e)})},this.handleActionLayerSelected=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",e).set("sqlExprObj",null)})},this.handleRemoveLayerForTriggerLayer=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",null)})},this.handleRemoveLayerForActionLayer=()=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",null).set("sqlExprObj",null)})},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("sqlExprObj",e)})},this.onMessageFieldSelected=(e,t)=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",{dataSourceId:this.props.config.messageUseDataSource.dataSourceId,mainDataSourceId:this.props.config.messageUseDataSource.mainDataSourceId,dataViewId:this.props.config.messageUseDataSource.dataViewId,rootDataSourceId:this.props.config.messageUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)})})},this.onActionFieldSelected=(e,t)=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("actionUseDataSource",{dataSourceId:this.props.config.actionUseDataSource.dataSourceId,mainDataSourceId:this.props.config.actionUseDataSource.mainDataSourceId,dataViewId:this.props.config.actionUseDataSource.dataViewId,rootDataSourceId:this.props.config.actionUseDataSource.rootDataSourceId,fields:e.map(e=>e.jimuName)})})},this.swicthEnabledDataRelationShip=e=>{this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("enabledDataRelationShip",e)})},this.checkTrigerLayerIsSameToActionLayer=()=>!(!this.props.config.messageUseDataSource||!this.props.config.actionUseDataSource)&&(this.props.config.messageUseDataSource.mainDataSourceId===this.props.config.actionUseDataSource.mainDataSourceId&&this.props.config.messageUseDataSource.rootDataSourceId===this.props.config.actionUseDataSource.rootDataSourceId),this.getDsRootIdsByWidgetId=e=>{var t,a,i,s;const n=null===(a=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,c=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e],l=[],u=o.DataSourceManager.getInstance();return null===(s=null==c?void 0:c.useDataSources)||void 0===s||s.forEach(e=>{const t=u.getDataSource(e.dataSourceId);(null==t?void 0:t.type)!==r.ArcGISDataSourceTypes.WebMap&&(null==t?void 0:t.type)!==r.ArcGISDataSourceTypes.WebScene||l.push(e.dataSourceId)}),l.length>0?Object(o.Immutable)(l):void 0},this.getDsIdsByWidgetId=e=>{var t,a,i,s;const n=null===(a=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,r=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e],c=u.a(e,this.props.messageType)?this.initOutputDataSources(null==r?void 0:r.outputDataSources):null==r?void 0:r.useDataSources;return Object(o.Immutable)(null!==(s=null==c?void 0:c.map(e=>null==e?void 0:e.mainDataSourceId))&&void 0!==s?s:[])},this.getDsSelectorSourceData=(e,t)=>{var a,i,s;const n=null===(i=null===(a=Object(o.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===i?void 0:i.appConfig,r=null===(s=null==n?void 0:n.widgets)||void 0===s?void 0:s[e];let c=!1;const l=this.getDsRootIdsByWidgetId(e);l&&0===l.length&&r&&r.useDataSources&&1===r.useDataSources.length&&(c=!0);const d=u.a(e,this.props.messageType)?this.initOutputDataSources(null==r?void 0:r.outputDataSources):null==r?void 0:r.useDataSources;l||1!==(null==d?void 0:d.length)||(c=!0);return{isReadOnly:c,useDataSources:t&&t.dataSourceId?Object(o.Immutable)([t]):Object(o.Immutable)([]),fromRootDsIds:l,fromDsIds:l?void 0:this.getDsIdsByWidgetId(e)}},this.checkIsDisableDataView=e=>{var t,a,i,s;if(this.props.messageType===o.MessageType.DataRecordsSelectionChange)return!0;const n=null===(a=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig,r=null===(i=null==n?void 0:n.widgets)||void 0===i?void 0:i[e];if(r){return"Map"===(null===(s=null==r?void 0:r.manifest)||void 0===s?void 0:s.label)}return!1},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){const e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj)})}getStyle(e){return o.css`
      .setting-header {
        padding: ${o.polished.rem(10)} ${o.polished.rem(16)} ${o.polished.rem(0)} ${o.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.colors.palette.dark[300]};
        border: 1px solid ${e.colors.palette.light[500]};
      }

      .relate-panel-left {
        flex: auto;
        .action-select-chooser {
          margin-top: ${o.polished.rem(12)};
        }
      }
    `}render(){var e,t;const r=this.props.config.actionUseDataSource&&o.DataSourceManager.getInstance().getDataSource(this.props.config.actionUseDataSource.dataSourceId),{theme:u}=this.props,p=this.getDsSelectorSourceData(this.props.messageWidgetId,this.props.config.messageUseDataSource),g=this.getDsSelectorSourceData(this.props.widgetId,this.props.config.actionUseDataSource);return Object(o.jsx)("div",{css:this.getStyle(this.props.theme)},Object(o.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:l.a.mapAction_TriggerLayer})},Object(o.jsx)(n.DataSourceSelector,{types:d,useDataSources:p.useDataSources,fromRootDsIds:p.fromRootDsIds,fromDsIds:p.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>p.isReadOnly,disableDataSourceList:p.isReadOnly,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})),Object(o.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_ActionLayer",defaultMessage:l.a.mapAction_ActionLayer})},Object(o.jsx)(n.DataSourceSelector,{types:d,useDataSources:g.useDataSources,fromRootDsIds:g.fromRootDsIds,fromDsIds:g.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>g.isReadOnly,disableDataSourceList:g.isReadOnly,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),this.props.config&&this.props.config.messageUseDataSource&&this.props.config.actionUseDataSource&&Object(o.jsx)(s.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_Conditions",defaultMessage:l.a.mapAction_Conditions})},Object(o.jsx)(s.SettingRow,{label:this.props.intl.formatMessage({id:"mapAction_RelateMessage",defaultMessage:l.a.mapAction_RelateMessage})},Object(o.jsx)(i.Switch,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.swicthEnabledDataRelationShip(e.target.checked)}})),Object(o.jsx)(s.SettingRow,null,Object(o.jsx)(i.Collapse,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},this.checkTrigerLayerIsSameToActionLayer()&&Object(o.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"mapAction_AutoBind",defaultMessage:l.a.mapAction_AutoBind})),!this.checkTrigerLayerIsSameToActionLayer()&&Object(o.jsx)("div",{className:"w-100 d-flex align-items-center"},Object(o.jsx)("div",{className:"d-flex flex-column relate-panel-left"},Object(o.jsx)(n.FieldSelector,{className:"w-100",useDataSources:Object(o.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"mapAction_TriggerLayerField",defaultMessage:l.a.mapAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,isSearchInputHidden:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:Object(o.Immutable)([])}),Object(o.jsx)(n.FieldSelector,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"mapAction_ActionLayerField",defaultMessage:l.a.mapAction_ActionLayerField}),useDataSources:Object(o.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,isSearchInputHidden:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:Object(o.Immutable)([])})),Object(o.jsx)(i.Icon,{className:"flex-none",width:12,height:40,color:u.colors.dark[400],icon:a(118)})))),Object(o.jsx)(s.SettingRow,null,Object(o.jsx)(i.Button,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},Object(o.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"mapAction_MoreConditions",defaultMessage:l.a.mapAction_MoreConditions}))),this.props.config.actionUseDataSource&&Object(o.jsx)(o.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},e=>Object(o.jsx)(c.SqlExpressionBuilderPopup,{dataSource:e,mode:o.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)}}))),Object(o.jsx)(s.SettingRow,null,Object(o.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&r?o.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,r).displaySQL:this.props.intl.formatMessage({id:"mapAction_SetExpression",defaultMessage:l.a.mapAction_SetExpression})))))}}p.defaultProps={config:Object(o.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})},t.default=o.themeUtils.withTheme(p)},27:function(e,t,a){"use strict";t.a={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Modify initial view",defaultView:"Default",defaultViewTip:"Initial position of the map inherited from the web map or web scene",customView:"Custom",customViewTip:"Create a new position of the map",customViewSet:"Modify",toolLabel:"Tools",options:"Options",selectionHighlightColor:"Selection highlight",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",sceneQualityMode:"Scene quality mode",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger data",mapAction_SetData:"Select data",mapAction_ActionLayer:"Action data",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select data",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No data.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},4:function(e,t){e.exports=i},50:function(e,t){e.exports=n},67:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var o=a(0);function i(e,t){return function(e,t){var a,i,s,n;const r=null===(i=null===(a=Object(o.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===i?void 0:i.appConfig,c=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[e],l=null===(n=null==c?void 0:c.manifest)||void 0===n?void 0:n.publishMessages;let u=null;return null==l||l.forEach(e=>{const a=e;(null==a?void 0:a.messageCarryData)&&(null==a?void 0:a.messageType)==t&&(u=null==a?void 0:a.messageCarryData)}),u}(e,t)==o.MessageCarryData.OutputDataSource}}}))}}}));