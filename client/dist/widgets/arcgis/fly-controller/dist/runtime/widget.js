System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/map","esri/views/3d/externalRenderers"],(function(t){var e,i,s,n,r;return{setters:[function(t){e=t},function(t){i=t},function(t){s=t},function(t){n=t},function(t){r=t}],execute:function(){t(function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=487)}({0:function(t,i){t.exports=e},1:function(t,e){t.exports=i},109:function(t,e,i){"use strict";i.d(e,"a",(function(){return F}));var s=i(8),n=i(25),r=i(4),a=i(3),o=i(37),l=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class h extends n.b{constructor(){super(...arguments),this._updateCamearGlByTilt=(t,e)=>{if(!Object(a.p)(this._cache.lookAtTargetGL.pos))return null;t<1?t=1:t>89&&(t=89);const i=this.vec3d.create();this.vec3.subtract(i,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const s=this.vec3.length(i),n=this.vec3d.create();this.vec3.normalize(n,this._cache.lookAtTargetGL.upAxis);const r=this.vec3d.create();this.vec3.scale(r,n,s);const o=this.vec3d.create();this.vec3.add(o,this._cache.lookAtTargetGL.pos,r);const l=this.vec3d.create();this.vec3.cross(l,n,i);let h=this.vec3d.create();h=this.rotateBySceneMode(o,l,t,this._cache.lookAtTargetGL.pos);const c=this.mat4d.create();this.mat4.rotate(c,c,Object(a.c)(t),l);const d=this.vec3d.create();this.vec3.subtract(d,h,this._cache.lookAtTargetGL.pos);const u=this.vec3d.create();if(this.vec3.cross(u,d,l),this.vec3.normalize(u,u),this._cache.cameraGL.pos=h,this._cache.cameraGL.upDir=u,null==e?void 0:e.isUpdateCamearConfig){const t=new this.GLCamera(this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos,this._cache.cameraGL.upDir);this.cameraInfo=this.cameraUtils.internalToExternal(this.sceneView,t),this.cameraInfo=this.cameraInfo.toJSON()}},this._computeCurrentTilt=()=>{const t=this.vec3d.create();this.vec3.subtract(t,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const e=this.vec3d.create();this.vec3.normalize(e,this._cache.lookAtTargetGL.upAxis);return Object(a.s)(this.vec3.angle(t,e))},this._updateInitCamera=(t,e)=>{let i,s=t;this._isDebug&&this.auxHelper.drawPoint(s),s=this.queryGeometryElevInfo(s),this._cache.lookAtTargetGL.pos=Object(a.g)([s.x,s.y,s.z],null,this.sceneView),this._cache.lookAtTargetGL.upAxis=this.vec3d.create(),this._cache.lookAtTargetGL.baseAlt=s.z,this.sceneView.renderCoordsHelper.worldUpAtPosition(this._cache.lookAtTargetGL.pos,this._cache.lookAtTargetGL.upAxis),i=Object(a.p)(this.cameraInfo)?this.Camera.fromJSON(this.cameraInfo):this.sceneView.camera.clone();const n=this.cameraUtils.externalToInternal(this.sceneView,i);return this._cache.cameraGL.pos=n.eye,this._cache.cameraGL.upDir=n.up,(null==e?void 0:e.isUpdateTilt)&&this._updateCamearGlByTilt(this._getTilt()),s},this.fly=t=>l(this,void 0,void 0,(function*(){return Object(a.p)(null==t?void 0:t.speedFactor)&&this.liveviewSetting.setSpeedFactor(t.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==t?void 0:t.animate):yield Promise.reject("isEnableToFly() === false"):(yield this.prepare(),yield this.resume(),!0)})),this.getApiCamera=()=>{const t=new this.GLCamera(this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos,this._cache.cameraGL.upDir),e=this.cameraUtils.internalToExternal(this.sceneView,t);return e.position.z<0&&(e.position.z=0),e},this.resumeCamera=t=>l(this,void 0,void 0,(function*(){const e=t;try{yield this.sceneView.goTo(this.getApiCamera(),{animate:e,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0})),this.getProgress=()=>0}setIsLiveview(t){const e=Object.create(null,{setIsLiveview:{get:()=>super.setIsLiveview}});return l(this,void 0,void 0,(function*(){return yield e.setIsLiveview.call(this,t),yield this.setLiveviewSettingInfo(this.getLiveviewSettingInfo())}))}setLiveviewSettingInfo(t){const e=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return l(this,void 0,void 0,(function*(){return yield e.setLiveviewSettingInfo.call(this,t,()=>l(this,void 0,void 0,(function*(){if(Object(a.p)(t)&&Object(a.p)(t.tilt)&&Object(a.p)(this._cache.lookAtTargetGL.pos)&&t.tilt>=0){this._updateCamearGlByTilt(t.tilt,{isUpdateCamearConfig:!0});try{yield this.sceneView.goTo(this.getApiCamera(),{animate:!1,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0}return!1})))}))}_getTilt(){let t=this.liveviewSetting.getTiltFactor(!0);return(null==t||isNaN(t))&&(t=this._computeCurrentTilt(),this.liveviewSetting.setTiltFactor(t)),t}getLiveviewSettingInfo(){return{tilt:this._getTilt(),altitude:null,speed:this.liveviewSetting.getSpeedFactor()}}prepare(t){const e=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return l(this,void 0,void 0,(function*(){const s=this.geometry;Object(a.p)(t)&&(Object(a.p)(t.angleLimit)?(this.optionsAngleLimit=t.angleLimit,this.angleLimitCounter=t.angleLimit):Object(a.p)(this.optionsAngleLimit),Object(a.p)(t.duration)&&(this.duration=t.duration)),e.preparing.call(this),this._updateInitCamera(s,{isUpdateTilt:!1}),Object(a.p)(this.duration)?this.animate.init(o.a.Linear,0,null!==(i=this.optionsAngleLimit)&&void 0!==i?i:360,this.duration):this.animate.init(o.a.NONE,0,0,this.duration);try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsBeforeTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==t?void 0:t.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),this._updateInitCamera(this.geometry,{isUpdateTilt:!0});try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsAfterTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield e.prepared.call(this),!0}))}_doFly(){const t=Object.create(null,{_doFly:{get:()=>super._doFly}});return l(this,void 0,void 0,(function*(){return t._doFly.call(this),yield this.updateAnimat(t=>{const e=this.animate.easing(t.deltaTime,this.liveviewSetting.getMappingSpeedFactor());let i=e.step;const n=e.progress;if(Object(a.p)(this.direction)&&this.direction===s.e.CW&&(i=-i),this.isLiveviewMode);else if(null===this.optionsAngleLimit||isNaN(this.optionsAngleLimit))this._rotateCam(i);else{n>=1&&(i=this.angleLimitCounter);const t=Math.min(Math.abs(i),this.angleLimitCounter);this.angleLimitCounter-=t,this.angleLimitCounter>0?this._rotateCam(i):this.stop()}this._isDebug&&this.auxHelper.drawPointGL(this._cache.cameraGL.pos,"red");const r=this.getApiCamera();this.sceneView.goTo(r,{animate:!1}).catch((function(t){if("AbortError"!==t.name)throw t;console.log("sceneView.goTo() Aborted")}))})}))}_rotateCam(t){const e=this._cache.lookAtTargetGL.upAxis;let i=this.vec3d.create();i=this.rotateBySceneMode(this._cache.cameraGL.pos,e,t,this._cache.lookAtTargetGL.pos),this._cache.cameraGL.pos=i;const s=this.mat4d.create();this.mat4.rotate(s,s,Object(a.c)(t),e);const n=this._cache.cameraGL.upDir;this.vec3.transformMat4(n,n,s),this.vec3.normalize(n,n),this._cache.cameraGL.upDir=n}resume(t){const e=Object.create(null,{resume:{get:()=>super.resume}});return l(this,void 0,void 0,(function*(){return e.resume.call(this),yield this._resume(this.resumeCamera(t))}))}clear(){const t=Object.create(null,{clear:{get:()=>super.clear}});return l(this,void 0,void 0,(function*(){yield t.clear.call(this),this._cache.lookAtTargetGL.pos=null}))}}class c{constructor(t,e){this.points=null!=t?t:[],this.points=this.normalPoints4Bspline(this.points),this.iter=null!=e?e:3}getSpline(){const t=this.bspline(this.points,this.iter);return this.mergePoints(t)}clear(){this.points=null,this.iter=null}normalPoints4Bspline(t){var e;const i=[];for(let s=0,n=t.length;s<n;s++){const n=t[s],r=n[0],a=n[1],o=null!==(e=n[2])&&void 0!==e?e:0;i.push(r,a,o)}return i}mergePoints(t){const e=[];for(let i=0,s=t.length/3;i<s;i++){const s=t[3*i],n=t[3*i+1],r=t[3*i+2],a=[];a.push(s,n,r),e.push(a)}return e}bspline(t,e){if(!Object(a.p)(e)||0===e)return t;const i=t.length/3,s=[t[0],t[1],t[2]];for(let e=0;e<i-1;e++){const i=3*e;s[3+2*i+0]=.8*t[i+0]+.2*t[i+3],s[3+2*i+1]=.8*t[i+1]+.2*t[i+4],s[3+2*i+2]=.8*t[i+2]+.2*t[i+5],s[3+2*i+3]=.2*t[i+0]+.8*t[i+3],s[3+2*i+4]=.2*t[i+1]+.8*t[i+4],s[3+2*i+5]=.2*t[i+2]+.8*t[i+5]}return s.push(t[t.length-3],t[t.length-2],t[t.length-1]),this.bspline(s,e-1)}}function d(t,e,i){const s=void 0!==e?e*e:1;return t=function(t,e){const i=t.length,s=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(i);let n=0,r=i-1;const o=[],l=[];let h,c,d,u;s[n]=s[r]=1;for(;a.p(r)&&0!==r;){for(c=0,h=n+1;h<r;h++)d=p(t[h],t[n],t[r]),d>c&&(u=h,c=d);c>e&&(s[u]=1,o.push(n,u,u,r)),r=o.pop(),n=o.pop()}for(h=0;h<i;h++)a.p(s[h])&&l.push(t[h]);return l}(t=i?t:function(t,e){let i=t[0];const s=[i];let n;for(let r=1,a=t.length;r<a;r++)n=t[r],u(n,i)>e&&(s.push(n),i=n);i!==n&&s.push(n);return s}(t,s),s)}function u(t,e){const i=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2];return i*i+s*s+n*n}function p(t,e,i){let s=e[0],n=e[1],r=e[2],a=i[0]-s,o=i[1]-n,l=i[2]-r;if(0!==a||0!==o||0!==l){const e=((t[0]-s)*a+(t[1]-n)*o+(t[2]-r)*l)/(a*a+o*o+l*l);e>1?(s=i[0],n=i[1],r=i[2]):e>0&&(s+=a*e,n+=o*e,r+=l*e)}return a=t[0]-s,o=t[1]-n,l=t[2]-r,a*a+o*o+l*l}class g{constructor(){this.c0=0,this.c1=0,this.c2=0,this.c3=0,this.init=(t,e,i,s)=>{this.c0=t,this.c1=i,this.c2=-3*t+3*e-2*i-s,this.c3=2*t-2*e+i+s},this.initCatmullRom=(t,e,i,s,n)=>{this.init(e,i,n*(i-t),n*(s-e))},this.initNonuniformCatmullRom=(t,e,i,s,n,r,a)=>{let o=(e-t)/n-(i-t)/(n+r)+(i-e)/r,l=(i-e)/r-(s-e)/(r+a)+(s-i)/a;o*=r,l*=r,this.init(e,i,o,l)},this.calc=t=>{const e=t*t,i=e*t;return this.c0+this.c1*t+this.c2*e+this.c3*i}}}class v{constructor(t,e,i){this.set=(t,e,i)=>(this.x=t,this.y=e,this.z=i,this),this.add=t=>(this.x+=t.x,this.y+=t.y,this.z+=t.z,this),this.subVectors=(t,e)=>(this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this),this.distanceToSquared=t=>{const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s},this.distanceTo=t=>Math.sqrt(this.distanceToSquared(t)),this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}}const f=new v,m=new g,y=new g,w=new g;class b{constructor(t,e,i,s){this._geoArrayToCoords=t=>{const e=[];for(let i=0,s=t.length;i<s;i++)e.push(new v(t[i][0],t[i][1],t[i][2]));return e},this.getPoint=(t,e)=>{const i=null!=e?e:new v,s=this.points,n=s.length,r=(n-(!0===this.closed?0:1))*t;let a,o=Math.floor(r),l=r-o;!0===this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:0===l&&o===n-1&&(o=n-2,l=1),!0===this.closed||o>0?a=s[(o-1)%n]:(f.subVectors(s[0],s[1]).add(s[0]),a=f);const h=s[o%n],c=s[(o+1)%n];let d;if(!0===this.closed||o+2<n?d=s[(o+2)%n]:(f.subVectors(s[n-1],s[n-2]).add(s[n-1]),d=f),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(c),t),s=Math.pow(c.distanceToSquared(d),t);i<1e-4&&(i=1),e<1e-4&&(e=i),s<1e-4&&(s=i),m.initNonuniformCatmullRom(a.x,h.x,c.x,d.x,e,i,s),y.initNonuniformCatmullRom(a.y,h.y,c.y,d.y,e,i,s),w.initNonuniformCatmullRom(a.z,h.z,c.z,d.z,e,i,s)}else"catmullrom"===this.curveType&&(m.initCatmullRom(a.x,h.x,c.x,d.x,this.tension),y.initCatmullRom(a.y,h.y,c.y,d.y,this.tension),w.initCatmullRom(a.z,h.z,c.z,d.z,this.tension));return i.set(m.calc(l),y.calc(l),w.calc(l)),i},this.getSpacedPoints=t=>{void 0===t&&(t=5);const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},this.getPointAt=(t,e)=>{const i=this.getUtoTmapping(t);return this.getPoint(i,e)},this.getUtoTmapping=(t,e)=>{const i=this.getLengths();let s=0;const n=i.length;let r;r=a.p(e)?e:t*i[n-1];let o,l=0,h=n-1;for(;l<=h;)if(s=Math.floor(l+(h-l)/2),o=i[s]-r,o<0)l=s+1;else{if(!(o>0)){h=s;break}h=s-1}if(s=h,i[s]===r)return s/(n-1);const c=i[s];return(s+(r-c)/(i[s+1]-c))/(n-1)},this.getLength=()=>{const t=this.getLengths();return t[t.length-1]},this.getLengths=t=>{if(void 0===t&&(t=this.arcLengthDivisions),a.p(this.cacheArcLengths)&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,s,n=this.getPoint(0),r=0;for(e.push(0),s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e},this.points=this._geoArrayToCoords(t),this.closed=null!=e&&e,this.curveType=null!=i?i:"centripetal",this.tension=null!=s?s:.3,this.arcLengthDivisions=2e4}destructor(){}}class C{constructor(t,e,i,s,n){this.longLineProcessing={threshold:400,distance:150},this.acuteAngleProcessing={angle:90,threshold:300,distance:100},this.geoArrayToCoords=t=>{const e=[];for(let i=0,s=t.length;i<s;i++){let s=t[i];s=a.g([s[0],s[1],s[2]],null,this.sceneView),e.push(s)}return e},this.getLength=()=>this.curve.getLength(),this.sceneView=e,this.points=this.geoArrayToCoords(t),this.vec3=i,this.vec3d=s,this.esriMathUtils=n;const r=d(this.points,5,!0);this.points=this.preProcessing(r);const o=new c(this.points);this.curve=new b(o.getSpline()),o.clear()}destructor(){this.points=null,this.curve=null}getUtoTmapping(t,e){return this.curve.getUtoTmapping(0,e)}getPoint(t){return this.curve.getPoint(t)}preProcessing(t){const e=[];let i=null;for(let s=0;s<t.length-1;s++){const n=t[s],r=t[s+1],o=t[s+2],l=a.d(n,r),h=a.p(o)?a.d(r,o):null;let c=!1;if(a.p(l)&&a.p(h)){const t=a.n(n,r,o,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils);c=Math.abs(t)>this.acuteAngleProcessing.angle}const d=!(0!==s),u=!(t.length-1!==s+1);let p;if(e.push(n),a.p(i)&&!d&&(e.push(i),i=null),p=this._getInsertControlPointRes(l,c),!0===p.isInsert&&!d&&!u){const t=this._getInsertedPoint(n,r,"forward",p.distance);e.push(t)}p=this._getInsertControlPointRes(h,c),!0!==p.isInsert||u||(i=this._getInsertedPoint(r,o,"backward",p.distance)),u&&e.push(r)}for(let t=0,i=e.length;t<i;t++){let i=e[t];i=a.u(i,null,this.sceneView),e.splice(t,1,i)}return e}_getInsertControlPointRes(t,e){const i=t>this.acuteAngleProcessing.threshold,s=null!==t&&t>this.longLineProcessing.threshold;return e&&i?{isInsert:!0,distance:this.acuteAngleProcessing.distance}:s?{isInsert:!0,distance:this.longLineProcessing.distance}:{isInsert:!1,distance:0}}_getInsertedPoint(t,e,i,s){const n=this.vec3d.create(),r=this.vec3d.create(),a=this.vec3d.create(),o=this.vec3d.create();return"forward"===i?(this.vec3.subtract(n,t,e),this.vec3.normalize(r,n),this.vec3.scale(a,r,s),this.vec3.add(o,e,a)):(this.vec3.subtract(n,e,t),this.vec3.normalize(r,n),this.vec3.scale(a,r,s),this.vec3.add(o,t,a)),o}_getMidpoint(t,e,i){const s=this.vec3d.create(),n=this.vec3d.create(),r=this.vec3d.create(),o=this.vec3d.create(),l=a.p(i)?i:a.d(t,e);return this.vec3.subtract(s,t,e),this.vec3.normalize(n,s),this.vec3.scale(r,n,l/2),this.vec3.add(o,e,r),o}}var P=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class S extends n.b{constructor(){super(...arguments),this._updateInitCamera=t=>{t=this.queryGeometryElevInfo(t),this._cache.cachedGeo=this.concatGeoPaths(t),this._cache.paths=new C(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const e=this._cache.paths.getLength();return this.animate.setAmount(e),t},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=()=>{let t,e;0===this.animate.getProgress()?(t=0*this.animate.getAmount(),this.animate.progressForward(),e=this.animate.getAmount()*this.animate.getProgress()):(t=this.animate.getAmount()*this.animate.progressBackward(),t<0&&(t=0,this.animate.progressForward()),e=this.animate.getAmount()*this.animate.getProgress());let i=this._cache.paths.getUtoTmapping(0,t);i=this._cache.paths.getPoint(i),i=this._coordToGeo(i);let s=this._cache.paths.getUtoTmapping(0,e);s=this._cache.paths.getPoint(s),s=this._coordToGeo(s);const n=parseFloat(i[2])+0,r=a.g([i[0],i[1],n],null,this.sceneView);let o=this.getCameraPosition(i,s);a.p(o)||(o=this._cache.cameraGL.pos);const l=this.vec3d.create();this.sceneView.renderCoordsHelper.worldUpAtPosition(o,l);const h=[0,0,0];h[0]=o[0],h[1]=o[1],h[2]=o[2];const c=[0,0,0];return c[0]=r[0],c[1]=r[1],c[2]=r[2],this._cache.cameraGL.pos=h,this._cache.cameraGL.upDir=l,this._cache.lookAtTargetGL.pos=c,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:c,camPos:h,up:l}},this.getApiCamera=t=>{let e=t.camPos,i=t.lookAt;const s=t.up;if(!a.p(e)||!a.p(i)||!a.p(s))return null;let n=0,r=a.u(i,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference});n=o.z,o.z=parseFloat(o.z)+this.liveviewSetting.getAltitudeFactor(),o.z<0&&(o.z=0),i=a.g([o.x,o.y,o.z],null,this.sceneView),r=a.u(e,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference}),o.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),e=a.g([o.x,o.y,o.z],null,this.sceneView);const l=new this.GLCamera(e,i,s);return this.cameraUtils.internalToExternal(this.sceneView,l)},this.getCameraPosition=(t,e)=>{var i,s;if(t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return null;const n=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,r=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=a.g([t[0],t[1],t[2]],null,this.sceneView),l=a.g([e[0],e[1],e[2]],null,this.sceneView),h=this.vec3d.create();this.vec3.subtract(h,o,l);const c=this.vec3.length(h),d=this.vec3d.create();this.vec3.normalize(d,h);const u=c+r,p=this.vec3d.create();this.vec3.scale(p,d,u);const g=this.vec3d.create();this.vec3.add(g,l,p);const v=a.u(g,1,this.sceneView),f=new this.Point({x:v[0],y:v[1],z:v[2],type:"point",spatialReference:this.sceneView.spatialReference});f.z<n&&(f.z=n),f.z<0&&(f.z=0),this._isDebug&&this.auxHelper.drawPoint(f);return a.g([f.x,f.y,f.z],null,this.sceneView)},this.resumeCamera=t=>P(this,void 0,void 0,(function*(){const e=t;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:e,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0})),this._coordToGeo=t=>a.p(t)?this.vec3d.fromValues(t.x,t.y,t.z):null}setLiveviewSettingInfo(t){const e=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return P(this,void 0,void 0,(function*(){return yield e.setLiveviewSettingInfo.call(this,t,()=>P(this,void 0,void 0,(function*(){const t=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(t,{animate:!1,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0})))}))}getLiveviewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(t){const e=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return P(this,void 0,void 0,(function*(){let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(a.p(null==t?void 0:t.duration)&&(this.duration=t.duration),e.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const t=this.animate.computeDuration();this.animate.init(o.a.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:t)}this._isDebug&&this.auxHelper.drawLineXY(this._cache.paths,"lightgreen");try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==t?void 0:t.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield e.prepared.call(this),!0}))}fly(t){const e=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return P(this,void 0,void 0,(function*(){return a.p(null==t?void 0:t.speedFactor)&&this.liveviewSetting.setSpeedFactor(t.speedFactor),e.isEnableToFly.call(this)?yield this.resume(t.animate):yield Promise.reject()}))}_doFly(){super._doFly(),this.updateAnimat(t=>{this.isLiveviewMode||this.animate.easing(t.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.getProgress()>=1)this.animate.reset(),this.stop();else{const t=this.getCameraByProgress(),e=this.getApiCamera(t);a.p(e)&&this.sceneView.goTo(e,{animate:!1})}})}resume(t){const e=Object.create(null,{resume:{get:()=>super.resume}});return P(this,void 0,void 0,(function*(){return e.resume.call(this),yield this._resume(this.resumeCamera(t))}))}clear(){const t=Object.create(null,{clear:{get:()=>super.clear}});return P(this,void 0,void 0,(function*(){yield t.clear.call(this)}))}}class M{constructor(t,e,i,s,n){this.geoArrayToCoords=t=>{const e=[];for(let i=0,s=t.length;i<s;i++){let s=t[i];s=a.g([s[0],s[1],s[2]],null,this.sceneView),e.push(s)}return e},this.getLength=()=>{this.points.length<2&&alert("line.length < 2");let t=0;for(let e=0,i=this.points.length;e<i-1;e++)t+=this.getLineLen(this.points[e+0],this.points[e+1]),t+=Math.abs(a.n(this.points[e+0],this.points[e+1],this.points[e+2],this.vec3,this.vec3d,this.sceneView,this.esriMathUtils));return this.length=t,t},this.sceneView=e,this.points=this.geoArrayToCoords(t),this.vec3=i,this.vec3d=s,this.esriMathUtils=n,this.points=d(this.points,5,!0)}destructor(){this.points=null}getLineLen(t,e){const i=t,s=e;return a.d(i,s)}getPoint(t,e){let i=0;for(let t=0,s=this.points.length;t<s-1;t++){const s=this.points[t+0],n=this.points[t+1],r=this.points[t+2],o=this.getLineLen(s,n);if(e<i+o){const t=e-i,r=t/o;return{type:"line",len:t,point:a.q(s,n,r)}}i+=o;const l=a.n(s,n,r,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils),h=Math.abs(l);if(e<i+h){return{type:"rotate",angle:(e-i)*a.w(l),point:n,points:{pre:s,base:n,next:r},lastLineLen:i}}i+=h}}}var I=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class x extends n.b{constructor(){super(...arguments),this._updateInitCamera=t=>{t=this.queryGeometryElevInfo(t),this._cache.cachedGeo=this.concatGeoPaths(t),this._cache.paths=new M(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const e=this._cache.paths.getLength();return this.animate.setAmount(e),t},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=t=>{let e,i;0===this.animate.getProgress()?(e=0*this.animate.getAmount(),this.animate.progressForward(),i=this.animate.getAmount()*this.animate.getProgress()):(e=this.animate.getAmount()*this.animate.progressBackward(),i=this.animate.getAmount()*this.animate.getProgress());const s=this._cache.paths.getPoint(0,e),n=this._cache.paths.getPoint(0,i),r=[0,0,0],o=[0,0,0],l=this.vec3d.create();if("line"===s.type){const t=s.point,e=n.point,i=t;let h=this.getCameraPosition(t,e);a.p(h)||(h=this._cache.cameraGL.pos),this.sceneView.renderCoordsHelper.worldUpAtPosition(h,l),r[0]=h[0],r[1]=h[1],r[2]=h[2],o[0]=i[0],o[1]=i[1],o[2]=i[2]}else if("rotate"===s.type){const t=s.points.pre,e=s.points.base,i=s.points.next,n=this.vec3d.create();this.vec3.subtract(n,e,t);const a=this.vec3d.create();this.vec3.subtract(a,i,e);const h=s.lastLineLen,c=this._cache.paths.getPoint(0,h-.02),d=this._cache.paths.getPoint(0,h-.01);let u=this.getCameraPosition(c.point,d.point);this.sceneView.renderCoordsHelper.worldUpAtPosition(e,l);const p=s.angle;u=this.rotateBySceneMode(u,l,p,e),r[0]=u[0],r[1]=u[1],r[2]=u[2],o[0]=e[0],o[1]=e[1],o[2]=e[2]}return this._cache.cameraGL.pos=r,this._cache.cameraGL.upDir=l,this._cache.lookAtTargetGL.pos=o,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:o,camPos:r,up:l,type:s.type}},this.getApiCamera=t=>{let e=t.camPos,i=t.lookAt;const s=t.up;if(!a.p(e)||!a.p(i)||!a.p(s))return null;let n=0,r=a.u(i,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference});n=o.z,o.z=parseFloat(o.z)+this.liveviewSetting.getAltitudeFactor(),o.z<0&&(o.z=0),i=a.g([o.x,o.y,o.z],null,this.sceneView),r=a.u(e,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference}),o.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),e=a.g([o.x,o.y,o.z],null,this.sceneView),this._isDebug&&this.auxHelper.drawLineGL([e,i],this.sceneView,"yellow");const l=new this.GLCamera(e,i,s);return this.cameraUtils.internalToExternal(this.sceneView,l)},this.resumeCamera=t=>I(this,void 0,void 0,(function*(){const e=t;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:e,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0}))}setLiveviewSettingInfo(t){const e=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return I(this,void 0,void 0,(function*(){return yield e.setLiveviewSettingInfo.call(this,t,()=>I(this,void 0,void 0,(function*(){const t=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(t,{animate:!1,signal:this.abortSignalHandler.update()})}catch(t){if("AbortError"===t.name)return console.log("sceneView.goTo() Aborted"),!1;throw t}return!0})))}))}getLiveviewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(t){const e=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return I(this,void 0,void 0,(function*(){let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(a.p(null==t?void 0:t.duration)&&(this.duration=t.duration),e.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const t=this.animate.computeDuration();this.animate.init(o.a.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:t)}try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==t?void 0:t.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(t))}catch(t){return"AbortError"===t.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield e.prepared.call(this),!0}))}fly(t){const e=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return I(this,void 0,void 0,(function*(){return a.p(null==t?void 0:t.speedFactor)&&this.liveviewSetting.setSpeedFactor(t.speedFactor),e.isEnableToFly.call(this)?yield this.resume(t.animate):yield Promise.reject()}))}_doFly(){const t=Object.create(null,{_doFly:{get:()=>super._doFly}});return I(this,void 0,void 0,(function*(){return t._doFly.call(this),yield this.updateAnimat(t=>{this.isLiveviewMode||this.animate.easing(t.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.animate.getProgress()>=1)this.animate.reset(),this.stop();else{const t=this.getCameraByProgress(),e=this.getApiCamera(t);a.p(e)&&this.sceneView.goTo(e,{animate:!1})}})}))}getCameraPosition(t,e){var i,s;if(t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return null;const n=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,r=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=t,l=e,h=this.vec3d.create();this.vec3.subtract(h,o,l);const c=this.vec3.length(h),d=this.vec3d.create();this.vec3.normalize(d,h);const u=c+r,p=this.vec3d.create();this.vec3.scale(p,d,u);const g=this.vec3d.create();this.vec3.add(g,l,p);const v=a.u(g,1,this.sceneView),f=new this.Point({x:v[0],y:v[1],z:v[2],type:"point",spatialReference:this.sceneView.spatialReference});f.z<n&&(f.z=n),f.z<0&&(f.z=0),this._isDebug&&this.auxHelper.drawPoint(f,"red");return a.g([f.x,f.y,f.z],null,this.sceneView)}resume(t){const e=Object.create(null,{resume:{get:()=>super.resume}});return I(this,void 0,void 0,(function*(){return e.resume.call(this),yield this._resume(this.resumeCamera(t))}))}clear(){const t=Object.create(null,{clear:{get:()=>super.clear}});return I(this,void 0,void 0,(function*(){yield t.clear.call(this)}))}}var L=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};var j,G=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};!function(t){t.RawData="rawData",t.DsInfo="dsInfo"}(j||(j={}));class A{constructor(){this.Geometry=null,this.Graphic=null}setup(t,e,i){return G(this,void 0,void 0,(function*(){return yield Object(r.loadArcGISJSAPIModules)(["esri/geometry","esri/Graphic"]).then(s=>G(this,void 0,void 0,(function*(){var r,a,o;[this.Geometry,this.Graphic]=s,this.recordConfig=t,this.sceneView=e,this.flyCallbacks=i,this.controller=null;const l=this.recordConfig.type;switch(l){case n.a.Rotate:case n.a.RealPath:case n.a.Smoothed:{let s;if((null===(r=t.storedGraphicsInfo)||void 0===r?void 0:r.type)===j.RawData){const e=t.storedGraphicsInfo.rawData.graphics;s=this.Graphic.fromJSON(e[0]).geometry}const l={id:t.idx,type:t.type,geometry:s,direction:t.direction,config:{cameraInfo:null===(a=t.controllerConfig)||void 0===a?void 0:a.cameraInfo,liveviewSettingState:null===(o=t.controllerConfig)||void 0===o?void 0:o.liveviewSettingState},sceneView:e,flyCallbacks:i};this.controller=yield class{static make(t){return L(this,void 0,void 0,(function*(){let e;const i=t.type;switch(i){case n.a.Rotate:e=yield(new h).setup(t);break;case n.a.RealPath:e=yield(new x).setup(t);break;case n.a.Smoothed:e=yield(new S).setup(t);break;default:console.error("ControllerFactory error type:",i)}return e}))}}.make(l);break}default:console.error("ControllerFactory error type: ",l)}}))),this}))}destructor(){var t;null===(t=this.controller)||void 0===t||t.destructor(),this.controller=null,this.recordConfig=null}getConfig(){var t;return this.recordConfig.controllerConfig=this.controller.getConfig(),(isNaN(this.recordConfig.duration)||this.recordConfig.duration<0)&&(null===(t=this.controller)||void 0===t?void 0:t.animate.state.amount)>=0&&(this.recordConfig.duration=this.controller.animate.getDuration()/1e3),this.cachingGraphicsInfo&&(this.recordConfig.storedGraphicsInfo.rawData=this.cachingGraphicsInfo.getConfig()),this.recordConfig}prepare(t){var e;return G(this,void 0,void 0,(function*(){return Object(a.p)(t)&&!Object(a.p)(t.animate)&&Object.assign(t,{animate:!0}),yield null===(e=this.controller)||void 0===e?void 0:e.prepare(t)}))}fly(t){var e;return G(this,void 0,void 0,(function*(){Object(a.p)(t.animate)||Object.assign(t,{animate:!0}),yield null===(e=this.controller)||void 0===e?void 0:e.fly(t)}))}pause(){var t;return G(this,void 0,void 0,(function*(){return yield null===(t=this.controller)||void 0===t?void 0:t.pause()}))}stop(){var t;return G(this,void 0,void 0,(function*(){yield null===(t=this.controller)||void 0===t?void 0:t.stop()}))}setGraphicsInfo(t){this.cachingGraphicsInfo=t}getGraphicsInfo(){return this.cachingGraphicsInfo}setSpeedFactor(t){var e;return null===(e=this.controller)||void 0===e?void 0:e.liveviewSetting.setSpeedFactor(t)}setIsLiveview(t){return G(this,void 0,void 0,(function*(){return yield this.controller.setIsLiveview(t)}))}setLiveviewSettingInfo(t){return G(this,void 0,void 0,(function*(){return yield this.controller.setLiveviewSettingInfo(t)}))}getLiveviewSettingInfo(){var t;return null===(t=this.controller)||void 0===t?void 0:t.getLiveviewSettingInfo()}getDefaultDuration(){return this.controller.getDefaultDuration()}}var T=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class R{constructor(){this._redrawAllRecordGraphics=t=>{const e=a.o(this.itemConfig.routes,t);null==e||e.records.map(t=>{t.mapViewId!==this.jimuMapView.id&&t.mapViewId!==a.t(this.jimuMapView.id)||this.drawOrUpdateGraphics(t)})}}setup(t,e,i,n,r,a,o,l,h){var c;return T(this,void 0,void 0,(function*(){switch(this.type=t.name,this.itemConfig=t,this.flyStateCallbacks=n,this.jimuMapView=i,this.record=null!=h?h:null,this.recordConfig=null!==(c=null==h?void 0:h.getConfig())&&void 0!==c?c:e,this.drawOrUpdateGraphics=r,this.highlightGraphics=a,this.checkAndSwitchJimuMapBeforePlay=o,this.getCurrentSceneView=l,this.type){case s.a.Rotate:case s.a.Path:this.itemConfig=t;break;case s.a.Route:this.itemConfig=this.itemConfig;break;default:console.error("ControllerFactory error type:",this.type)}return this._resetPlayingInfo(),this}))}destructor(){var t;this._resetPlayingInfo(),null===(t=this.record)||void 0===t||t.destructor()}handleUpdateJimuMapView(t){var e,i;this.jimuMapView=t,(null===(e=this.playingInfo.currentIds)||void 0===e?void 0:e.ids)&&this._redrawAllRecordGraphics(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids)}handleUpdateFlyCallbacks(t){this.flyStateCallbacks=t}_getFlyRecordDynamically(t,e,i){return T(this,void 0,void 0,(function*(){this.itemConfig=this.itemConfig;const s=a.m(this.itemConfig.routes,t);return yield(new A).setup(s,e,i)}))}_getLimitionParamForPrepare(t,e){const i={},s=t.getConfig().type,r=t.getConfig().duration;let o;if(s===n.a.Rotate&&(o=t.getConfig().angle),a.p(r)&&!isNaN(r)&&r>0&&Object.assign(i,{duration:r*this._computeRouteTaskTimeScale()*1e3}),a.p(o)&&Object.assign(i,{angleLimit:o}),a.p(e)){Object.assign(i,{animate:e.animate});const t=!1!==e.waittingForTerrain;Object.assign(i,{waittingForTerrain:t})}return i}playSpecifiedRecord(){return T(this,void 0,void 0,(function*(){const t=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(t.getGraphics()),yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}prepare(t){return T(this,void 0,void 0,(function*(){switch(yield this._setSpeed(null),this.type){case s.a.Rotate:case s.a.Path:{const e=this._getLimitionParamForPrepare(this.record,t);return yield this.record.prepare(e)}case s.a.Route:{const e=yield this.prepareSpecifiedRecord(t,this.flyStateCallbacks);return!(!e.isCanPlay||!e.prepareState)}default:return console.error("ControllerFactory error type:",this.type),!1}}))}fly(t){var e;return T(this,void 0,void 0,(function*(){switch(yield this.setSpeedFactor(t.settingSpeed),this.type){case s.a.Rotate:case s.a.Path:yield this.record.fly({speedFactor:this.getSpeedFactor()});break;case s.a.Route:if(a.p(null===(e=this.playingInfo.currentIds)||void 0===e?void 0:e.ids))return this.flyStateCallbacks.onFly(),void(yield this.playTask());this.flyStateCallbacks.onFly(),!this._isPlayRoute(t.ids)&&t.isPreviewSpecifiedRecord?yield this.playSpecifiedRecord():yield this.playRouteFly({routeUuid:t.ids.routeUuid},0);break;default:console.error("ControllerFactory error type:",this.type)}}))}pause(){var t;return T(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:yield null===(t=this.record)||void 0===t?void 0:t.pause();break;default:console.error("fly-route.pause error type:",this.type)}}))}stop(t=!1){var e,i;return T(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:yield null===(e=this.record)||void 0===e?void 0:e.stop();break;case s.a.Route:if(t)return;yield this.pause(),this.interruptDelayWaiting(),this._onAllRecordsFinish(),yield null===(i=this.record)||void 0===i?void 0:i.stop();break;default:console.error("fly-route.stop error type:",this.type)}}))}setSpeedFactor(t){return T(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:default:return yield this._setSpeed(t)}}))}getSpeedFactor(){return this.speedFactor}_setSpeed(t){var e;return T(this,void 0,void 0,(function*(){if(null===t){const e=a.k();t=e.speed}this.speedFactor=t,this.playingInfo.isWaiting?(this.interruptDelayWaiting(),yield this.playTask()):null===(e=this.record)||void 0===e||e.setSpeedFactor(t)}))}_computeRouteTaskTimeScale(){let t=1;switch(this.speedFactor){case 0:t=8;break;case.25:t=4;break;case.375:t=2;break;case.5:t=1;break;case.59375:t=1/1.5;break;case.625:t=.5;break;case.75:t=1/4;break;case 1:t=1/8;break;default:t=1}return t}setIsLiveview(t,e){var i,n;return T(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:return yield this.record.setIsLiveview(t);case s.a.Route:if(t){const s=yield this.prepareSpecifiedRecord({ids:e},this.flyStateCallbacks);return!(!s.isCanPlay||!s.prepareState)&&(yield null===(i=this.record)||void 0===i?void 0:i.setIsLiveview(t))}return yield null===(n=this.record)||void 0===n?void 0:n.setIsLiveview(t);default:console.error("ControllerFactory error type:",this.type)}}))}getLiveviewSettingInfo(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:return this.record.getLiveviewSettingInfo();default:console.error("ControllerFactory error type:",this.type)}}getDefaultDuration(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:return this.record.getDefaultDuration();default:console.error("ControllerFactory error type:",this.type)}}setLiveviewSettingInfo(t,e){var i,n;return T(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:{yield null===(i=this.record)||void 0===i?void 0:i.setLiveviewSettingInfo(t);(null===(n=null==e?void 0:e.isUpdateLine)||void 0===n||n)&&this.record.setGraphicsInfo(this.drawOrUpdateGraphics(this.record.getConfig()));const s=this.record.getGraphicsInfo();a.p(null==e?void 0:e.isNeedHighlight)&&e.isNeedHighlight&&a.p(s.getGraphics())&&this.highlightGraphics(s.getGraphics());break}default:console.error("ControllerFactory error type:",this.type)}}))}_isPlayRoute(t){return a.p(t.routeUuid)&&!a.p(t.recordUuid)}prepareSpecifiedRecord(t,e){return T(this,void 0,void 0,(function*(){const i=t.ids;if(this._isPlayRoute(t.ids)){const e=a.e(this.itemConfig.routes,t.ids,0);i.recordUuid=null==e?void 0:e.idx}const{isCanPlay:s}=yield this.checkAndSwitchJimuMapBeforePlay(t.ids);if(!s)return console.error("FlyRoute.prepareSpecifiedRecord(): JimuMap is not matched"),{isCanPlay:!1,prepareState:null};this._redrawAllRecordGraphics(t.ids);let n=e;!!t.isBuilderSettingFlag&&(n={onFly:()=>{e.onFly()},onFinish:()=>{this.highlightGraphics(null),e.onFinish()},onPause:()=>{this.highlightGraphics(null),e.onPause()}}),this.record=yield this._getFlyRecordDynamically(t.ids,this.getCurrentSceneView(),n);const r=this._getLimitionParamForPrepare(this.record,t);return{isCanPlay:!0,prepareState:yield this.record.prepare(r)}}))}playRouteFly(t,e){return T(this,void 0,void 0,(function*(){const i=a.o(this.itemConfig.routes,t),s=i.records.length-e,n=e,r=a.e(this.itemConfig.routes,t,e);this.initTask({routeUuid:i.idx,recordUuid:null==r?void 0:r.idx},n,s),yield this.playTask({init:!0})}))}initTask(t,e,i){this._resetPlayingInfo(),this.playingInfo.currentIds={ids:t,orderId:e-1},this.playingInfo.maxRecordLen=i,this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0;const s=this.getCurrentSceneView(),n=s.on("drag",t=>{this.playingInfo.isWaiting&&"start"===t.action&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())}),r=s.on("mouse-wheel",t=>{this.playingInfo.isWaiting&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())});this.playingInfo.eventHandlers.push(n),this.playingInfo.eventHandlers.push(r),this._nextPlayingInfo()}_nextPlayingInfo(){var t;this.playingInfo.currentIds.orderId++;const e={routeUuid:null===(t=this.playingInfo.currentIds.ids)||void 0===t?void 0:t.routeUuid,recordUuid:null},i=a.e(this.itemConfig.routes,e,this.playingInfo.currentIds.orderId);this.playingInfo.currentIds.ids={routeUuid:e.routeUuid,recordUuid:null==i?void 0:i.idx}}playTask(t){var e;return T(this,void 0,void 0,(function*(){if(this.playingInfo.isWaiting=!1,this.playingInfo.currentIds.orderId>=this.playingInfo.maxRecordLen)return void this._onAllRecordsFinish();const i={onFinish:this._onOneRecordFinish.bind(this,{}),onPause:this._onPause.bind(this,{})},s=a.e(this.itemConfig.routes,this.playingInfo.currentIds.ids,this.playingInfo.currentIds.orderId);if((null==t?void 0:t.init)||(null===(e=this.record)||void 0===e?void 0:e.getConfig().idx)!==(null==s?void 0:s.idx)){const t=yield this.prepareSpecifiedRecord({ids:this.playingInfo.currentIds.ids},i);if(!t.isCanPlay)return console.warn("playTask: skip a record"),i.onFinish(),!1;if(!t.prepareState)return i.onPause(),!1}const n=this.record.getConfig().endDelay;a.p(n)?this.playingInfo.continueDelay=n*this._computeRouteTaskTimeScale():this.playingInfo.continueDelay=0,yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}_onOneRecordFinish(){return T(this,void 0,void 0,(function*(){if(this._nextPlayingInfo(),a.p(this.playingInfo.continueDelay)){this.playingInfo.waittingPromise=this._abortWrapper(this.waitDelay(this.playingInfo.continueDelay));try{yield this.playingInfo.waittingPromise,yield this.playTask()}catch(t){}}else yield this.playTask()}))}waitDelay(t){return T(this,void 0,void 0,(function*(){return this.playingInfo.isWaiting=!0,yield new Promise((e,i)=>{setTimeout(()=>{e({})},1e3*t)})}))}interruptDelayWaiting(){var t;a.p(null===(t=this.playingInfo.waittingPromise)||void 0===t?void 0:t.abort)&&this.playingInfo.waittingPromise.abort(),this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0}_abortWrapper(t){return T(this,void 0,void 0,(function*(){let e;const i=new Promise((t,i)=>e=i),s=Promise.race([t,i]);return s.abort=e,s}))}_onPause(){var t;null===(t=this.flyStateCallbacks)||void 0===t||t.onPause()}_onAllRecordsFinish(){var t;this._resetPlayingInfo(),null===(t=this.flyStateCallbacks)||void 0===t||t.onFinish()}_resetPlayingInfo(){var t;a.p(null===(t=this.playingInfo)||void 0===t?void 0:t.eventHandlers)&&(this.playingInfo.eventHandlers.map(t=>{t.remove()}),this.playingInfo.eventHandlers=null,this.playingInfo.eventHandlers=[]),this.playingInfo={currentIds:{ids:null,orderId:0},maxRecordLen:0,waittingPromise:null,isWaiting:!1,continueDelay:0,eventHandlers:[]}}}var O=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class D{constructor(){this.sceneView=null}setup(t){return O(this,void 0,void 0,(function*(){return yield Object(r.loadArcGISJSAPIModules)(["esri/core/watchUtils"]).then(e=>{[this.watchUtils]=e,this.sceneView=t.sceneView,this.onTerrainLoaded=t.onTerrainLoaded,this.handleTerrainLoaded()}),this}))}handleTerrainLoaded(){return O(this,void 0,void 0,(function*(){yield Promise.race([this.getTerrainLoadedPromise(),this.getTimerPromise(1e4)]),this.onTerrainLoaded()}))}getTerrainLoadedPromise(){return O(this,void 0,void 0,(function*(){if(!this.sceneView||!this.sceneView.groundView)return!1;try{yield this.watchUtils.whenTrueOnce(this.sceneView.groundView,"updating"),yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}catch(t){return!1}return!0}))}getTimerPromise(t){return O(this,void 0,void 0,(function*(){return yield new Promise(e=>setTimeout(e,t))}))}}var k=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class F{constructor(t){this.findFirstUsedItem=()=>{for(let t=0,e=this.itemsList.length;t<e;t++){const e=this.itemsList[t];if(e.config.isInUse)return e}return{config:null,routes:null}},this.findFirstRouteItem=()=>{for(const t of this.itemsList)if(t.config.isInUse&&s.a.Route===t.config.name)return t;return{config:null,routes:null}},this._findItemIdx=t=>this.itemsList.findIndex(e=>e.config.uuid===t),this.getActiveItem=()=>this.activedItem,this.getActiveItemConfig=()=>{var t;return null===(t=this.activedItem)||void 0===t?void 0:t.config},this.getFlyStyle=()=>{var t;return null===(t=this.activedItem)||void 0===t?void 0:t.config.name},this.getRouteByIdx=t=>this.getActiveItem().routes,this.getRouteConfigByIdx=t=>{var e;const i=this.getActiveItemConfig();return null===(e=null==i?void 0:i.routes)||void 0===e?void 0:e.find(e=>e.idx===t.routeUuid)},this.getRecordConfigByIds=t=>{const e=this.getActiveItemConfig().routes;return Object(a.m)(e,t)},this.getRecordByIds=t=>{var e;const i=null===(e=this.activedItem.routes)||void 0===e?void 0:e.record;return t.recordUuid===(null==i?void 0:i.getConfig().idx)?i:null},this.isUesRouteFlyMode=()=>{const t=this.getActiveItemConfig();return(null==t?void 0:t.name)===s.a.Route},this.clear=()=>{},this.checkAndSwitchJimuMapBeforePlay=t=>k(this,void 0,void 0,(function*(){const e=this.getRecordConfigByIds(t);if(!Object(a.p)(e))return{isCanPlay:!1,hadSwitchedMap:!1};const i=this.isJimuMapViewInGroup(e.mapViewId),s=this.isCurrentJimuMap(e);return s?{isCanPlay:!0,hadSwitchedMap:!1}:i?s?{isCanPlay:!0,hadSwitchedMap:!1}:(this.onBeforeSwitchMap(),yield this.viewGroup.switchMap(),{isCanPlay:!0,hadSwitchedMap:!0}):(console.error("FlyManager.checkAndSwitchJimuMapBeforePlay: this RecordConfig can't fly in this JimuMap"),{isCanPlay:!1,hadSwitchedMap:!1})})),this.isRecordCanPlay=t=>{const e=this.isJimuMapViewInGroup(t.mapViewId),i=this.isCurrentJimuMap(t);return!!i||(!!e||(console.error("FlyManager.isRecordCanPlay: this RecordConfig can't fly in this JimuMap"),!1))},this.isJimuMapViewInGroup=t=>{var e;let i=null!=t?t:this.jimuMapView.id;i=Object(a.t)(i);const s=Object.keys(null===(e=this.viewGroup)||void 0===e?void 0:e.jimuMapViews).find(t=>Object(a.t)(t)===i);return!!Object(a.p)(s)},this.isCurrentJimuMap=t=>{var e;return t.mapViewId===Object(a.t)(null===(e=this.jimuMapView)||void 0===e?void 0:e.id)},this.getCurrentSceneView=()=>this.sceneView,this.stop(),this.onTerrainLoaded=t.onTerrainLoaded,this.onBeforeSwitchMap=t.onBeforeSwitchMap,this.drawOrUpdateGraphics=t.drawOrUpdateGraphics,this.highlightGraphics=t.highlightGraphics,this.onItemsUpdate=t.onItemsUpdate,this.isBuilderSettingFlag=t.isBuilderSettingFlag,this.updateViewGroup(t.viewGroup),this.updateJimuMapView(t.jimuMapView),this.uiLoadingCallbacks=t.uiLoadingCallbacks,this.flyStateCallbacks=t.flyStateCallbacks,this.updateItems(t.widgetConfig)}updateViewGroup(t){this.viewGroup=t}updateJimuMapView(t){var e;this.jimuMapView=t,this.sceneView=null===(e=this.jimuMapView)||void 0===e?void 0:e.view;const i=this.getActiveItem();Object(a.p)(null==i?void 0:i.routes)&&(null==i||i.routes.handleUpdateJimuMapView(t)),this.getTerrainLoadingHelper(this.sceneView,this.onTerrainLoaded)}updateItems(t){this.itemsList=[];const e=t.itemsList.asMutable({deep:!0});for(const t of e)t.isInUse&&this.itemsList.push({config:t,routes:null});"function"==typeof this.onItemsUpdate&&this.onItemsUpdate(this.itemsList)}destructor(){this.stop()}findItemByUuid(t){var e;let i=null;return i=null===(e=this.itemsList)||void 0===e?void 0:e.find(e=>e.config.uuid===t),i}registerItem(t){const e=this.findItemByUuid(t);this.activedItem=e}unRegisterItem(){var t;(null===(t=this.activedItem)||void 0===t?void 0:t.routes)&&this.activedItem.routes.destructor(),this.activedItem=null}getControllerTypeByItemData(t){let e;return t.name===s.a.Rotate?e=n.a.Rotate:t.name===s.a.Path&&(e=t.style),e}buildTemporaryRecordConfig(t,e,i){const r=this.getActiveItemConfig(),a=this.getFlyStyle();let o;a===s.a.Rotate?o=n.a.Rotate:a===s.a.Path&&(o=this.getControllerTypeByItemData(r));return{idx:null,type:o,displayName:"runtime",duration:null,startDelay:null,endDelay:null,angle:null,controllerConfig:{cameraInfo:e,liveviewSettingState:null},direction:r.direction,storedGraphicsInfo:{type:j.RawData,rawData:t.getConfig()},mapViewId:i.id}}buildTemporaryRecord(t,e,i,s){return k(this,void 0,void 0,(function*(){const n=yield(new A).setup(t,e,i);return Object(a.p)(s)&&n.setGraphicsInfo(s),n}))}prepareRoutePreview(t,e){return k(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return!1;const i=this.getActiveItem();return yield this.setupFly(i.config,null,null!=e?e:this.flyStateCallbacks),yield this.prepare({ids:{routeUuid:t.routeUuid},waittingForTerrain:!1})}))}previewSpecifiedRoute(t,e,i){return k(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const s=this.getActiveItem(),n=null!=i?i:this.flyStateCallbacks;Object(a.p)(s.routes)||(yield this.prepareRoutePreview(e,n)),yield this.fly({ids:e,settingSpeed:t,isPreviewSpecifiedRecord:!1},n)}))}previewSpecifiedRecord(t,e){return k(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const{isCanPlay:i}=yield this.checkAndSwitchJimuMapBeforePlay(t);if(!i)return;const s=this.getActiveItem();yield this.setupFly(s.config,null,e);(yield this.prepare({ids:t,isBuilderSettingFlag:this.isBuilderSettingFlag}))&&(yield this.fly({ids:t,settingSpeed:null,isPreviewSpecifiedRecord:!0}))}))}setIsLiveviewSpecifiedRecord(t,e){return k(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const i=this.getActiveItem();if(Object(a.p)(i.routes)||(yield this.setupFly(i.config,null),yield this.prepare({ids:t,animate:!1})),yield this.setIsLiveview(e,t),e){const t=yield this.getLiveviewSettingInfo();this.onLiveviewParamChange(t,{isNeedHighlight:!0})}}))}loadingForUI(t){const e=null!=t?t:this.uiLoadingCallbacks;"function"==typeof e.onLoading&&e.onLoading()}loadedForUI(t){const e=null!=t?t:this.uiLoadingCallbacks;"function"==typeof e.onLoaded&&e.onLoaded()}setupFly(t,e,i,s){return k(this,void 0,void 0,(function*(){const n=this.getActiveItem();n.routes&&n.routes.destructor();const r=null!=i?i:this.flyStateCallbacks;return n.routes=yield(new R).setup(t,e,this.jimuMapView,r,this.drawOrUpdateGraphics,this.highlightGraphics,this.checkAndSwitchJimuMapBeforePlay,this.getCurrentSceneView,s),n}))}prepare(t){var e;return k(this,void 0,void 0,(function*(){const i=this.getActiveItem();return Object(a.p)(i)?yield null===(e=i.routes)||void 0===e?void 0:e.prepare(t):null}))}fly(t,e){var i,s;return k(this,void 0,void 0,(function*(){const n=this.getActiveItem();if(!Object(a.p)(n))return null;e&&(null===(i=n.routes)||void 0===i||i.handleUpdateFlyCallbacks(e)),yield null===(s=n.routes)||void 0===s?void 0:s.fly(t)}))}pause(){var t;return k(this,void 0,void 0,(function*(){const e=this.getActiveItem();if(!Object(a.p)(e))return null;yield null===(t=e.routes)||void 0===t?void 0:t.pause()}))}stop(t={isUpdate:!1}){var e;return k(this,void 0,void 0,(function*(){const i=this.getActiveItem();if(!Object(a.p)(i))return null;yield null===(e=i.routes)||void 0===e?void 0:e.stop(t.isUpdate)}))}getProgress(){}getLiveviewSettingInfo(){const t=this.getActiveItem();return Object(a.p)(t)?t.routes.getLiveviewSettingInfo():null}getDefaultDuration(){var t;const e=this.getActiveItem();return Object(a.p)(e)?null===(t=e.routes)||void 0===t?void 0:t.getDefaultDuration():null}setIsLiveview(t,e){return k(this,void 0,void 0,(function*(){const i=this.getActiveItem();return Object(a.p)(i)?yield i.routes.setIsLiveview(t,e):null}))}onLiveviewParamChange(t,e){var i;return k(this,void 0,void 0,(function*(){const s=this.getActiveItem();if(!Object(a.p)(s))return null;yield null===(i=s.routes)||void 0===i?void 0:i.setLiveviewSettingInfo(t,e)}))}setSpeedFactor(t){var e;return k(this,void 0,void 0,(function*(){const i=this.getActiveItem();if(!Object(a.p)(i))return null;yield null===(e=i.routes)||void 0===e?void 0:e.setSpeedFactor(t)}))}getTerrainLoadingHelper(t,e){return k(this,void 0,void 0,(function*(){this.terrainLoadingHelper=yield(new D).setup({sceneView:t,onTerrainLoaded:e})}))}}},125:function(t,e){t.exports='<svg viewBox="0 0 15 16" xmlns="http://www.w3.org/2000/svg"><path d="M5.3 3.383l9 6.285h-3.874l2.316 4.421-2.687 1.294-2.373-4.498L5.3 14.009V3.383zM6.299 5.3v5.748l1.537-2.014 2.653 5.029.886-.426-2.601-4.97h2.347L6.299 5.3zm-2.82 1.426l.529.721-2.579 1.191-.389-.784 2.44-1.128zM.648 3.697l2.624.894-.117.883-2.806-.957.299-.82zm10.946-.723l.389.784-2.579 1.193-.25-.85 2.44-1.127zM8.489.072l.848.29-.989 2.71-.784-.465.925-2.535zM4.392.521l.974 1.966-.812.375L3.58.896 4.392.52z" fill="#000" fill-rule="nonzero"></path></svg>'},126:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 1c-2.209 0-4 .852-4 3.067v7.922L8 16l4-4.01V4.066C12 1.852 10.209 1 8 1zm3.1 10.686L8 14.794l-3.1-3.108v-7.76C4.9 2.51 5.943 1.79 8 1.79c2.057 0 3.1.719 3.1 2.137v7.759zM10 6.022a2 2 0 11-4 0 2 2 0 014 0zm-1 0a1 1 0 10-2 0 1 1 0 002 0z" fill="#000" fill-rule="nonzero"></path></svg>'},127:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.793 1.3a.983.983 0 011.32-.086l.094.086 5.5 5.624c.36.368.388.948.083 1.35l-.083.096-6.5 6.646a.992.992 0 01-.576.29l-.131.01h-4a.986.986 0 01-.608-.211l-.099-.089-3.5-3.579a1.04 1.04 0 01-.083-1.35l.083-.096 8.5-8.691zm.707.706L1.008 10.69c-.007.008-.01.022-.007.033l.007.015 3.497 3.577h3.989l6.498-6.645c.007-.007.01-.02.007-.032l-.007-.015L9.5 2.006zM4.844 8.5l-1.838 1.85c-.005.005-.007.015-.005.024l.005.01L5.504 13h2.849l.413-.358c.005-.006.007-.016.005-.024l-.005-.011L4.844 8.5z" fill="#000" fill-rule="nonzero"></path></svg>'},128:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.957.057A8.001 8.001 0 018 16 8 8 0 011.763 2.99l.249.24.093.993A7 7 0 108 1l.213.004.744-.947zM8 7a1 1 0 110 2 1 1 0 010-2zM1 0l6.734.46L2.86 5.377v-2.99L1 0z" fill="#000" fill-rule="nonzero"></path></svg>'},129:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M1 14a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2zm7-9l-.812 9-2.75-3.335L3 9.328 11 4zm-5 7a1 1 0 110 2 1 1 0 010-2zm6-10a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2z" fill="#000" fill-rule="evenodd"></path></svg>'},130:function(t,e){t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.619 3l-1.94-1.616.641-.768L15.781 3.5l-3.46 2.884-.641-.768L13.62 4H3.87a2.37 2.37 0 100 4.74h8.25a3.38 3.38 0 010 6.76H2.167v-1h9.953a2.38 2.38 0 000-4.76H3.87a3.37 3.37 0 110-6.74h9.749z" fill="#000"></path></svg>'},131:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M15 8L1 0v16l14-8zM2 1.723l10.983 6.276L2 14.276V1.723z" fill="#000" fill-rule="nonzero"></path></svg>'},132:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 1v14H4V1h1zm7 0v14h-1V1h1z" fill="#000" fill-rule="nonzero"></path></svg>'},20:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return l}));var s,n=i(4),r=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class a{constructor(){this.symbolJsonUtils=null,this.getDefaultPointSymbol=t=>this.symbolJsonUtils.fromJSON({type:"PointSymbol3D",symbolLayers:[{type:"Icon",material:{color:t},size:12,outline:{color:[255,255,255],size:.75}}],verticalOffset:{screenLength:5,minWorldLength:5,maxWorldLength:10},callout:{type:"line",color:[255,255,255],size:2,border:{color:[50,50,50]}}}),this.getDefaultLineSymbol=t=>this.symbolJsonUtils.fromJSON({type:"LineSymbol3D",symbolLayers:[{type:"Line",material:{color:t,transparency:50},join:"round",cap:"round",size:2.25}]})}setup(){return r(this,void 0,void 0,(function*(){return yield Object(n.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then(t=>r(this,void 0,void 0,(function*(){[this.symbolJsonUtils]=t}))),this}))}}!function(t){t[t.Default=0]="Default",t[t.Custom=1]="Custom"}(s||(s={}));class o{constructor(t){return this.update(t)}update(t){const{graphics:e,isPicked:i}=t;return this.setGraphics(e),this.isPicked=i,this.symbolType=s.Default,this}setGraphics(t){this.graphics=t}getGraphics(){return this.graphics}destructor(){}getMainGraphic(){return this.graphics?this.graphics[0]:null}updateByConfig(){}getConfig(){var t;const e={graphics:null,isPicked:this.isPicked,symbolType:s.Default};return e.graphics=null===(t=this.graphics)||void 0===t?void 0:t.map(t=>{const e=t.clone();if(e.symbol=null,e.toJSON)return e.toJSON()}),e}}class l{}l.SPEED={MIN:0,MAX:1,MULTIPLIER:8,DECIMAL:3,DEFAULT_SPEED:50},l.ALT={MIN:0,MAX:800,STEP:10},l.TILT={MIN:0,MAX:90,STEP:1},l.TIME={MIN:0},l.CALCULATED_VALUE_ROUNDED={ANGLE:0,ELEV:1,TIME:1}},247:function(t,e){t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity=".01" fill="#076FE5" d="M0 0h16v16H0z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M.5 2a.5.5 0 000 1h15a.5.5 0 000-1H.5zM0 7.5A.5.5 0 01.5 7h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5zm0 5a.5.5 0 01.5-.5h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5z" fill="#076FE5"></path></svg>'},248:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M9.636 0a.51.51 0 01.503.4c.174.825.294 1.53.362 2.117.427.183.828.414 1.197.684l1.975-.772a.52.52 0 01.636.214L15.93 5.38a.49.49 0 01-.104.625 25.124 25.124 0 01-1.703 1.364 5.906 5.906 0 01-.008 1.352L15.789 10c.201.153.256.427.128.642l-1.622 2.737a.52.52 0 01-.607.225 25.675 25.675 0 01-2.065-.754 6.076 6.076 0 01-1.206.67l-.3 2.05a.51.51 0 01-.509.429H6.364a.51.51 0 01-.503-.4 24.02 24.02 0 01-.362-2.117 6.105 6.105 0 01-1.197-.684l-1.975.772a.52.52 0 01-.636-.214L.07 10.62a.49.49 0 01.104-.625 25.127 25.127 0 011.702-1.364 5.906 5.906 0 01.009-1.352L.211 6a.491.491 0 01-.128-.642L1.705 2.62a.52.52 0 01.607-.225c.822.267 1.51.519 2.065.754.37-.265.776-.49 1.207-.67l.3-2.05A.51.51 0 016.392 0h3.244zm-.421 1H6.837l-.319 2.178-.531.22a5.078 5.078 0 00-.766.398l-.235.159-.477.341-.542-.23c-.375-.16-.819-.328-1.332-.505l-.252-.086L1.194 5.48l1.778 1.36-.069.558a4.932 4.932 0 00-.024.952l.017.169.066.574-.477.343c-.329.236-.7.526-1.114.87l-.202.169 1.187 2.006 2.1-.82.463.339c.232.17.478.32.734.448l.26.12.54.232.066.571c.046.395.118.854.217 1.374l.05.255h2.376l.32-2.178.532-.221c.268-.112.524-.244.765-.397l.236-.159.476-.341.543.23c.374.16.818.328 1.33.505l.252.085 1.189-2.005-1.777-1.359.069-.558a4.932 4.932 0 00.023-.952l-.016-.167-.067-.575.478-.343c.328-.237.7-.527 1.114-.87l.201-.171-1.187-2.006-2.1.82L11.081 4a5.094 5.094 0 00-.734-.448l-.26-.12-.54-.232-.066-.571c-.037-.316-.09-.673-.16-1.07L9.214 1zM8 5c1.701 0 3.08 1.343 3.08 3S9.701 11 8 11 4.92 9.657 4.92 8 6.299 5 8 5zm0 1c-1.134 0-2.053.895-2.053 2S6.866 10 8 10s2.053-.895 2.053-2S9.134 6 8 6z" fill="#000" fill-rule="nonzero"></path></svg>'},249:function(t,e){t.exports='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="#FFF" fill-rule="nonzero"><path d="M19.38 1.552l-3.572 13.942-6.932-2.175 2.626-3.482-4.424 2.952-6.482-1.996 18.783-9.241zM17.87 3.408l-14.574 7.17 3.621 1.115 8.93-5.958-5.32 7.054 4.573 1.435 2.77-10.816zM8.656 18.25l2.282-3.169-2.282-.666v3.836z"></path></g></svg>'},25:function(t,e,i){"use strict";i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return v}));var s=i(4),n=i(3);class r{constructor(t){this.GraphicsLayer=null,this.Point=null,this.clearAll=()=>{n.p(this.auxGraphicsLayer)&&this.auxGraphicsLayer.removeAll(),n.p(this.auxMovingObjLayer)&&this.auxMovingObjLayer.removeAll()},this.deposeMoving=()=>{this.auxMovingObjLayer.removeAll()},this.drawPoint=(t,e)=>{const i=n.p(e)?e:"darkgreen",s=new this.Graphic({geometry:t,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:i},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(s),s},this.drawPointGL=(t,e)=>{const i=n.u(t,1,this.sceneView),s=new this.Point({x:i[0],y:i[1],z:i[2],spatialReference:this.sceneView.spatialReference});s.z<100&&(s.z=100);const r=n.p(e)?e:"darkgreen",a=new this.Graphic({geometry:s,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:r},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(a),a},this.drawLine=(t,e)=>{const i=n.p(e)?e:"lightblue",s=new this.Graphic({geometry:{type:"polyline",paths:t,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:i},size:3}]}});return this.auxGraphicsLayer.add(s),s},this.drawLineXY=(t,e)=>{const i=[];for(let e=0,s=t.length;e<s;e++){const s=t[e],n=s[0],r=s[1],a=s[2];0===a?i.push([n,r]):i.push([n,r,a])}const s=n.p(e)?e:"lightblue",r=new this.Graphic({geometry:{type:"polyline",paths:i,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(r),r},this.drawLineGL=(t,e,i)=>{const s=n.p(i)?i:"lightblue",r=[];for(let i=0,s=t.length;i<s;i++){const s=t[i],a=n.u(s,1,e);r.push(a)}const a=new this.Graphic({geometry:{type:"polyline",paths:r,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(a),a},Object(s.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/Graphic","esri/views/3d/support/projectionUtils","esri/geometry/support/webMercatorUtils"]).then(t=>{[this.GraphicsLayer,this.Point,this.Graphic,this.projectionUtils,this.webMercatorUtils]=t,this.auxGraphicsLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxGraphicsLayer),this.auxMovingObjLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxMovingObjLayer)}),this.sceneView=t.sceneView}}var a=i(20),o=i(37),l=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class h{constructor(){this.easing=(t,e)=>{switch(this.state.mode){case o.a.In:return this.easingIn(t,e);case o.a.InOut:return this.easingInOut(t,e);case o.a.Linear:return this.linear(t,e);case o.a.NONE:return this.uniformSpeed(t,e)}},this.uniformSpeed=(t,e)=>{this.updateCurrentDuration(t*e);const i=this.getMovementByFrame(t)*e;return this.state.progress=0,{interp:0,step:i,progress:this.state.progress}},this.linear=(t,e)=>{const i=this.updateCurrentDuration(t*e);let s=0,n=0;return i<this.state.interp.time.duration?(s=o.b.linear(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.easingIn=(t,e)=>{const i=this.updateCurrentDuration(t*e);let s=0,n=0;return i<this.state.interp.time.duration?(s=o.b.easeIn(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.interp.cache.lastStep=n):n=this.state.interp.cache.lastStep*e,this.state.progress=-1,{interp:s,step:n,progress:this.state.progress}},this.easingInOut=(t,e)=>{const i=this.updateCurrentDuration(t*e);let s=0,n=0;return i<this.state.interp.time.duration?(s=o.b.easeInOut(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.getMovementByFrame=t=>this.getSpeed()/(1e3/t)}setup(){return l(this,void 0,void 0,(function*(){return yield Object(s.loadArcGISJSAPIModules)(["esri/core/scheduling"]).then(t=>{[this.scheduling]=t}),this.state={speed:a.a.SPEED.DEFAULT_SPEED,mode:o.a.NONE,progress:0,amount:-1,interp:{time:{begin:0,currentDuration:0,duration:1e4},value:{start:0,end:0},cache:{lastVal:0,lastStep:0}}},this.animatHandler=null,this}))}getState(){return this.state}setState(t){this.state=t}init(t,e,i,s){this.state.mode=t,this.state.interp.value.start=e,this.state.interp.value.end=i,this.state.interp.time.duration=s}reset(){this.state.interp.time.begin=0,this.state.interp.time.currentDuration=0,this.state.progress=0}computeDuration(){return this.state.amount/this.state.speed*1e3}getDuration(){return this.state.interp.time.duration}setAmount(t){return this.state.amount=t,this}getAmount(){return this.state.amount}getProgress(){return this.state.progress}progressForward(){return this.state.progress+=1e-4,this.state.progress}progressBackward(){return this.state.progress-1e-4}updateCurrentDuration(t){return this.state.interp.time.currentDuration=this.state.interp.time.currentDuration+t,isNaN(this.state.interp.time.currentDuration)&&(this.state.interp.time.currentDuration=0),this.state.interp.time.currentDuration}getSpeed(){return this.state.speed}setSpeed(t){this.state.speed=t}update(t){return l(this,void 0,void 0,(function*(){null===this.animatHandler&&(this.animatHandler=this.scheduling.addFrameTask({update:e=>{t(e)}}))}))}stop(){null!==this.animatHandler&&(this.animatHandler.pause(),this.animatHandler.remove(),this.animatHandler=null)}insertAnExtraFrame(t){var e;null===(e=this.scheduling)||void 0===e||e.schedule(e=>{t(e)})}}class c{constructor(){return this.abort(),this.update(),this}destructor(){this.signalHandler&&(this.signalHandler.abort(),this.signalHandler=null)}update(){return this.signalHandler=null,this.signalHandler=new AbortController,this.signalHandler.signal}abort(){var t;(null===(t=this.signalHandler)||void 0===t?void 0:t.signal)&&this.signalHandler.abort()}}class d{constructor(){this.DEFAULT_SPEED=(a.a.SPEED.MIN+a.a.SPEED.MAX)/2,this.state=d._getDefualtLiveviewSetting()}static _getDefualtLiveviewSetting(){return{speedFactor:.5,fixHeading:NaN,fixTilt:NaN,fixAltitude:0,initCamOffset:{height:60,distance:90}}}getState(){return this.state}setState(t){this.state=t}getCamOffsetHeight(){return this.state.initCamOffset.height}getCamOffsetDistance(){return this.state.initCamOffset.distance}setSpeedFactor(t){let e;e=void 0===t?this.DEFAULT_SPEED:t,this.state.speedFactor=parseFloat(e)}getSpeedFactor(){return void 0===this.state.speedFactor?.5:this.state.speedFactor}getMappingSpeedFactor(){if(void 0===this.state.speedFactor)return this.DEFAULT_SPEED;return Object(n.x)(this.state.speedFactor)}setHeadingFactor(t){let e=0;void 0!==t&&(e=t),this.state.fixHeading=e}getHeadingFactor(){return Object(n.p)(this.state.fixHeading)?this.state.fixHeading:0}setTiltFactor(t){let e=0;void 0!==t&&(e=t),this.state.fixTilt=e}getTiltFactor(t){return t||Object(n.p)(this.state.fixTilt)?this.state.fixTilt:0}setAltitudeFactor(t){let e=0;void 0!==t&&(e=t),this.state.fixAltitude=e}getAltitudeFactor(t){return t||Object(n.p)(this.state.fixAltitude)?this.state.fixAltitude:0}}var u,p,g=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};!function(t){t.Rotate="ROTATE",t.Smoothed="CURVED",t.RealPath="LINE"}(u||(u={})),function(t){t[t.INITED=-1]="INITED",t[t.PREPARING=0]="PREPARING",t[t.PREPARED=1]="PREPARED",t[t.RUNNING=2]="RUNNING",t[t.STOPPED=3]="STOPPED"}(p||(p={}));class v{constructor(){this.Camera=null,this._resume=t=>g(this,void 0,void 0,(function*(){yield this.preparing();return!!(yield t)&&(yield this.prepared(),this._doFly(),!0)})),this.rotateBySceneMode=(t,e,i,s)=>{const r=this.vec3d.fromValues(t[0],t[1],t[2]),a=this.vec3d.create();n.p(s)&&(this.vec3.negate(a,s),this.vec3.add(r,r,a));const o=this.mat4d.create();return this.mat4.rotate(o,o,n.c(i),e),this.vec3.transformMat4(r,r,o),n.p(s)&&this.vec3.subtract(r,r,a),r},this.queryGeometryElevInfo=t=>{var e;return n.p(null===(e=this.sceneView.groundView)||void 0===e?void 0:e.elevationSampler)?this.sceneView.groundView.elevationSampler.queryElevation(t):t.hasZ?t:void 0},this._coordsToGeoArray=t=>{const e=[];let i;for(let s=0,n=t.length;s<n;s++)i=this.vec3d.fromValues(t[s].x,t[s].y,t[s].z),e.push(i);return e},this.getPrepareGoToOptionsBeforeTerrainLoaded=t=>{const e={animate:!0,maxDuration:4e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return t&&!t.animate&&(e.animate=!1,delete e.maxDuration,delete e.easing),e},this.getPrepareGoToOptionsAfterTerrainLoaded=t=>{const e={animate:!0,maxDuration:1e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return t&&!t.animate&&(e.animate=!1,delete e.maxDuration,delete e.easing),e}}setup(t){return g(this,void 0,void 0,(function*(){return yield Object(s.loadArcGISJSAPIModules)(["esri/core/libs/gl-matrix-2/vec3f64","esri/core/libs/gl-matrix-2/mat4f64","esri/core/libs/gl-matrix-2/vec3","esri/core/libs/gl-matrix-2/mat4","esri/core/libs/gl-matrix-2/quatf64","esri/core/libs/gl-matrix-2/quat","esri/views/3d/support/cameraUtils","esri/views/3d/webgl-engine/lib/Camera","esri/geometry/Point","esri/views/3d/support/mathUtils","esri/core/watchUtils","esri/Camera"]).then(e=>g(this,void 0,void 0,(function*(){[this.libVec3f64,this.libMat4f64,this.libVec3,this.libMat4,this.libQuatf64,this.libQuat,this.cameraUtils,this.GLCamera,this.Point,this.esriMathUtils,this.watchUtils,this.Camera]=e,this.vec3=this.libVec3.vec3,this.vec3d=this.libVec3f64.vec3f64,this.mat4=this.libMat4.mat4,this.mat4d=this.libMat4f64.mat4f64,this.quat=this.libQuat.quat,this.quatd=this.libQuatf64.quatf64,yield this.clear();const{id:i,type:s,geometry:a,direction:o,config:l,sceneView:h,flyCallbacks:c}=t;this.id=i,this.type=s,this.geometry=a,this.direction=o,this.cameraInfo=l.cameraInfo,n.p(l.liveviewSettingState)&&this.liveviewSetting.setState(l.liveviewSettingState),this.sceneView=h,this.flyCallbacks=c,this._isDebug=!1,this._isDebug&&(this.auxHelper=new r({sceneView:this.sceneView})),this.DEBUG={planTime:0,startTime:0,endTime:0},this.eventHandlers.push(this.sceneView.on("drag",t=>{this.flyState<=p.RUNNING&&"start"===t.action&&this.pause()})),this.eventHandlers.push(this.sceneView.on("mouse-wheel",t=>{this.flyState<=p.RUNNING&&this.pause()}))}))),this}))}destructor(){this.onStop(),this.clear()}isInited(){return this.flyState>=p.INITED}isEnableToFly(){const t=this.flyState;return t===p.PREPARED||t===p.STOPPED||t===p.PREPARING}isEnableToPause(){return this.flyState>=p.PREPARING}init(){this.flyState=p.INITED,this.animate.reset()}preparing(){var t;return g(this,void 0,void 0,(function*(){this.flyState=p.PREPARING,"function"==typeof(null===(t=this.flyCallbacks)||void 0===t?void 0:t.onPreparing)&&this.flyCallbacks.onPreparing()}))}prepared(){return g(this,void 0,void 0,(function*(){return this.flyState=p.PREPARED,setTimeout(()=>{},50)}))}_doFly(){this.isLiveviewMode||this.onStart()}setConfig(t){this.cameraInfo=t.cameraInfo,this.liveviewSetting.setState(t.liveviewSettingState)}getConfig(){return{cameraInfo:this.cameraInfo,liveviewSettingState:this.liveviewSetting.getState()}}pause(){return g(this,void 0,void 0,(function*(){return!!this.isEnableToPause()&&(this.stopAnimat(),this.onPause(),!0)}))}resume(t){return g(this,void 0,void 0,(function*(){}))}stop(){this.stopAnimat(),this.onStop()}clear(){var t,e,i,s;return g(this,void 0,void 0,(function*(){n.p(this.eventHandlers)&&this.eventHandlers.map(t=>{t.remove()}),this.eventHandlers=null,this.eventHandlers=[],this.abortSignalHandler&&this.abortSignalHandler.abort(),this.abortSignalHandler=null,this.abortSignalHandler=new c,this._isDebug&&(null===(t=this.auxHelper)||void 0===t||t.clearAll()),n.p(null===(e=this._cache)||void 0===e?void 0:e.paths)&&(null===(i=this._cache)||void 0===i||i.paths.destructor()),this.id=null,this.type=null,this.geometry=null,this.direction=null,this.cameraInfo=null,this.sceneView=null,this.flyCallbacks=null,this.auxHelper=null,null===(s=this.animate)||void 0===s||s.stop(),this.animate=null,this.animate=yield(new h).setup(),this.liveviewSetting=null,this.liveviewSetting=new d,this.flyState=null,this.isLiveviewMode=!1,this.shownProgress=0,this._cache={paths:null,cachedGeo:null,cameraGL:{pos:null,upDir:null},lookAtTargetGL:{pos:null,upAxis:null,baseAlt:null}},this._isDebug=!1,this.DEBUG={planTime:null,startTime:null,endTime:null}}))}updateAnimat(t){return g(this,void 0,void 0,(function*(){return yield this.animate.update(e=>{t(e)})}))}stopAnimat(){this.animate.stop(),this.updateProgressBar()}setIsLiveview(t){return g(this,void 0,void 0,(function*(){return this.isLiveviewMode=t,t?yield this.fly({animate:!1}):yield this.pause()}))}setLiveviewSettingInfo(t,e){return g(this,void 0,void 0,(function*(){if(!n.p(t))return!1;let i=!1;const s=t.altitude;void 0!==s&&(i=!0,this.liveviewSetting.setAltitudeFactor(s));const r=t.tilt;return void 0!==r&&(i=!0,this.liveviewSetting.setTiltFactor(r)),i&&n.p(this.animate)&&this.isLiveviewMode&&this.animate.insertAnExtraFrame(t=>g(this,void 0,void 0,(function*(){yield e(t)}))),!0}))}getDefaultDuration(){return this.flyState>=p.PREPARED?this.animate.getDuration():null}onStart(){var t;this.flyState=p.RUNNING,this._isDebug&&(this.DEBUG.planTime=this.animate.state.interp.time.duration,this.DEBUG.startTime=(new Date).getTime()),"function"==typeof(null===(t=this.flyCallbacks)||void 0===t?void 0:t.onFly)&&this.flyCallbacks.onFly()}onPause(){var t;this.abortSignalHandler.abort(),this.flyState=p.STOPPED,"function"==typeof(null===(t=this.flyCallbacks)||void 0===t?void 0:t.onPause)&&this.flyCallbacks.onPause()}onStop(){var t;if(this.abortSignalHandler.abort(),this.flyState=p.STOPPED,this._isDebug){this.DEBUG.endTime=(new Date).getTime();const t=(this.DEBUG.endTime-this.DEBUG.startTime)/1e3,e=this.DEBUG.planTime/1e3;console.log("DEBUG 1.fly sum time ==> "+t.toFixed(2)+" s"),console.log("DEBUG 2.plan time ==> "+e.toFixed(2)+" s");const i=(t-e)/e*100;console.log("DEBUG 3.mistake ==> "+i.toFixed(5)+" %")}"function"==typeof(null===(t=this.flyCallbacks)||void 0===t?void 0:t.onFinish)&&this.flyCallbacks.onFinish()}updateProgressBar(){var t,e;if("function"==typeof(null===(t=this.flyCallbacks)||void 0===t?void 0:t.onUpdateProgress)){const t=Math.ceil(100*this.getProgress());let i=!1;(t<=1||t>=99||Math.abs(t-this.shownProgress)>=1)&&(i=!0),i&&(this.shownProgress=t),i&&(null===(e=this.flyCallbacks)||void 0===e||e.onUpdateProgress(this.shownProgress))}}concatGeoPaths(t){let e=[];for(let i=0;i<t.paths.length;i++)e=e.concat(t.paths[i]);return e}geoCoordToRenderCoord(t){const e=[];for(let i=0,s=t.length;i<s;i++){let s=t[i];s=n.g([s[0],s[1],s[2]],null,this.sceneView),e.push(s)}return e}}},3:function(t,e,i){"use strict";i.d(e,"g",(function(){return o})),i.d(e,"u",(function(){return l})),i.d(e,"c",(function(){return h})),i.d(e,"s",(function(){return c})),i.d(e,"d",(function(){return d})),i.d(e,"w",(function(){return u})),i.d(e,"q",(function(){return p})),i.d(e,"n",(function(){return g})),i.d(e,"r",(function(){return v})),i.d(e,"h",(function(){return f})),i.d(e,"i",(function(){return m})),i.d(e,"x",(function(){return y})),i.d(e,"k",(function(){return w})),i.d(e,"v",(function(){return b})),i.d(e,"b",(function(){return C})),i.d(e,"a",(function(){return P})),i.d(e,"y",(function(){return S})),i.d(e,"o",(function(){return I})),i.d(e,"m",(function(){return x})),i.d(e,"e",(function(){return L})),i.d(e,"j",(function(){return j})),i.d(e,"f",(function(){return G})),i.d(e,"t",(function(){return A})),i.d(e,"p",(function(){return T})),i.d(e,"l",(function(){return R}));var s=i(86),n=(i(0),i(8)),r=i(41),a=i(20);function o(t,e,i){const n=T(e)?e:1,r=[];return s.toRenderCoordinates(i,t,0,null,r,0,n),r}function l(t,e,i){const n=T(e)?e:1,r=[];return s.fromRenderCoordinates(i,t,0,r,0,null,n),r}function h(t){return t*Math.PI/180}function c(t){return 180*t/Math.PI}function d(t,e){const i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],r=i*i+s*s+n*n;return Math.sqrt(r)}function u(t){return t<0?-1:t>0?1:0}function p(t,e,i){const s=[];return s[0]=(e[0]-t[0])*i+t[0],s[1]=(e[1]-t[1])*i+t[1],s[2]=(e[2]-t[2])*i+t[2],s}function g(t,e,i,s,n,r,a){const o=t,l=null!=e?e:null,h=null!=i?i:null;if(null===l||null===h)return 0;const d=n.create();s.subtract(d,l,o);const u=n.create();s.subtract(u,h,l);const p=n.create();r.renderCoordsHelper.worldUpAtPosition(l,p);return c(a.angle(d,u,p))}function v(t,e){return e.groundView.elevationSampler.queryElevation(t)}function f(t){let e=0;for(let i=0,s=t.length;i<s;i++){const s=t[i];T(s)&&!1!==s.isInUse&&e++}return e}function m(t,e){return t===n.a.Rotate?e.intl.formatMessage({id:"flyStyleRotate",defaultMessage:r.a.flyStyleRotate}):t===n.a.Path?e.intl.formatMessage({id:"flyStylePath",defaultMessage:r.a.flyStylePath}):t===n.a.Route?e.intl.formatMessage({id:"flyStyleRoute",defaultMessage:r.a.flyStyleRoute}):null}function y(t,e){const i=a.a.SPEED.MIN,s=a.a.SPEED.MAX,n=a.a.SPEED.MULTIPLIER;let r;const o=(s-i)/2;return t<o?r=1/((o-t)/o*n):(r=(t-o)/(s-o)*n,0===r&&(r=1)),parseFloat(r.toFixed(T(e)?e:a.a.SPEED.DECIMAL))}function w(){return{speed:.5,tilt:0,altitude:0}}function b(t,e){return C(Number(t)).toString()+" "+e}function C(t){return M((null==t?void 0:t.toFixed)?parseFloat(t.toFixed(a.a.CALCULATED_VALUE_ROUNDED.ANGLE)):NaN)}function P(t){return M((null==t?void 0:t.toFixed)?parseFloat(t.toFixed(a.a.CALCULATED_VALUE_ROUNDED.ELEV)):NaN)}function S(t){return M((null==t?void 0:t.toFixed)?parseFloat(t.toFixed(a.a.CALCULATED_VALUE_ROUNDED.TIME)):NaN)}function M(t){return null===t||isNaN(t)?0:t}function I(t,e){return null==t?void 0:t.find(t=>t.idx===e.routeUuid)}function x(t,e){var i;const s=I(t,e);return null===(i=null==s?void 0:s.records)||void 0===i?void 0:i.find(t=>t.idx===e.recordUuid)}function L(t,e,i){const s=I(t,e);return null==s?void 0:s.records[i]}function j(t,e){const i=e+" ";let s=0;return t.forEach(t=>{let e;const n=t.displayName.split(i);T(n)&&2===n.length&&""===n[0]&&(e=n[1],/^\d+$/.test(e)&&(e=parseInt(e),s=Math.max(e,s)))}),`${i}${s+1}`}function G(t){return"fly__"+t}function A(t){return(null==t?void 0:t.startsWith("fly__"))?t.replace("fly__",""):t}function T(t){return null!=t}function R(t,e,i){return{isTriggeredByFly:e===t,isTriggeredByMapSelf:e===i}}},37:function(t,e,i){"use strict";var s;i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return n})),function(t){t[t.NONE=0]="NONE",t[t.In=1]="In",t[t.Out=2]="Out",t[t.InOut=3]="InOut",t[t.Linear=4]="Linear"}(s||(s={}));class n{}n.linear=(t,e,i,s)=>i*t/s+e,n.easeIn=(t,e,i,s)=>i*(t/=s)*t+e,n.easeOut=(t,e,i,s)=>-i*(t/=s)*(t-2)+e,n.easeInOut=(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},4:function(t,e){t.exports=s},41:function(t,e,i){"use strict";e.a={_widgetLabel:"Fly Controller",chooseMapTip:"Please select a map with 3D data.",configErrorTip:"Please select at least one fly style.",flyStyleRotate:"Rotate fly",flyStylePath:"Fly along path",flyStyleRoute:"Plan routes",triggerDrawPoint:"Draw a point",triggerDrawPath:"Draw a path",triggerSelectFeature:"Select a feature",triggerClear:"Clear drawing or selection",speed:"Speed",heading:"Heading",plannedRoutesTip:"Routes"}},45:function(t,e){t.exports=n},487:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return D}));var s,n=i(0),r=i(1),a=i(4),o=i(3),l=i(41);!function(t){t[t.Choose3DMap=0]="Choose3DMap",t[t.ConfigError=1]="ConfigError"}(s||(s={}));class h{constructor(t){this.getDefaultError=()=>this.chooseMapTip,this.isError=()=>this.isNoMapId()||this.isNoScene()||this.isNoModeInSetting(),this.setError=t=>{t!==this.widget.state.errorTip&&this.widget.setState({errorTip:t})},this.setErrorByType=t=>{t===s.Choose3DMap&&this.setError(this.chooseMapTip)},this.isNoScene=()=>!o.p(this.widget.state.jimuMapView),this.isNoModeInSetting=()=>o.h(this.widget.props.config.itemsList)<1,this.isNoMapId=()=>!o.p(this.widget.props.useMapWidgetIds)||!o.p(this.widget.props.useMapWidgetIds[0]),this.checkErrorInConfig=()=>{this.isNoScene()||this.isNoMapId()?this.setError(this.chooseMapTip):this.isNoModeInSetting()?this.setError(this.configErrorTip):o.p(this.widget.jimuMapView)&&this.setError("")},this.widget=t.widget,this.chooseMapTip=this.widget.props.intl.formatMessage({id:"chooseMapTip",defaultMessage:l.a.chooseMapTip}),this.configErrorTip=this.widget.props.intl.formatMessage({id:"configErrorTip",defaultMessage:l.a.configErrorTip})}}function c(t){const e=t.surfaces[1];return n.css`
    position: relative;
    border: ${e.border.width} solid ${e.border.color};

    .bar {
      display: flex;
      background-color: ${e.bg};

      .btns, dropdowns{
        width: 32px;
        height: 32px;
        border: none;
      }
      .btns {
        margin: 5px;
        border-radius: 0;
      }

      .speed-controller{
        margin: 0 8px;
      }

      .progress-bar-wapper {
        /*display: flex;*/
        position: absolute;
        width: 100%;
        bottom: 0px;
      }
      .items {
        display: flex;
        position: relative;
      }
      .items .item {
        display: flex;
        background: ${e.bg};
      }
      /*.items .btn .jimu-icon{
        margin: 0;
      }*/
      .separator-line{
        width: 2px;
        margin: 4px 1px;
        border-right: ${e.border.width} solid ${e.border.color};
      }
      .speed-wapper{
        width: 214px;
      }
    }
    .bar .hide,
    .bar .items.hide {
      display: none;
    }
    `}function d(t){let e="hide";return t&&(e=""),e}function u(t){let e="";return t&&(e="hide"),e}class p extends n.React.PureComponent{renderSeparator(){return Object(n.jsx)("div",{className:"separator-line"})}render(){return Object(n.jsx)("div",{css:c(this.props.theme),className:"fly-wapper d-flex"},Object(n.jsx)(r.Nav,{navbar:!0,className:"bar"},Object(n.jsx)("div",{className:"items d-flex flex-row justify-content-around"},Object(n.jsx)("div",{className:"d-flex"},Object(n.jsx)("div",{className:"setting-btns-wapper items "+u(this.props.isPlaying)},Object(n.jsx)("div",{className:"item"},this.props.flyStyleContent),!this.props.isRouteMode&&Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)("div",{className:"item"},Object(n.jsx)("div",{className:"d-flex"},this.renderSeparator(),this.props.graphicInteractionManager)),Object(n.jsx)("div",{className:"item"},this.props.liveviewSettingContent)),this.props.isRouteMode&&Object(n.jsx)(n.React.Fragment,null,this.props.graphicInteractionManager,this.props.routeListContent)),Object(n.jsx)("div",{className:d(this.props.isPlaying)},Object(n.jsx)("div",{className:"speed-wapper h-100"},this.props.speedController))),Object(n.jsx)("div",{className:"d-flex"},Object(n.jsx)("div",{className:"item"},this.renderSeparator(),this.props.playStateContent)),Object(n.jsx)("div",{className:"progress-bar-wapper "+d(this.props.isPlaying)},this.props.progressBar))))}}function g(t){const e=t.surfaces[1];return n.css`
    .plan-route-mode {
      margin-top: ${-44}px;
    }

    .palette-wapper {
      position: relative;
      width: ${144}px;
      height: ${92}px;

      .hide{
        display: none;
      }

      .btns,
      .dropdowns{
        position: absolute;
        width: ${32}px;
        height: ${32}px;
        border-radius: 50%;
      }
      .btns:not(.active){
        background-color: ${e.bg};
        border: ${e.border.width} solid ${e.border.color};
      }

      .play-btn{
        width: ${48}px;
        height: ${48}px;
        bottom: 0;
        ${"left"}: ${48}px;
      }
      .draw-btn{
        ${"left"}: 16px;
        top: 16px;
      }
      .pick-btn{
        top: 0;
        ${"left"}: ${56}px;
      }
      .clear-btn{
        ${"right"}: 16px;
        top: 16px;
      }

      .flystyle-btn{
        ${"left"}: 0;
        bottom: ${8}px;
      }
      .routes-dropdown,
      .liveview-btn{
        ${"right"}: 0;
        bottom: ${8}px;
      }

      .progress-bar-wapper{
        position: absolute;
        width: ${54}px;
        height: ${54}px;
        ${"left"}: ${45}px;
        bottom: 20px;
      }

      .speedcontroller-btn{
        position: absolute;
        width: ${40}px;
        height: ${16}px;
        bottom: 0;
        ${"left"}: 78px;
        border: ${e.border.width} solid ${e.border.color};
        border-radius: 10px;
        background-color: ${e.bg};
      }

      .speedcontroller-text{
        font-size: 10px;
        padding: 0;

        .icon-btn-sizer{
          min-height: 0;
        }
      }
    }`}function v(t){let e=" hide ";return t&&(e=""),e}function f(t){let e="";return t&&(e=" hide "),e}function m(t){let e="";return t&&(e=" plan-route-mode "),e}class y extends n.React.PureComponent{render(){return Object(n.jsx)("div",{css:g(this.props.theme),className:"fly-wapper d-flex"},Object(n.jsx)("div",{className:"palette-wapper"+m(this.props.isRouteMode)},Object(n.jsx)("div",{className:"progress-bar-wapper"+v(this.props.isPlaying)},this.props.progressBar),Object(n.jsx)("div",{className:f(this.props.isPlaying)},this.props.flyStyleContent,this.props.graphicInteractionManager,!this.props.isRouteMode&&Object(n.jsx)(n.React.Fragment,null,this.props.liveviewSettingContent),this.props.isRouteMode&&this.props.routeListContent),this.props.playStateContent,Object(n.jsx)("div",{className:v(this.props.isPlaying)},this.props.speedController)))}}var w=i(8);function b(t){return n.css`
  padding: 5px 10px;
  border: 1px solid ${t.colors.palette.light[400]};

  .dropdown-items{
    padding: 10px;
  }
  .dropdown-item{
    padding: 5px 0;
  }
  .dropdown-item-title{
    font-size: 13px;
    padding-bottom:5px;
  }

  .dropdown-item-comment{
    font-style:italic;
    font-size: 12px;
    color: ${t.colors.palette.light[600]};
    letter-spacing: 0;
  }

  .setting-altitude-separator{
    margin: 0 8px 0 4px;
  }

  .alt-wapper {
    align-items: center;
    font-size: 13px;
  }
  .alt-input {
    width: 60px
  }
  `}const C=i(247);class P extends n.React.PureComponent{constructor(t){super(t),this.togglePopup=()=>{this.setState({isPopupOpen:!this.state.isPopupOpen})},this.handleActivedRouteChangeBySelect=t=>{const e=t.target.value;this.handleActivedRouteChange(e)},this.handleActivedRouteChange=t=>{this.props.onActivedRouteChange(t)},this.getStyle=()=>n.css`
      .routes-dropdown {
        width: 170px;

        .jimu-dropdown-button,
        .jimu-dropdown-button:hover{
          height: 100%;
          border: none;
        }
      }
      `,this._getItemByActivedItemUuid=()=>{let t=null;return o.p(this.props.activedItemUuid)&&o.p(this.props.itemsList)&&(t=this.props.itemsList.find(t=>t.config.uuid===this.props.activedItemUuid&&w.a.Route===t.config.name)),t},this.getActivedRouteName=t=>{const e=o.o(null==t?void 0:t.routes,{routeUuid:this.props.activedRouteUuid});return null==e?void 0:e.displayName},this.state={isPopupOpen:!1}}getRouteItemStyle(){return n.css`
      .route-item {
        max-width: 120px;
        text-overflow: ellipsis;
        overflow: hidden;
      }
    `}render(){const{isRouteMode:t,isEnable:e,layout:i}=this.props,s=this.props.intl.formatMessage({id:"plannedRoutesTip",defaultMessage:l.a.plannedRoutesTip}),a=this._getItemByActivedItemUuid(),o=null==a?void 0:a.config,h=this.getActivedRouteName(o);return t&&Object(n.jsx)("div",{className:"h-100 item",css:this.getStyle()},i===w.b.Palette&&Object(n.jsx)(r.Dropdown,{isOpen:this.state.isPopupOpen,disabled:!e,toggle:this.togglePopup,className:"btns routes-dropdown dropdowns",activeIcon:!0},Object(n.jsx)(r.DropdownButton,{icon:!0,className:"dropdown-btn",type:"tertiary",arrow:!1,title:null!=h?h:s},Object(n.jsx)(r.Icon,{icon:C,size:12})),Object(n.jsx)(r.DropdownMenu,{showArrow:!0,css:b(this.props.theme)},null==o?void 0:o.routes.map((t,e)=>t.isInUse&&Object(n.jsx)("div",{key:e},Object(n.jsx)(r.DropdownItem,{title:t.displayName,onClick:()=>this.handleActivedRouteChange(t.idx),active:this.props.activedRouteUuid===t.idx},Object(n.jsx)("div",{css:this.getRouteItemStyle()},Object(n.jsx)("div",{className:"mx-2 route-item"},t.displayName))))))),i===w.b.Horizontal&&Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)("div",{className:"separator-line"}),Object(n.jsx)(r.Select,{onChange:this.handleActivedRouteChangeBySelect,placeholder:null!=h?h:s,className:"routes-dropdown",disabled:!e},null==o?void 0:o.routes.map((t,e)=>t.isInUse&&Object(n.jsx)("option",{key:e,label:t.displayName,title:t.displayName,value:t.idx,selected:this.props.activedRouteUuid===t.idx},Object(n.jsx)("div",{css:this.getRouteItemStyle()},Object(n.jsx)("div",{className:"route-item"},t.displayName)))))))}}var S=i(109),M=i(49),I=i(20),x=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};const L=i(128),j=i(129),G=i(130);class A extends n.React.PureComponent{constructor(t){super(t),this.onTerrainLoaded=()=>{this.setState({isTerrainLoaded:!0})},this.handleFlyManagerItemsUpdate=t=>{this.setState({flyManagerItems:t})},this.handleRefGraphicInteractionManager=t=>{this.graphicInteractionManagerRef=t,null!==t?this.setState({subCompsLoaded:!0}):this.setState({subCompsLoaded:!1})},this.isAutoControlWidgetIdChanged=t=>t.autoControlWidgetId&&this.props.autoControlWidgetId!==t.autoControlWidgetId,this.handleAutoControlMapPublish=()=>{Object(n.getAppStore)().dispatch(n.appActions.requestAutoControlMapWidget(this.props.useMapWidgetIds[0],this.props.widgetId))},this.resetDefaultUI=t=>{var e,i;this.setState({isFlyStylePopupOpen:!1}),this.setState({isLiveview:!1}),null===(e=this.graphicInteractionManagerRef)||void 0===e||e.onRenderStateChange({drawingMode:M.a.Null,isPicking:!1}),this.handleStop(),(null==t?void 0:t.isCleanGraphics)&&(this.handleFocusedGraphicChanged(null),null===(i=this.graphicInteractionManagerRef)||void 0===i||i.clearAll())},this.handleFlyStyleChange=t=>{var e;let i,s;null===t?(s=this.flyManager.findFirstUsedItem(),i=s.config.uuid):(s=this.flyManager.findItemByUuid(t),i=t),this.setState({activedItemUuid:i},()=>{this.flyManager.isUesRouteFlyMode()||this.handleActivedRouteChange(null)}),this.handleSpeedChange(null),this.resetDefaultUI({isCleanGraphics:!0}),this.flyManager.unRegisterItem(),this.flyManager.registerItem(i),null===(e=this.graphicInteractionManagerRef)||void 0===e||e.removeAllGraphics()},this.handlePlayStateBtnClick=()=>{this.state.isPlaying?this.handlePause():this.handlePlay()},this.setPlayStatePlaying=t=>{var e;this.setState({isPlaying:t,isLiveview:!1}),null===(e=this.graphicInteractionManagerRef)||void 0===e||e.onRenderStateChange(null)},this.handleFlyLoading=()=>{this.setPlayStatePlaying(!0)},this.handleFlyLoaded=()=>{this.setPlayStatePlaying(!1)},this.handleFlyPlay=()=>{this.state.isLiveview||this.state.isPlaying||this.setPlayStatePlaying(!0)},this.handleFlyPause=()=>{this.setPlayStatePlaying(!1)},this.handleFlyFinish=()=>{this.setPlayStatePlaying(!1)},this.isLiveviewMode=()=>this.state.isLiveview,this.handleUpdateProgress=t=>{this.setState({progress:t})},this.getFlyStyleContent=()=>{const t=this.flyManager.getFlyStyle();let e=null;return t===w.a.Rotate?e=Object(n.jsx)(r.Icon,{icon:L}):t===w.a.Path?e=Object(n.jsx)(r.Icon,{icon:j}):t===w.a.Route&&(e=Object(n.jsx)(r.Icon,{icon:G})),e},this.toggleFlyStylePopup=()=>{o.h(this.props.config.itemsList)<=1?this.setState({isFlyStylePopupOpen:!1}):this.state.isPlaying||this.setState({isFlyStylePopupOpen:!this.state.isFlyStylePopupOpen})},this.isDisableButton=t=>{const{isPlaying:e,isLiveview:i,focusedGraphic:s}=t;let n=!this.state.subCompsLoaded;return e&&(n=n&&!this.state.isPlaying),i&&(n=n&&!this.state.isLiveview),s&&(n=n||!o.p(this.state.focusedGraphic)),n},this.handleFocusedGraphicChanged=t=>{this.setState({focusedGraphic:t})},this.handleGraphicsUpdateHanlder=t=>x(this,void 0,void 0,(function*(){this.handleSpeedChange(null);const e=t.graphicsInfo,i=t.cameraInfo,s=this.flyManager.getFlyStyle();s===w.a.Rotate||s===w.a.Path&&this.handleAltitudeChange(0,{setToController:!0,isUpdateLine:!1,isNeedHighlight:!1});const n=yield this.flyManager.buildTemporaryRecordConfig(e,i,this.props.jimuMapView),r=yield this.flyManager.buildTemporaryRecord(n,this.props.jimuMapView.view,this.flyStateCallbacks,e),a=this.flyManager.getActiveItemConfig();yield this.flyManager.setupFly(a,null,this.flyStateCallbacks,r),yield this.flyManager.prepare(null)})),this.handlePickHanlder=t=>{this.handleGraphicsUpdateHanlder(t)},this.handleClearBtnClick=()=>{this.resetDefaultUI({isCleanGraphics:!0}),o.p(this.flyManager)&&this.handleStop()},this.toggleLiveviewSettingPopup=()=>x(this,void 0,void 0,(function*(){if(!o.p(this.state.focusedGraphic))return;const t=!this.state.isLiveview;yield this.flyManager.setIsLiveview(t);const e=yield this.flyManager.getLiveviewSettingInfo();o.p(e)&&(this.handleTiltChange(e.tilt),this.handleAltitudeChange(e.altitude,{isNeedHighlight:!0}),this.setState({isLiveview:t}))})),this.handleSpeedChange=t=>{var e;if(null===t){t=o.k().speed}this.setState({settingSpeed:t}),null===(e=this.flyManager)||void 0===e||e.setSpeedFactor(t)},this.handleTiltChange=(t,e)=>{this.setState({settingTilt:t}),o.p(this.flyManager)&&(null==e?void 0:e.setToController)&&this.flyManager.onLiveviewParamChange({tilt:t},{isUpdateLine:!1,isNeedHighlight:null==e?void 0:e.isNeedHighlight})},this.handleAltitudeChange=(t,e)=>{const i=o.a(t);this.setState({settingAltitude:i}),o.p(this.flyManager)&&(null==e?void 0:e.setToController)&&this.flyManager.onLiveviewParamChange({altitude:i},{isUpdateLine:null==e?void 0:e.isUpdateLine,isNeedHighlight:null==e?void 0:e.isNeedHighlight})},this.handlePlay=()=>x(this,void 0,void 0,(function*(){if(!o.p(this.state.focusedGraphic)&&!this.flyManager.isUesRouteFlyMode())return;(yield this.flyManager.setIsLiveview(!1))&&(this.handleAutoControlMapPublish(),this.flyManager.fly({settingSpeed:this.state.settingSpeed,ids:{routeUuid:this.state.activedRouteUuid,recordUuid:null},isPreviewSpecifiedRecord:!1}))})),this.handleStop=()=>{var t;null===(t=this.flyManager)||void 0===t||t.stop()},this.handlePause=()=>{var t;null===(t=this.flyManager)||void 0===t||t.pause()},this.handleClear=()=>{var t;null===(t=this.flyManager)||void 0===t||t.clear()},this.toggleSpeedPopup=()=>{this.setState({isSpeedPopupOpen:!this.state.isSpeedPopupOpen})},this.isShowDropdownButtonArrow=t=>{var e;return t!==w.b.Palette&&(null===(e=this.flyManager.itemsList)||void 0===e?void 0:e.length)>1},this.handleActivedRouteChange=t=>x(this,void 0,void 0,(function*(){var e;null===(e=this.graphicInteractionManagerRef)||void 0===e||e.clearAll(),this.handleSpeedChange(null),this.setState({activedRouteUuid:t},()=>x(this,void 0,void 0,(function*(){o.p(this.state.activedRouteUuid)&&this.flyManager.isUesRouteFlyMode()&&(yield this.flyManager.prepareRoutePreview({routeUuid:t}))})))})),this.handleDrawOrUpdateGraphics=t=>{var e;if("function"==typeof(null===(e=this.graphicInteractionManagerRef)||void 0===e?void 0:e.drawOrUpdateGraphics))return this.graphicInteractionManagerRef.drawOrUpdateGraphics(t)},this.highlightGraphics=t=>{var e;"function"==typeof(null===(e=this.graphicInteractionManagerRef)||void 0===e?void 0:e.highlight)&&this.graphicInteractionManagerRef.highlight(t)};const e=o.k();this.state={flyManagerItems:null,subCompsLoaded:!1,isTerrainLoaded:!1,focusedGraphic:null,isFlyStylePopupOpen:!1,activedItemUuid:null,isPlaying:!1,isLiveview:!1,settingSpeed:e.speed,settingTilt:e.tilt,settingAltitude:e.altitude,progress:0,isSpeedPopupOpen:!1,activedRouteUuid:null}}_reset(t){this.uiLoadingCallbacks={onLoading:this.handleFlyLoading,onLoaded:this.handleFlyLoaded},this.flyStateCallbacks={onFly:this.handleFlyPlay,onPause:this.handleFlyPause,onFinish:this.handleFlyFinish,onUpdateProgress:this.handleUpdateProgress},o.p(t)&&this._resetFlyManager()}_resetFlyManager(){var t;null===(t=this.flyManager)||void 0===t||t.destructor(),this.flyManager=new S.a({widgetConfig:this.props.config,isBuilderSettingFlag:!1,jimuMapView:this.props.jimuMapView,viewGroup:this.props.viewGroup,uiLoadingCallbacks:this.uiLoadingCallbacks,flyStateCallbacks:this.flyStateCallbacks,drawOrUpdateGraphics:this.handleDrawOrUpdateGraphics,highlightGraphics:this.highlightGraphics,onItemsUpdate:this.handleFlyManagerItemsUpdate,onBeforeSwitchMap:this.handleAutoControlMapPublish,onTerrainLoaded:this.onTerrainLoaded}),this.flyManager.unRegisterItem(),this.handleFlyStyleChange(null)}getCurrentActiveItemName(){const t=this.flyManager.getActiveItemConfig();return null==t?void 0:t.name}componentDidMount(){this._reset(this.props.jimuMapView)}componentWillUnmount(){var t;this.resetDefaultUI({isCleanGraphics:!0}),null===(t=this.flyManager)||void 0===t||t.destructor()}componentDidUpdate(t,e){this.props.config!==t.config&&(this._resetFlyManager(),this.handleClearBtnClick());const i=this.props.jimuMapView!==t.jimuMapView,{isTriggeredByFly:s,isTriggeredByMapSelf:n}=o.l(this.props.widgetId,this.props.autoControlWidgetId,this.props.useMapWidgetIds[0]);i&&(this.setState({isTerrainLoaded:!1}),!s&&n&&this.handleClearBtnClick(),o.p(this.flyManager)?this.flyManager.updateJimuMapView(this.props.jimuMapView):this._resetFlyManager()),this.props.viewGroup!==t.viewGroup&&(o.p(this.flyManager)?this.flyManager.updateViewGroup(this.props.viewGroup):this._resetFlyManager()),i||!this.isAutoControlWidgetIdChanged(t)||n||this.handlePause()}renderFlyStyleSelectorContent(t){const e=this.flyManager.getActiveItemConfig(),i=o.p(e)&&o.i(e.name,this.props),s=this.props.intl.formatMessage({id:"flyStyleRotate",defaultMessage:l.a.flyStyleRotate}),a=this.props.intl.formatMessage({id:"flyStylePath",defaultMessage:l.a.flyStylePath}),h=this.props.intl.formatMessage({id:"flyStyleRoute",defaultMessage:l.a.flyStyleRoute}),c=this.isShowDropdownButtonArrow(t),d=this.getFlyStyleContent();return Object(n.jsx)(r.Dropdown,{isOpen:this.state.isFlyStylePopupOpen,toggle:this.toggleFlyStylePopup,className:"dropdowns flystyle-btn",activeIcon:!0},Object(n.jsx)(r.DropdownButton,{icon:!0,className:"btns d-flex",title:i,type:"tertiary",arrow:c},d),Object(n.jsx)(r.DropdownMenu,{showArrow:!1},this.flyManager.itemsList.map((t,e)=>{const i=t.config,o=i.name,l=t.config.uuid,c=l===this.state.activedItemUuid;return i.isInUse?w.a.Rotate===o?Object(n.jsx)("div",{key:e},Object(n.jsx)(r.DropdownItem,{className:"dropdown-items",title:s,onClick:()=>this.handleFlyStyleChange(l),active:c},Object(n.jsx)(r.Icon,{icon:L}),Object(n.jsx)("span",{className:"mx-2"},s))):w.a.Path===o?Object(n.jsx)("div",{key:e},Object(n.jsx)(r.DropdownItem,{className:"dropdown-items",title:a,onClick:()=>this.handleFlyStyleChange(l),active:c},Object(n.jsx)(r.Icon,{icon:j}),Object(n.jsx)("span",{className:"mx-2"},a))):w.a.Route===o?Object(n.jsx)("div",{key:e},Object(n.jsx)(r.DropdownItem,{className:"dropdown-items",title:h,onClick:()=>this.handleFlyStyleChange(l),active:c},Object(n.jsx)(r.Icon,{icon:G}),Object(n.jsx)("span",{className:"mx-2"},h))):void 0:null})))}renderLiveviewSettingContent(){var t;const e=i(248),s=this.isDisableButton({isPlaying:!0,focusedGraphic:!0}),a=this.props.intl.formatMessage({id:"settings",defaultMessage:r.defaultMessages.settings}),l=this.props.intl.formatMessage({id:"tilt",defaultMessage:r.defaultMessages.tilt}),h=this.props.intl.formatMessage({id:"altitude",defaultMessage:r.defaultMessages.altitude}),c=this.props.intl.formatMessage({id:"degree",defaultMessage:r.defaultMessages.degree}),d=this.props.intl.formatMessage({id:"meter",defaultMessage:r.defaultMessages.meter}),u=this.props.intl.formatMessage({id:"meterAbbr",defaultMessage:r.defaultMessages.meterAbbr}),p=this.props.intl.formatMessage({id:"ground",defaultMessage:r.defaultMessages.ground}),g=this.props.intl.formatMessage({id:"outerSpace",defaultMessage:r.defaultMessages.outerSpace}),v=this.props.intl.formatMessage({id:"relative2Ground",defaultMessage:r.defaultMessages.relative2Ground}),f=null===(t=this.flyManager)||void 0===t?void 0:t.getFlyStyle();return Object(n.jsx)(r.Dropdown,{isOpen:this.state.isLiveview,toggle:this.toggleLiveviewSettingPopup,className:"dropdowns liveview-btn"},Object(n.jsx)(r.DropdownButton,{icon:!0,className:"btns d-flex",disabled:s,title:a,type:"tertiary",arrow:!1},Object(n.jsx)(r.Icon,{icon:e})),Object(n.jsx)(r.DropdownMenu,{showArrow:!1,css:b(this.props.theme)},f===w.a.Rotate&&Object(n.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(n.jsx)("span",{className:"d-flex dropdown-item-title"},l),Object(n.jsx)(r.Slider,{id:"setting-tilt",className:"d-flex",size:"sm",value:this.state.settingTilt,min:I.a.TILT.MIN,max:I.a.TILT.MAX,step:I.a.TILT.STEP,onChange:t=>this.handleTiltChange(t.target.value,{setToController:!0,isNeedHighlight:!0}),title:o.v(this.state.settingTilt,c)})),f===w.a.Path&&Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(n.jsx)("span",{className:"d-flex dropdown-item dropdown-item-title"},h),Object(n.jsx)(r.Slider,{id:"setting-altitude",className:"d-flex dropdown-item",size:"sm",value:this.state.settingAltitude,min:I.a.ALT.MIN,max:I.a.ALT.MAX,step:I.a.ALT.STEP,onChange:t=>x(this,void 0,void 0,(function*(){return this.handleAltitudeChange(parseFloat(t.target.value),{setToController:!0,isNeedHighlight:!0})})),title:o.v(this.state.settingAltitude,d)}),Object(n.jsx)("div",{className:"d-flex justify-content-between dropdown-item-comment dropdown-item"},Object(n.jsx)("span",null,p),Object(n.jsx)("span",null,g))),Object(n.jsx)("div",{className:"d-flex dropdown-items flex-column"},Object(n.jsx)("div",{className:"d-flex alt-wapper"},Object(n.jsx)("div",{className:"alt-input"},Object(n.jsx)(r.NumericInput,{defaultValue:"0",size:"sm",value:this.state.settingAltitude,min:I.a.ALT.MIN,max:I.a.ALT.MAX,onChange:t=>x(this,void 0,void 0,(function*(){return this.handleAltitudeChange(t,{setToController:!0,isNeedHighlight:!0})}))})),Object(n.jsx)("span",{className:"setting-altitude-separator"},u),v)))))}renderPlayStateContent(){const t=i(131),e=i(132);let s=null;const a=this.isDisableButton({isPlaying:!0,isLiveview:!0,focusedGraphic:!0})&&null===this.state.activedRouteUuid;let o=null;return this.state.isPlaying?(o=Object(n.jsx)(r.Icon,{icon:e}),s=this.props.intl.formatMessage({id:"pause",defaultMessage:r.defaultMessages.pause})):(o=Object(n.jsx)(r.Icon,{icon:t}),s=this.props.intl.formatMessage({id:"play",defaultMessage:r.defaultMessages.play})),Object(n.jsx)(r.Button,{icon:!0,onClick:this.handlePlayStateBtnClick,title:s,disabled:a,className:"btns play-btn",type:"tertiary"},o)}renderProgressBarContent(t){var e;const i=t===w.b.Palette?"circular":"linear";return(null===(e=this.flyManager)||void 0===e?void 0:e.getFlyStyle())===w.a.Path?Object(n.jsx)(r.Progress,{type:i,value:this.state.progress,className:"w-100"}):null}renderSpeedControllerContent(){const t=this.props.intl.formatMessage({id:"speed",defaultMessage:l.a.speed})+": "+this.props.intl.formatNumber(o.x(this.state.settingSpeed))+"x",e=[0,.25,.375,.5,.59375,.625,.75,1],i=e.length;return Object(n.jsx)("div",{className:"d-flex item align-items-center h-100"},Object(n.jsx)(r.Slider,{id:"setting-speed",className:"d-flex speed-controller",value:e.indexOf(this.state.settingSpeed),min:0,max:i-1,step:1,size:"sm",onChange:t=>this.handleSpeedChange(e[t.target.value]),title:t}))}renderSpeedControllerContentPalette(){const t=this.props.intl.formatMessage({id:"speed",defaultMessage:l.a.speed}),e=o.x(this.state.settingSpeed),i=this.props.intl.formatNumber(e),s=t+": "+i+"x";return Object(n.jsx)(r.Dropdown,{isOpen:this.state.isSpeedPopupOpen,toggle:this.toggleSpeedPopup,className:"speedcontroller-btn",direction:"up"},Object(n.jsx)(r.DropdownButton,{icon:!0,className:"d-flex speedcontroller-text",title:s,type:"tertiary",arrow:!1},i+"x"),Object(n.jsx)(r.DropdownMenu,{showArrow:!1,css:n.css`
    min-width: 60px;
    padding: 0;

    .speed-popup-wapper{
      font-size: 12px;

      .dropdown-item{
        padding-left: 0;
        padding-right: 0;
      }
    }`},Object(n.jsx)("div",{className:"speed-popup-wapper"},[0,.25,.375,.5,.59375,.625,.75,1].map((t,e)=>{const i=t===this.state.settingSpeed,s=this.props.intl.formatNumber(o.x(t));return Object(n.jsx)("div",{key:e},Object(n.jsx)(r.DropdownItem,{onClick:()=>this.handleSpeedChange(t),active:i},Object(n.jsx)("span",{className:"mx-2"},s+"x")))}))))}render(){if(!this.state.flyManagerItems)return null;const t=this.props.config.layout,e=this.flyManager.getFlyStyle(),i=this.renderFlyStyleSelectorContent(t),s=this.renderLiveviewSettingContent(),r=this.renderPlayStateContent(),a=this.renderProgressBarContent(t),o=this.renderSpeedControllerContent(),l=this.renderSpeedControllerContentPalette(),h=this.flyManager.isUesRouteFlyMode(),c=this.renderRouteFlyModeContent(t),d=h?[]:[M.b.Point,M.b.Line,M.b.Pick,M.b.Clear],u=Object(n.jsx)(M.c,{onRef:this.handleRefGraphicInteractionManager,widgetId:this.props.widgetId,theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView,showItems:d,isDisabled:!this.state.isTerrainLoaded,flyStyle:e,isPlaying:this.state.isPlaying,focusedGraphic:this.state.focusedGraphic,onFocusedGraphicChanged:this.handleFocusedGraphicChanged,onDrawFinish:this.handleGraphicsUpdateHanlder,onClearBtnClick:this.handleClearBtnClick,onPickHanlder:this.handlePickHanlder});let g=null;return t===w.b.Horizontal?g=Object(n.jsx)(p,{flyStyleContent:i,graphicInteractionManager:u,liveviewSettingContent:s,playStateContent:r,progressBar:a,speedController:o,theme:this.props.theme,isPlaying:this.state.isPlaying,isRouteMode:h,routeListContent:c}):t===w.b.Palette&&(g=Object(n.jsx)(y,{flyStyleContent:i,graphicInteractionManager:u,liveviewSettingContent:s,playStateContent:r,progressBar:a,speedController:l,theme:this.props.theme,isPlaying:this.state.isPlaying,isRouteMode:h,routeListContent:c})),Object(n.jsx)("div",{css:n.css`
    height: 100%;

    .fly-error-tips {
      display: flex;
      height: 100%;
      justify-content: center;
      align-items: center;
    }

    .fly-controller {
      height: 32px;
    }

    .fly-wapper {
      white-space: nowrap;
    }
    `,className:"d-flex align-items-center justify-content-center"},g)}renderRouteFlyModeContent(t){const e=this.state.subCompsLoaded;return Object(n.jsx)(P,{theme:this.props.theme,intl:this.props.intl,layout:t,isEnable:e,itemsList:this.flyManager.itemsList,activedItemUuid:this.state.activedItemUuid,activedRouteUuid:this.state.activedRouteUuid,isRouteMode:this.flyManager.isUesRouteFlyMode(),onActivedRouteChange:this.handleActivedRouteChange})}}class T extends n.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.2.0",description:"rename RECORD.records to RECORD.routes",upgrader:t=>{let e=t;const i=e.getIn(["itemsList"]).asMutable({deep:!0});return i.map((t,e)=>("RECORD"===t.name&&(void 0!==t.records&&delete t.records,t.routes=[]),Object.assign({},t))),e=e.set("itemsList",i),e}},{version:"1.5.0",description:"config upgrade for 9.2",upgrader:t=>{let e=t;const i=e.getIn(["itemsList"]).asMutable({deep:!0});if(2===i.length){const t={uuid:"2",name:w.a.Route,isInUse:!1,routes:[]};i.push(t)}return i.map((t,e)=>(void 0===t.uuid&&(t.uuid=e.toString()),"RECORD"===t.name&&(t.name=w.a.Route),w.a.Route===t.name&&(void 0!==t.records&&delete t.records,t.routes=[],t.isInUse=!1),Object.assign({},t))),e=e.set("itemsList",i),e}}]}}const R=new T,O=i(249);class D extends n.React.PureComponent{constructor(t){super(t),this.handleActiveViewChange=t=>null==t||"2d"===t.view.type?(this.errorTipsManager.setErrorByType(s.Choose3DMap),void this.setState({jimuMapView:null})):(this.errorTipsManager.setError(""),void this.setState({jimuMapView:t})),this.handleViewGroupCreate=t=>{this.setState({viewGroup:t})},this.errorTipsManager=new h({widget:this}),this.state={errorTip:this.errorTipsManager.getDefaultError(),jimuMapView:null,viewGroup:null}}componentDidMount(){const{layoutId:t,layoutItemId:e,id:i}=this.props;this.props.dispatch(n.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:t,layoutItemId:e}))}componentDidUpdate(t,e){this.errorTipsManager.isError()&&this.errorTipsManager.checkErrorInConfig()}renderWidgetPlaceholder(){return Object(n.jsx)(r.WidgetPlaceholder,{icon:O,widgetId:this.props.id,message:this.state.errorTip,css:n.css`
    .thumbnail-wrapper {
      margin: ${n.polished.rem(5)} 0;
    }
  `})}render(){var t;const e=Object(n.jsx)(a.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.handleActiveViewChange,onViewGroupCreate:this.handleViewGroupCreate}),{config:i,intl:s,theme:r}=this.props;let o=null;return o=this.errorTipsManager.isError()?this.renderWidgetPlaceholder():Object(n.jsx)(A,{config:i,widgetId:this.props.id,theme:r,intl:s,jimuMapView:this.state.jimuMapView,viewGroup:this.state.viewGroup,useMapWidgetIds:this.props.useMapWidgetIds,autoControlWidgetId:this.props.autoControlWidgetId}),Object(n.jsx)("div",{className:"d-flex align-items-center justify-content-center"},o,Object(n.jsx)("div",{className:"fly-map"},Object(n.jsx)("div",null,e)))}}D.versionManager=R,D.mapExtraStateProps=(t,e)=>{var i;const{useMapWidgetIds:s}=e,n=s&&0!==s.length?s[0]:void 0,r=t&&t.mapWidgetsInfo;return{autoControlWidgetId:n?null===(i=r[n])||void 0===i?void 0:i.autoControlWidgetId:void 0}}},49:function(t,e,i){"use strict";i.d(e,"a",(function(){return b})),i.d(e,"b",(function(){return C})),i.d(e,"c",(function(){return S}));var s,n=i(0),r=i(1),a=i(4),o=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};!function(t){t.RelativeToGround="relative-to-ground",t.OnTheGround="on-the-ground"}(s||(s={}));class l{constructor(){this.widgetId="",this.jimuMapView=null,this.GraphicsLayer=null,this.removeAllGraphics=()=>{var t,e;null===(t=this.layersGroup.layerOnTheGround)||void 0===t||t.removeAll(),null===(e=this.layersGroup.layerRelativeToGround)||void 0===e||e.removeAll()}}setup(t,e){return o(this,void 0,void 0,(function*(){return yield Object(a.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer"]).then(i=>{[this.GraphicsLayer]=i,this.widgetId=e,this.resetJimuMapView(t),this.layersGroup={layerRelativeToGround:null,layerOnTheGround:null},this.resetGraphicsLayers()}),this}))}resetJimuMapView(t){var e,i,s,n;return this.jimuMapView&&(null===(e=this.jimuMapView.view)||void 0===e||e.map.remove(null===(i=this.layersGroup)||void 0===i?void 0:i.layerRelativeToGround),null===(s=this.jimuMapView.view)||void 0===s||s.map.remove(null===(n=this.layersGroup)||void 0===n?void 0:n.layerOnTheGround)),this.jimuMapView=t,this}resetGraphicsLayers(){return this._getGraphicsLayer(s.RelativeToGround),this._getGraphicsLayer(s.OnTheGround),this}_getGraphicsLayer(t){var e;let i=null;const n=t+"-draw-layer-"+this.widgetId+"-"+this.jimuMapView.id;(null===(e=this.jimuMapView.view)||void 0===e?void 0:e.map)&&(i=this.jimuMapView.view.map.findLayerById(n),i||(i=new this.GraphicsLayer({id:n,listMode:"hide",title:n,elevationInfo:{mode:t}}),this.jimuMapView.view.map.add(i))),t===s.RelativeToGround?this.layersGroup.layerRelativeToGround=i:t===s.OnTheGround&&(this.layersGroup.layerOnTheGround=i)}}var h=i(45),c=i(20),d=i(3),u=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};class p extends n.React.PureComponent{constructor(t){super(t),this.Graphic=null,this.Geometry=null,this.Point=null,this.handleDrawToolCreated=t=>u(this,void 0,void 0,(function*(){this.jimuDrawToolsRef=t,yield this.jimuDrawToolsRef.complete(),this.props.onDrawHelperCreated(this)})),this.handleDrawToolsActived=t=>{null!==t&&this._drawingModeChange(t)},this.handleDrawCancel=()=>{this._drawingModeChange(b.Null),this.props.onDrawCancel()},this._drawingModeChange=t=>{this.drawingMode=t,this.props.onDrawingModeChanged(t)},this.handleDrawStart=()=>{"function"==typeof this.props.onDrawStart&&this.props.onDrawStart()},this.handleDrawEnd=t=>{},this.handleDrawFinish=({type:t,graphic:e,layer:i})=>{var s,n;if("deleted"===t||"modified"===t)return;if(null==i||i.removeAll(),"aborted"===t)return this.handleDrawCancel();const r=null===(n=null===(s=this.sceneView)||void 0===s?void 0:s.camera)||void 0===n?void 0:n.clone().toJSON(),a=new c.c({graphics:null,isPicked:!1});this.drawingMode===b.Point&&(e.geometry.z&&(e.geometry.z=0),a.setGraphics(this.doDrawPoint(e)),this.props.onDrawFinish({graphicsInfo:a,cameraInfo:r,drawingMode:this.drawingMode}),this._drawingModeChange(b.Null)),this.drawingMode===b.Line&&(a.setGraphics(this.doDrawLine(e)),this.props.onDrawFinish({graphicsInfo:a,cameraInfo:r,drawingMode:this.drawingMode}),this._drawingModeChange(b.Null))},this.getGraphicsByAttrId=t=>{let e=[];const i=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(e=>e.attributes.id===t);return i.length>0?(e.push(i[0]),e=e.concat(this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(e=>e.attributes.id===t)),e):this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(e=>e.attributes.id===t)},this._removeGraphicsByAttrId=t=>{let e=this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(e=>e.attributes.id===t.attributes.id);e.length>0&&this.props.layersGroup.layerRelativeToGround.removeMany(e),e=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(e=>e.attributes.id===t.attributes.id),e.length>0&&this.props.layersGroup.layerOnTheGround.removeMany(e)},this.setGeoZ=(t,e)=>{t.geometry.z=e},this.doDrawPoint=t=>{const e=t.clone();return this._removeGraphicsByAttrId(t),e.layer=this.props.layersGroup.layerRelativeToGround,this.props.layersGroup.layerRelativeToGround.addMany([e]),[e]},this.doDrawLine=t=>{const e=t.clone();this._removeGraphicsByAttrId(t),e.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([e]);const i=this.genStartEndPoint(e);this.props.layersGroup.layerRelativeToGround.addMany(i);let s=[];return s.push(e),s=s.concat(i),s},this.genStartEndPoint=t=>{const e=t.geometry.paths[0];return[this.genExtraPoint(e[0],t,this.materials.startPtMarker),this.genExtraPoint(e[e.length-1],t,this.materials.endPtMarker)]},this.genExtraPoint=(t,e,i)=>{let s=t;return"local"===this.sceneView.viewingMode?s=new this.Point({x:s[0],y:s[1],z:0,spatialReference:this.sceneView.spatialReference}):(s=this.webMercatorUtils.xyToLngLat(s[0],s[1]),s=new this.Point({x:s[0],y:s[1],z:s[2]})),s=new this.Graphic({geometry:s,symbol:i,layer:this.props.layersGroup.layerRelativeToGround,attributes:{id:e.attributes.id}}),s},this.updateLineByAltitude=(t,e)=>{var i;const s=0===e,n=this.getGraphicsByAttrId(t.attributes.id),r=n[0].clone(),a=n[1].clone(),o=n[2].clone();if(this._removeGraphicsByAttrId(r),s)r.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([r]);else{r.layer=this.props.layersGroup.layerRelativeToGround;const t=r.geometry;t.hasZ=!0,d.p(null===(i=t.paths)||void 0===i?void 0:i.length)&&(t.paths.map(t=>{t.map(t=>{t[2]=e})}),this.props.layersGroup.layerRelativeToGround.addMany([r]))}return a.layer=this.props.layersGroup.layerRelativeToGround,o.layer=this.props.layersGroup.layerRelativeToGround,this.setGeoZ(a,e),this.setGeoZ(o,e),this.props.layersGroup.layerRelativeToGround.addMany([a,o]),[r,a,o]},this.startDrawing=t=>{var e,i,s,n;"function"==typeof(null===(e=this.jimuDrawToolsRef)||void 0===e?void 0:e.sketch.cancel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel()),b.Point===t&&(this.jimuDrawToolsRef.sketch.viewModel.pointSymbol=this.defaultSymbols.getDefaultPointSymbol([54,213,22]),null===(s=this.jimuDrawToolsRef)||void 0===s||s.sketch.create(t)),b.Line===t&&(this.jimuDrawToolsRef.sketch.viewModel.polylineSymbol=this.defaultSymbols.getDefaultLineSymbol([13,137,255]),null===(n=this.jimuDrawToolsRef)||void 0===n||n.sketch.create(t))},this.cancelDrawing=()=>{var t,e,i;this.handleDrawCancel(),"function"==typeof(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.cancel)&&d.p(null===(e=this.jimuDrawToolsRef)||void 0===e?void 0:e.sketch.viewModel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel())},this.createOrUpdateGraphic=(t,e,i)=>{var s,n;t.geometry.paths?t.symbol=this.materials.lineSymbol.toJSON():t.symbol=this.materials.startPtMarker.toJSON();const r="function"==typeof t.clone?t.clone():this.Graphic.fromJSON(t);if("point"===r.geometry.type)return this.doDrawPoint(r);if("polyline"===r.geometry.type){i&&((null===(s=r.layer)||void 0===s?void 0:s.id)===this.props.layersGroup.layerRelativeToGround.id&&(null===(n=r.layer)||void 0===n?void 0:n.id)===this.props.layersGroup.layerOnTheGround.id||(r.geometry=d.r(r.geometry,this.sceneView)));let t=this.doDrawLine(r);return d.p(null==e?void 0:e.fixAltitude)&&!isNaN(null==e?void 0:e.fixAltitude)&&(t=this.updateLineByAltitude(r,null==e?void 0:e.fixAltitude)),t}},this.removeGraphics=t=>{d.p(t)&&(this.props.layersGroup.layerRelativeToGround.removeMany(t),this.props.layersGroup.layerOnTheGround.removeMany(t))},this.removeAll=()=>{var t,e;null===(t=this.props.layersGroup.layerRelativeToGround)||void 0===t||t.removeAll(),null===(e=this.props.layersGroup.layerOnTheGround)||void 0===e||e.removeAll()},this.drawPickedLineStartEndPoints=t=>this.doDrawLine(t),this.removePickedLineStartEndPoints=t=>{this._removeGraphicsByAttrId(t)},this.state={apiLoaded:!1},this.drawingMode=b.Null}componentDidMount(){var t;this.state.apiLoaded||Object(a.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Geometry","esri/geometry/Point","esri/geometry/support/webMercatorUtils"]).then(t=>u(this,void 0,void 0,(function*(){[this.Graphic,this.Geometry,this.Point,this.webMercatorUtils]=t,this.defaultSymbols=yield(new c.b).setup(),this.materials={markerColor:[13,137,255],markerSize:10,outlineColor:"[128, 128, 128, 0.8]",startPtMarker:this.defaultSymbols.getDefaultPointSymbol([54,213,22]),endPtMarker:this.defaultSymbols.getDefaultPointSymbol([255,65,89]),lineColor:[13,137,255,.5],lineSymbol:this.defaultSymbols.getDefaultLineSymbol([13,137,255])},this.setState({apiLoaded:!0})}))),this.sceneView=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view}componentDidUpdate(t,e){var i;this.props.jimuMapView!==t.jimuMapView&&(this.removeAll(),this.sceneView=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)}render(){return this.state.apiLoaded&&this.props.jimuMapView&&this.props.layersGroup.layerOnTheGround&&this.props.layersGroup.layerRelativeToGround&&Object(n.jsx)("div",{style:{display:"none"}},Object(n.jsx)(h.Draw,{jimuMapView:this.props.jimuMapView,onDrawToolCreated:this.handleDrawToolCreated,onDrawToolsActived:this.handleDrawToolsActived,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawCancel:this.handleDrawCancel,onGraphicEdited:this.handleDrawFinish,creationMode:"update",isActive:!1,disableSymbolSelector:!0,updateOnGraphicClick:!1,defaultCreateOptions:{hasZ:!0},defaultUpdateOptions:{enableZ:!1}}))}}var g=i(41);class v extends n.React.PureComponent{constructor(t){super(t),this.onPickBtnClick=()=>{this.props.onPickingStateCahnged(!this.props.isPicking)},this.insertAttrId=t=>(d.p(t)&&(d.p(t.attributes)||(t.attributes={}),d.p(t.attributes.id)||(t.attributes.id=n.utils.getUUID())),t),this.pointerMoveHandler=t=>{var e;this.props.isPicking&&(null===(e=this.props.jimuMapView)||void 0===e||e.view.hitTest(t).then(t=>{const e=null==t?void 0:t.results;if((null==e?void 0:e.length)>0){const t=e[0].graphic;this.props.onHoverPicking([t])}}))},this.pointerClickHandler=t=>{var e;this.props.isPicking&&(null===(e=this.props.jimuMapView)||void 0===e||e.view.hitTest(t).then(e=>this.clickGraphicsByPick(e,t)))},this.clickGraphicsByPick=(t,e)=>{var i,s;this.props.onPickingStateCahnged(!1);const n=(null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view).camera.clone().toJSON(),r=t.results;if((null==r?void 0:r.length)>0){e.stopPropagation();let t=r[0].graphic;t=this.insertAttrId(t);const i=t.geometry;if("polyline"===i.type)this.pickAndClickLine(t,n);else if("point"===i.type){let e;i.hasZ||(e=d.r(i,null===(s=this.props.jimuMapView)||void 0===s?void 0:s.view)),this.pickAndClickPoint(t,n,e)}}},this.pickAndClickPoint=(t,e,i)=>{const s=new c.c({graphics:[t],isPicked:!0});this.props.onPicked({graphicsInfo:s,cameraInfo:e,hitPointWithZ:i,pickMode:"point"})},this.pickAndClickLine=(t,e)=>{const i=new c.c({graphics:[t],isPicked:!0});this.props.onPicked({graphicsInfo:i,cameraInfo:e,hitPointWithZ:null,pickMode:"polyline"})},this.state={isPicking:!1},this._clearEvents(),this._resetEvents()}componentWillUnmount(){this._clearEvents()}_clearEvents(){d.p(this.pointerMoveEvent)&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),d.p(this.pointerDownEvent)&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null)}_resetEvents(){var t,e;this.pointerMoveEvent=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.on("pointer-move",this.pointerMoveHandler),this.pointerDownEvent=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.on("pointer-down",this.pointerClickHandler)}componentDidUpdate(t){this.props.jimuMapView!==t.jimuMapView&&(this._clearEvents(),this._resetEvents())}render(){const t=i(125),e=!this.props.isDrawHelperLoaded||this.props.isPlaying,s=this.props.intl.formatMessage({id:"triggerSelectFeature",defaultMessage:g.a.triggerSelectFeature});return Object(n.jsx)(r.Button,{icon:!0,onClick:t=>this.onPickBtnClick(),active:this.props.isPicking,disabled:e,title:s,className:"btns pick-btn",type:"tertiary"},Object(n.jsx)(r.Icon,{icon:t}))}}var f=i(8);class m extends n.React.PureComponent{constructor(t){super(t),this._resetHightlightCache=()=>{this.highlightCache={hover:{graphic:null,hanlder:null},selected:{graphics:null,hanlder:null}}},this.removeHoverHightlightCache=()=>{d.p(this.highlightCache.hover.hanlder)&&this.highlightCache.hover.hanlder.remove(),this.highlightCache.hover.graphic=null,this.highlightCache.hover.hanlder=null},this.cacheHoverHightlight=(t,e)=>{this.highlightCache.hover.graphic=e,this.highlightCache.hover.hanlder=t},this.removeSelectedHightlightCache=()=>{d.p(this.highlightCache.selected.hanlder)&&this.highlightCache.selected.hanlder.remove(),this.highlightCache.selected.graphics=null,this.highlightCache.selected.hanlder=null},this.cacheSelectedHightlight=(t,e)=>{this.highlightCache.selected.graphics=e,this.highlightCache.selected.hanlder=t},this.highlightGraphicsByHover=t=>{var e,i;const s=d.p(t)?t[0]:null;if(null===s)return;const n=null===(e=null==s?void 0:s.geometry)||void 0===e?void 0:e.type;("polyline"===n&&this.props.flyStyle===f.a.Path||"point"===n&&this.props.flyStyle===f.a.Rotate)&&(null===(i=this.props.jimuMapView)||void 0===i||i.view.whenLayerView(s.layer).then(t=>{const e=t;this.cacheHoverHightlight(e.highlight(s),s)}))},this.highlightGraphicsBySelect=t=>{var e;const i=d.p(t)?t[0]:null;null!==i&&(null===(e=this.props.jimuMapView)||void 0===e||e.view.whenLayerView(i.layer).then(e=>{const s=e.highlight(i);this.cacheSelectedHightlight(s,t)}))},this.clear=()=>{this.removeHoverHightlightCache(),this.removeSelectedHightlightCache()},this._resetHightlightCache()}componentDidUpdate(t){this.props.hoverPickingGraphics!==t.hoverPickingGraphics&&(this.removeHoverHightlightCache(),this.highlightGraphicsByHover(this.props.hoverPickingGraphics)),this.props.selectedPickingGraphics!==t.selectedPickingGraphics&&(this.removeSelectedHightlightCache(),this.highlightGraphicsBySelect(this.props.selectedPickingGraphics))}componentWillUnmount(){this.clear(),this._resetHightlightCache()}render(){return null}}class y extends n.React.PureComponent{constructor(t){super(t),this.componentDidMount=()=>{this.props.onPopupHelperCreated(this)},this.componentWillUnmount=()=>{this.restoreMapPopupHightlightState()},this.clearCacheMapState=()=>{this.mapPopupState={popup:null,hightLight:null}},this.enablePopupAndHighlight=()=>{const t=this.props.jimuMapView;d.p(t)&&(t.startEdit(),t.enablePopup(),t.enableHighlight(),t.exitEdit())},this.disablePopupAndHighlight=()=>{const t=this.props.jimuMapView;d.p(t)&&(t.startEdit(),t.disablePopup(),t.disableHighlight(),t.exitEdit())},this.cacheMapPopupHightlightState=()=>{var t,e;this.mapPopupState.popup=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.getIsEnablePopup(),this.mapPopupState.hightLight=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.getIsEnableHighlight()},this.restoreMapPopupHightlightState=()=>{const t=this.props.jimuMapView;if(d.p(t)){let e=!1;t.startEdit();const i=this.mapPopupState.popup;i?(t.enablePopup(),e=!0):i||(t.disablePopup(),e=!0);const s=this.mapPopupState.hightLight;s?(t.enableHighlight(),e=!0):s||(t.disableHighlight(),e=!0),e&&this.clearCacheMapState(),t.exitEdit()}},this.mapPopupState={popup:null,hightLight:null},this.clearCacheMapState()}render(){return null}}class w extends n.React.PureComponent{constructor(t){super(t),this.TRANSPARENT_GIF="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}render(){const t={borderRadius:"50%",border:"none",backgroundColor:this.props.theme.colors.palette.light[600]};return Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)(r.Button,{icon:!0,type:"tertiary",className:"btns "+this.props.className,disabled:!0},Object(n.jsx)(r.Icon,{icon:this.TRANSPARENT_GIF,style:t})))}}var b,C,P=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))};!function(t){t.Null="null",t.Point="point",t.Line="polyline"}(b||(b={})),function(t){t.Point="point",t.Line="polyline",t.Pick="pick",t.Clear="clear"}(C||(C={}));class S extends n.React.PureComponent{constructor(t){super(t),this._isInCludeShowItem=t=>this.props.showItems.includes(t),this.handleDrawHelperCreated=t=>{this.drawHelperRef=t,this.setState({isDrawHelperLoaded:!0}),this.props.onRef(this)},this.handleDrawingModeChanged=t=>{b.Null!==t&&this.setState({isPicking:!1}),this.setState({drawingMode:t}),"function"==typeof this.props.onDrawingModeChanged&&this.props.onDrawingModeChanged(t)},this.getDrawBtnContent=()=>{const t=this._isInCludeShowItem(C.Point),e=this._isInCludeShowItem(C.Line),s=i(126),a=i(97),o=!!this.props.isDisabled||(this.props.isPlaying||!this.state.isDrawHelperLoaded),l=this.props.intl.formatMessage({id:"triggerDrawPoint",defaultMessage:g.a.triggerDrawPoint}),h=this.props.intl.formatMessage({id:"triggerDrawPath",defaultMessage:g.a.triggerDrawPath}),c=this.props.flyStyle;return Object(n.jsx)(n.React.Fragment,null,t&&(c===f.a.Rotate||null===c)&&Object(n.jsx)(r.Button,{icon:!0,active:b.Point===this.state.drawingMode,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>this.onDrawBtnClick(b.Point,{isTriggerCancel:!0}),disabled:o,title:l},Object(n.jsx)(r.Icon,{icon:s})),e&&(c===f.a.Path||null===c)&&Object(n.jsx)(r.Button,{icon:!0,active:b.Line===this.state.drawingMode,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>this.onDrawBtnClick(b.Line,{isTriggerCancel:!0}),disabled:o,title:h},Object(n.jsx)(r.Icon,{icon:a})))},this.onDrawBtnClick=(t,e)=>{var i,s;(null==e?void 0:e.isTriggerCancel)&&(null===(i=this.drawHelperRef)||void 0===i||i.cancelDrawing());t===this.state.drawingMode||b.Point!==t&&b.Line!==t||null===(s=this.drawHelperRef)||void 0===s||s.startDrawing(t)},this.handleDrawStart=()=>{this.beforInteract()},this.handleDrawEnd=()=>{},this.handleDrawFinish=t=>{var e;null!==this.state.selectedPickingGraphics&&(null===(e=this.drawHelperRef)||void 0===e||e.removePickedLineStartEndPoints(this.state.selectedPickingGraphics[0])),this.props.onDrawFinish(t,!1),this.highlightGraphics(t.graphicsInfo.getGraphics()),this.focusGraphics(t.graphicsInfo.getGraphics()),this.afterInteract()},this.handleDrawCancel=()=>{this.afterInteract(),"function"==typeof this.props.onDrawCancel&&this.props.onDrawCancel()},this.getPickBtnContent=()=>Object(n.jsx)(v,{jimuMapView:this.props.jimuMapView,intl:this.props.intl,isPlaying:this.props.isPlaying,isDrawHelperLoaded:this.state.isDrawHelperLoaded,drawingMode:this.state.drawingMode,isPicking:this.state.isPicking,onPicked:this.handlePicked,onPickingStateCahnged:this.handlePickingStateCahnged,onHoverPicking:this.handleHoverPicking,hoveredGraphic:this.state.hoveredGraphic}),this.handleHoverPicking=t=>{this.setState({hoverPickingGraphics:t})},this.handlePickingStateCahnged=t=>{t?this.drawHelperRef.cancelDrawing():t||this.setState({hoverPickingGraphics:null}),this.setState({isPicking:t})},this.handlePicked=t=>{if(!this.validPickingByType(t))return;this.clearAll();let e=t.graphicsInfo.getGraphics();const i=e[0];setTimeout(()=>{if("polyline"===i.geometry.type){const t=this.drawHelperRef.drawPickedLineStartEndPoints(i);e=[i,t[1],t[2]]}this.highlightGraphics(e),this.focusGraphics(e),this.props.onPickHanlder(t)},10)},this.validPickingByType=t=>{let e=!1;return(this.props.flyStyle===f.a.Rotate&&"point"===t.pickMode||this.props.flyStyle===f.a.Path&&"polyline"===t.pickMode)&&(e=!0),e},this.highlight=t=>{null===t?this.clearHighlightGraphics():(this.highlightGraphics(t),this.focusGraphics(t))},this.clearHighlightGraphics=()=>{this.setState({selectedPickingGraphics:null}),this.setState({hoverPickingGraphics:null})},this.highlightGraphics=t=>{this.setState({selectedPickingGraphics:t})},this.getClearBtnContent=()=>{const t=i(127),e=this.props.intl.formatMessage({id:"triggerClear",defaultMessage:g.a.triggerClear}),s=this.props.isPlaying||null===this.props.focusedGraphic;return Object(n.jsx)(r.Button,{icon:!0,onClick:this.handleClearBtnClick,disabled:s,title:e,className:"btns clear-btn",type:"tertiary"},Object(n.jsx)(r.Icon,{icon:t}))},this.focusGraphics=t=>{this.props.onFocusedGraphicChanged(null);const e=null===t?null:t[0];this.props.onFocusedGraphicChanged(e)},this.handlePopupHelperCreated=t=>{this.popupHelperRef=t},this.beforInteract=()=>{var t,e;null===(t=this.popupHelperRef)||void 0===t||t.cacheMapPopupHightlightState(),null===(e=this.popupHelperRef)||void 0===e||e.disablePopupAndHighlight()},this.afterInteract=()=>{setTimeout(()=>{this.restoreMapPopupHightlightState()},10)},this.restoreMapPopupHightlightState=()=>{var t;null===(t=this.popupHelperRef)||void 0===t||t.restoreMapPopupHightlightState()},this.handleClearBtnClick=()=>{this.clearAll(),this.focusGraphics(null),this.props.onClearBtnClick()},this.clearAll=()=>{var t,e;this.highlight(null),null===(t=this.popupHelperRef)||void 0===t||t.restoreMapPopupHightlightState(),null===(e=this.drawHelperRef)||void 0===e||e.removeAll()},this.onRenderStateChange=t=>{void 0!==(null==t?void 0:t.drawingMode)&&(this.handleDrawingModeChanged(t.drawingMode),this.onDrawBtnClick(t.drawingMode,{isTriggerCancel:!1})),null==t||t.isPicking},this.drawOrUpdateGraphics=t=>{var e;const i=t.storedGraphicsInfo.rawData,s=i.graphics[0],n=i.isPicked,r=null===(e=t.controllerConfig)||void 0===e?void 0:e.liveviewSettingState;let a;if(n){const t=s;a="polyline"===t.geometry.type||Object(d.p)(t.geometry.paths)?this.drawHelperRef.createOrUpdateGraphic(t,r,n):i.graphics}else a=this.drawHelperRef.createOrUpdateGraphic(s,r,n);return new c.c({graphics:a,isPicked:n})},this.removeGraphics=t=>{var e;null===(e=this.drawHelperRef)||void 0===e||e.removeGraphics(t)},this.removeAllGraphics=()=>{this.drawLayersGroup.removeAllGraphics()},this.query=()=>null,this.state={apiLoaded:!1,layersGroup:{layerRelativeToGround:null,layerOnTheGround:null},isDrawHelperLoaded:!1,drawingMode:b.Null,isPicking:!1,hoveredGraphic:null,hoverPickingGraphics:null,selectedPickingGraphics:null}}componentDidMount(){return P(this,void 0,void 0,(function*(){this.state.apiLoaded||(this.drawLayersGroup=yield(new l).setup(this.props.jimuMapView,this.props.widgetId),this.setState({apiLoaded:!0}),this.setState({layersGroup:this.drawLayersGroup.layersGroup}))}))}componentWillUnmount(){this.drawLayersGroup&&(this.drawLayersGroup=null),this.props.onRef(null)}componentDidUpdate(t,e){var i,s;this.props.jimuMapView!==t.jimuMapView&&(this.setState({hoverPickingGraphics:null}),this.setState({selectedPickingGraphics:null}),null===(i=this.drawLayersGroup)||void 0===i||i.resetJimuMapView(this.props.jimuMapView),null===(s=this.drawLayersGroup)||void 0===s||s.resetGraphicsLayers(),this.state.apiLoaded&&this.setState({layersGroup:this.drawLayersGroup.layersGroup}))}render(){let t=null;return t=Object(n.jsx)("div",null,Object(n.jsx)(n.React.Fragment,null,(!this.state.apiLoaded||!this.state.isDrawHelperLoaded||this.props.isDisabled)&&Object(n.jsx)(n.React.Fragment,null,this._isInCludeShowItem(C.Point)&&Object(n.jsx)(w,{theme:this.props.theme,className:"draw-btn"}),this._isInCludeShowItem(C.Pick)&&Object(n.jsx)(w,{theme:this.props.theme,className:"pick-btn"}),this._isInCludeShowItem(C.Line)&&Object(n.jsx)(w,{theme:this.props.theme,className:"clear-btn"})),this.state.apiLoaded&&this.state.isDrawHelperLoaded&&!this.props.isDisabled&&Object(n.jsx)(n.React.Fragment,null,this.getDrawBtnContent(),this._isInCludeShowItem(C.Pick)&&this.getPickBtnContent(),this._isInCludeShowItem(C.Clear)&&this.getClearBtnContent()),Object(n.jsx)(p,{jimuMapView:this.props.jimuMapView,onDrawHelperCreated:this.handleDrawHelperCreated,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawFinish:this.handleDrawFinish,onDrawCancel:this.handleDrawCancel,layersGroup:this.state.layersGroup}),Object(n.jsx)(m,{jimuMapView:this.props.jimuMapView,flyStyle:this.props.flyStyle,hoverPickingGraphics:this.state.hoverPickingGraphics,selectedPickingGraphics:this.state.selectedPickingGraphics}),Object(n.jsx)(y,{jimuMapView:this.props.jimuMapView,onPopupHelperCreated:this.handlePopupHelperCreated}))),t}getBtnStyleForBuilder(){var t,e,i;const s=null===(t=this.props.theme)||void 0===t?void 0:t.arcgis,r=null===(e=null==s?void 0:s.components)||void 0===e?void 0:e.button,{default:a}=null!==(i=null==r?void 0:r.variants)&&void 0!==i?i:{},o=null==a?void 0:a.active;return n.css`
      &.btns.active {
        color: ${o.color} !important;
        background-color: ${o.bg} !important;
        border-radius: ${o.borderRadius} !important;
        box-shadow: ${o.shadow} !important;
      }
    `}}},8:function(t,e,i){"use strict";var s,n,r,a,o;i.d(e,"a",(function(){return s})),i.d(e,"e",(function(){return n})),i.d(e,"d",(function(){return r})),i.d(e,"c",(function(){return a})),i.d(e,"b",(function(){return o})),function(t){t.Rotate="ROTATE",t.Path="PATH",t.Route="ROUTE"}(s||(s={})),function(t){t.CW="CW",t.CCW="CCW"}(n||(n={})),function(t){t.Smoothed="CURVED",t.RealPath="LINE"}(r||(r={})),function(t){t.Forward="FORWARD",t.Backward="BACKWARD"}(a||(a={})),function(t){t.Horizontal="HORIZONTAL",t.Vertical="VERTICAL",t.Palette="PALETTE"}(o||(o={}))},86:function(t,e){t.exports=r},97:function(t,e){t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.582 5L11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2h-1.418z" fill="#363636"></path></svg>'}}))}}}));