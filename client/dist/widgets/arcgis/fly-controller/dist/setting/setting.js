System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-for-builder","jimu-ui/basic/list-tree","jimu-ui/advanced/map","esri/views/3d/externalRenderers"],(function(e){var t,i,s,n,a,o,r,l;return{setters:[function(e){t=e},function(e){i=e},function(e){s=e},function(e){n=e},function(e){a=e},function(e){o=e},function(e){r=e},function(e){l=e}],execute:function(){e(function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=484)}({0:function(e,i){e.exports=t},1:function(e,t){e.exports=i},10:function(e,t){e.exports=a},109:function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var s=i(8),n=i(25),a=i(4),o=i(3),r=i(37),l=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class h extends n.b{constructor(){super(...arguments),this._updateCamearGlByTilt=(e,t)=>{if(!Object(o.p)(this._cache.lookAtTargetGL.pos))return null;e<1?e=1:e>89&&(e=89);const i=this.vec3d.create();this.vec3.subtract(i,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const s=this.vec3.length(i),n=this.vec3d.create();this.vec3.normalize(n,this._cache.lookAtTargetGL.upAxis);const a=this.vec3d.create();this.vec3.scale(a,n,s);const r=this.vec3d.create();this.vec3.add(r,this._cache.lookAtTargetGL.pos,a);const l=this.vec3d.create();this.vec3.cross(l,n,i);let h=this.vec3d.create();h=this.rotateBySceneMode(r,l,e,this._cache.lookAtTargetGL.pos);const d=this.mat4d.create();this.mat4.rotate(d,d,Object(o.c)(e),l);const c=this.vec3d.create();this.vec3.subtract(c,h,this._cache.lookAtTargetGL.pos);const p=this.vec3d.create();if(this.vec3.cross(p,c,l),this.vec3.normalize(p,p),this._cache.cameraGL.pos=h,this._cache.cameraGL.upDir=p,null==t?void 0:t.isUpdateCamearConfig){const e=new this.GLCamera(this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos,this._cache.cameraGL.upDir);this.cameraInfo=this.cameraUtils.internalToExternal(this.sceneView,e),this.cameraInfo=this.cameraInfo.toJSON()}},this._computeCurrentTilt=()=>{const e=this.vec3d.create();this.vec3.subtract(e,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const t=this.vec3d.create();this.vec3.normalize(t,this._cache.lookAtTargetGL.upAxis);return Object(o.s)(this.vec3.angle(e,t))},this._updateInitCamera=(e,t)=>{let i,s=e;this._isDebug&&this.auxHelper.drawPoint(s),s=this.queryGeometryElevInfo(s),this._cache.lookAtTargetGL.pos=Object(o.g)([s.x,s.y,s.z],null,this.sceneView),this._cache.lookAtTargetGL.upAxis=this.vec3d.create(),this._cache.lookAtTargetGL.baseAlt=s.z,this.sceneView.renderCoordsHelper.worldUpAtPosition(this._cache.lookAtTargetGL.pos,this._cache.lookAtTargetGL.upAxis),i=Object(o.p)(this.cameraInfo)?this.Camera.fromJSON(this.cameraInfo):this.sceneView.camera.clone();const n=this.cameraUtils.externalToInternal(this.sceneView,i);return this._cache.cameraGL.pos=n.eye,this._cache.cameraGL.upDir=n.up,(null==t?void 0:t.isUpdateTilt)&&this._updateCamearGlByTilt(this._getTilt()),s},this.fly=e=>l(this,void 0,void 0,(function*(){return Object(o.p)(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==e?void 0:e.animate):yield Promise.reject("isEnableToFly() === false"):(yield this.prepare(),yield this.resume(),!0)})),this.getApiCamera=()=>{const e=new this.GLCamera(this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos,this._cache.cameraGL.upDir),t=this.cameraUtils.internalToExternal(this.sceneView,e);return t.position.z<0&&(t.position.z=0),t},this.resumeCamera=e=>l(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0})),this.getProgress=()=>0}setIsLiveview(e){const t=Object.create(null,{setIsLiveview:{get:()=>super.setIsLiveview}});return l(this,void 0,void 0,(function*(){return yield t.setIsLiveview.call(this,e),yield this.setLiveviewSettingInfo(this.getLiveviewSettingInfo())}))}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return l(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>l(this,void 0,void 0,(function*(){if(Object(o.p)(e)&&Object(o.p)(e.tilt)&&Object(o.p)(this._cache.lookAtTargetGL.pos)&&e.tilt>=0){this._updateCamearGlByTilt(e.tilt,{isUpdateCamearConfig:!0});try{yield this.sceneView.goTo(this.getApiCamera(),{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0}return!1})))}))}_getTilt(){let e=this.liveviewSetting.getTiltFactor(!0);return(null==e||isNaN(e))&&(e=this._computeCurrentTilt(),this.liveviewSetting.setTiltFactor(e)),e}getLiveviewSettingInfo(){return{tilt:this._getTilt(),altitude:null,speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return l(this,void 0,void 0,(function*(){const s=this.geometry;Object(o.p)(e)&&(Object(o.p)(e.angleLimit)?(this.optionsAngleLimit=e.angleLimit,this.angleLimitCounter=e.angleLimit):Object(o.p)(this.optionsAngleLimit),Object(o.p)(e.duration)&&(this.duration=e.duration)),t.preparing.call(this),this._updateInitCamera(s,{isUpdateTilt:!1}),Object(o.p)(this.duration)?this.animate.init(r.a.Linear,0,null!==(i=this.optionsAngleLimit)&&void 0!==i?i:360,this.duration):this.animate.init(r.a.NONE,0,0,this.duration);try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==e?void 0:e.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),this._updateInitCamera(this.geometry,{isUpdateTilt:!0});try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield t.prepared.call(this),!0}))}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return l(this,void 0,void 0,(function*(){return e._doFly.call(this),yield this.updateAnimat(e=>{const t=this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor());let i=t.step;const n=t.progress;if(Object(o.p)(this.direction)&&this.direction===s.e.CW&&(i=-i),this.isLiveviewMode);else if(null===this.optionsAngleLimit||isNaN(this.optionsAngleLimit))this._rotateCam(i);else{n>=1&&(i=this.angleLimitCounter);const e=Math.min(Math.abs(i),this.angleLimitCounter);this.angleLimitCounter-=e,this.angleLimitCounter>0?this._rotateCam(i):this.stop()}this._isDebug&&this.auxHelper.drawPointGL(this._cache.cameraGL.pos,"red");const a=this.getApiCamera();this.sceneView.goTo(a,{animate:!1}).catch((function(e){if("AbortError"!==e.name)throw e;console.log("sceneView.goTo() Aborted")}))})}))}_rotateCam(e){const t=this._cache.lookAtTargetGL.upAxis;let i=this.vec3d.create();i=this.rotateBySceneMode(this._cache.cameraGL.pos,t,e,this._cache.lookAtTargetGL.pos),this._cache.cameraGL.pos=i;const s=this.mat4d.create();this.mat4.rotate(s,s,Object(o.c)(e),t);const n=this._cache.cameraGL.upDir;this.vec3.transformMat4(n,n,s),this.vec3.normalize(n,n),this._cache.cameraGL.upDir=n}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return l(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return l(this,void 0,void 0,(function*(){yield e.clear.call(this),this._cache.lookAtTargetGL.pos=null}))}}class d{constructor(e,t){this.points=null!=e?e:[],this.points=this.normalPoints4Bspline(this.points),this.iter=null!=t?t:3}getSpline(){const e=this.bspline(this.points,this.iter);return this.mergePoints(e)}clear(){this.points=null,this.iter=null}normalPoints4Bspline(e){var t;const i=[];for(let s=0,n=e.length;s<n;s++){const n=e[s],a=n[0],o=n[1],r=null!==(t=n[2])&&void 0!==t?t:0;i.push(a,o,r)}return i}mergePoints(e){const t=[];for(let i=0,s=e.length/3;i<s;i++){const s=e[3*i],n=e[3*i+1],a=e[3*i+2],o=[];o.push(s,n,a),t.push(o)}return t}bspline(e,t){if(!Object(o.p)(t)||0===t)return e;const i=e.length/3,s=[e[0],e[1],e[2]];for(let t=0;t<i-1;t++){const i=3*t;s[3+2*i+0]=.8*e[i+0]+.2*e[i+3],s[3+2*i+1]=.8*e[i+1]+.2*e[i+4],s[3+2*i+2]=.8*e[i+2]+.2*e[i+5],s[3+2*i+3]=.2*e[i+0]+.8*e[i+3],s[3+2*i+4]=.2*e[i+1]+.8*e[i+4],s[3+2*i+5]=.2*e[i+2]+.8*e[i+5]}return s.push(e[e.length-3],e[e.length-2],e[e.length-1]),this.bspline(s,t-1)}}function c(e,t,i){const s=void 0!==t?t*t:1;return e=function(e,t){const i=e.length,s=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(i);let n=0,a=i-1;const r=[],l=[];let h,d,c,p;s[n]=s[a]=1;for(;o.p(a)&&0!==a;){for(d=0,h=n+1;h<a;h++)c=u(e[h],e[n],e[a]),c>d&&(p=h,d=c);d>t&&(s[p]=1,r.push(n,p,p,a)),a=r.pop(),n=r.pop()}for(h=0;h<i;h++)o.p(s[h])&&l.push(e[h]);return l}(e=i?e:function(e,t){let i=e[0];const s=[i];let n;for(let a=1,o=e.length;a<o;a++)n=e[a],p(n,i)>t&&(s.push(n),i=n);i!==n&&s.push(n);return s}(e,s),s)}function p(e,t){const i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return i*i+s*s+n*n}function u(e,t,i){let s=t[0],n=t[1],a=t[2],o=i[0]-s,r=i[1]-n,l=i[2]-a;if(0!==o||0!==r||0!==l){const t=((e[0]-s)*o+(e[1]-n)*r+(e[2]-a)*l)/(o*o+r*r+l*l);t>1?(s=i[0],n=i[1],a=i[2]):t>0&&(s+=o*t,n+=r*t,a+=l*t)}return o=e[0]-s,r=e[1]-n,l=e[2]-a,o*o+r*r+l*l}class g{constructor(){this.c0=0,this.c1=0,this.c2=0,this.c3=0,this.init=(e,t,i,s)=>{this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-s,this.c3=2*e-2*t+i+s},this.initCatmullRom=(e,t,i,s,n)=>{this.init(t,i,n*(i-e),n*(s-t))},this.initNonuniformCatmullRom=(e,t,i,s,n,a,o)=>{let r=(t-e)/n-(i-e)/(n+a)+(i-t)/a,l=(i-t)/a-(s-t)/(a+o)+(s-i)/o;r*=a,l*=a,this.init(t,i,r,l)},this.calc=e=>{const t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i}}}class m{constructor(e,t,i){this.set=(e,t,i)=>(this.x=e,this.y=t,this.z=i,this),this.add=e=>(this.x+=e.x,this.y+=e.y,this.z+=e.z,this),this.subVectors=(e,t)=>(this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this),this.distanceToSquared=e=>{const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s},this.distanceTo=e=>Math.sqrt(this.distanceToSquared(e)),this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=i?i:0}}const v=new m,f=new g,y=new g,w=new g;class I{constructor(e,t,i,s){this._geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++)t.push(new m(e[i][0],e[i][1],e[i][2]));return t},this.getPoint=(e,t)=>{const i=null!=t?t:new m,s=this.points,n=s.length,a=(n-(!0===this.closed?0:1))*e;let o,r=Math.floor(a),l=a-r;!0===this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/n)+1)*n:0===l&&r===n-1&&(r=n-2,l=1),!0===this.closed||r>0?o=s[(r-1)%n]:(v.subVectors(s[0],s[1]).add(s[0]),o=v);const h=s[r%n],d=s[(r+1)%n];let c;if(!0===this.closed||r+2<n?c=s[(r+2)%n]:(v.subVectors(s[n-1],s[n-2]).add(s[n-1]),c=v),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),s=Math.pow(d.distanceToSquared(c),e);i<1e-4&&(i=1),t<1e-4&&(t=i),s<1e-4&&(s=i),f.initNonuniformCatmullRom(o.x,h.x,d.x,c.x,t,i,s),y.initNonuniformCatmullRom(o.y,h.y,d.y,c.y,t,i,s),w.initNonuniformCatmullRom(o.z,h.z,d.z,c.z,t,i,s)}else"catmullrom"===this.curveType&&(f.initCatmullRom(o.x,h.x,d.x,c.x,this.tension),y.initCatmullRom(o.y,h.y,d.y,c.y,this.tension),w.initCatmullRom(o.z,h.z,d.z,c.z,this.tension));return i.set(f.calc(l),y.calc(l),w.calc(l)),i},this.getSpacedPoints=e=>{void 0===e&&(e=5);const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},this.getPointAt=(e,t)=>{const i=this.getUtoTmapping(e);return this.getPoint(i,t)},this.getUtoTmapping=(e,t)=>{const i=this.getLengths();let s=0;const n=i.length;let a;a=o.p(t)?t:e*i[n-1];let r,l=0,h=n-1;for(;l<=h;)if(s=Math.floor(l+(h-l)/2),r=i[s]-a,r<0)l=s+1;else{if(!(r>0)){h=s;break}h=s-1}if(s=h,i[s]===a)return s/(n-1);const d=i[s];return(s+(a-d)/(i[s+1]-d))/(n-1)},this.getLength=()=>{const e=this.getLengths();return e[e.length-1]},this.getLengths=e=>{if(void 0===e&&(e=this.arcLengthDivisions),o.p(this.cacheArcLengths)&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s,n=this.getPoint(0),a=0;for(t.push(0),s=1;s<=e;s++)i=this.getPoint(s/e),a+=i.distanceTo(n),t.push(a),n=i;return this.cacheArcLengths=t,t},this.points=this._geoArrayToCoords(e),this.closed=null!=t&&t,this.curveType=null!=i?i:"centripetal",this.tension=null!=s?s:.3,this.arcLengthDivisions=2e4}destructor(){}}class C{constructor(e,t,i,s,n){this.longLineProcessing={threshold:400,distance:150},this.acuteAngleProcessing={angle:90,threshold:300,distance:100},this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=o.g([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>this.curve.getLength(),this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n;const a=c(this.points,5,!0);this.points=this.preProcessing(a);const r=new d(this.points);this.curve=new I(r.getSpline()),r.clear()}destructor(){this.points=null,this.curve=null}getUtoTmapping(e,t){return this.curve.getUtoTmapping(0,t)}getPoint(e){return this.curve.getPoint(e)}preProcessing(e){const t=[];let i=null;for(let s=0;s<e.length-1;s++){const n=e[s],a=e[s+1],r=e[s+2],l=o.d(n,a),h=o.p(r)?o.d(a,r):null;let d=!1;if(o.p(l)&&o.p(h)){const e=o.n(n,a,r,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils);d=Math.abs(e)>this.acuteAngleProcessing.angle}const c=!(0!==s),p=!(e.length-1!==s+1);let u;if(t.push(n),o.p(i)&&!c&&(t.push(i),i=null),u=this._getInsertControlPointRes(l,d),!0===u.isInsert&&!c&&!p){const e=this._getInsertedPoint(n,a,"forward",u.distance);t.push(e)}u=this._getInsertControlPointRes(h,d),!0!==u.isInsert||p||(i=this._getInsertedPoint(a,r,"backward",u.distance)),p&&t.push(a)}for(let e=0,i=t.length;e<i;e++){let i=t[e];i=o.u(i,null,this.sceneView),t.splice(e,1,i)}return t}_getInsertControlPointRes(e,t){const i=e>this.acuteAngleProcessing.threshold,s=null!==e&&e>this.longLineProcessing.threshold;return t&&i?{isInsert:!0,distance:this.acuteAngleProcessing.distance}:s?{isInsert:!0,distance:this.longLineProcessing.distance}:{isInsert:!1,distance:0}}_getInsertedPoint(e,t,i,s){const n=this.vec3d.create(),a=this.vec3d.create(),o=this.vec3d.create(),r=this.vec3d.create();return"forward"===i?(this.vec3.subtract(n,e,t),this.vec3.normalize(a,n),this.vec3.scale(o,a,s),this.vec3.add(r,t,o)):(this.vec3.subtract(n,t,e),this.vec3.normalize(a,n),this.vec3.scale(o,a,s),this.vec3.add(r,e,o)),r}_getMidpoint(e,t,i){const s=this.vec3d.create(),n=this.vec3d.create(),a=this.vec3d.create(),r=this.vec3d.create(),l=o.p(i)?i:o.d(e,t);return this.vec3.subtract(s,e,t),this.vec3.normalize(n,s),this.vec3.scale(a,n,l/2),this.vec3.add(r,t,a),r}}var b=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class M extends n.b{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new C(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=()=>{let e,t;0===this.animate.getProgress()?(e=0*this.animate.getAmount(),this.animate.progressForward(),t=this.animate.getAmount()*this.animate.getProgress()):(e=this.animate.getAmount()*this.animate.progressBackward(),e<0&&(e=0,this.animate.progressForward()),t=this.animate.getAmount()*this.animate.getProgress());let i=this._cache.paths.getUtoTmapping(0,e);i=this._cache.paths.getPoint(i),i=this._coordToGeo(i);let s=this._cache.paths.getUtoTmapping(0,t);s=this._cache.paths.getPoint(s),s=this._coordToGeo(s);const n=parseFloat(i[2])+0,a=o.g([i[0],i[1],n],null,this.sceneView);let r=this.getCameraPosition(i,s);o.p(r)||(r=this._cache.cameraGL.pos);const l=this.vec3d.create();this.sceneView.renderCoordsHelper.worldUpAtPosition(r,l);const h=[0,0,0];h[0]=r[0],h[1]=r[1],h[2]=r[2];const d=[0,0,0];return d[0]=a[0],d[1]=a[1],d[2]=a[2],this._cache.cameraGL.pos=h,this._cache.cameraGL.upDir=l,this._cache.lookAtTargetGL.pos=d,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:d,camPos:h,up:l}},this.getApiCamera=e=>{let t=e.camPos,i=e.lookAt;const s=e.up;if(!o.p(t)||!o.p(i)||!o.p(s))return null;let n=0,a=o.u(i,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference});n=r.z,r.z=parseFloat(r.z)+this.liveviewSetting.getAltitudeFactor(),r.z<0&&(r.z=0),i=o.g([r.x,r.y,r.z],null,this.sceneView),a=o.u(t,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference}),r.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),t=o.g([r.x,r.y,r.z],null,this.sceneView);const l=new this.GLCamera(t,i,s);return this.cameraUtils.internalToExternal(this.sceneView,l)},this.getCameraPosition=(e,t)=>{var i,s;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const n=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,a=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,r=o.g([e[0],e[1],e[2]],null,this.sceneView),l=o.g([t[0],t[1],t[2]],null,this.sceneView),h=this.vec3d.create();this.vec3.subtract(h,r,l);const d=this.vec3.length(h),c=this.vec3d.create();this.vec3.normalize(c,h);const p=d+a,u=this.vec3d.create();this.vec3.scale(u,c,p);const g=this.vec3d.create();this.vec3.add(g,l,u);const m=o.u(g,1,this.sceneView),v=new this.Point({x:m[0],y:m[1],z:m[2],type:"point",spatialReference:this.sceneView.spatialReference});v.z<n&&(v.z=n),v.z<0&&(v.z=0),this._isDebug&&this.auxHelper.drawPoint(v);return o.g([v.x,v.y,v.z],null,this.sceneView)},this.resumeCamera=e=>b(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0})),this._coordToGeo=e=>o.p(e)?this.vec3d.fromValues(e.x,e.y,e.z):null}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return b(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>b(this,void 0,void 0,(function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0})))}))}getLiveviewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return b(this,void 0,void 0,(function*(){let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(o.p(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(r.a.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}this._isDebug&&this.auxHelper.drawLineXY(this._cache.paths,"lightgreen");try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==e?void 0:e.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield t.prepared.call(this),!0}))}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return b(this,void 0,void 0,(function*(){return o.p(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject()}))}_doFly(){super._doFly(),this.updateAnimat(e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);o.p(t)&&this.sceneView.goTo(t,{animate:!1})}})}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return b(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return b(this,void 0,void 0,(function*(){yield e.clear.call(this)}))}}class P{constructor(e,t,i,s,n){this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=o.g([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>{this.points.length<2&&alert("line.length < 2");let e=0;for(let t=0,i=this.points.length;t<i-1;t++)e+=this.getLineLen(this.points[t+0],this.points[t+1]),e+=Math.abs(o.n(this.points[t+0],this.points[t+1],this.points[t+2],this.vec3,this.vec3d,this.sceneView,this.esriMathUtils));return this.length=e,e},this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n,this.points=c(this.points,5,!0)}destructor(){this.points=null}getLineLen(e,t){const i=e,s=t;return o.d(i,s)}getPoint(e,t){let i=0;for(let e=0,s=this.points.length;e<s-1;e++){const s=this.points[e+0],n=this.points[e+1],a=this.points[e+2],r=this.getLineLen(s,n);if(t<i+r){const e=t-i,a=e/r;return{type:"line",len:e,point:o.q(s,n,a)}}i+=r;const l=o.n(s,n,a,this.vec3,this.vec3d,this.sceneView,this.esriMathUtils),h=Math.abs(l);if(t<i+h){return{type:"rotate",angle:(t-i)*o.w(l),point:n,points:{pre:s,base:n,next:a},lastLineLen:i}}i+=h}}}var j=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class S extends n.b{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new P(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=e=>{let t,i;0===this.animate.getProgress()?(t=0*this.animate.getAmount(),this.animate.progressForward(),i=this.animate.getAmount()*this.animate.getProgress()):(t=this.animate.getAmount()*this.animate.progressBackward(),i=this.animate.getAmount()*this.animate.getProgress());const s=this._cache.paths.getPoint(0,t),n=this._cache.paths.getPoint(0,i),a=[0,0,0],r=[0,0,0],l=this.vec3d.create();if("line"===s.type){const e=s.point,t=n.point,i=e;let h=this.getCameraPosition(e,t);o.p(h)||(h=this._cache.cameraGL.pos),this.sceneView.renderCoordsHelper.worldUpAtPosition(h,l),a[0]=h[0],a[1]=h[1],a[2]=h[2],r[0]=i[0],r[1]=i[1],r[2]=i[2]}else if("rotate"===s.type){const e=s.points.pre,t=s.points.base,i=s.points.next,n=this.vec3d.create();this.vec3.subtract(n,t,e);const o=this.vec3d.create();this.vec3.subtract(o,i,t);const h=s.lastLineLen,d=this._cache.paths.getPoint(0,h-.02),c=this._cache.paths.getPoint(0,h-.01);let p=this.getCameraPosition(d.point,c.point);this.sceneView.renderCoordsHelper.worldUpAtPosition(t,l);const u=s.angle;p=this.rotateBySceneMode(p,l,u,t),a[0]=p[0],a[1]=p[1],a[2]=p[2],r[0]=t[0],r[1]=t[1],r[2]=t[2]}return this._cache.cameraGL.pos=a,this._cache.cameraGL.upDir=l,this._cache.lookAtTargetGL.pos=r,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:r,camPos:a,up:l,type:s.type}},this.getApiCamera=e=>{let t=e.camPos,i=e.lookAt;const s=e.up;if(!o.p(t)||!o.p(i)||!o.p(s))return null;let n=0,a=o.u(i,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference});n=r.z,r.z=parseFloat(r.z)+this.liveviewSetting.getAltitudeFactor(),r.z<0&&(r.z=0),i=o.g([r.x,r.y,r.z],null,this.sceneView),a=o.u(t,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference}),r.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),t=o.g([r.x,r.y,r.z],null,this.sceneView),this._isDebug&&this.auxHelper.drawLineGL([t,i],this.sceneView,"yellow");const l=new this.GLCamera(t,i,s);return this.cameraUtils.internalToExternal(this.sceneView,l)},this.resumeCamera=e=>j(this,void 0,void 0,(function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0}))}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return j(this,void 0,void 0,(function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>j(this,void 0,void 0,(function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){if("AbortError"===e.name)return console.log("sceneView.goTo() Aborted"),!1;throw e}return!0})))}))}getLiveviewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});var i;return j(this,void 0,void 0,(function*(){let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(o.p(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(r.a.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(!1!==(null==e?void 0:e.waittingForTerrain)){yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating"),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}return yield t.prepared.call(this),!0}))}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return j(this,void 0,void 0,(function*(){return o.p(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject()}))}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return j(this,void 0,void 0,(function*(){return e._doFly.call(this),yield this.updateAnimat(e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.animate.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);o.p(t)&&this.sceneView.goTo(t,{animate:!1})}})}))}getCameraPosition(e,t){var i,s;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const n=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,a=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,r=e,l=t,h=this.vec3d.create();this.vec3.subtract(h,r,l);const d=this.vec3.length(h),c=this.vec3d.create();this.vec3.normalize(c,h);const p=d+a,u=this.vec3d.create();this.vec3.scale(u,c,p);const g=this.vec3d.create();this.vec3.add(g,l,u);const m=o.u(g,1,this.sceneView),v=new this.Point({x:m[0],y:m[1],z:m[2],type:"point",spatialReference:this.sceneView.spatialReference});v.z<n&&(v.z=n),v.z<0&&(v.z=0),this._isDebug&&this.auxHelper.drawPoint(v,"red");return o.g([v.x,v.y,v.z],null,this.sceneView)}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return j(this,void 0,void 0,(function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))}))}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return j(this,void 0,void 0,(function*(){yield e.clear.call(this)}))}}var R=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};var x,A=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.RawData="rawData",e.DsInfo="dsInfo"}(x||(x={}));class L{constructor(){this.Geometry=null,this.Graphic=null}setup(e,t,i){return A(this,void 0,void 0,(function*(){return yield Object(a.loadArcGISJSAPIModules)(["esri/geometry","esri/Graphic"]).then(s=>A(this,void 0,void 0,(function*(){var a,o,r;[this.Geometry,this.Graphic]=s,this.recordConfig=e,this.sceneView=t,this.flyCallbacks=i,this.controller=null;const l=this.recordConfig.type;switch(l){case n.a.Rotate:case n.a.RealPath:case n.a.Smoothed:{let s;if((null===(a=e.storedGraphicsInfo)||void 0===a?void 0:a.type)===x.RawData){const t=e.storedGraphicsInfo.rawData.graphics;s=this.Graphic.fromJSON(t[0]).geometry}const l={id:e.idx,type:e.type,geometry:s,direction:e.direction,config:{cameraInfo:null===(o=e.controllerConfig)||void 0===o?void 0:o.cameraInfo,liveviewSettingState:null===(r=e.controllerConfig)||void 0===r?void 0:r.liveviewSettingState},sceneView:t,flyCallbacks:i};this.controller=yield class{static make(e){return R(this,void 0,void 0,(function*(){let t;const i=e.type;switch(i){case n.a.Rotate:t=yield(new h).setup(e);break;case n.a.RealPath:t=yield(new S).setup(e);break;case n.a.Smoothed:t=yield(new M).setup(e);break;default:console.error("ControllerFactory error type:",i)}return t}))}}.make(l);break}default:console.error("ControllerFactory error type: ",l)}}))),this}))}destructor(){var e;null===(e=this.controller)||void 0===e||e.destructor(),this.controller=null,this.recordConfig=null}getConfig(){var e;return this.recordConfig.controllerConfig=this.controller.getConfig(),(isNaN(this.recordConfig.duration)||this.recordConfig.duration<0)&&(null===(e=this.controller)||void 0===e?void 0:e.animate.state.amount)>=0&&(this.recordConfig.duration=this.controller.animate.getDuration()/1e3),this.cachingGraphicsInfo&&(this.recordConfig.storedGraphicsInfo.rawData=this.cachingGraphicsInfo.getConfig()),this.recordConfig}prepare(e){var t;return A(this,void 0,void 0,(function*(){return Object(o.p)(e)&&!Object(o.p)(e.animate)&&Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.prepare(e)}))}fly(e){var t;return A(this,void 0,void 0,(function*(){Object(o.p)(e.animate)||Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.fly(e)}))}pause(){var e;return A(this,void 0,void 0,(function*(){return yield null===(e=this.controller)||void 0===e?void 0:e.pause()}))}stop(){var e;return A(this,void 0,void 0,(function*(){yield null===(e=this.controller)||void 0===e?void 0:e.stop()}))}setGraphicsInfo(e){this.cachingGraphicsInfo=e}getGraphicsInfo(){return this.cachingGraphicsInfo}setSpeedFactor(e){var t;return null===(t=this.controller)||void 0===t?void 0:t.liveviewSetting.setSpeedFactor(e)}setIsLiveview(e){return A(this,void 0,void 0,(function*(){return yield this.controller.setIsLiveview(e)}))}setLiveviewSettingInfo(e){return A(this,void 0,void 0,(function*(){return yield this.controller.setLiveviewSettingInfo(e)}))}getLiveviewSettingInfo(){var e;return null===(e=this.controller)||void 0===e?void 0:e.getLiveviewSettingInfo()}getDefaultDuration(){return this.controller.getDefaultDuration()}}var D=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class T{constructor(){this._redrawAllRecordGraphics=e=>{const t=o.o(this.itemConfig.routes,e);null==t||t.records.map(e=>{e.mapViewId!==this.jimuMapView.id&&e.mapViewId!==o.t(this.jimuMapView.id)||this.drawOrUpdateGraphics(e)})}}setup(e,t,i,n,a,o,r,l,h){var d;return D(this,void 0,void 0,(function*(){switch(this.type=e.name,this.itemConfig=e,this.flyStateCallbacks=n,this.jimuMapView=i,this.record=null!=h?h:null,this.recordConfig=null!==(d=null==h?void 0:h.getConfig())&&void 0!==d?d:t,this.drawOrUpdateGraphics=a,this.highlightGraphics=o,this.checkAndSwitchJimuMapBeforePlay=r,this.getCurrentSceneView=l,this.type){case s.a.Rotate:case s.a.Path:this.itemConfig=e;break;case s.a.Route:this.itemConfig=this.itemConfig;break;default:console.error("ControllerFactory error type:",this.type)}return this._resetPlayingInfo(),this}))}destructor(){var e;this._resetPlayingInfo(),null===(e=this.record)||void 0===e||e.destructor()}handleUpdateJimuMapView(e){var t,i;this.jimuMapView=e,(null===(t=this.playingInfo.currentIds)||void 0===t?void 0:t.ids)&&this._redrawAllRecordGraphics(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids)}handleUpdateFlyCallbacks(e){this.flyStateCallbacks=e}_getFlyRecordDynamically(e,t,i){return D(this,void 0,void 0,(function*(){this.itemConfig=this.itemConfig;const s=o.m(this.itemConfig.routes,e);return yield(new L).setup(s,t,i)}))}_getLimitionParamForPrepare(e,t){const i={},s=e.getConfig().type,a=e.getConfig().duration;let r;if(s===n.a.Rotate&&(r=e.getConfig().angle),o.p(a)&&!isNaN(a)&&a>0&&Object.assign(i,{duration:a*this._computeRouteTaskTimeScale()*1e3}),o.p(r)&&Object.assign(i,{angleLimit:r}),o.p(t)){Object.assign(i,{animate:t.animate});const e=!1!==t.waittingForTerrain;Object.assign(i,{waittingForTerrain:e})}return i}playSpecifiedRecord(){return D(this,void 0,void 0,(function*(){const e=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(e.getGraphics()),yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}prepare(e){return D(this,void 0,void 0,(function*(){switch(yield this._setSpeed(null),this.type){case s.a.Rotate:case s.a.Path:{const t=this._getLimitionParamForPrepare(this.record,e);return yield this.record.prepare(t)}case s.a.Route:{const t=yield this.prepareSpecifiedRecord(e,this.flyStateCallbacks);return!(!t.isCanPlay||!t.prepareState)}default:return console.error("ControllerFactory error type:",this.type),!1}}))}fly(e){var t;return D(this,void 0,void 0,(function*(){switch(yield this.setSpeedFactor(e.settingSpeed),this.type){case s.a.Rotate:case s.a.Path:yield this.record.fly({speedFactor:this.getSpeedFactor()});break;case s.a.Route:if(o.p(null===(t=this.playingInfo.currentIds)||void 0===t?void 0:t.ids))return this.flyStateCallbacks.onFly(),void(yield this.playTask());this.flyStateCallbacks.onFly(),!this._isPlayRoute(e.ids)&&e.isPreviewSpecifiedRecord?yield this.playSpecifiedRecord():yield this.playRouteFly({routeUuid:e.ids.routeUuid},0);break;default:console.error("ControllerFactory error type:",this.type)}}))}pause(){var e;return D(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:yield null===(e=this.record)||void 0===e?void 0:e.pause();break;default:console.error("fly-route.pause error type:",this.type)}}))}stop(e=!1){var t,i;return D(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:yield null===(t=this.record)||void 0===t?void 0:t.stop();break;case s.a.Route:if(e)return;yield this.pause(),this.interruptDelayWaiting(),this._onAllRecordsFinish(),yield null===(i=this.record)||void 0===i?void 0:i.stop();break;default:console.error("fly-route.stop error type:",this.type)}}))}setSpeedFactor(e){return D(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:default:return yield this._setSpeed(e)}}))}getSpeedFactor(){return this.speedFactor}_setSpeed(e){var t;return D(this,void 0,void 0,(function*(){if(null===e){const t=o.k();e=t.speed}this.speedFactor=e,this.playingInfo.isWaiting?(this.interruptDelayWaiting(),yield this.playTask()):null===(t=this.record)||void 0===t||t.setSpeedFactor(e)}))}_computeRouteTaskTimeScale(){let e=1;switch(this.speedFactor){case 0:e=8;break;case.25:e=4;break;case.375:e=2;break;case.5:e=1;break;case.59375:e=1/1.5;break;case.625:e=.5;break;case.75:e=1/4;break;case 1:e=1/8;break;default:e=1}return e}setIsLiveview(e,t){var i,n;return D(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:return yield this.record.setIsLiveview(e);case s.a.Route:if(e){const s=yield this.prepareSpecifiedRecord({ids:t},this.flyStateCallbacks);return!(!s.isCanPlay||!s.prepareState)&&(yield null===(i=this.record)||void 0===i?void 0:i.setIsLiveview(e))}return yield null===(n=this.record)||void 0===n?void 0:n.setIsLiveview(e);default:console.error("ControllerFactory error type:",this.type)}}))}getLiveviewSettingInfo(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:return this.record.getLiveviewSettingInfo();default:console.error("ControllerFactory error type:",this.type)}}getDefaultDuration(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:return this.record.getDefaultDuration();default:console.error("ControllerFactory error type:",this.type)}}setLiveviewSettingInfo(e,t){var i,n;return D(this,void 0,void 0,(function*(){switch(this.type){case s.a.Rotate:case s.a.Path:case s.a.Route:{yield null===(i=this.record)||void 0===i?void 0:i.setLiveviewSettingInfo(e);(null===(n=null==t?void 0:t.isUpdateLine)||void 0===n||n)&&this.record.setGraphicsInfo(this.drawOrUpdateGraphics(this.record.getConfig()));const s=this.record.getGraphicsInfo();o.p(null==t?void 0:t.isNeedHighlight)&&t.isNeedHighlight&&o.p(s.getGraphics())&&this.highlightGraphics(s.getGraphics());break}default:console.error("ControllerFactory error type:",this.type)}}))}_isPlayRoute(e){return o.p(e.routeUuid)&&!o.p(e.recordUuid)}prepareSpecifiedRecord(e,t){return D(this,void 0,void 0,(function*(){const i=e.ids;if(this._isPlayRoute(e.ids)){const t=o.e(this.itemConfig.routes,e.ids,0);i.recordUuid=null==t?void 0:t.idx}const{isCanPlay:s}=yield this.checkAndSwitchJimuMapBeforePlay(e.ids);if(!s)return console.error("FlyRoute.prepareSpecifiedRecord(): JimuMap is not matched"),{isCanPlay:!1,prepareState:null};this._redrawAllRecordGraphics(e.ids);let n=t;!!e.isBuilderSettingFlag&&(n={onFly:()=>{t.onFly()},onFinish:()=>{this.highlightGraphics(null),t.onFinish()},onPause:()=>{this.highlightGraphics(null),t.onPause()}}),this.record=yield this._getFlyRecordDynamically(e.ids,this.getCurrentSceneView(),n);const a=this._getLimitionParamForPrepare(this.record,e);return{isCanPlay:!0,prepareState:yield this.record.prepare(a)}}))}playRouteFly(e,t){return D(this,void 0,void 0,(function*(){const i=o.o(this.itemConfig.routes,e),s=i.records.length-t,n=t,a=o.e(this.itemConfig.routes,e,t);this.initTask({routeUuid:i.idx,recordUuid:null==a?void 0:a.idx},n,s),yield this.playTask({init:!0})}))}initTask(e,t,i){this._resetPlayingInfo(),this.playingInfo.currentIds={ids:e,orderId:t-1},this.playingInfo.maxRecordLen=i,this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0;const s=this.getCurrentSceneView(),n=s.on("drag",e=>{this.playingInfo.isWaiting&&"start"===e.action&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())}),a=s.on("mouse-wheel",e=>{this.playingInfo.isWaiting&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())});this.playingInfo.eventHandlers.push(n),this.playingInfo.eventHandlers.push(a),this._nextPlayingInfo()}_nextPlayingInfo(){var e;this.playingInfo.currentIds.orderId++;const t={routeUuid:null===(e=this.playingInfo.currentIds.ids)||void 0===e?void 0:e.routeUuid,recordUuid:null},i=o.e(this.itemConfig.routes,t,this.playingInfo.currentIds.orderId);this.playingInfo.currentIds.ids={routeUuid:t.routeUuid,recordUuid:null==i?void 0:i.idx}}playTask(e){var t;return D(this,void 0,void 0,(function*(){if(this.playingInfo.isWaiting=!1,this.playingInfo.currentIds.orderId>=this.playingInfo.maxRecordLen)return void this._onAllRecordsFinish();const i={onFinish:this._onOneRecordFinish.bind(this,{}),onPause:this._onPause.bind(this,{})},s=o.e(this.itemConfig.routes,this.playingInfo.currentIds.ids,this.playingInfo.currentIds.orderId);if((null==e?void 0:e.init)||(null===(t=this.record)||void 0===t?void 0:t.getConfig().idx)!==(null==s?void 0:s.idx)){const e=yield this.prepareSpecifiedRecord({ids:this.playingInfo.currentIds.ids},i);if(!e.isCanPlay)return console.warn("playTask: skip a record"),i.onFinish(),!1;if(!e.prepareState)return i.onPause(),!1}const n=this.record.getConfig().endDelay;o.p(n)?this.playingInfo.continueDelay=n*this._computeRouteTaskTimeScale():this.playingInfo.continueDelay=0,yield this.record.fly({speedFactor:this.getSpeedFactor()})}))}_onOneRecordFinish(){return D(this,void 0,void 0,(function*(){if(this._nextPlayingInfo(),o.p(this.playingInfo.continueDelay)){this.playingInfo.waittingPromise=this._abortWrapper(this.waitDelay(this.playingInfo.continueDelay));try{yield this.playingInfo.waittingPromise,yield this.playTask()}catch(e){}}else yield this.playTask()}))}waitDelay(e){return D(this,void 0,void 0,(function*(){return this.playingInfo.isWaiting=!0,yield new Promise((t,i)=>{setTimeout(()=>{t({})},1e3*e)})}))}interruptDelayWaiting(){var e;o.p(null===(e=this.playingInfo.waittingPromise)||void 0===e?void 0:e.abort)&&this.playingInfo.waittingPromise.abort(),this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0}_abortWrapper(e){return D(this,void 0,void 0,(function*(){let t;const i=new Promise((e,i)=>t=i),s=Promise.race([e,i]);return s.abort=t,s}))}_onPause(){var e;null===(e=this.flyStateCallbacks)||void 0===e||e.onPause()}_onAllRecordsFinish(){var e;this._resetPlayingInfo(),null===(e=this.flyStateCallbacks)||void 0===e||e.onFinish()}_resetPlayingInfo(){var e;o.p(null===(e=this.playingInfo)||void 0===e?void 0:e.eventHandlers)&&(this.playingInfo.eventHandlers.map(e=>{e.remove()}),this.playingInfo.eventHandlers=null,this.playingInfo.eventHandlers=[]),this.playingInfo={currentIds:{ids:null,orderId:0},maxRecordLen:0,waittingPromise:null,isWaiting:!1,continueDelay:0,eventHandlers:[]}}}var O=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class G{constructor(){this.sceneView=null}setup(e){return O(this,void 0,void 0,(function*(){return yield Object(a.loadArcGISJSAPIModules)(["esri/core/watchUtils"]).then(t=>{[this.watchUtils]=t,this.sceneView=e.sceneView,this.onTerrainLoaded=e.onTerrainLoaded,this.handleTerrainLoaded()}),this}))}handleTerrainLoaded(){return O(this,void 0,void 0,(function*(){yield Promise.race([this.getTerrainLoadedPromise(),this.getTimerPromise(1e4)]),this.onTerrainLoaded()}))}getTerrainLoadedPromise(){return O(this,void 0,void 0,(function*(){if(!this.sceneView||!this.sceneView.groundView)return!1;try{yield this.watchUtils.whenTrueOnce(this.sceneView.groundView,"updating"),yield this.watchUtils.whenFalseOnce(this.sceneView.groundView,"updating")}catch(e){return!1}return!0}))}getTimerPromise(e){return O(this,void 0,void 0,(function*(){return yield new Promise(t=>setTimeout(t,e))}))}}var F=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class N{constructor(e){this.findFirstUsedItem=()=>{for(let e=0,t=this.itemsList.length;e<t;e++){const t=this.itemsList[e];if(t.config.isInUse)return t}return{config:null,routes:null}},this.findFirstRouteItem=()=>{for(const e of this.itemsList)if(e.config.isInUse&&s.a.Route===e.config.name)return e;return{config:null,routes:null}},this._findItemIdx=e=>this.itemsList.findIndex(t=>t.config.uuid===e),this.getActiveItem=()=>this.activedItem,this.getActiveItemConfig=()=>{var e;return null===(e=this.activedItem)||void 0===e?void 0:e.config},this.getFlyStyle=()=>{var e;return null===(e=this.activedItem)||void 0===e?void 0:e.config.name},this.getRouteByIdx=e=>this.getActiveItem().routes,this.getRouteConfigByIdx=e=>{var t;const i=this.getActiveItemConfig();return null===(t=null==i?void 0:i.routes)||void 0===t?void 0:t.find(t=>t.idx===e.routeUuid)},this.getRecordConfigByIds=e=>{const t=this.getActiveItemConfig().routes;return Object(o.m)(t,e)},this.getRecordByIds=e=>{var t;const i=null===(t=this.activedItem.routes)||void 0===t?void 0:t.record;return e.recordUuid===(null==i?void 0:i.getConfig().idx)?i:null},this.isUesRouteFlyMode=()=>{const e=this.getActiveItemConfig();return(null==e?void 0:e.name)===s.a.Route},this.clear=()=>{},this.checkAndSwitchJimuMapBeforePlay=e=>F(this,void 0,void 0,(function*(){const t=this.getRecordConfigByIds(e);if(!Object(o.p)(t))return{isCanPlay:!1,hadSwitchedMap:!1};const i=this.isJimuMapViewInGroup(t.mapViewId),s=this.isCurrentJimuMap(t);return s?{isCanPlay:!0,hadSwitchedMap:!1}:i?s?{isCanPlay:!0,hadSwitchedMap:!1}:(this.onBeforeSwitchMap(),yield this.viewGroup.switchMap(),{isCanPlay:!0,hadSwitchedMap:!0}):(console.error("FlyManager.checkAndSwitchJimuMapBeforePlay: this RecordConfig can't fly in this JimuMap"),{isCanPlay:!1,hadSwitchedMap:!1})})),this.isRecordCanPlay=e=>{const t=this.isJimuMapViewInGroup(e.mapViewId),i=this.isCurrentJimuMap(e);return!!i||(!!t||(console.error("FlyManager.isRecordCanPlay: this RecordConfig can't fly in this JimuMap"),!1))},this.isJimuMapViewInGroup=e=>{var t;let i=null!=e?e:this.jimuMapView.id;i=Object(o.t)(i);const s=Object.keys(null===(t=this.viewGroup)||void 0===t?void 0:t.jimuMapViews).find(e=>Object(o.t)(e)===i);return!!Object(o.p)(s)},this.isCurrentJimuMap=e=>{var t;return e.mapViewId===Object(o.t)(null===(t=this.jimuMapView)||void 0===t?void 0:t.id)},this.getCurrentSceneView=()=>this.sceneView,this.stop(),this.onTerrainLoaded=e.onTerrainLoaded,this.onBeforeSwitchMap=e.onBeforeSwitchMap,this.drawOrUpdateGraphics=e.drawOrUpdateGraphics,this.highlightGraphics=e.highlightGraphics,this.onItemsUpdate=e.onItemsUpdate,this.isBuilderSettingFlag=e.isBuilderSettingFlag,this.updateViewGroup(e.viewGroup),this.updateJimuMapView(e.jimuMapView),this.uiLoadingCallbacks=e.uiLoadingCallbacks,this.flyStateCallbacks=e.flyStateCallbacks,this.updateItems(e.widgetConfig)}updateViewGroup(e){this.viewGroup=e}updateJimuMapView(e){var t;this.jimuMapView=e,this.sceneView=null===(t=this.jimuMapView)||void 0===t?void 0:t.view;const i=this.getActiveItem();Object(o.p)(null==i?void 0:i.routes)&&(null==i||i.routes.handleUpdateJimuMapView(e)),this.getTerrainLoadingHelper(this.sceneView,this.onTerrainLoaded)}updateItems(e){this.itemsList=[];const t=e.itemsList.asMutable({deep:!0});for(const e of t)e.isInUse&&this.itemsList.push({config:e,routes:null});"function"==typeof this.onItemsUpdate&&this.onItemsUpdate(this.itemsList)}destructor(){this.stop()}findItemByUuid(e){var t;let i=null;return i=null===(t=this.itemsList)||void 0===t?void 0:t.find(t=>t.config.uuid===e),i}registerItem(e){const t=this.findItemByUuid(e);this.activedItem=t}unRegisterItem(){var e;(null===(e=this.activedItem)||void 0===e?void 0:e.routes)&&this.activedItem.routes.destructor(),this.activedItem=null}getControllerTypeByItemData(e){let t;return e.name===s.a.Rotate?t=n.a.Rotate:e.name===s.a.Path&&(t=e.style),t}buildTemporaryRecordConfig(e,t,i){const a=this.getActiveItemConfig(),o=this.getFlyStyle();let r;o===s.a.Rotate?r=n.a.Rotate:o===s.a.Path&&(r=this.getControllerTypeByItemData(a));return{idx:null,type:r,displayName:"runtime",duration:null,startDelay:null,endDelay:null,angle:null,controllerConfig:{cameraInfo:t,liveviewSettingState:null},direction:a.direction,storedGraphicsInfo:{type:x.RawData,rawData:e.getConfig()},mapViewId:i.id}}buildTemporaryRecord(e,t,i,s){return F(this,void 0,void 0,(function*(){const n=yield(new L).setup(e,t,i);return Object(o.p)(s)&&n.setGraphicsInfo(s),n}))}prepareRoutePreview(e,t){return F(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return!1;const i=this.getActiveItem();return yield this.setupFly(i.config,null,null!=t?t:this.flyStateCallbacks),yield this.prepare({ids:{routeUuid:e.routeUuid},waittingForTerrain:!1})}))}previewSpecifiedRoute(e,t,i){return F(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const s=this.getActiveItem(),n=null!=i?i:this.flyStateCallbacks;Object(o.p)(s.routes)||(yield this.prepareRoutePreview(t,n)),yield this.fly({ids:t,settingSpeed:e,isPreviewSpecifiedRecord:!1},n)}))}previewSpecifiedRecord(e,t){return F(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const{isCanPlay:i}=yield this.checkAndSwitchJimuMapBeforePlay(e);if(!i)return;const s=this.getActiveItem();yield this.setupFly(s.config,null,t);(yield this.prepare({ids:e,isBuilderSettingFlag:this.isBuilderSettingFlag}))&&(yield this.fly({ids:e,settingSpeed:null,isPreviewSpecifiedRecord:!0}))}))}setIsLiveviewSpecifiedRecord(e,t){return F(this,void 0,void 0,(function*(){if(!this.isUesRouteFlyMode())return;const i=this.getActiveItem();if(Object(o.p)(i.routes)||(yield this.setupFly(i.config,null),yield this.prepare({ids:e,animate:!1})),yield this.setIsLiveview(t,e),t){const e=yield this.getLiveviewSettingInfo();this.onLiveviewParamChange(e,{isNeedHighlight:!0})}}))}loadingForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoading&&t.onLoading()}loadedForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoaded&&t.onLoaded()}setupFly(e,t,i,s){return F(this,void 0,void 0,(function*(){const n=this.getActiveItem();n.routes&&n.routes.destructor();const a=null!=i?i:this.flyStateCallbacks;return n.routes=yield(new T).setup(e,t,this.jimuMapView,a,this.drawOrUpdateGraphics,this.highlightGraphics,this.checkAndSwitchJimuMapBeforePlay,this.getCurrentSceneView,s),n}))}prepare(e){var t;return F(this,void 0,void 0,(function*(){const i=this.getActiveItem();return Object(o.p)(i)?yield null===(t=i.routes)||void 0===t?void 0:t.prepare(e):null}))}fly(e,t){var i,s;return F(this,void 0,void 0,(function*(){const n=this.getActiveItem();if(!Object(o.p)(n))return null;t&&(null===(i=n.routes)||void 0===i||i.handleUpdateFlyCallbacks(t)),yield null===(s=n.routes)||void 0===s?void 0:s.fly(e)}))}pause(){var e;return F(this,void 0,void 0,(function*(){const t=this.getActiveItem();if(!Object(o.p)(t))return null;yield null===(e=t.routes)||void 0===e?void 0:e.pause()}))}stop(e={isUpdate:!1}){var t;return F(this,void 0,void 0,(function*(){const i=this.getActiveItem();if(!Object(o.p)(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.stop(e.isUpdate)}))}getProgress(){}getLiveviewSettingInfo(){const e=this.getActiveItem();return Object(o.p)(e)?e.routes.getLiveviewSettingInfo():null}getDefaultDuration(){var e;const t=this.getActiveItem();return Object(o.p)(t)?null===(e=t.routes)||void 0===e?void 0:e.getDefaultDuration():null}setIsLiveview(e,t){return F(this,void 0,void 0,(function*(){const i=this.getActiveItem();return Object(o.p)(i)?yield i.routes.setIsLiveview(e,t):null}))}onLiveviewParamChange(e,t){var i;return F(this,void 0,void 0,(function*(){const s=this.getActiveItem();if(!Object(o.p)(s))return null;yield null===(i=s.routes)||void 0===i?void 0:i.setLiveviewSettingInfo(e,t)}))}setSpeedFactor(e){var t;return F(this,void 0,void 0,(function*(){const i=this.getActiveItem();if(!Object(o.p)(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.setSpeedFactor(e)}))}getTerrainLoadingHelper(e,t){return F(this,void 0,void 0,(function*(){this.terrainLoadingHelper=yield(new G).setup({sceneView:e,onTerrainLoaded:t})}))}}},111:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M9 6V2.333C9 .939 10.408 0 12 0h8c1.592 0 3 .939 3 2.333V6h8a1 1 0 010 2h-3l-1.858 22.153A2 2 0 0124.148 32H7.852a2 2 0 01-1.994-1.847L4 8H1a1 1 0 010-2h8zm2 0h10V2c0-.078-10-.078-10 0v4zM6.006 8l1.846 22h16.296l1.846-22H6.006zM13 12a1 1 0 011 1v12a1 1 0 01-2 0V13a1 1 0 011-1zm6 0a1 1 0 011 1v12a1 1 0 01-2 0V13a1 1 0 011-1z"></path></svg>'},125:function(e,t){e.exports='<svg viewBox="0 0 15 16" xmlns="http://www.w3.org/2000/svg"><path d="M5.3 3.383l9 6.285h-3.874l2.316 4.421-2.687 1.294-2.373-4.498L5.3 14.009V3.383zM6.299 5.3v5.748l1.537-2.014 2.653 5.029.886-.426-2.601-4.97h2.347L6.299 5.3zm-2.82 1.426l.529.721-2.579 1.191-.389-.784 2.44-1.128zM.648 3.697l2.624.894-.117.883-2.806-.957.299-.82zm10.946-.723l.389.784-2.579 1.193-.25-.85 2.44-1.127zM8.489.072l.848.29-.989 2.71-.784-.465.925-2.535zM4.392.521l.974 1.966-.812.375L3.58.896 4.392.52z" fill="#000" fill-rule="nonzero"></path></svg>'},126:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 1c-2.209 0-4 .852-4 3.067v7.922L8 16l4-4.01V4.066C12 1.852 10.209 1 8 1zm3.1 10.686L8 14.794l-3.1-3.108v-7.76C4.9 2.51 5.943 1.79 8 1.79c2.057 0 3.1.719 3.1 2.137v7.759zM10 6.022a2 2 0 11-4 0 2 2 0 014 0zm-1 0a1 1 0 10-2 0 1 1 0 002 0z" fill="#000" fill-rule="nonzero"></path></svg>'},127:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.793 1.3a.983.983 0 011.32-.086l.094.086 5.5 5.624c.36.368.388.948.083 1.35l-.083.096-6.5 6.646a.992.992 0 01-.576.29l-.131.01h-4a.986.986 0 01-.608-.211l-.099-.089-3.5-3.579a1.04 1.04 0 01-.083-1.35l.083-.096 8.5-8.691zm.707.706L1.008 10.69c-.007.008-.01.022-.007.033l.007.015 3.497 3.577h3.989l6.498-6.645c.007-.007.01-.02.007-.032l-.007-.015L9.5 2.006zM4.844 8.5l-1.838 1.85c-.005.005-.007.015-.005.024l.005.01L5.504 13h2.849l.413-.358c.005-.006.007-.016.005-.024l-.005-.011L4.844 8.5z" fill="#000" fill-rule="nonzero"></path></svg>'},128:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.957.057A8.001 8.001 0 018 16 8 8 0 011.763 2.99l.249.24.093.993A7 7 0 108 1l.213.004.744-.947zM8 7a1 1 0 110 2 1 1 0 010-2zM1 0l6.734.46L2.86 5.377v-2.99L1 0z" fill="#000" fill-rule="nonzero"></path></svg>'},129:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M1 14a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2zm7-9l-.812 9-2.75-3.335L3 9.328 11 4zm-5 7a1 1 0 110 2 1 1 0 010-2zm6-10a1 1 0 110 2 1 1 0 010-2zm3-1a1 1 0 110 2 1 1 0 010-2z" fill="#000" fill-rule="evenodd"></path></svg>'},130:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.619 3l-1.94-1.616.641-.768L15.781 3.5l-3.46 2.884-.641-.768L13.62 4H3.87a2.37 2.37 0 100 4.74h8.25a3.38 3.38 0 010 6.76H2.167v-1h9.953a2.38 2.38 0 000-4.76H3.87a3.37 3.37 0 110-6.74h9.749z" fill="#000"></path></svg>'},131:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M15 8L1 0v16l14-8zM2 1.723l10.983 6.276L2 14.276V1.723z" fill="#000" fill-rule="nonzero"></path></svg>'},132:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 1v14H4V1h1zm7 0v14h-1V1h1z" fill="#000" fill-rule="nonzero"></path></svg>'},15:function(e,t){e.exports=o},167:function(e,t){e.exports='<svg viewBox="0 0 8 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.067C0 .852 1.791 0 4 0s4 .852 4 3.066v7.924L4 15l-4-4.011V3.067zm4 10.727l3.1-3.108V2.927C7.1 1.509 6.057.79 4 .79 1.943.79.9 1.51.9 2.926v7.76L4 13.794zm2-8.772a2 2 0 11-4 0 2 2 0 014 0zm-2-1a1 1 0 110 2 1 1 0 010-2z" fill="#B6B6B6"></path></svg>'},2:function(e,t){e.exports=s},20:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return l}));var s,n=i(4),a=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class o{constructor(){this.symbolJsonUtils=null,this.getDefaultPointSymbol=e=>this.symbolJsonUtils.fromJSON({type:"PointSymbol3D",symbolLayers:[{type:"Icon",material:{color:e},size:12,outline:{color:[255,255,255],size:.75}}],verticalOffset:{screenLength:5,minWorldLength:5,maxWorldLength:10},callout:{type:"line",color:[255,255,255],size:2,border:{color:[50,50,50]}}}),this.getDefaultLineSymbol=e=>this.symbolJsonUtils.fromJSON({type:"LineSymbol3D",symbolLayers:[{type:"Line",material:{color:e,transparency:50},join:"round",cap:"round",size:2.25}]})}setup(){return a(this,void 0,void 0,(function*(){return yield Object(n.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then(e=>a(this,void 0,void 0,(function*(){[this.symbolJsonUtils]=e}))),this}))}}!function(e){e[e.Default=0]="Default",e[e.Custom=1]="Custom"}(s||(s={}));class r{constructor(e){return this.update(e)}update(e){const{graphics:t,isPicked:i}=e;return this.setGraphics(t),this.isPicked=i,this.symbolType=s.Default,this}setGraphics(e){this.graphics=e}getGraphics(){return this.graphics}destructor(){}getMainGraphic(){return this.graphics?this.graphics[0]:null}updateByConfig(){}getConfig(){var e;const t={graphics:null,isPicked:this.isPicked,symbolType:s.Default};return t.graphics=null===(e=this.graphics)||void 0===e?void 0:e.map(e=>{const t=e.clone();if(t.symbol=null,t.toJSON)return t.toJSON()}),t}}class l{}l.SPEED={MIN:0,MAX:1,MULTIPLIER:8,DECIMAL:3,DEFAULT_SPEED:50},l.ALT={MIN:0,MAX:800,STEP:10},l.TILT={MIN:0,MAX:90,STEP:1},l.TIME={MIN:0},l.CALCULATED_VALUE_ROUNDED={ANGLE:0,ELEV:1,TIME:1}},25:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return m}));var s=i(4),n=i(3);class a{constructor(e){this.GraphicsLayer=null,this.Point=null,this.clearAll=()=>{n.p(this.auxGraphicsLayer)&&this.auxGraphicsLayer.removeAll(),n.p(this.auxMovingObjLayer)&&this.auxMovingObjLayer.removeAll()},this.deposeMoving=()=>{this.auxMovingObjLayer.removeAll()},this.drawPoint=(e,t)=>{const i=n.p(t)?t:"darkgreen",s=new this.Graphic({geometry:e,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:i},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(s),s},this.drawPointGL=(e,t)=>{const i=n.u(e,1,this.sceneView),s=new this.Point({x:i[0],y:i[1],z:i[2],spatialReference:this.sceneView.spatialReference});s.z<100&&(s.z=100);const a=n.p(t)?t:"darkgreen",o=new this.Graphic({geometry:s,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:a},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(o),o},this.drawLine=(e,t)=>{const i=n.p(t)?t:"lightblue",s=new this.Graphic({geometry:{type:"polyline",paths:e,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:i},size:3}]}});return this.auxGraphicsLayer.add(s),s},this.drawLineXY=(e,t)=>{const i=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],n=s[0],a=s[1],o=s[2];0===o?i.push([n,a]):i.push([n,a,o])}const s=n.p(t)?t:"lightblue",a=new this.Graphic({geometry:{type:"polyline",paths:i,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(a),a},this.drawLineGL=(e,t,i)=>{const s=n.p(i)?i:"lightblue",a=[];for(let i=0,s=e.length;i<s;i++){const s=e[i],o=n.u(s,1,t);a.push(o)}const o=new this.Graphic({geometry:{type:"polyline",paths:a,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(o),o},Object(s.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/Graphic","esri/views/3d/support/projectionUtils","esri/geometry/support/webMercatorUtils"]).then(e=>{[this.GraphicsLayer,this.Point,this.Graphic,this.projectionUtils,this.webMercatorUtils]=e,this.auxGraphicsLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxGraphicsLayer),this.auxMovingObjLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxMovingObjLayer)}),this.sceneView=e.sceneView}}var o=i(20),r=i(37),l=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class h{constructor(){this.easing=(e,t)=>{switch(this.state.mode){case r.a.In:return this.easingIn(e,t);case r.a.InOut:return this.easingInOut(e,t);case r.a.Linear:return this.linear(e,t);case r.a.NONE:return this.uniformSpeed(e,t)}},this.uniformSpeed=(e,t)=>{this.updateCurrentDuration(e*t);const i=this.getMovementByFrame(e)*t;return this.state.progress=0,{interp:0,step:i,progress:this.state.progress}},this.linear=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=r.b.linear(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.easingIn=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=r.b.easeIn(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.interp.cache.lastStep=n):n=this.state.interp.cache.lastStep*t,this.state.progress=-1,{interp:s,step:n,progress:this.state.progress}},this.easingInOut=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=r.b.easeInOut(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.getMovementByFrame=e=>this.getSpeed()/(1e3/e)}setup(){return l(this,void 0,void 0,(function*(){return yield Object(s.loadArcGISJSAPIModules)(["esri/core/scheduling"]).then(e=>{[this.scheduling]=e}),this.state={speed:o.a.SPEED.DEFAULT_SPEED,mode:r.a.NONE,progress:0,amount:-1,interp:{time:{begin:0,currentDuration:0,duration:1e4},value:{start:0,end:0},cache:{lastVal:0,lastStep:0}}},this.animatHandler=null,this}))}getState(){return this.state}setState(e){this.state=e}init(e,t,i,s){this.state.mode=e,this.state.interp.value.start=t,this.state.interp.value.end=i,this.state.interp.time.duration=s}reset(){this.state.interp.time.begin=0,this.state.interp.time.currentDuration=0,this.state.progress=0}computeDuration(){return this.state.amount/this.state.speed*1e3}getDuration(){return this.state.interp.time.duration}setAmount(e){return this.state.amount=e,this}getAmount(){return this.state.amount}getProgress(){return this.state.progress}progressForward(){return this.state.progress+=1e-4,this.state.progress}progressBackward(){return this.state.progress-1e-4}updateCurrentDuration(e){return this.state.interp.time.currentDuration=this.state.interp.time.currentDuration+e,isNaN(this.state.interp.time.currentDuration)&&(this.state.interp.time.currentDuration=0),this.state.interp.time.currentDuration}getSpeed(){return this.state.speed}setSpeed(e){this.state.speed=e}update(e){return l(this,void 0,void 0,(function*(){null===this.animatHandler&&(this.animatHandler=this.scheduling.addFrameTask({update:t=>{e(t)}}))}))}stop(){null!==this.animatHandler&&(this.animatHandler.pause(),this.animatHandler.remove(),this.animatHandler=null)}insertAnExtraFrame(e){var t;null===(t=this.scheduling)||void 0===t||t.schedule(t=>{e(t)})}}class d{constructor(){return this.abort(),this.update(),this}destructor(){this.signalHandler&&(this.signalHandler.abort(),this.signalHandler=null)}update(){return this.signalHandler=null,this.signalHandler=new AbortController,this.signalHandler.signal}abort(){var e;(null===(e=this.signalHandler)||void 0===e?void 0:e.signal)&&this.signalHandler.abort()}}class c{constructor(){this.DEFAULT_SPEED=(o.a.SPEED.MIN+o.a.SPEED.MAX)/2,this.state=c._getDefualtLiveviewSetting()}static _getDefualtLiveviewSetting(){return{speedFactor:.5,fixHeading:NaN,fixTilt:NaN,fixAltitude:0,initCamOffset:{height:60,distance:90}}}getState(){return this.state}setState(e){this.state=e}getCamOffsetHeight(){return this.state.initCamOffset.height}getCamOffsetDistance(){return this.state.initCamOffset.distance}setSpeedFactor(e){let t;t=void 0===e?this.DEFAULT_SPEED:e,this.state.speedFactor=parseFloat(t)}getSpeedFactor(){return void 0===this.state.speedFactor?.5:this.state.speedFactor}getMappingSpeedFactor(){if(void 0===this.state.speedFactor)return this.DEFAULT_SPEED;return Object(n.x)(this.state.speedFactor)}setHeadingFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixHeading=t}getHeadingFactor(){return Object(n.p)(this.state.fixHeading)?this.state.fixHeading:0}setTiltFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixTilt=t}getTiltFactor(e){return e||Object(n.p)(this.state.fixTilt)?this.state.fixTilt:0}setAltitudeFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixAltitude=t}getAltitudeFactor(e){return e||Object(n.p)(this.state.fixAltitude)?this.state.fixAltitude:0}}var p,u,g=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.Rotate="ROTATE",e.Smoothed="CURVED",e.RealPath="LINE"}(p||(p={})),function(e){e[e.INITED=-1]="INITED",e[e.PREPARING=0]="PREPARING",e[e.PREPARED=1]="PREPARED",e[e.RUNNING=2]="RUNNING",e[e.STOPPED=3]="STOPPED"}(u||(u={}));class m{constructor(){this.Camera=null,this._resume=e=>g(this,void 0,void 0,(function*(){yield this.preparing();return!!(yield e)&&(yield this.prepared(),this._doFly(),!0)})),this.rotateBySceneMode=(e,t,i,s)=>{const a=this.vec3d.fromValues(e[0],e[1],e[2]),o=this.vec3d.create();n.p(s)&&(this.vec3.negate(o,s),this.vec3.add(a,a,o));const r=this.mat4d.create();return this.mat4.rotate(r,r,n.c(i),t),this.vec3.transformMat4(a,a,r),n.p(s)&&this.vec3.subtract(a,a,o),a},this.queryGeometryElevInfo=e=>{var t;return n.p(null===(t=this.sceneView.groundView)||void 0===t?void 0:t.elevationSampler)?this.sceneView.groundView.elevationSampler.queryElevation(e):e.hasZ?e:void 0},this._coordsToGeoArray=e=>{const t=[];let i;for(let s=0,n=e.length;s<n;s++)i=this.vec3d.fromValues(e[s].x,e[s].y,e[s].z),t.push(i);return t},this.getPrepareGoToOptionsBeforeTerrainLoaded=e=>{const t={animate:!0,maxDuration:4e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t},this.getPrepareGoToOptionsAfterTerrainLoaded=e=>{const t={animate:!0,maxDuration:1e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t}}setup(e){return g(this,void 0,void 0,(function*(){return yield Object(s.loadArcGISJSAPIModules)(["esri/core/libs/gl-matrix-2/vec3f64","esri/core/libs/gl-matrix-2/mat4f64","esri/core/libs/gl-matrix-2/vec3","esri/core/libs/gl-matrix-2/mat4","esri/core/libs/gl-matrix-2/quatf64","esri/core/libs/gl-matrix-2/quat","esri/views/3d/support/cameraUtils","esri/views/3d/webgl-engine/lib/Camera","esri/geometry/Point","esri/views/3d/support/mathUtils","esri/core/watchUtils","esri/Camera"]).then(t=>g(this,void 0,void 0,(function*(){[this.libVec3f64,this.libMat4f64,this.libVec3,this.libMat4,this.libQuatf64,this.libQuat,this.cameraUtils,this.GLCamera,this.Point,this.esriMathUtils,this.watchUtils,this.Camera]=t,this.vec3=this.libVec3.vec3,this.vec3d=this.libVec3f64.vec3f64,this.mat4=this.libMat4.mat4,this.mat4d=this.libMat4f64.mat4f64,this.quat=this.libQuat.quat,this.quatd=this.libQuatf64.quatf64,yield this.clear();const{id:i,type:s,geometry:o,direction:r,config:l,sceneView:h,flyCallbacks:d}=e;this.id=i,this.type=s,this.geometry=o,this.direction=r,this.cameraInfo=l.cameraInfo,n.p(l.liveviewSettingState)&&this.liveviewSetting.setState(l.liveviewSettingState),this.sceneView=h,this.flyCallbacks=d,this._isDebug=!1,this._isDebug&&(this.auxHelper=new a({sceneView:this.sceneView})),this.DEBUG={planTime:0,startTime:0,endTime:0},this.eventHandlers.push(this.sceneView.on("drag",e=>{this.flyState<=u.RUNNING&&"start"===e.action&&this.pause()})),this.eventHandlers.push(this.sceneView.on("mouse-wheel",e=>{this.flyState<=u.RUNNING&&this.pause()}))}))),this}))}destructor(){this.onStop(),this.clear()}isInited(){return this.flyState>=u.INITED}isEnableToFly(){const e=this.flyState;return e===u.PREPARED||e===u.STOPPED||e===u.PREPARING}isEnableToPause(){return this.flyState>=u.PREPARING}init(){this.flyState=u.INITED,this.animate.reset()}preparing(){var e;return g(this,void 0,void 0,(function*(){this.flyState=u.PREPARING,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPreparing)&&this.flyCallbacks.onPreparing()}))}prepared(){return g(this,void 0,void 0,(function*(){return this.flyState=u.PREPARED,setTimeout(()=>{},50)}))}_doFly(){this.isLiveviewMode||this.onStart()}setConfig(e){this.cameraInfo=e.cameraInfo,this.liveviewSetting.setState(e.liveviewSettingState)}getConfig(){return{cameraInfo:this.cameraInfo,liveviewSettingState:this.liveviewSetting.getState()}}pause(){return g(this,void 0,void 0,(function*(){return!!this.isEnableToPause()&&(this.stopAnimat(),this.onPause(),!0)}))}resume(e){return g(this,void 0,void 0,(function*(){}))}stop(){this.stopAnimat(),this.onStop()}clear(){var e,t,i,s;return g(this,void 0,void 0,(function*(){n.p(this.eventHandlers)&&this.eventHandlers.map(e=>{e.remove()}),this.eventHandlers=null,this.eventHandlers=[],this.abortSignalHandler&&this.abortSignalHandler.abort(),this.abortSignalHandler=null,this.abortSignalHandler=new d,this._isDebug&&(null===(e=this.auxHelper)||void 0===e||e.clearAll()),n.p(null===(t=this._cache)||void 0===t?void 0:t.paths)&&(null===(i=this._cache)||void 0===i||i.paths.destructor()),this.id=null,this.type=null,this.geometry=null,this.direction=null,this.cameraInfo=null,this.sceneView=null,this.flyCallbacks=null,this.auxHelper=null,null===(s=this.animate)||void 0===s||s.stop(),this.animate=null,this.animate=yield(new h).setup(),this.liveviewSetting=null,this.liveviewSetting=new c,this.flyState=null,this.isLiveviewMode=!1,this.shownProgress=0,this._cache={paths:null,cachedGeo:null,cameraGL:{pos:null,upDir:null},lookAtTargetGL:{pos:null,upAxis:null,baseAlt:null}},this._isDebug=!1,this.DEBUG={planTime:null,startTime:null,endTime:null}}))}updateAnimat(e){return g(this,void 0,void 0,(function*(){return yield this.animate.update(t=>{e(t)})}))}stopAnimat(){this.animate.stop(),this.updateProgressBar()}setIsLiveview(e){return g(this,void 0,void 0,(function*(){return this.isLiveviewMode=e,e?yield this.fly({animate:!1}):yield this.pause()}))}setLiveviewSettingInfo(e,t){return g(this,void 0,void 0,(function*(){if(!n.p(e))return!1;let i=!1;const s=e.altitude;void 0!==s&&(i=!0,this.liveviewSetting.setAltitudeFactor(s));const a=e.tilt;return void 0!==a&&(i=!0,this.liveviewSetting.setTiltFactor(a)),i&&n.p(this.animate)&&this.isLiveviewMode&&this.animate.insertAnExtraFrame(e=>g(this,void 0,void 0,(function*(){yield t(e)}))),!0}))}getDefaultDuration(){return this.flyState>=u.PREPARED?this.animate.getDuration():null}onStart(){var e;this.flyState=u.RUNNING,this._isDebug&&(this.DEBUG.planTime=this.animate.state.interp.time.duration,this.DEBUG.startTime=(new Date).getTime()),"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFly)&&this.flyCallbacks.onFly()}onPause(){var e;this.abortSignalHandler.abort(),this.flyState=u.STOPPED,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPause)&&this.flyCallbacks.onPause()}onStop(){var e;if(this.abortSignalHandler.abort(),this.flyState=u.STOPPED,this._isDebug){this.DEBUG.endTime=(new Date).getTime();const e=(this.DEBUG.endTime-this.DEBUG.startTime)/1e3,t=this.DEBUG.planTime/1e3;console.log("DEBUG 1.fly sum time ==> "+e.toFixed(2)+" s"),console.log("DEBUG 2.plan time ==> "+t.toFixed(2)+" s");const i=(e-t)/t*100;console.log("DEBUG 3.mistake ==> "+i.toFixed(5)+" %")}"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFinish)&&this.flyCallbacks.onFinish()}updateProgressBar(){var e,t;if("function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onUpdateProgress)){const e=Math.ceil(100*this.getProgress());let i=!1;(e<=1||e>=99||Math.abs(e-this.shownProgress)>=1)&&(i=!0),i&&(this.shownProgress=e),i&&(null===(t=this.flyCallbacks)||void 0===t||t.onUpdateProgress(this.shownProgress))}}concatGeoPaths(e){let t=[];for(let i=0;i<e.paths.length;i++)t=t.concat(e.paths[i]);return t}geoCoordToRenderCoord(e){const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=n.g([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t}}},250:function(e,t){e.exports='<svg viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg"><path d="M6 5.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm0 1a2.5 2.5 0 110-5 2.5 2.5 0 010 5zM6 1c-2.124 0-3.714.967-4.867 3C2.286 6.033 3.876 7 6 7s3.714-.967 4.867-3C9.714 1.967 8.124 1 6 1zm0 7C3.333 8 1.333 6.667 0 4c1.333-2.667 3.333-4 6-4s4.667 1.333 6 4c-1.333 2.667-3.333 4-6 4z"></path></svg>'},251:function(e,t){e.exports='<svg viewBox="0 0 12 10" xmlns="http://www.w3.org/2000/svg"><path d="M6.62 6.366L4.635 4.379a1.5 1.5 0 001.987 1.987zm.746-.745a1.5 1.5 0 00-1.987-1.987l1.987 1.987zM3.899 3.644l-.825-.825C2.322 3.314 1.678 4.038 1.133 5 2.286 7.033 3.876 8 6 8c.702 0 1.345-.106 1.934-.32L7.356 7.1A2.5 2.5 0 013.9 3.645zm.745-.745A2.5 2.5 0 018.1 6.355l.826.826c.752-.495 1.396-1.219 1.941-2.181C9.714 2.967 8.124 2 6 2c-.702 0-1.345.106-1.934.32l.578.579zM2.354 2.1L1.155.9A.527.527 0 011.9.154l1.4 1.4C4.107 1.184 5.008 1 6 1c2.667 0 4.667 1.333 6 4-.634 1.268-1.419 2.235-2.355 2.9l1.2 1.2a.527.527 0 01-.745.746l-1.4-1.4C7.893 8.816 6.992 9 6 9 3.333 9 1.333 7.667 0 5c.634-1.268 1.419-2.235 2.355-2.9z"></path></svg>'},252:function(e,t){e.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 11h10a1 1 0 110 2H13v10a1 1 0 11-2 0V13H1a1 1 0 110-2h10V1a1 1 0 112 0v10z" fill="#000" fill-rule="nonzero"></path></svg>'},253:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5 11V5h6v6H5zm1-5h4v4H6V6z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M16 8A8 8 0 110 8a8 8 0 0116 0zm-8 7A7 7 0 108 1a7 7 0 000 14z" fill="#000"></path></svg>'},254:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 118 0a8 8 0 010 16zm2.544-8L6.455 4.986v6.028L10.545 8zm.556.802l-4.09 3.014a.937.937 0 01-1.332-.229 1.008 1.008 0 01-.178-.573V4.986c0-.545.428-.986.955-.986.2 0 .394.064.556.184L11.1 7.198a1.006 1.006 0 010 1.604z" fill="#000" fill-rule="nonzero"></path></svg>'},255:function(e,t){e.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm0 1a5 5 0 100 10A5 5 0 006 1zm.5 3.5v4H7a.5.5 0 110 1H5a.5.5 0 110-1h.5v-3H5a.5.5 0 110-1h1.5zm-.5-2a.5.5 0 110 1 .5.5 0 010-1z" fill="#FFF" fill-rule="nonzero"></path></svg>'},256:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjExMHB4IiBoZWlnaHQ9Ijc0cHgiIHZpZXdCb3g9IjAgMCAxMTAgNzQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHRpdGxlPnRodW1ibmFpbF9mbHlfYmFyPC90aXRsZT4NCiAgICA8ZyBpZD0iRmx5IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4NCiAgICAgICAgPGcgaWQ9IkZseV9Cb3RoIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTE5NS4wMDAwMDAsIC01OTYuMDAwMDAwKSI+DQogICAgICAgICAgICA8ZyBpZD0idGh1bWJuYWlsL2ZseS9iYXIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExOTUuMDAwMDAwLCA1OTYuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTMiPg0KICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBmaWxsPSIjMjgyODI4IiBmaWxsLXJ1bGU9Im5vbnplcm8iIHg9IjkiIHk9IjI3IiB3aWR0aD0iOTIiIGhlaWdodD0iMjAiPjwvcmVjdD4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0iT3ZhbCIgZmlsbD0iIzZBNkE2QSIgY3g9IjE5IiBjeT0iMzciIHI9IjUiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLUNvcHktMyIgZmlsbD0iIzZBNkE2QSIgY3g9IjMzIiBjeT0iMzciIHI9IjUiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLUNvcHktNiIgZmlsbD0iIzZBNkE2QSIgY3g9IjQ3IiBjeT0iMzciIHI9IjUiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLUNvcHktNyIgZmlsbD0iIzZBNkE2QSIgY3g9IjkxIiBjeT0iMzciIHI9IjUiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlIiBmaWxsPSIjMzYzNjM2IiB4PSI4MiIgeT0iMzIiIHdpZHRoPSIxIiBoZWlnaHQ9IjEwIj48L3JlY3Q+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtQ29weS04IiBmaWxsPSIjNkE2QTZBIiBjeD0iNzUiIGN5PSIzNyIgcj0iNSI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtQ29weS05IiBmaWxsPSIjNkE2QTZBIiBjeD0iNjEiIGN5PSIzNyIgcj0iNSI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgPC9nPg0KICAgICAgICAgICAgPC9nPg0KICAgICAgICA8L2c+DQogICAgPC9nPg0KPC9zdmc+"},257:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjEwOHB4IiBoZWlnaHQ9IjcycHgiIHZpZXdCb3g9IjAgMCAxMDggNzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHRpdGxlPnRodW1ibmFpbF9mbHlfcGFsZXR0ZTwvdGl0bGU+DQogICAgPGcgaWQ9IkZseSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJGbHlfQm90aCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMTYuMDAwMDAwLCAtNTk3LjAwMDAwMCkiPg0KICAgICAgICAgICAgPGcgaWQ9InRodW1ibmFpbC9mbHkvcGFsZXR0ZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTMxNi4wMDAwMDAsIDU5Ny4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICA8ZyBpZD0iR3JvdXAtMiI+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtQ29weS0xMCIgZmlsbD0iIzZBNkE2QSIgY3g9IjUzIiBjeT0iNDMiIHI9IjEwIj48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0iT3ZhbC1Db3B5LTExIiBmaWxsPSIjNTI1MjUyIiBjeD0iMzEiIGN5PSI0NyIgcj0iNiI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtQ29weS0xMyIgZmlsbD0iIzUyNTI1MiIgY3g9IjUzIiBjeT0iMjEiIHI9IjYiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsLUNvcHktMTQiIGZpbGw9IiM1MjUyNTIiIGN4PSIzNyIgY3k9IjMxIiByPSI2Ij48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0iT3ZhbC1Db3B5LTE1IiBmaWxsPSIjNTI1MjUyIiBjeD0iNjkiIGN5PSIzMSIgcj0iNiI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9Ik92YWwtQ29weS0xMiIgZmlsbD0iIzUyNTI1MiIgY3g9Ijc1IiBjeT0iNDciIHI9IjYiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgIDwvZz4NCiAgICAgICAgPC9nPg0KICAgIDwvZz4NCjwvc3ZnPg=="},3:function(e,t,i){"use strict";i.d(t,"g",(function(){return r})),i.d(t,"u",(function(){return l})),i.d(t,"c",(function(){return h})),i.d(t,"s",(function(){return d})),i.d(t,"d",(function(){return c})),i.d(t,"w",(function(){return p})),i.d(t,"q",(function(){return u})),i.d(t,"n",(function(){return g})),i.d(t,"r",(function(){return m})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return f})),i.d(t,"x",(function(){return y})),i.d(t,"k",(function(){return w})),i.d(t,"v",(function(){return I})),i.d(t,"b",(function(){return C})),i.d(t,"a",(function(){return b})),i.d(t,"y",(function(){return M})),i.d(t,"o",(function(){return j})),i.d(t,"m",(function(){return S})),i.d(t,"e",(function(){return R})),i.d(t,"j",(function(){return x})),i.d(t,"f",(function(){return A})),i.d(t,"t",(function(){return L})),i.d(t,"p",(function(){return D})),i.d(t,"l",(function(){return T}));var s=i(86),n=(i(0),i(8)),a=i(41),o=i(20);function r(e,t,i){const n=D(t)?t:1,a=[];return s.toRenderCoordinates(i,e,0,null,a,0,n),a}function l(e,t,i){const n=D(t)?t:1,a=[];return s.fromRenderCoordinates(i,e,0,a,0,null,n),a}function h(e){return e*Math.PI/180}function d(e){return 180*e/Math.PI}function c(e,t){const i=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2],a=i*i+s*s+n*n;return Math.sqrt(a)}function p(e){return e<0?-1:e>0?1:0}function u(e,t,i){const s=[];return s[0]=(t[0]-e[0])*i+e[0],s[1]=(t[1]-e[1])*i+e[1],s[2]=(t[2]-e[2])*i+e[2],s}function g(e,t,i,s,n,a,o){const r=e,l=null!=t?t:null,h=null!=i?i:null;if(null===l||null===h)return 0;const c=n.create();s.subtract(c,l,r);const p=n.create();s.subtract(p,h,l);const u=n.create();a.renderCoordsHelper.worldUpAtPosition(l,u);return d(o.angle(c,p,u))}function m(e,t){return t.groundView.elevationSampler.queryElevation(e)}function v(e){let t=0;for(let i=0,s=e.length;i<s;i++){const s=e[i];D(s)&&!1!==s.isInUse&&t++}return t}function f(e,t){return e===n.a.Rotate?t.intl.formatMessage({id:"flyStyleRotate",defaultMessage:a.a.flyStyleRotate}):e===n.a.Path?t.intl.formatMessage({id:"flyStylePath",defaultMessage:a.a.flyStylePath}):e===n.a.Route?t.intl.formatMessage({id:"flyStyleRoute",defaultMessage:a.a.flyStyleRoute}):null}function y(e,t){const i=o.a.SPEED.MIN,s=o.a.SPEED.MAX,n=o.a.SPEED.MULTIPLIER;let a;const r=(s-i)/2;return e<r?a=1/((r-e)/r*n):(a=(e-r)/(s-r)*n,0===a&&(a=1)),parseFloat(a.toFixed(D(t)?t:o.a.SPEED.DECIMAL))}function w(){return{speed:.5,tilt:0,altitude:0}}function I(e,t){return C(Number(e)).toString()+" "+t}function C(e){return P((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(o.a.CALCULATED_VALUE_ROUNDED.ANGLE)):NaN)}function b(e){return P((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(o.a.CALCULATED_VALUE_ROUNDED.ELEV)):NaN)}function M(e){return P((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(o.a.CALCULATED_VALUE_ROUNDED.TIME)):NaN)}function P(e){return null===e||isNaN(e)?0:e}function j(e,t){return null==e?void 0:e.find(e=>e.idx===t.routeUuid)}function S(e,t){var i;const s=j(e,t);return null===(i=null==s?void 0:s.records)||void 0===i?void 0:i.find(e=>e.idx===t.recordUuid)}function R(e,t,i){const s=j(e,t);return null==s?void 0:s.records[i]}function x(e,t){const i=t+" ";let s=0;return e.forEach(e=>{let t;const n=e.displayName.split(i);D(n)&&2===n.length&&""===n[0]&&(t=n[1],/^\d+$/.test(t)&&(t=parseInt(t),s=Math.max(t,s)))}),`${i}${s+1}`}function A(e){return"fly__"+e}function L(e){return(null==e?void 0:e.startsWith("fly__"))?e.replace("fly__",""):e}function D(e){return null!=e}function T(e,t,i){return{isTriggeredByFly:t===e,isTriggeredByMapSelf:t===i}}},37:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),function(e){e[e.NONE=0]="NONE",e[e.In=1]="In",e[e.Out=2]="Out",e[e.InOut=3]="InOut",e[e.Linear=4]="Linear"}(s||(s={}));class n{}n.linear=(e,t,i,s)=>i*e/s+t,n.easeIn=(e,t,i,s)=>i*(e/=s)*e+t,n.easeOut=(e,t,i,s)=>-i*(e/=s)*(e-2)+t,n.easeInOut=(e,t,i,s)=>(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},4:function(e,t){e.exports=n},41:function(e,t,i){"use strict";t.a={_widgetLabel:"Fly Controller",chooseMapTip:"Please select a map with 3D data.",configErrorTip:"Please select at least one fly style.",flyStyleRotate:"Rotate fly",flyStylePath:"Fly along path",flyStyleRoute:"Plan routes",triggerDrawPoint:"Draw a point",triggerDrawPath:"Draw a path",triggerSelectFeature:"Select a feature",triggerClear:"Clear drawing or selection",speed:"Speed",heading:"Heading",plannedRoutesTip:"Routes"}},45:function(e,t){e.exports=r},484:function(e,t,i){"use strict";i.r(t),i.d(t,"PageMode",(function(){return Ie})),i.d(t,"NewFeatureMode",(function(){return Ce})),i.d(t,"default",(function(){return be}));var s=i(0),n=i(4),a=i(10),o=i(2),r=i(8),l=i(1),h="Select a map widget with 3D data",d="Controller style",c="Bar",p="Palette",u="Choose fly modes",g="Rotate fly",m="Fly along path",v="Plan routes",f="Rotate direction",y="Path style",w="Clockwise",I="Counterclockwise",C="Smoothed path",b="Real path",M="New route",P="Configure route",j="Route",S="Point",R="Path",x="New element",A="Draw a point",L="Draw a path",D="Preview route",T="Preview route (with new changes)",O="Edit element",G="Preview element",F="Stop preview",N="Close without saving",k="Save to",V="Save",U="Advanced settings",E="Fly time of this element (Second)",_="Rotation angle (Degree)",B="The pause time after this element finishes flying (Second)",z="Please select a map with 3D data.";const H=i(128),W=i(129),J=i(130),Z=i(64),Y=i(63),Q=e=>{const t=Object(s.useIntl)(),{styleConfig:i,idx:n}=e,a=i.isInUse,h=i.name,d=(e=>{switch(e){case r.a.Rotate:return H;case r.a.Path:return W;case r.a.Route:return J}})(h),c=(e=>{switch(e){case r.a.Rotate:return t.formatMessage({id:"flyStyleRotate",defaultMessage:g});case r.a.Path:return t.formatMessage({id:"flyStylePath",defaultMessage:m});case r.a.Route:return t.formatMessage({id:"flyStyleRecord",defaultMessage:v})}})(h),p=(e=>e?Z:Y)(a);return Object(s.jsx)("div",{onClick:t=>((t,i)=>{t.stopPropagation(),e.handleFlyModesChange(!a,i)})(t,n),style:{cursor:"pointer"}},Object(s.jsx)(o.SettingRow,{className:"d-flex align-items-center justify-content-between"},Object(s.jsx)("div",{className:"d-flex align-items-center"},Object(s.jsx)(l.Checkbox,{checked:a}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"}},Object(s.jsx)(l.Icon,{icon:d,className:"m-2"}),c)),Object(s.jsx)(l.Icon,{icon:p,size:12,className:"d-flex"})))};var $=i(15);class K extends s.React.PureComponent{constructor(e){super(e),this.mapRoutesToListItems=()=>{const e=[];for(let t=0,i=this.props.placeholderNums;t<i;t++)e.push({itemKey:t.toString(),itemStateCommands:[{iconProps:()=>({icon:null,size:12,style:{opacity:0}})}]});return e},this.getStyle=()=>s.css`
    /* disable hover for skeleton-list */
    .skeleton-list .jimu-tree-main .jimu-tree-item .jimu-tree-item__body:hover {
      background-color: ${this.props.theme.colors.palette.light[500]};
    } `,this.state={listItems:[]}}componentDidMount(){this.setState({listItems:this.mapRoutesToListItems()})}render(){return Object(s.jsx)("div",{css:this.getStyle(),className:"d-flex"},Object(s.jsx)($.List,{className:"skeleton-list w-100",itemsJson:this.state.listItems,dndEnabled:!1,isItemFocused:()=>!1,overrideItemBlockInfo:()=>({name:$.TreeItemActionType.RenderOverrideItem,children:[{name:$.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemBody,children:[{name:$.TreeItemActionType.RenderOverrideItemDragHandle},{name:$.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:$.TreeItemActionType.RenderOverrideItemTitle},{name:$.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})}))}}var q=i(3);class X extends s.React.PureComponent{constructor(e){super(e),this.handleEdit=e=>{this.props.onRouteEdit({routeUuid:e})},this.handleAddRoute=()=>{const e=this.props.intl.formatMessage({id:"plannedRoute",defaultMessage:j}),t=q.j(this.props.routeConfig.routes,e),i={idx:Object(s.uuidv1)(),isInUse:!0,type:null,records:[],displayName:t};this.props.onRouteAdd(i,this.props.flyModeIdx)},this.handleRouteDelete=e=>{this.props.onRouteDelete({routeUuid:e})},this.handleToggleVisibility=(e,t)=>{this.props.onRouteToggleVisibilityChange({routeUuid:e},t)},this.getStyle=e=>s.css`
      .records-list {
        border: 1px solid #888;
        width: 100%;
        display: flex;
        justify-content: space-between;
        margin-bottom: ${s.polished.rem(4)};
        .record-name-input {
          padding: 3px 0;
          width: 110px;
        }
      }
      .records-list:hover {
        cursor: pointer;
        background: ${e.colors.secondary};
        border-left: 2px solid ${e.colors.primary};
      }
      `,this.mapRoutesToListItems=e=>{const t=this.props.intl.formatMessage({id:"editRoute",defaultMessage:P}),n=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),a=this.props.intl.formatMessage({id:"clickToHide",defaultMessage:l.defaultMessages.clickToHide}),o=this.props.intl.formatMessage({id:"clickToShow",defaultMessage:l.defaultMessages.clickToShow});return null==e?void 0:e.map(e=>{var s;const r=e.isInUse;return{itemKey:e.idx,itemStateTitle:null!==(s=e.displayName)&&void 0!==s?s:"",itemStateCommands:[{label:t,iconProps:()=>({icon:i(75)}),action:e=>{this.handleEdit(e.data.itemJsons[0].itemKey)}},{label:n,iconProps:()=>({icon:i(111)}),action:e=>{this.handleRouteDelete(e.data.itemJsons[0].itemKey)}},{label:a,collapsed:!r,iconProps:()=>({icon:i(250)}),action:e=>{this.handleToggleVisibility(e.data.itemJsons[0].itemKey,!1)}},{label:o,collapsed:r,iconProps:()=>({icon:i(251)}),action:e=>{this.handleToggleVisibility(e.data.itemJsons[0].itemKey,!0)}}]}})},this.state={listItems:null}}componentDidMount(){var e;this.setState({listItems:this.mapRoutesToListItems(null===(e=this.props.routeConfig)||void 0===e?void 0:e.routes)})}componentDidUpdate(e,t){var i;s.lodash.isDeepEqual(this.props.routeConfig,e.routeConfig)||this.setState({listItems:this.mapRoutesToListItems(null===(i=this.props.routeConfig)||void 0===i?void 0:i.routes)})}render(){const{useMapWidgetIds:e,jimuMapView:t,theme:n,routeConfig:a}=this.props,{listItems:r}=this.state,h=this.props.intl.formatMessage({id:"newRoute",defaultMessage:M}),d=q.p(null==e?void 0:e.length)&&(null==e?void 0:e.length)>0,c=q.p(t)&&q.p(a)&&q.p(r);return Object(s.jsx)("div",{className:"item-detail-wapper"},Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Button,{className:"w-100 d-flex align-items-center justify-content-center",disabled:!c,onClick:this.handleAddRoute},Object(s.jsx)(l.Icon,{className:"d-flex",icon:i(252),size:12}),h)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)("div",{className:"w-100",css:this.getStyle(n)},d&&!c&&Object(s.jsx)(K,{placeholderNums:3,theme:this.props.theme}),d&&c&&Object(s.jsx)($.List,{className:"w-100",itemsJson:r,dndEnabled:!0,onUpdateItem:(e,t)=>{if(e.updateType===$.TreeItemActionType.HandleDidDrop){const[,t]=e.itemJsons;this.props.onRoutesOrderUpdate([...t])}},overrideItemBlockInfo:()=>({name:$.TreeItemActionType.RenderOverrideItem,children:[{name:$.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemBody,children:[{name:$.TreeItemActionType.RenderOverrideItemDragHandle},{name:$.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:$.TreeItemActionType.RenderOverrideItemTitle},{name:$.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})}))))}}var ee=i(25);const te=i(253);class ie extends s.React.PureComponent{constructor(e){super(e),this.getStyle=()=>s.css`
      .record-list {
        .is-available{
        }
        .not-available{
          background-color: red;
        }
      }
      `,this.handleRecordEdit=e=>{this.props.onRecordEdit({routeUuid:null,recordUuid:e})},this.handleRecordPreview=e=>{this.props.onRecordPreview({routeUuid:null,recordUuid:e})},this.handlePauseRecordPreview=e=>{this.props.onPauseRecordPreview({routeUuid:null,recordUuid:e})},this.handleRecordDelete=e=>{this.props.onRecordDelete({routeUuid:null,recordUuid:e})},this.mapRoutesToListItems=e=>{const t=this.props.intl.formatMessage({id:"editElement",defaultMessage:O}),n=this.props.intl.formatMessage({id:"previewElement",defaultMessage:G}),a=this.props.intl.formatMessage({id:"stopPreview",defaultMessage:F}),o=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete});return null==e?void 0:e.map(e=>{let s;return e.type===ee.a.Rotate?s={icon:i(167)}:e.type!==ee.a.Smoothed&&e.type!==ee.a.RealPath||(s={icon:i(97)}),{itemStateIcon:s,itemKey:e.idx,itemStateTitle:e.displayName,itemStateDisabled:!1,itemStateCommands:[{label:t,iconProps:()=>({icon:i(75)}),action:e=>{this.handleRecordEdit(e.data.itemJsons[0].itemKey)}},{label:n,collapsed:!1,iconProps:()=>({icon:i(254)}),action:e=>{this.handleRecordPreview(e.data.itemJsons[0].itemKey)}},{label:a,collapsed:!0,iconProps:()=>({icon:te}),action:e=>{this.handlePauseRecordPreview(e.data.itemJsons[0].itemKey)}},{label:o,iconProps:()=>({icon:i(111)}),action:e=>{this.handleRecordDelete(e.data.itemJsons[0].itemKey)}}]}})},this.updateListItemsByPlayingInfo=()=>{var e;const t=null===(e=this.state.listItems)||void 0===e?void 0:e.map(e=>{var t;const{itemKey:i,itemStateCommands:s}=e;return i===(null===(t=this.props.playingInfo)||void 0===t?void 0:t.recordUuid)?(s[1].collapsed=!0,s[2].collapsed=!1):(s[1].collapsed=!1,s[2].collapsed=!0),e.itemStateDisabled=!this.props.isTerrainLoaded,e});this.setState({listItems:t})},this.state={listItems:null}}componentDidMount(){this.setState({listItems:this.mapRoutesToListItems(this.props.records)},()=>{this.updateListItemsByPlayingInfo()})}componentDidUpdate(e,t){s.lodash.isDeepEqual(this.props.records,e.records)||this.setState({listItems:this.mapRoutesToListItems(this.props.records)}),this.props.playingInfo!==e.playingInfo&&this.updateListItemsByPlayingInfo(),this.props.isTerrainLoaded!==e.isTerrainLoaded&&this.updateListItemsByPlayingInfo()}render(){return Object(q.p)(this.state.listItems)&&Object(s.jsx)("div",{css:this.getStyle()},Object(q.p)(this.props.records)&&Object(s.jsx)("div",{className:"record-list d-flex"},Object(s.jsx)($.List,{className:"w-100",itemsJson:this.state.listItems,dndEnabled:!0,onUpdateItem:(e,t)=>{if(e.updateType===$.TreeItemActionType.HandleDidDrop){const[,t]=e.itemJsons;this.props.onRecordsOrderUpdate([...t])}},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:$.TreeItemActionType.RenderOverrideItem,children:[{name:$.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:$.TreeItemActionType.RenderOverrideItemBody,children:[{name:$.TreeItemActionType.RenderOverrideItemDragHandle},{name:$.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:$.TreeItemActionType.RenderOverrideItemTitle},{name:$.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})})))}}const se=i(167),ne=i(97),ae=i(255);class oe extends s.React.PureComponent{constructor(e){super(e),this.handleKeydown=(e,t)=>{13===e.keyCode&&t.current.blur()},this._handleIsDisablePlayBtn=()=>this.props.routeConfig.records.length<=0,this._handleNewRecordNotify=()=>{this.setState({previewNeedToResetFlag:!0})},this.handleRecordEdit=e=>{this.props.onRecordEdit(e),this.setState({previewNeedToResetFlag:!0})},this.handleRecordDelete=e=>{this.props.onRecordDelete(e),this.setState({previewNeedToResetFlag:!0})},this.handleRecordsOrderUpdate=e=>{this.props.onRecordsOrderUpdate(e),this.setState({previewNeedToResetFlag:!0})},this.getStyle=()=>s.css`
      .map-2d-warning{
        flex-direction: column;
        margin-top: 128px;
        color: ${this.props.theme.colors.palette.dark[200]};

        .tip {
          font-size: 14px;
        }
      }

      .description {
        height: ${s.polished.rem(40)};
      }

      .new-feature-dropdown {
        width: 190px;/*calc(100% - ${s.polished.rem(32)});*/
      }

      .del-btn-wapper {
        position: relative;

        .delete-con {
          & {
            position: absolute;
            bottom: ${s.polished.rem(16)};
            width: 100%;
            height: ${s.polished.rem(32)};
          }
          button {
            width: calc(100% - ${s.polished.rem(32)});
          }
        }
      }
      `,this.handleBackBtnClick=()=>{this.props.onShowMapPopperChange(!1),this.props.onRouteEdit({routeUuid:null}),this.props.onSettingPageModeChange(Ie.Common)},this.handleDeleteClick=()=>{this.props.onRouteDelete({routeUuid:this.props.routeConfig.idx}),this.handleBackBtnClick()},this.handleRouteNameChange=e=>{this.props.onRouteNameChange({routeUuid:this.props.routeConfig.idx},e)},this.toggleNewFeaturePopup=()=>{this.setState({isNewFeaturePopupOpen:!this.state.isNewFeaturePopupOpen})},this.handleNewFeatureModeClick=e=>{this.props.onNewFeatureModeChange(e)},this.handlePreviewRoute=()=>{if(this.props.isPreviewRouteBtnPlaying)this.props.onPauseRoutePreview();else{const e=.5;this.props.onPreviewRoute(e,{routeUuid:this.props.routeConfig.idx},this.state.previewNeedToResetFlag),this.setState({previewNeedToResetFlag:!1})}},this.state={isNewFeaturePopupOpen:!1,previewNeedToResetFlag:!1,is2DJimuMapView:!1}}componentDidUpdate(e){this.props.newestRecordIdx!==e.newestRecordIdx&&this._handleNewRecordNotify(),this.props.routeConfig!==e.routeConfig&&this._handleIsDisablePlayBtn()&&this.setState({previewNeedToResetFlag:!1}),this.props.mapPopperJimuMapView!==e.mapPopperJimuMapView&&("2d"===this.props.mapPopperJimuMapView.view.type?(this.setState({is2DJimuMapView:!0}),this.setState({previewNeedToResetFlag:!1})):this.setState({is2DJimuMapView:!1}))}render(){var e;const{routeConfig:t}=this.props,n=this.props.intl.formatMessage({id:"back",defaultMessage:l.defaultMessages.back}),a=this.props.intl.formatMessage({id:"delete",defaultMessage:s.defaultMessages.delete}),r=this.props.intl.formatMessage({id:"label",defaultMessage:l.defaultMessages.label}),h=this.props.intl.formatMessage({id:"chooseMapTip",defaultMessage:z}),d=s.React.createRef(),c=t.records;return q.p(t)&&Object(s.jsx)("div",{className:"w-100 h-100",css:this.getStyle()},Object(s.jsx)("div",{className:"w-100 h-100"},Object(s.jsx)(o.SettingSection,null,Object(s.jsx)(l.Button,{className:"page-back-btn",type:"tertiary",onClick:this.handleBackBtnClick},Object(s.jsx)(l.Icon,{icon:i(69),size:16,autoFlip:!0}),Object(s.jsx)(l.Label,null,n)),Object(s.jsx)(o.SettingRow,{label:r}),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.TextInput,{className:"w-100",ref:d,size:"sm",required:!0,title:t.displayName,value:null!==(e=t.displayName)&&void 0!==e?e:"",onChange:e=>this.handleRouteNameChange(e.target.value),onKeyDown:e=>this.handleKeydown(e,d)}))),Object(s.jsx)(o.SettingSection,null,this.state.is2DJimuMapView&&Object(s.jsx)("div",{className:"d-flex align-items-center justify-content-center map-2d-warning"},Object(s.jsx)(l.Icon,{icon:ae,size:42}),Object(s.jsx)("div",{className:"tip text-center mt-3"},h)),!this.state.is2DJimuMapView&&Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)("div",{className:"d-flex justify-content-between mb-4"},this.renderNewFeatureContent(),this.renderPreviewContent()),q.p(c)&&Object(s.jsx)(ie,{records:c,mapPopperJimuMapView:this.props.mapPopperJimuMapView,isTerrainLoaded:this.props.isTerrainLoaded,theme:this.props.theme,intl:this.props.intl,playingInfo:this.props.playingInfo,onRecordEdit:this.handleRecordEdit,onRecordPreview:this.props.onRecordPreview,onPauseRecordPreview:this.props.onPauseRecordPreview,onRecordDelete:this.handleRecordDelete,onRecordsOrderUpdate:this.handleRecordsOrderUpdate,isRecordCanPlay:this.props.isRecordCanPlay})))),Object(s.jsx)(o.SettingRow,{className:"del-btn-wapper"},Object(s.jsx)("div",{className:"d-flex w-100 justify-content-center delete-con"},Object(s.jsx)(l.Button,{type:"secondary",onClick:this.handleDeleteClick},a))))}renderNewFeatureContent(){const e=this.props.intl.formatMessage({id:"newFeature",defaultMessage:x}),t=this.props.intl.formatMessage({id:"addPoint",defaultMessage:A}),i=this.props.intl.formatMessage({id:"addPath",defaultMessage:L}),n=!this.props.isDrawHelperLoaded||this.state.is2DJimuMapView||!this.props.isTerrainLoaded;return Object(s.jsx)(l.Dropdown,{isOpen:this.state.isNewFeaturePopupOpen,toggle:this.toggleNewFeaturePopup,className:"dropdowns",activeIcon:!0,disabled:n},Object(s.jsx)(l.DropdownButton,{icon:!0,className:"new-feature-dropdown oper-btns",arrow:!1},e),Object(s.jsx)(l.DropdownMenu,{showArrow:!1},Object(s.jsx)(l.DropdownItem,{onClick:()=>this.handleNewFeatureModeClick(Ce.Point),className:"dropdown-items"},Object(s.jsx)(l.Icon,{icon:se}),Object(s.jsx)("span",{className:"mx-2"},t)),Object(s.jsx)(l.DropdownItem,{onClick:()=>this.handleNewFeatureModeClick(Ce.Path),className:"dropdown-items"},Object(s.jsx)(l.Icon,{icon:ne}),Object(s.jsx)("span",{className:"mx-2"},i))))}renderPreviewContent(){let e;const t=this.props.intl.formatMessage({id:"previewRoute",defaultMessage:D}),n=this.props.intl.formatMessage({id:"previewRouteBadge",defaultMessage:T}),a=this.props.intl.formatMessage({id:"pause",defaultMessage:l.defaultMessages.pause}),o=this._handleIsDisablePlayBtn()||!this.props.isDrawHelperLoaded||this.state.is2DJimuMapView||!this.props.isTerrainLoaded;if(this.props.isPreviewRouteBtnPlaying)e=Object(s.jsx)(l.Button,{icon:!0,onClick:this.handlePreviewRoute,title:a,disabled:o},Object(s.jsx)(l.Icon,{icon:i(132),size:12}));else{const a=this.state.previewNeedToResetFlag?n:t;e=Object(s.jsx)(l.Button,{icon:!0,onClick:this.handlePreviewRoute,title:a,disabled:o},Object(s.jsx)(l.Icon,{icon:i(131),size:12}))}return Object(s.jsx)(l.Badge,{dot:!0,hideBadge:!this.state.previewNeedToResetFlag,color:"danger"},e)}}var re=i(20);class le extends s.React.PureComponent{constructor(e){super(e),this.handleKeydown=(e,t)=>{13===e.keyCode&&t.current.blur()},this.getStyle=()=>s.css`
      .tilt-setting{
        .tilt-slider{
          width:80px
        }

        .tilt-number{
          .jimu-numeric-input {
            width: 64px;
          }
        }
      }

      .altitude-setting{
        margin-top: 1rem;
        margin-bottom: 1rem;

        .altitude-number{
          width: 70px;
        }
        .small-tips{
          font-size: 12px;
          color: #A8A8A8;
        }
      }
      `,this.handleBackBtnClick=()=>{this.props.onRecordChange(this.tmpRecordConfig),this.props.onRecordEdit({routeUuid:null,recordUuid:null})},this.handleRecordChange=e=>{this.props.onRecordChange(e)},this.handleDisplayNameChange=e=>{this.tmpRecordConfig.displayName=e},this.handleDurationChange=e=>{this.tmpRecordConfig.duration=Object(q.y)(e),this.setState({duration:this.tmpRecordConfig.duration})},this.handleDelayChange=e=>{this.tmpRecordConfig.endDelay=Object(q.y)(e),this.setState({endDelay:this.tmpRecordConfig.endDelay})},this.handlePointDirectionChange=e=>{this.tmpRecordConfig.direction=e,this.setState({rotateDirection:e})},this.handlePointTiltChange=e=>{let t=this.tmpRecordConfig.controllerConfig.liveviewSettingState.fixTilt;t=Object(q.b)(e),this.props.onLiveviewSettingChange({tilt:t}),this.setState({tilt:t})},this.handlePointAngleChange=e=>{this.tmpRecordConfig.angle=Object(q.b)(e),this.setState({angle:this.tmpRecordConfig.angle})},this.renderPointDirection=()=>{const e=this.state.rotateDirection===r.e.CW,t=this.props.intl.formatMessage({id:"styleLabelRotate",defaultMessage:f}),i=this.props.intl.formatMessage({id:"CW",defaultMessage:w}),n=this.props.intl.formatMessage({id:"CCW",defaultMessage:I});return Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingRow,{label:t}),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:e,id:"CW",style:{cursor:"pointer"},onChange:e=>this.handlePointDirectionChange(r.e.CW)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CW",className:"ml-1 text-break"},i)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:!e,id:"CCW",style:{cursor:"pointer"},onChange:e=>this.handlePointDirectionChange(r.e.CCW)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CCW",className:"ml-1 text-break"},n)))},this.renderTilt=()=>{const{tilt:e}=this.state,t=this.props.intl.formatMessage({id:"tilt",defaultMessage:l.defaultMessages.tilt}),i=this.props.intl.formatMessage({id:"degree",defaultMessage:l.defaultMessages.degree});return Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingRow,{label:t}),Object(s.jsx)(o.SettingRow,{className:"tilt-setting mt-0"},Object(s.jsx)(l.Slider,{className:"d-flex dropdown-item tilt-slider",size:"sm",value:e,min:re.a.TILT.MIN,max:re.a.TILT.MAX,step:re.a.TILT.STEP,onChange:e=>this.handlePointTiltChange(parseFloat(e.target.value))}),Object(s.jsx)("div",{className:"d-flex tilt-number"},Object(s.jsx)(l.NumericInput,{className:"m-2",defaultValue:"0",size:"sm",value:e,min:re.a.TILT.MIN,max:re.a.TILT.MAX,onChange:e=>this.handlePointTiltChange(e)}),Object(s.jsx)(l.Label,{className:""},i))))},this.renderPointsAdvancedSettings=()=>{const{duration:e,angle:t,endDelay:i}=this.state,n=this.props.intl.formatMessage({id:"advancedSettings",defaultMessage:U}),a=this.props.intl.formatMessage({id:"duration",defaultMessage:E}),r=this.props.intl.formatMessage({id:"rotationAngle",defaultMessage:_}),h=this.props.intl.formatMessage({id:"endDelay",defaultMessage:B});return Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingRow,{label:n}),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},a)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.NumericInput,{className:"w-100",showHandlers:!1,value:e,min:re.a.TIME.MIN,onChange:e=>{this.handleDurationChange(e)}})),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},r)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.NumericInput,{className:"w-100",showHandlers:!1,value:t,min:0,onChange:e=>{this.handlePointAngleChange(e)}})),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},h)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.NumericInput,{className:"w-100",showHandlers:!1,value:i,min:re.a.TIME.MIN,onChange:e=>{this.handleDelayChange(e)}})))},this.handlePathStyleChange=e=>{this.tmpRecordConfig.type=e,this.setState({pathStyle:e})},this.handlePathAltitudeChange=e=>{let t=this.tmpRecordConfig.controllerConfig.liveviewSettingState.fixAltitude;t=Object(q.a)(e),this.props.onLiveviewSettingChange({altitude:t}),this.setState({altitude:t})},this.renderPathStyle=()=>{const e=this.state.pathStyle===ee.a.Smoothed,t=this.props.intl.formatMessage({id:"styleLabelPath",defaultMessage:y}),i=this.props.intl.formatMessage({id:"pathTypeSmoothedCurve",defaultMessage:C}),n=this.props.intl.formatMessage({id:"pathTypeRealPath",defaultMessage:b});return Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:" text-truncate"},t)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:e,id:"CURVED",style:{cursor:"pointer"},onChange:e=>this.handlePathStyleChange(ee.a.Smoothed)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CURVED",className:"ml-1 text-break"},i)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:!e,id:"LINE",style:{cursor:"pointer"},onChange:e=>this.handlePathStyleChange(ee.a.RealPath)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"LINE",className:"ml-1 text-break"},n)))},this.renderAltitude=()=>{const{altitude:e}=this.state,t=this.props.intl.formatMessage({id:"altitude",defaultMessage:l.defaultMessages.altitude}),i=this.props.intl.formatMessage({id:"meterAbbr",defaultMessage:l.defaultMessages.meterAbbr}),n=this.props.intl.formatMessage({id:"ground",defaultMessage:l.defaultMessages.ground}),a=this.props.intl.formatMessage({id:"outerSpace",defaultMessage:l.defaultMessages.outerSpace}),r=this.props.intl.formatMessage({id:"relative2Ground",defaultMessage:l.defaultMessages.relative2Ground});return Object(s.jsx)("div",{className:"altitude-setting"},Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},t)),Object(s.jsx)(o.SettingRow,{className:"d-flex justify-content-between"},Object(s.jsx)("div",{className:"d-flex altitude-number"},Object(s.jsx)(l.NumericInput,{defaultValue:"0",size:"sm",value:e,min:re.a.ALT.MIN,max:re.a.ALT.MAX,onChange:e=>this.handlePathAltitudeChange(e)}),Object(s.jsx)(l.Label,{className:"small-tips"},i)),Object(s.jsx)(l.Label,{className:"small-tips"},r)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Slider,{className:"d-flex dropdown-item",size:"sm",value:e,min:re.a.ALT.MIN,max:re.a.ALT.MAX,step:re.a.ALT.STEP,onChange:e=>this.handlePathAltitudeChange(parseFloat(e.target.value)),title:""})),Object(s.jsx)(o.SettingRow,{className:"d-flex mt-0 justify-content-between "},Object(s.jsx)(l.Label,{className:"small-tips"},n),Object(s.jsx)(l.Label,{className:"small-tips"},a)))},this.renderPathAdvancedSettings=()=>{const{duration:e,endDelay:t}=this.state,i=this.props.intl.formatMessage({id:"advancedSettings",defaultMessage:U}),n=this.props.intl.formatMessage({id:"duration",defaultMessage:E}),a=this.props.intl.formatMessage({id:"endDelay",defaultMessage:B});return Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingRow,{label:i}),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},n)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.NumericInput,{className:"w-100",showHandlers:!1,value:e,min:re.a.TIME.MIN,onChange:e=>{this.handleDurationChange(e)}})),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:""},a)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.NumericInput,{className:"w-100",showHandlers:!1,value:t,min:re.a.TIME.MIN,onChange:e=>{this.handleDelayChange(e)}})))};const{type:t}=this.props.record.getConfig();let i,n,a,h;t===ee.a.Rotate?(i=this.props.record.getConfig().direction,n=this.props.getCurrentLiveviewSetting().tilt):t!==ee.a.RealPath&&t!==ee.a.Smoothed||(a=this.props.record.getConfig().type,h=this.props.getCurrentLiveviewSetting().altitude);const d=this.props.getDefaultDuration()/1e3,c=Object(q.p)(this.props.record.getConfig().duration)?this.props.record.getConfig().duration:d,p=this.props.record.getConfig().angle,u=this.props.record.getConfig().endDelay;this.state={rotateDirection:i,tilt:Object(q.b)(n),angle:Object(q.b)(p),pathStyle:a,altitude:Object(q.a)(h),duration:Object(q.y)(c),endDelay:Object(q.y)(u)},this.tmpRecordConfig=this.props.record.getConfig()}render(){var e;const t=this.props.record.getConfig(),n=s.React.createRef(),a=this.props.intl.formatMessage({id:"label",defaultMessage:l.defaultMessages.label}),r=this.props.intl.formatMessage({id:"back",defaultMessage:l.defaultMessages.back}),h=null==t?void 0:t.type;return Object(q.p)(t)&&Object(s.jsx)("div",{className:"w-100",css:this.getStyle()},Object(s.jsx)(o.SettingSection,null,Object(s.jsx)(l.Button,{className:"page-back-btn",type:"tertiary",onClick:this.handleBackBtnClick},Object(s.jsx)(l.Icon,{icon:i(69),size:16,autoFlip:!0}),Object(s.jsx)(l.Label,null,r)),Object(s.jsx)(o.SettingRow,{label:a}),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.TextInput,{className:"w-100",ref:n,size:"sm",required:!0,title:t.displayName,value:null!==(e=t.displayName)&&void 0!==e?e:"",onChange:e=>this.handleDisplayNameChange(e.target.value),onKeyDown:e=>this.handleKeydown(e,n)})),h===ee.a.Rotate&&Object(s.jsx)(s.React.Fragment,null,this.renderPointDirection(),this.renderTilt(),this.renderPointsAdvancedSettings()),(h===ee.a.RealPath||h===ee.a.Smoothed)&&Object(s.jsx)(s.React.Fragment,null,this.renderPathStyle(),this.renderAltitude(),this.renderPathAdvancedSettings())))}}var he=i(45),de=i(49),ce=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class pe extends s.React.PureComponent{constructor(e){super(e),this._isRecordsIdEqual=(e,t)=>{const i=e.records.map(e=>e.idx),n=t.records.map(e=>e.idx);return s.lodash.isDeepEqual(i,n)},this._redrawAllRecordGraphics=e=>{Object(q.p)(this.graphicInteractionManagerRef)&&(this.graphicInteractionManagerRef.removeAllGraphics(),e.records.map(e=>{e.mapViewId===this.props.getPopperJimuMapId()&&this.graphicInteractionManagerRef.drawOrUpdateGraphics(e)}))},this.handleGraphicsUpdate=e=>ce(this,void 0,void 0,(function*(){let t;const i=Object(s.uuidv1)(),{graphicsInfo:n,cameraInfo:a,drawingMode:o}=e,r=this.getDefaultOptions(o);e.drawingMode===de.a.Point?t=yield this.addPointRecord(i,r,n,a):e.drawingMode===de.a.Line&&(t=yield this.addPathRecord(i,r,n,a)),this.props.onNewFeatureModeChange(Ce.Empty),"function"==typeof this.props.onDrawFinish&&this.props.onDrawFinish(t)})),this.handleDrawCancel=()=>{this.props.onNewFeatureModeChange(Ce.Empty)},this.getDefaultOptions=e=>{let t;switch(e){case de.a.Point:t={direction:r.e.CCW};break;case de.a.Line:t={direction:r.c.Forward,style:r.d.Smoothed};break;default:console.error("action-panel::getDefaultOptions")}return t},this.addPointRecord=(e,t,i,s)=>ce(this,void 0,void 0,(function*(){const n=this.props.intl.formatMessage({id:"pointStyle",defaultMessage:S}),a=q.j(this.props.activedRouteConfig.records,n);let o=this.props.buildTemporaryRecordConfig(i,s,this.props.jimuMapView);return o=Object.assign(o,{idx:e,type:ee.a.Rotate,displayName:a,duration:10,startDelay:0,endDelay:0,angle:360,direction:t.direction,mapViewId:this.props.getPopperJimuMapId()}),yield this.props.buildDefaultRecord(o,i)})),this.addPathRecord=(e,t,i,s)=>ce(this,void 0,void 0,(function*(){const n=this.props.intl.formatMessage({id:"pathStyle",defaultMessage:R}),a=q.j(this.props.activedRouteConfig.records,n);let o=this.props.buildTemporaryRecordConfig(i,s,this.props.jimuMapView);return o=Object.assign(o,{idx:e,type:ee.a.Smoothed,displayName:a,duration:-1,startDelay:0,endDelay:0,direction:t.direction,mapViewId:this.props.getPopperJimuMapId()}),yield this.props.buildDefaultRecord(o,i)})),this.handlePickHanlder=e=>{this.handleGraphicsUpdate(e)},this.handleRefGraphicInteractionManager=e=>{this.graphicInteractionManagerRef=e,null!==e?this.setState({isLoaded:!0}):this.setState({isLoaded:!1}),this._redrawAllRecordGraphics(this.props.activedRouteConfig),this.props.onRefGraphicInteractionManager(e)},this.handleFocusedGraphicChanged=e=>{},this.handleDrawingModeChanged=e=>{this.props.stopFly()},this.state={isLoaded:!1},this._init(this.props.jimuMapView)}_init(e){Object(q.p)(e)&&(this.jimuMapView=e,this._redrawAllRecordGraphics(this.props.activedRouteConfig))}componentDidUpdate(e,t){var i,s,n;this.props.jimuMapView!==e.jimuMapView&&this._init(this.props.jimuMapView),this.props.newFeatureMode!==e.newFeatureMode&&(this.props.newFeatureMode===Ce.Point?null===(i=this.graphicInteractionManagerRef)||void 0===i||i.onRenderStateChange({drawingMode:de.a.Point}):this.props.newFeatureMode===Ce.Path?null===(s=this.graphicInteractionManagerRef)||void 0===s||s.onRenderStateChange({drawingMode:de.a.Line}):this.props.newFeatureMode===Ce.Empty&&(null===(n=this.graphicInteractionManagerRef)||void 0===n||n.onRenderStateChange({drawingMode:de.a.Null}))),Object(q.p)(this.props.jimuMapView)&&!this._isRecordsIdEqual(this.props.activedRouteConfig,e.activedRouteConfig)&&this._redrawAllRecordGraphics(this.props.activedRouteConfig)}componentWillUnmount(){this.props.onRefGraphicInteractionManager(null)}render(){return Object(s.jsx)("div",{className:"d-flex align-items-center justify-content-center"},Object(q.p)(this.props.jimuMapView)&&Object(s.jsx)(de.c,{onRef:this.handleRefGraphicInteractionManager,widgetId:this.props.specifiedJimuMapId,intl:this.props.intl,theme:this.props.theme,jimuMapView:this.props.jimuMapView,showItems:[de.b.Point,de.b.Line],isDisabled:this.props.isDisableDraw||!this.props.isTerrainLoaded,flyStyle:null,isPlaying:!1,onFocusedGraphicChanged:this.handleFocusedGraphicChanged,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawFinish:this.handleGraphicsUpdate,onDrawCancel:this.handleDrawCancel}))}}const ue=i(51);class ge extends s.React.PureComponent{constructor(e){super(e),this.Graphic=null,this.GraphicsLayer=null,this.getPoperStyle=e=>s.css`
        .popper-content {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;

          .popper-header {
            width: 100%;
            flex-shrink: 0;
            flex-grow: 0;
            cursor: move;
          }
          .map-container {
            width: 800px;
            height: 800px;
            background-color: gray;
            display: contents;
          }
          .popper-footer {
            display: flex;
            background:${e.colors.palette.light[300]};
            color:${e.colors.palette.dark[600]};
            padding: ${s.polished.rem(10)} ${s.polished.rem(20)};

            .left-tool {
              min-height: 32px;
            }
          }
        }
    `,this.handleClickClose=()=>{this.props.onShowMapPopperChange(!1,Ie.Common)},this.getDefalutSize=()=>{const e=this.querySelector(`div.widget-renderer[data-widgetid="${this.props.useMapWidgetIds[0]}"]`),t=q.p(document.querySelector("#default"))?document.querySelector("#default").clientHeight-20:1080;let i={width:770,height:850},s={width:770,height:770};if(q.p(e)){const n=e.getBoundingClientRect();let a=n.width/n.height;a=a>0?a:1;let o=1.1*n.width,r=1.1*n.height+111,l=1.1*n.width,h=1.1*n.height;o<770?(o=770,r=770/a+111,l=770,h=770/a):o>1080&&(o=1080,r=1080/a+111,l=1080,h=1080/a),r>t&&(r=t,o=(t-111)*a>770?(t-111)*a:770),h>t-111&&(h=t-111,l=(t-111)*a),i={width:o,height:r},s={width:l-2,height:h}}return{innerSize:i,innerMapSize:s}},this.getWidgetPosition=()=>{const e=Object(s.getAppStore)().getState().appStateInBuilder.appContext.isRTL;let t={x:500,y:50};const{innerSize:i}=this.getDefalutSize();return t={x:e?260:document.body.clientWidth-i.width-260,y:50},t},this.handleActiveViewChange=e=>{var t;this.props.onMapPopperJimuMapViewUpdate(e),e!==this.state.jimuMapView&&("3d"===(null===(t=e.view)||void 0===t?void 0:t.type)?this.setState({isDisableDraw:!1}):this.setState({isDisableDraw:!0})),this.setState({jimuMapView:e})},this.handleViewGroupCreate=e=>{this.props.onMapPopperViewGroupUpdate(e)},this.handleDrawFinish=e=>{this.tmpRecordForConfirm=e,this._toggleConfirmWindow(!0)},this._toggleConfirmWindow=e=>{let t;t=void 0!==e?e:!this.state.isShowConfirmWin,this.setState({isShowConfirmWin:t},()=>{!t&&q.p(this.tmpRecordForConfirm)&&(this.tmpRecordForConfirm=null)})},this.getRecordName=()=>{var e;return null===(e=this.tmpRecordForConfirm)||void 0===e?void 0:e.getConfig().displayName},this._getConfirmWindow=()=>{var e;const{innerSize:t}=this.getDefalutSize(),{theme:i}=this.props,n=this.props.intl.formatMessage({id:"saveTo",defaultMessage:k}),a=this.props.intl.formatMessage({id:"closePopup",defaultMessage:N}),o=this.props.intl.formatMessage({id:"editElement",defaultMessage:O}),r=this.props.intl.formatMessage({id:"save",defaultMessage:V});return Object(s.jsx)("div",{css:s.css`
        position: absolute;
        z-index: 11;
        top: 0;
        left: 0;
        background-color: ${s.polished.rgba(i.colors.palette.secondary[400],.65)};
        width: ${t.width}px;
        height: ${t.height}px;
        .real-container{
          background-color: ${i.colors.palette.secondary[300]};
          border: 1px solid ${i.colors.palette.secondary[800]};
          background-clip: padding-box;
          width: 480px;
          position: relative;
          top: 50%;
          margin: -60px auto 0;
        }
        .confirm-header {
          border-bottom: 1px solid ${i.colors.palette.light[800]};
          padding: 16px 20px;
        }
        .confirm-context {
          padding: ${s.polished.rem(20)} ${s.polished.rem(20)} 0 ${s.polished.rem(20)};
        }
        .confirm-footer {
          display: flex;
          justify-content: flex-end;
          padding: ${s.polished.rem(20)};
          button {
            cursor: pointer;
            margin-left: ${s.polished.rem(8)};
            min-width: ${s.polished.rem(100)};
          }
        }
      `},Object(s.jsx)("div",{className:"real-container"},Object(s.jsx)(l.PanelHeader,{title:n+" "+this.props.activedRouteConfig.displayName,moveable:!1,className:"confirm-header",actions:[{name:"close",label:a,icon:ue,onClick:this.handleConfirmWinClose}]}),Object(s.jsx)("div",{className:"confirm-context"},Object(s.jsx)(l.TextInput,{className:"w-100",defaultValue:null!==(e=this.getRecordName())&&void 0!==e?e:"",onChange:e=>this.handleConfirmWinNameChange(e.target.value)})),Object(s.jsx)("div",{className:"confirm-footer"},Object(s.jsx)(l.Button,{type:"secondary",onClick:this.handleConfirmWinEdit},o),Object(s.jsx)(l.Button,{type:"primary",onClick:this.handleConfirmWinSave},r))))},this.handleConfirmWinClose=()=>{this.props.onRemoveGraphics(this.tmpRecordForConfirm.cachingGraphicsInfo.getGraphics()),this._toggleConfirmWindow(!1)},this.handleConfirmWinNameChange=e=>{this.tmpRecordForConfirm.getConfig().displayName=e},this.handleConfirmWinEdit=()=>{q.p(this.tmpRecordForConfirm)&&this.props.onRecordAddAndEdit(this.tmpRecordForConfirm.getConfig()).then(()=>{this._toggleConfirmWindow(!1)})},this.handleConfirmWinSave=()=>{q.p(this.tmpRecordForConfirm)&&this.props.onRecordAdd(this.tmpRecordForConfirm.getConfig()),this._toggleConfirmWindow(!1)},this.state={jimuMapView:null,jimuMapViews:null,apiLoaded:!1,isDisableDraw:!1,isTerrainLoaded:!1,mapSize:this.getDefalutSize().innerSize,isShowConfirmWin:!1}}componentDidMount(){this.state.apiLoaded||Object(n.loadArcGISJSAPIModules)(["esri/Graphic"]).then(e=>{[this.Graphic]=e,this.setState({apiLoaded:!0})})}querySelector(e){var t;const i=document.querySelector(`iframe[name="${s.APP_FRAME_NAME_IN_BUILDER}"]`);if(q.p(i)){return(null!==(t=i.contentDocument)&&void 0!==t?t:i.contentWindow.document).querySelector(e)}return null}render(){var e,t;const{mapSize:i}=this.state,{activedRouteConfig:n,theme:a,isShowMapPopper:o}=this.props,r=q.p(this.props.useMapWidgetIds)&&this.props.useMapWidgetIds[0],h=Object(s.getAppStore)().getState().appStateInBuilder.appConfig;if(!q.p(h.widgets[r]))return null;const d=h.widgets[r].useDataSources,c={canZoom:!0,canHome:!0,canCompass:!0,canLayers:!0};let p;if(q.p(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.dataSourceId)){const e=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.dataSourceId;p=Object(s.Immutable)({}).set("initialMapDataSourceID",e).set("toolConifg",c)}const u=s.css`.header{
          background:${a.colors.palette.light[300]};
          color:${a.colors.palette.dark[600]};
          height: 50px;
          flex-shrink: 0;
          font-size: 1rem;
          font-weight: 500;
          .jimu-btn {
            color: ${a.colors.palette.dark[600]} !important;
          }
          & >.actions >.jimu-btn.action-close :hover {
            color: ${a.colors.black} !important;
          }
        }`,g=Object(s.jsx)(l.FloatingPanel,{onHeaderClose:this.handleClickClose,defaultPosition:this.getWidgetPosition(),headerTitle:n.displayName,size:i,minSize:{width:770,height:850},disableResize:!0,css:u,className:"surface-3",disableActivateOverlay:!0,dragBounds:"body"},Object(s.jsx)("div",{className:"rounded w-100 h-100",css:this.getPoperStyle(a)},Object(s.jsx)("div",{className:"popper-content"},Object(s.jsx)("div",{className:"map-container",style:{height:"600px",width:"700px"}},Object(s.jsx)(he.JimuMap,{id:this.props.specifiedJimuMapId,useDataSources:d,jimuMapConfig:p,onActiveViewChange:this.handleActiveViewChange,onViewGroupCreate:this.handleViewGroupCreate})),this.state.isShowConfirmWin&&this._getConfirmWindow(),Object(s.jsx)("div",{className:"popper-footer"},Object(s.jsx)("div",{className:"left-tool"},Object(s.jsx)(pe,{specifiedJimuMapId:this.props.specifiedJimuMapId,theme:a,intl:this.props.intl,jimuMapView:this.state.jimuMapView,isDisableDraw:this.state.isDisableDraw,isTerrainLoaded:this.props.isTerrainLoaded,getPopperJimuMapId:this.props.getPopperJimuMapId,onRefGraphicInteractionManager:this.props.onRefGraphicInteractionManager,newFeatureMode:this.props.newFeatureMode,onNewFeatureModeChange:this.props.onNewFeatureModeChange,buildTemporaryRecordConfig:this.props.buildTemporaryRecordConfig,buildDefaultRecord:this.props.buildDefaultRecord,onDrawFinish:this.handleDrawFinish,activedRouteConfig:this.props.activedRouteConfig,playingInfo:this.props.playingInfo,isPreviewRouteBtnPlaying:this.props.isPreviewRouteBtnPlaying,stopFly:this.props.stopFly})),Object(s.jsx)("div",{className:"float-right"})))));return Object(s.jsx)("div",{className:"w-100"},o&&g)}}function me(e){const t=e.colors.palette.light[200];return s.css`
    .widget-setting-fly-controller{
      font-weight: lighter;
      font-size: 13px;

      .select-map-descript {
        color: ${e.colors.palette.dark[600]}
      }

      .flystyle-label {
        color: ${e.colors.palette.dark[400]}
      }

      .hide {
        display: none;
      }

      .radio-wapper > span.jimu-radio {
        flex-shrink: 0;
      }

      .map-selector-section .component-map-selector .form-control{
        width: 100%;
      }

      /* ui-mode */
      .ui-mode-card-chooser{
        display: flex;
        align-items: start;

        .ui-mode-card-wapper {
          width: 49%
        }
        .ui-mode-card-separator {
          width: 2%
        }
        .ui-mode-card {
          flex: 1;
          width: 100%;
          background: ${t};
          border: 2px solid ${t};
          margin: 0 0 0.5rem 0;
        }
        .ui-mode-card.active {
          border: 2px solid #00D8ED;
        }
        .ui-mode-label {
          overflow: hidden;
          text-align: center;
        }
      }

      /* itme-mode */
      .item-detail-wapper {
        padding-left: 0;
        padding-right: 0;
        padding-top: 0.8rem;
      }

      /* Planned routes */
      .page-back-btn {
        padding-left: 0;
        padding-right: 0;
      }

      /* dnd-tree */
      .jimu-tree-main__item {
        .jimu-tree-item__body {
          padding: 1px 0;
        }
        .jimu-tree-item__main-line .jimu-tree-item__title >.jimu-tree-item__title-text {
          -webkit-line-clamp: 1;
        }
      }
    }
  `}function ve(e,t){let i=!1;!1===e[t].isInUse&&(i=!0);let s="";return i&&(s="hide"),s}var fe=i(109),ye=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};const we={[r.b.Horizontal]:{w:340,h:60},[r.b.Palette]:{w:340,h:98}};var Ie,Ce;!function(e){e.Common="flyStyle-list",e.RouteDetails="route-details",e.RecordLoading="record-loading",e.RecordDetails="record-details"}(Ie||(Ie={})),function(e){e.Empty="Empty",e.Point="Point",e.Path="Path",e.Pick="Pick"}(Ce||(Ce={}));class be extends s.React.PureComponent{constructor(e){super(e),this.handleMapWidgetChange=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.handleActiveViewChange=e=>{var t;q.p(e)&&"2d"!==e.view.type?(null===(t=this.state.jimuMapView)||void 0===t?void 0:t.id)!==e.id&&this.setState({jimuMapView:e}):this.setState({jimuMapView:null})},this.handleFlyPlay=()=>{},this.handleFlyPause=()=>{this.setState({isPreviewRouteBtnPlaying:!1})},this.handleFlyFinish=()=>{this.setState({isPreviewRouteBtnPlaying:!1})},this.handleFlyModesChange=(e,t)=>{const i=this.props.config.itemsList.asMutable({deep:!0}),n=Object(s.Immutable)(i[t]);let a;(n.name===r.a.Rotate||n.name===r.a.Path||n.name===r.a.Route)&&(a=n.set("isInUse",e),i.splice(t,1,a.asMutable({deep:!0}))),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})},this.activeControllerLayout=e=>this.props.config.layout===e?" active":"",this.handleControllerLayoutChanged=e=>{const t=e.target.getAttribute("data-uimode"),i=Object(a.getAppConfigAction)(),{layoutInfo:n}=this.props,o=we[t];this.getLayoutType()===s.LayoutType.FixedLayout&&i.editLayoutItemSize(n,o.w,o.h).exec(),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("layout",t)})},this.getLayoutType=()=>{var e,t;const{layoutInfo:i,appConfig:s}=this.props,n=i.layoutId;return null===(t=null===(e=null==s?void 0:s.layouts)||void 0===e?void 0:e[n])||void 0===t?void 0:t.type},this.handleRotateRadioChange=(e,t)=>{const i=this.props.config.itemsList.asMutable({deep:!0}),n=Object(s.Immutable)(i[t]);if(n.name===r.a.Rotate){const s=n.set("direction",e);i.splice(t,1,s.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})}},this.handlePathRadioChange=(e,t)=>{const i=this.props.config.itemsList.asMutable({deep:!0}),n=Object(s.Immutable)(i[t]);if(n.name===r.a.Path){const s=n.set("style",e);i.splice(t,1,s.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})}},this.renderRotateSetting=(e,t)=>{const i=e.direction===r.e.CW,n=ve(this.props.config.itemsList,t),a=this.props.intl.formatMessage({id:"styleLabelRotate",defaultMessage:f}),h=this.props.intl.formatMessage({id:"CW",defaultMessage:w}),d=this.props.intl.formatMessage({id:"CCW",defaultMessage:I});return Object(s.jsx)(o.SettingSection,{className:"d-2 item-detail-wapper "+n},Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:"flystyle-label"},a)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:i,id:"CW",style:{cursor:"pointer"},onChange:e=>this.handleRotateRadioChange(r.e.CW,t)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CW",className:"ml-1 text-break"},h)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:!i,id:"CCW",style:{cursor:"pointer"},onChange:e=>this.handleRotateRadioChange(r.e.CCW,t)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CCW",className:"ml-1 text-break"},d)))},this.renderPathSetting=(e,t)=>{const i=e.style===r.d.Smoothed,n=ve(this.props.config.itemsList,t),a=this.props.intl.formatMessage({id:"styleLabelPath",defaultMessage:y}),h=this.props.intl.formatMessage({id:"pathTypeSmoothedCurve",defaultMessage:C}),d=this.props.intl.formatMessage({id:"pathTypeRealPath",defaultMessage:b});return Object(s.jsx)(o.SettingSection,{className:"d-2 item-detail-wapper "+n},Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(l.Label,{className:"flystyle-label text-truncate"},a)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:i,id:"CURVED",style:{cursor:"pointer"},onChange:e=>this.handlePathRadioChange(r.d.Smoothed,t)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"CURVED",className:"ml-1 text-break"},h)),Object(s.jsx)(o.SettingRow,{className:"mt-2 radio-wapper"},Object(s.jsx)(l.Radio,{checked:!i,id:"LINE",style:{cursor:"pointer"},onChange:e=>this.handlePathRadioChange(r.d.RealPath,t)}),Object(s.jsx)(l.Label,{style:{cursor:"pointer"},for:"LINE",className:"ml-1 text-break"},d)))},this.handleRefGraphicInteractionManager=e=>{this.graphicInteractionManagerRef=e,this.setState({isDrawHelperLoaded:!0}),null===e&&this.setState({isDrawHelperLoaded:!1})},this.handleSettingPageModeChange=e=>ye(this,void 0,void 0,(function*(){var t;yield this.stopFly(),this.setState({pageMode:e}),this.setState({playingInfo:null}),e===Ie.Common?(this.setState({activedRouteUuid:null,activedRecordUuid:null}),this.handleShowMapPopperChange(!1)):this.handleShowMapPopperChange(!0),e!==Ie.RouteDetails&&e!==Ie.RecordLoading&&this.setState({newestRecordIdx:null,playingInfo:null}),e===Ie.RouteDetails&&(null===(t=this.graphicInteractionManagerRef)||void 0===t||t.highlight(null))})),this.handleShowMapPopperChange=(e,t)=>ye(this,void 0,void 0,(function*(){this.setState({isShowMapPopper:e}),e||(this.setState({isTerrainLoaded:!1}),q.p(t)&&this.handleSettingPageModeChange(t))})),this.handleMapPopperJimuMapViewUpdate=e=>{this.setState({isTerrainLoaded:!1}),this.setState({mapPopperJimuMapView:e},()=>{var e;const{isTriggeredByFly:t,isTriggeredByMapSelf:i}=q.l(this.props.widgetId,this.props.autoControlWidgetId,q.f(this.props.useMapWidgetIds[0]));!t&&i&&(null===(e=this.flyManager)||void 0===e||e.stop()),q.p(this.flyManager)?(this.flyManager.stop({isUpdate:!0}),this.flyManager.updateJimuMapView(this.state.mapPopperJimuMapView)):this.initFlyManager()})},this.handleAutoControlMapPublish=()=>{Object(s.getAppStore)().dispatch(s.appActions.requestAutoControlMapWidget(q.f(this.props.useMapWidgetIds[0]),this.props.widgetId))},this.handleMapPopperViewGroupUpdate=e=>{this.setState({viewGroup:e},()=>{q.p(this.flyManager)?(this.flyManager.stop({isUpdate:!0}),this.flyManager.updateViewGroup(this.state.viewGroup)):this.initFlyManager()})},this.getSpecifiedJimuMapId=()=>q.f(this.props.useMapWidgetIds[0]),this.handleFlyManagerItemsUpdate=e=>{this.setState({flyManagerItems:e})},this.onTerrainLoaded=()=>{this.setState({isTerrainLoaded:!0})},this.handleRoutesOrderUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t],n=[];e.map(e=>{const t=e.itemKey,i=s.routes.find(e=>e.idx===t);n.push(i)}),s.routes=n,i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})},this.handleRouteConfigPush=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t];s.routes.push(e),i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})},this.handleRouteConfigDelete=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t],n=s.routes.findIndex(t=>t.idx===e);n>-1&&(s.routes.splice(n,1),i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)}))},this.handleRouteDisplayNameChange=(e,t)=>{const i=this.state.activedRecordFlyStyleIdx,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[i],a=n.routes.findIndex(t=>t.idx===e);n.routes[a].displayName=t,s.splice(i,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRouteToggleVisibilityChange=(e,t)=>{const i=this.state.activedRecordFlyStyleIdx,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[i],a=n.routes.findIndex(t=>t.idx===e.routeUuid);n.routes[a].isInUse=t,s.splice(i,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordsOrderUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t],a=n.routes.find(e=>e.idx===i),o=a.records,r=[];e.map(e=>{const t=e.itemKey,i=o.find(e=>e.idx===t);i.storedGraphicsInfo.rawData.graphics.forEach(e=>{e.symbol=null}),r.push(i)}),a.records=r,s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordConfigPush=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t];n.routes.find(e=>e.idx===i).records.push(e),s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordConfigDelete=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t],a=n.routes.find(e=>e.idx===i).records,o=a.findIndex(t=>t.idx===e);o>-1&&(a.splice(o,1),s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)}))},this.handleRecordConfigUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=e.idx,n=this.props.config.itemsList.asMutable({deep:!0}),a=n[t],o=a.routes.find(e=>e.idx===i).records,r=o.findIndex(e=>e.idx===s);r>-1&&(o.splice(r,1,e),n.splice(t,1,a),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",n)}))},this.handleRecordModeSelected=e=>{this.setState({activedRecordFlyStyleIdx:e})},this.handleRouteAdd=e=>{this.handleRouteConfigPush(e),setTimeout(()=>{this.handleRouteEdit({routeUuid:e.idx})},100)},this.handleRouteDelete=e=>{this.handleRouteConfigDelete(e.routeUuid)},this.handleRouteEdit=e=>{this.setState({activedRouteUuid:e.routeUuid}),this.handleSettingPageModeChange(Ie.RouteDetails)},this.getCurrentRouteName=()=>{const e=this.flyManager.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return null==e?void 0:e.displayName},this.renderRoutesList=(e,t,i)=>{const{theme:n,intl:a}=this.props;return Object(s.jsx)(s.React.Fragment,null,i&&Object(s.jsx)(X,{useMapWidgetIds:this.props.useMapWidgetIds,jimuMapView:this.state.jimuMapView,theme:n,intl:a,flyModeIdx:t,routeConfig:e,onRouteEdit:this.handleRouteEdit,onRouteAdd:this.handleRouteAdd,onRouteDelete:this.handleRouteDelete,onRouteToggleVisibilityChange:this.handleRouteToggleVisibilityChange,onRoutesOrderUpdate:this.handleRoutesOrderUpdate}))},this.stopFly=()=>ye(this,void 0,void 0,(function*(){var e;yield null===(e=this.flyManager)||void 0===e?void 0:e.stop()})),this.handleRecordAdd=e=>ye(this,void 0,void 0,(function*(){yield this.stopFly(),this.handleRecordConfigPush(e),this._handleRecordAddNotify(e.idx)})),this._handleRecordAddNotify=e=>{this.setState({newestRecordIdx:e})},this.handleRecordAddAndEdit=e=>ye(this,void 0,void 0,(function*(){return yield this.stopFly(),this.handleRecordConfigPush(e),yield setTimeout(()=>{this.handleRecordEdit({routeUuid:this.state.activedRouteUuid,recordUuid:e.idx})},100),!0})),this.handleRouteNameChange=(e,t)=>{this.handleRouteDisplayNameChange(e.routeUuid,t)},this.handleRecordEdit=(e,t)=>ye(this,void 0,void 0,(function*(){if(yield this.stopFly(),this.setState({activedRecordUuid:e.recordUuid}),t)return;const i=null!==e.recordUuid;this.setState({delayUpdateFlyManagerFlag:i,activedRecordUuid:e.recordUuid},()=>{this.handleSettingPageModeChange(Ie.RecordLoading),this._asyncRecordEdit(i,e)})})),this._asyncRecordEdit=(e,t)=>ye(this,void 0,void 0,(function*(){yield this.flyManager.setIsLiveviewSpecifiedRecord({routeUuid:this.state.activedRouteUuid,recordUuid:this.state.activedRecordUuid},e),e?this.handleSettingPageModeChange(Ie.RecordDetails):(this.initFlyManager(),this.handleSettingPageModeChange(Ie.RouteDetails))})),this._getCurrentLiveviewSetting=()=>this.flyManager.getLiveviewSettingInfo(),this.getDefaultDuration=()=>this.flyManager.getDefaultDuration(),this.handleRecordPreview=e=>ye(this,void 0,void 0,(function*(){this.setState({playingInfo:e}),yield this.stopFly();const t={onFly:()=>ye(this,void 0,void 0,(function*(){this.handleFlyPlay(),this.setState({playingInfo:e})})),onPause:()=>ye(this,void 0,void 0,(function*(){this.handleFlyPause(),yield this.handlePauseRecordPreview(null,!0)})),onFinish:()=>ye(this,void 0,void 0,(function*(){this.handleFlyFinish(),yield this.handleFinishRecordPreview()}))};yield this.flyManager.previewSpecifiedRecord({routeUuid:this.state.activedRouteUuid,recordUuid:e.recordUuid},t)})),this.handlePauseRecordPreview=(e,t)=>ye(this,void 0,void 0,(function*(){t||(yield this.stopFly()),this.setState({playingInfo:null})})),this.handleFinishRecordPreview=()=>ye(this,void 0,void 0,(function*(){this.setState({playingInfo:null})})),this.handleRecordDelete=e=>ye(this,void 0,void 0,(function*(){yield this.stopFly(),this.handleRecordConfigDelete(e.recordUuid),this.setState({playingInfo:null})})),this.handlePreviewRoute=(e,t,i)=>ye(this,void 0,void 0,(function*(){const s=this.state.playingInfo;s&&null===s.routeUuid&&null!==s.recordUuid&&(yield this.stopFly());const n={routeUuid:t.routeUuid};i&&(yield this.flyManager.prepareRoutePreview(n)),this.setState({isPreviewRouteBtnPlaying:!0}),this.setState({playingInfo:t}),yield this.flyManager.previewSpecifiedRoute(e,n)})),this.handlePauseRoutePreview=()=>{var e;null===(e=this.flyManager)||void 0===e||e.pause(),this.setState({isPreviewRouteBtnPlaying:!1})},this.handleNewFeatureModeChange=e=>ye(this,void 0,void 0,(function*(){yield this.stopFly(),this.state.newFeatureMode!==e&&this.setState({newFeatureMode:e})})),this.renderRouteDetailPage=()=>{var e;let t;const{theme:i,intl:n}=this.props,{newFeatureMode:a}=this.state,o=this.flyManager.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return t=q.p(this.state.mapPopperJimuMapView)?q.p(o)&&Object(s.jsx)(oe,{routeConfig:o,mapPopperJimuMapView:this.state.mapPopperJimuMapView,isTerrainLoaded:this.state.isTerrainLoaded,theme:i,intl:n,onShowMapPopperChange:this.handleShowMapPopperChange,onSettingPageModeChange:this.handleSettingPageModeChange,onRouteNameChange:this.handleRouteNameChange,onRouteDelete:this.handleRouteDelete,onRouteEdit:this.handleRouteEdit,newFeatureMode:a,onNewFeatureModeChange:this.handleNewFeatureModeChange,isPreviewRouteBtnPlaying:this.state.isPreviewRouteBtnPlaying,onPreviewRoute:this.handlePreviewRoute,onPauseRoutePreview:this.handlePauseRoutePreview,newestRecordIdx:this.state.newestRecordIdx,playingInfo:this.state.playingInfo,onRecordEdit:this.handleRecordEdit,onRecordPreview:this.handleRecordPreview,onPauseRecordPreview:this.handlePauseRecordPreview,onRecordDelete:this.handleRecordDelete,onRecordsOrderUpdate:this.handleRecordsOrderUpdate,isRecordCanPlay:null===(e=this.flyManager)||void 0===e?void 0:e.isRecordCanPlay,isDrawHelperLoaded:this.state.isDrawHelperLoaded}):Object(s.jsx)(l.Loading,{type:l.LoadingType.Secondary}),t},this.buildTemporaryRecordConfig=(e,t,i)=>this.flyManager.buildTemporaryRecordConfig(e,t,i),this.buildDefaultRecord=(e,t)=>ye(this,void 0,void 0,(function*(){return yield this.flyManager.buildTemporaryRecord(e,this.state.jimuMapView.view,null,t)})),this.getPopperJimuMapId=()=>q.t(this.state.mapPopperJimuMapView.id),this.handleRecordChange=e=>{this.handleRecordConfigUpdate(e)},this.handleLiveviewSettingChange=e=>{this.flyManager.onLiveviewParamChange(e,{isNeedHighlight:!0})},this.renderRecordLoadingPage=()=>Object(s.jsx)(l.Loading,{type:l.LoadingType.Secondary}),this.renderRecordDetailPage=()=>{const{theme:e,intl:t}=this.props,i=this.flyManager.getRecordByIds({routeUuid:this.state.activedRouteUuid,recordUuid:this.state.activedRecordUuid});return q.p(i)&&Object(s.jsx)(le,{record:i,mapPopperJimuMapView:this.state.mapPopperJimuMapView,theme:e,intl:t,onRecordEdit:this.handleRecordEdit,onRecordChange:this.handleRecordChange,getCurrentLiveviewSetting:this._getCurrentLiveviewSetting,onLiveviewSettingChange:this.handleLiveviewSettingChange,getDefaultDuration:this.getDefaultDuration})},this.handleDrawOrUpdateGraphics=e=>{var t;if("function"==typeof(null===(t=this.graphicInteractionManagerRef)||void 0===t?void 0:t.drawOrUpdateGraphics))return this.graphicInteractionManagerRef.drawOrUpdateGraphics(e)},this.handleRemoveGraphics=e=>{var t;null===(t=this.graphicInteractionManagerRef)||void 0===t||t.removeGraphics(e)},this.handleHighlightGraphics=e=>{var t;"function"==typeof(null===(t=this.graphicInteractionManagerRef)||void 0===t?void 0:t.highlight)&&this.graphicInteractionManagerRef.highlight(e)},this.state={jimuMapView:null,viewGroup:null,pageMode:Ie.Common,isShowMapPopper:!1,mapPopperJimuMapView:null,flyManagerItems:null,isTerrainLoaded:!1,activedRecordFlyStyleIdx:null,activedRouteUuid:null,activedRecordUuid:null,isPreviewRouteBtnPlaying:!1,playingInfo:null,newestRecordIdx:null,delayUpdateFlyManagerFlag:!1,isDrawHelperLoaded:!1,newFeatureMode:Ce.Empty}}componentDidMount(){this.handleRecordModeSelected(2),this.initFlyManager()}componentDidUpdate(e,t){this.props.config!==e.config&&this.initFlyManager(),this.props.settingPanelChange!==e.settingPanelChange&&(this.handleRouteEdit({routeUuid:null}),this.handleRecordEdit({routeUuid:null,recordUuid:null},!0),this.handleSettingPageModeChange(Ie.Common),this.initFlyManager())}render(){var e,t;const a=this.props.config.itemsList.asMutable({deep:!0}),g=this.props.intl.formatMessage({id:"selectMap",defaultMessage:h}),m=this.props.intl.formatMessage({id:"controllerStyle",defaultMessage:d}),v=this.props.intl.formatMessage({id:"bar",defaultMessage:c}),f=this.props.intl.formatMessage({id:"palette",defaultMessage:p}),y=this.props.intl.formatMessage({id:"selectStyle",defaultMessage:u}),{theme:w,useDataSources:I,useMapWidgetIds:C,config:b,intl:M}=this.props,{jimuMapView:P,isShowMapPopper:j,newFeatureMode:S}=this.state,R=null===(e=this.flyManager)||void 0===e?void 0:e.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return Object(s.jsx)("div",{className:" h-100",css:me(this.props.theme)},Object(s.jsx)("div",{className:"widget-setting-fly-controller h-100"},Ie.Common===this.state.pageMode&&Object(s.jsx)(s.React.Fragment,null,Object(s.jsx)(o.SettingSection,{className:"map-selector-section"},Object(s.jsx)(o.SettingRow,{flow:"wrap"},Object(s.jsx)("div",{className:"select-map-descript text-break"},g)),Object(s.jsx)(o.SettingRow,null,Object(s.jsx)(o.JimuMapViewSelector,{onSelect:this.handleMapWidgetChange,useMapWidgetIds:this.props.useMapWidgetIds})),Object(s.jsx)("div",{className:"fly-map"},Object(s.jsx)("div",null,Object(s.jsx)(n.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.handleActiveViewChange})))),Object(s.jsx)(o.SettingSection,{title:m},Object(s.jsx)(o.SettingRow,null,Object(s.jsx)("div",{className:"ui-mode-card-chooser"},Object(s.jsx)("div",{className:"ui-mode-card-wapper"},Object(s.jsx)("img",{className:"ui-mode-card"+this.activeControllerLayout(r.b.Horizontal),"data-uimode":r.b.Horizontal,id:"uimode-0",src:i(256),onClick:this.handleControllerLayoutChanged}),Object(s.jsx)(l.Label,{for:"uimode-0",className:"mx-1 text-break ui-mode-label"},v)),Object(s.jsx)("div",{className:"ui-mode-card-separator"}),Object(s.jsx)("div",{className:"ui-mode-card-wapper"},Object(s.jsx)("img",{className:"ui-mode-card"+this.activeControllerLayout(r.b.Palette),"data-uimode":r.b.Palette,id:"uimode-1",src:i(257),onClick:this.handleControllerLayoutChanged}),Object(s.jsx)(l.Label,{for:"uimode-1",className:"mx-1 text-break ui-mode-label"},f))))),Object(s.jsx)(o.SettingSection,{title:y},a.map((e,t)=>{const i=e.name;return r.a.Rotate===i?Object(s.jsx)("div",{key:t},Object(s.jsx)(Q,{idx:t,styleConfig:e,handleFlyModesChange:this.handleFlyModesChange}),this.renderRotateSetting(e,t)):r.a.Path===i?Object(s.jsx)("div",{key:t},Object(s.jsx)(Q,{idx:t,styleConfig:e,handleFlyModesChange:this.handleFlyModesChange}),this.renderPathSetting(e,t)):r.a.Route===i?Object(s.jsx)("div",{key:t},Object(s.jsx)(Q,{idx:t,styleConfig:e,handleFlyModesChange:this.handleFlyModesChange}),this.renderRoutesList(e,t,e.isInUse)):void 0}))),Ie.RouteDetails===this.state.pageMode&&this.renderRouteDetailPage(),Ie.RecordLoading===this.state.pageMode&&this.renderRecordLoadingPage(),Ie.RecordDetails===this.state.pageMode&&this.renderRecordDetailPage(),this.state.isShowMapPopper&&R&&Object(s.jsx)(ge,{specifiedJimuMapId:this.getSpecifiedJimuMapId(),theme:w,intl:M,config:b,isShowMapPopper:j,useDataSources:I,useMapWidgetIds:C,jimuMapView:P,isTerrainLoaded:this.state.isTerrainLoaded,onRefGraphicInteractionManager:this.handleRefGraphicInteractionManager,activedRouteConfig:R,onShowMapPopperChange:this.handleShowMapPopperChange,newFeatureMode:S,onNewFeatureModeChange:this.handleNewFeatureModeChange,onMapPopperJimuMapViewUpdate:this.handleMapPopperJimuMapViewUpdate,onMapPopperViewGroupUpdate:this.handleMapPopperViewGroupUpdate,onRecordAdd:this.handleRecordAdd,onRecordAddAndEdit:this.handleRecordAddAndEdit,buildTemporaryRecordConfig:this.buildTemporaryRecordConfig,buildDefaultRecord:this.buildDefaultRecord,getPopperJimuMapId:this.getPopperJimuMapId,playingInfo:this.state.playingInfo,isPreviewRouteBtnPlaying:this.state.isPreviewRouteBtnPlaying,onRemoveGraphics:this.handleRemoveGraphics,stopFly:this.stopFly})))}initFlyManager(){var e;return ye(this,void 0,void 0,(function*(){if(this.state.delayUpdateFlyManagerFlag)return;this.flyManager=new fe.a({widgetConfig:this.props.config,isBuilderSettingFlag:!0,jimuMapView:this.state.mapPopperJimuMapView,viewGroup:this.state.viewGroup,flyStateCallbacks:{onFly:this.handleFlyPlay,onPause:this.handleFlyPause,onFinish:this.handleFlyFinish},drawOrUpdateGraphics:this.handleDrawOrUpdateGraphics,highlightGraphics:this.handleHighlightGraphics,onItemsUpdate:this.handleFlyManagerItemsUpdate,onBeforeSwitchMap:this.handleAutoControlMapPublish,onTerrainLoaded:this.onTerrainLoaded}),this.flyManager.unRegisterItem();const t=this.flyManager.findFirstRouteItem();this.flyManager.registerItem(null===(e=t.config)||void 0===e?void 0:e.uuid)}))}}be.mapExtraStateProps=(e,t)=>{var i,s,n,a,o,r;const{id:l,useMapWidgetIds:h}=t,d=h&&0!==h.length?q.f(h[0]):void 0,c=e&&e.mapWidgetsInfo;return{appConfig:null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig,layoutInfo:null===(n=null===(s=null==e?void 0:e.appStateInBuilder)||void 0===s?void 0:s.widgetsState[l])||void 0===n?void 0:n.layoutInfo,autoControlWidgetId:d?null===(a=c[d])||void 0===a?void 0:a.autoControlWidgetId:void 0,settingPanelChange:null===(r=null===(o=null==e?void 0:e.widgetsState)||void 0===o?void 0:o[t.id])||void 0===r?void 0:r.settingPanelChange}}},49:function(e,t,i){"use strict";i.d(t,"a",(function(){return I})),i.d(t,"b",(function(){return C})),i.d(t,"c",(function(){return M}));var s,n=i(0),a=i(1),o=i(4),r=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.RelativeToGround="relative-to-ground",e.OnTheGround="on-the-ground"}(s||(s={}));class l{constructor(){this.widgetId="",this.jimuMapView=null,this.GraphicsLayer=null,this.removeAllGraphics=()=>{var e,t;null===(e=this.layersGroup.layerOnTheGround)||void 0===e||e.removeAll(),null===(t=this.layersGroup.layerRelativeToGround)||void 0===t||t.removeAll()}}setup(e,t){return r(this,void 0,void 0,(function*(){return yield Object(o.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer"]).then(i=>{[this.GraphicsLayer]=i,this.widgetId=t,this.resetJimuMapView(e),this.layersGroup={layerRelativeToGround:null,layerOnTheGround:null},this.resetGraphicsLayers()}),this}))}resetJimuMapView(e){var t,i,s,n;return this.jimuMapView&&(null===(t=this.jimuMapView.view)||void 0===t||t.map.remove(null===(i=this.layersGroup)||void 0===i?void 0:i.layerRelativeToGround),null===(s=this.jimuMapView.view)||void 0===s||s.map.remove(null===(n=this.layersGroup)||void 0===n?void 0:n.layerOnTheGround)),this.jimuMapView=e,this}resetGraphicsLayers(){return this._getGraphicsLayer(s.RelativeToGround),this._getGraphicsLayer(s.OnTheGround),this}_getGraphicsLayer(e){var t;let i=null;const n=e+"-draw-layer-"+this.widgetId+"-"+this.jimuMapView.id;(null===(t=this.jimuMapView.view)||void 0===t?void 0:t.map)&&(i=this.jimuMapView.view.map.findLayerById(n),i||(i=new this.GraphicsLayer({id:n,listMode:"hide",title:n,elevationInfo:{mode:e}}),this.jimuMapView.view.map.add(i))),e===s.RelativeToGround?this.layersGroup.layerRelativeToGround=i:e===s.OnTheGround&&(this.layersGroup.layerOnTheGround=i)}}var h=i(45),d=i(20),c=i(3),p=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};class u extends n.React.PureComponent{constructor(e){super(e),this.Graphic=null,this.Geometry=null,this.Point=null,this.handleDrawToolCreated=e=>p(this,void 0,void 0,(function*(){this.jimuDrawToolsRef=e,yield this.jimuDrawToolsRef.complete(),this.props.onDrawHelperCreated(this)})),this.handleDrawToolsActived=e=>{null!==e&&this._drawingModeChange(e)},this.handleDrawCancel=()=>{this._drawingModeChange(I.Null),this.props.onDrawCancel()},this._drawingModeChange=e=>{this.drawingMode=e,this.props.onDrawingModeChanged(e)},this.handleDrawStart=()=>{"function"==typeof this.props.onDrawStart&&this.props.onDrawStart()},this.handleDrawEnd=e=>{},this.handleDrawFinish=({type:e,graphic:t,layer:i})=>{var s,n;if("deleted"===e||"modified"===e)return;if(null==i||i.removeAll(),"aborted"===e)return this.handleDrawCancel();const a=null===(n=null===(s=this.sceneView)||void 0===s?void 0:s.camera)||void 0===n?void 0:n.clone().toJSON(),o=new d.c({graphics:null,isPicked:!1});this.drawingMode===I.Point&&(t.geometry.z&&(t.geometry.z=0),o.setGraphics(this.doDrawPoint(t)),this.props.onDrawFinish({graphicsInfo:o,cameraInfo:a,drawingMode:this.drawingMode}),this._drawingModeChange(I.Null)),this.drawingMode===I.Line&&(o.setGraphics(this.doDrawLine(t)),this.props.onDrawFinish({graphicsInfo:o,cameraInfo:a,drawingMode:this.drawingMode}),this._drawingModeChange(I.Null))},this.getGraphicsByAttrId=e=>{let t=[];const i=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(t=>t.attributes.id===e);return i.length>0?(t.push(i[0]),t=t.concat(this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.id===e)),t):this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.id===e)},this._removeGraphicsByAttrId=e=>{let t=this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.id===e.attributes.id);t.length>0&&this.props.layersGroup.layerRelativeToGround.removeMany(t),t=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(t=>t.attributes.id===e.attributes.id),t.length>0&&this.props.layersGroup.layerOnTheGround.removeMany(t)},this.setGeoZ=(e,t)=>{e.geometry.z=t},this.doDrawPoint=e=>{const t=e.clone();return this._removeGraphicsByAttrId(e),t.layer=this.props.layersGroup.layerRelativeToGround,this.props.layersGroup.layerRelativeToGround.addMany([t]),[t]},this.doDrawLine=e=>{const t=e.clone();this._removeGraphicsByAttrId(e),t.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([t]);const i=this.genStartEndPoint(t);this.props.layersGroup.layerRelativeToGround.addMany(i);let s=[];return s.push(t),s=s.concat(i),s},this.genStartEndPoint=e=>{const t=e.geometry.paths[0];return[this.genExtraPoint(t[0],e,this.materials.startPtMarker),this.genExtraPoint(t[t.length-1],e,this.materials.endPtMarker)]},this.genExtraPoint=(e,t,i)=>{let s=e;return"local"===this.sceneView.viewingMode?s=new this.Point({x:s[0],y:s[1],z:0,spatialReference:this.sceneView.spatialReference}):(s=this.webMercatorUtils.xyToLngLat(s[0],s[1]),s=new this.Point({x:s[0],y:s[1],z:s[2]})),s=new this.Graphic({geometry:s,symbol:i,layer:this.props.layersGroup.layerRelativeToGround,attributes:{id:t.attributes.id}}),s},this.updateLineByAltitude=(e,t)=>{var i;const s=0===t,n=this.getGraphicsByAttrId(e.attributes.id),a=n[0].clone(),o=n[1].clone(),r=n[2].clone();if(this._removeGraphicsByAttrId(a),s)a.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([a]);else{a.layer=this.props.layersGroup.layerRelativeToGround;const e=a.geometry;e.hasZ=!0,c.p(null===(i=e.paths)||void 0===i?void 0:i.length)&&(e.paths.map(e=>{e.map(e=>{e[2]=t})}),this.props.layersGroup.layerRelativeToGround.addMany([a]))}return o.layer=this.props.layersGroup.layerRelativeToGround,r.layer=this.props.layersGroup.layerRelativeToGround,this.setGeoZ(o,t),this.setGeoZ(r,t),this.props.layersGroup.layerRelativeToGround.addMany([o,r]),[a,o,r]},this.startDrawing=e=>{var t,i,s,n;"function"==typeof(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.cancel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel()),I.Point===e&&(this.jimuDrawToolsRef.sketch.viewModel.pointSymbol=this.defaultSymbols.getDefaultPointSymbol([54,213,22]),null===(s=this.jimuDrawToolsRef)||void 0===s||s.sketch.create(e)),I.Line===e&&(this.jimuDrawToolsRef.sketch.viewModel.polylineSymbol=this.defaultSymbols.getDefaultLineSymbol([13,137,255]),null===(n=this.jimuDrawToolsRef)||void 0===n||n.sketch.create(e))},this.cancelDrawing=()=>{var e,t,i;this.handleDrawCancel(),"function"==typeof(null===(e=this.jimuDrawToolsRef)||void 0===e?void 0:e.sketch.cancel)&&c.p(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.viewModel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel())},this.createOrUpdateGraphic=(e,t,i)=>{var s,n;e.geometry.paths?e.symbol=this.materials.lineSymbol.toJSON():e.symbol=this.materials.startPtMarker.toJSON();const a="function"==typeof e.clone?e.clone():this.Graphic.fromJSON(e);if("point"===a.geometry.type)return this.doDrawPoint(a);if("polyline"===a.geometry.type){i&&((null===(s=a.layer)||void 0===s?void 0:s.id)===this.props.layersGroup.layerRelativeToGround.id&&(null===(n=a.layer)||void 0===n?void 0:n.id)===this.props.layersGroup.layerOnTheGround.id||(a.geometry=c.r(a.geometry,this.sceneView)));let e=this.doDrawLine(a);return c.p(null==t?void 0:t.fixAltitude)&&!isNaN(null==t?void 0:t.fixAltitude)&&(e=this.updateLineByAltitude(a,null==t?void 0:t.fixAltitude)),e}},this.removeGraphics=e=>{c.p(e)&&(this.props.layersGroup.layerRelativeToGround.removeMany(e),this.props.layersGroup.layerOnTheGround.removeMany(e))},this.removeAll=()=>{var e,t;null===(e=this.props.layersGroup.layerRelativeToGround)||void 0===e||e.removeAll(),null===(t=this.props.layersGroup.layerOnTheGround)||void 0===t||t.removeAll()},this.drawPickedLineStartEndPoints=e=>this.doDrawLine(e),this.removePickedLineStartEndPoints=e=>{this._removeGraphicsByAttrId(e)},this.state={apiLoaded:!1},this.drawingMode=I.Null}componentDidMount(){var e;this.state.apiLoaded||Object(o.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Geometry","esri/geometry/Point","esri/geometry/support/webMercatorUtils"]).then(e=>p(this,void 0,void 0,(function*(){[this.Graphic,this.Geometry,this.Point,this.webMercatorUtils]=e,this.defaultSymbols=yield(new d.b).setup(),this.materials={markerColor:[13,137,255],markerSize:10,outlineColor:"[128, 128, 128, 0.8]",startPtMarker:this.defaultSymbols.getDefaultPointSymbol([54,213,22]),endPtMarker:this.defaultSymbols.getDefaultPointSymbol([255,65,89]),lineColor:[13,137,255,.5],lineSymbol:this.defaultSymbols.getDefaultLineSymbol([13,137,255])},this.setState({apiLoaded:!0})}))),this.sceneView=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view}componentDidUpdate(e,t){var i;this.props.jimuMapView!==e.jimuMapView&&(this.removeAll(),this.sceneView=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)}render(){return this.state.apiLoaded&&this.props.jimuMapView&&this.props.layersGroup.layerOnTheGround&&this.props.layersGroup.layerRelativeToGround&&Object(n.jsx)("div",{style:{display:"none"}},Object(n.jsx)(h.Draw,{jimuMapView:this.props.jimuMapView,onDrawToolCreated:this.handleDrawToolCreated,onDrawToolsActived:this.handleDrawToolsActived,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawCancel:this.handleDrawCancel,onGraphicEdited:this.handleDrawFinish,creationMode:"update",isActive:!1,disableSymbolSelector:!0,updateOnGraphicClick:!1,defaultCreateOptions:{hasZ:!0},defaultUpdateOptions:{enableZ:!1}}))}}var g=i(41);class m extends n.React.PureComponent{constructor(e){super(e),this.onPickBtnClick=()=>{this.props.onPickingStateCahnged(!this.props.isPicking)},this.insertAttrId=e=>(c.p(e)&&(c.p(e.attributes)||(e.attributes={}),c.p(e.attributes.id)||(e.attributes.id=n.utils.getUUID())),e),this.pointerMoveHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then(e=>{const t=null==e?void 0:e.results;if((null==t?void 0:t.length)>0){const e=t[0].graphic;this.props.onHoverPicking([e])}}))},this.pointerClickHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then(t=>this.clickGraphicsByPick(t,e)))},this.clickGraphicsByPick=(e,t)=>{var i,s;this.props.onPickingStateCahnged(!1);const n=(null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view).camera.clone().toJSON(),a=e.results;if((null==a?void 0:a.length)>0){t.stopPropagation();let e=a[0].graphic;e=this.insertAttrId(e);const i=e.geometry;if("polyline"===i.type)this.pickAndClickLine(e,n);else if("point"===i.type){let t;i.hasZ||(t=c.r(i,null===(s=this.props.jimuMapView)||void 0===s?void 0:s.view)),this.pickAndClickPoint(e,n,t)}}},this.pickAndClickPoint=(e,t,i)=>{const s=new d.c({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:s,cameraInfo:t,hitPointWithZ:i,pickMode:"point"})},this.pickAndClickLine=(e,t)=>{const i=new d.c({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:i,cameraInfo:t,hitPointWithZ:null,pickMode:"polyline"})},this.state={isPicking:!1},this._clearEvents(),this._resetEvents()}componentWillUnmount(){this._clearEvents()}_clearEvents(){c.p(this.pointerMoveEvent)&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),c.p(this.pointerDownEvent)&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null)}_resetEvents(){var e,t;this.pointerMoveEvent=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.on("pointer-move",this.pointerMoveHandler),this.pointerDownEvent=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.on("pointer-down",this.pointerClickHandler)}componentDidUpdate(e){this.props.jimuMapView!==e.jimuMapView&&(this._clearEvents(),this._resetEvents())}render(){const e=i(125),t=!this.props.isDrawHelperLoaded||this.props.isPlaying,s=this.props.intl.formatMessage({id:"triggerSelectFeature",defaultMessage:g.a.triggerSelectFeature});return Object(n.jsx)(a.Button,{icon:!0,onClick:e=>this.onPickBtnClick(),active:this.props.isPicking,disabled:t,title:s,className:"btns pick-btn",type:"tertiary"},Object(n.jsx)(a.Icon,{icon:e}))}}var v=i(8);class f extends n.React.PureComponent{constructor(e){super(e),this._resetHightlightCache=()=>{this.highlightCache={hover:{graphic:null,hanlder:null},selected:{graphics:null,hanlder:null}}},this.removeHoverHightlightCache=()=>{c.p(this.highlightCache.hover.hanlder)&&this.highlightCache.hover.hanlder.remove(),this.highlightCache.hover.graphic=null,this.highlightCache.hover.hanlder=null},this.cacheHoverHightlight=(e,t)=>{this.highlightCache.hover.graphic=t,this.highlightCache.hover.hanlder=e},this.removeSelectedHightlightCache=()=>{c.p(this.highlightCache.selected.hanlder)&&this.highlightCache.selected.hanlder.remove(),this.highlightCache.selected.graphics=null,this.highlightCache.selected.hanlder=null},this.cacheSelectedHightlight=(e,t)=>{this.highlightCache.selected.graphics=t,this.highlightCache.selected.hanlder=e},this.highlightGraphicsByHover=e=>{var t,i;const s=c.p(e)?e[0]:null;if(null===s)return;const n=null===(t=null==s?void 0:s.geometry)||void 0===t?void 0:t.type;("polyline"===n&&this.props.flyStyle===v.a.Path||"point"===n&&this.props.flyStyle===v.a.Rotate)&&(null===(i=this.props.jimuMapView)||void 0===i||i.view.whenLayerView(s.layer).then(e=>{const t=e;this.cacheHoverHightlight(t.highlight(s),s)}))},this.highlightGraphicsBySelect=e=>{var t;const i=c.p(e)?e[0]:null;null!==i&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.whenLayerView(i.layer).then(t=>{const s=t.highlight(i);this.cacheSelectedHightlight(s,e)}))},this.clear=()=>{this.removeHoverHightlightCache(),this.removeSelectedHightlightCache()},this._resetHightlightCache()}componentDidUpdate(e){this.props.hoverPickingGraphics!==e.hoverPickingGraphics&&(this.removeHoverHightlightCache(),this.highlightGraphicsByHover(this.props.hoverPickingGraphics)),this.props.selectedPickingGraphics!==e.selectedPickingGraphics&&(this.removeSelectedHightlightCache(),this.highlightGraphicsBySelect(this.props.selectedPickingGraphics))}componentWillUnmount(){this.clear(),this._resetHightlightCache()}render(){return null}}class y extends n.React.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.props.onPopupHelperCreated(this)},this.componentWillUnmount=()=>{this.restoreMapPopupHightlightState()},this.clearCacheMapState=()=>{this.mapPopupState={popup:null,hightLight:null}},this.enablePopupAndHighlight=()=>{const e=this.props.jimuMapView;c.p(e)&&(e.startEdit(),e.enablePopup(),e.enableHighlight(),e.exitEdit())},this.disablePopupAndHighlight=()=>{const e=this.props.jimuMapView;c.p(e)&&(e.startEdit(),e.disablePopup(),e.disableHighlight(),e.exitEdit())},this.cacheMapPopupHightlightState=()=>{var e,t;this.mapPopupState.popup=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.getIsEnablePopup(),this.mapPopupState.hightLight=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.getIsEnableHighlight()},this.restoreMapPopupHightlightState=()=>{const e=this.props.jimuMapView;if(c.p(e)){let t=!1;e.startEdit();const i=this.mapPopupState.popup;i?(e.enablePopup(),t=!0):i||(e.disablePopup(),t=!0);const s=this.mapPopupState.hightLight;s?(e.enableHighlight(),t=!0):s||(e.disableHighlight(),t=!0),t&&this.clearCacheMapState(),e.exitEdit()}},this.mapPopupState={popup:null,hightLight:null},this.clearCacheMapState()}render(){return null}}class w extends n.React.PureComponent{constructor(e){super(e),this.TRANSPARENT_GIF="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}render(){const e={borderRadius:"50%",border:"none",backgroundColor:this.props.theme.colors.palette.light[600]};return Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)(a.Button,{icon:!0,type:"tertiary",className:"btns "+this.props.className,disabled:!0},Object(n.jsx)(a.Icon,{icon:this.TRANSPARENT_GIF,style:e})))}}var I,C,b=function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))};!function(e){e.Null="null",e.Point="point",e.Line="polyline"}(I||(I={})),function(e){e.Point="point",e.Line="polyline",e.Pick="pick",e.Clear="clear"}(C||(C={}));class M extends n.React.PureComponent{constructor(e){super(e),this._isInCludeShowItem=e=>this.props.showItems.includes(e),this.handleDrawHelperCreated=e=>{this.drawHelperRef=e,this.setState({isDrawHelperLoaded:!0}),this.props.onRef(this)},this.handleDrawingModeChanged=e=>{I.Null!==e&&this.setState({isPicking:!1}),this.setState({drawingMode:e}),"function"==typeof this.props.onDrawingModeChanged&&this.props.onDrawingModeChanged(e)},this.getDrawBtnContent=()=>{const e=this._isInCludeShowItem(C.Point),t=this._isInCludeShowItem(C.Line),s=i(126),o=i(97),r=!!this.props.isDisabled||(this.props.isPlaying||!this.state.isDrawHelperLoaded),l=this.props.intl.formatMessage({id:"triggerDrawPoint",defaultMessage:g.a.triggerDrawPoint}),h=this.props.intl.formatMessage({id:"triggerDrawPath",defaultMessage:g.a.triggerDrawPath}),d=this.props.flyStyle;return Object(n.jsx)(n.React.Fragment,null,e&&(d===v.a.Rotate||null===d)&&Object(n.jsx)(a.Button,{icon:!0,active:I.Point===this.state.drawingMode,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>this.onDrawBtnClick(I.Point,{isTriggerCancel:!0}),disabled:r,title:l},Object(n.jsx)(a.Icon,{icon:s})),t&&(d===v.a.Path||null===d)&&Object(n.jsx)(a.Button,{icon:!0,active:I.Line===this.state.drawingMode,className:"oper-btns btns draw-btn",type:"tertiary",css:this.getBtnStyleForBuilder(),onClick:()=>this.onDrawBtnClick(I.Line,{isTriggerCancel:!0}),disabled:r,title:h},Object(n.jsx)(a.Icon,{icon:o})))},this.onDrawBtnClick=(e,t)=>{var i,s;(null==t?void 0:t.isTriggerCancel)&&(null===(i=this.drawHelperRef)||void 0===i||i.cancelDrawing());e===this.state.drawingMode||I.Point!==e&&I.Line!==e||null===(s=this.drawHelperRef)||void 0===s||s.startDrawing(e)},this.handleDrawStart=()=>{this.beforInteract()},this.handleDrawEnd=()=>{},this.handleDrawFinish=e=>{var t;null!==this.state.selectedPickingGraphics&&(null===(t=this.drawHelperRef)||void 0===t||t.removePickedLineStartEndPoints(this.state.selectedPickingGraphics[0])),this.props.onDrawFinish(e,!1),this.highlightGraphics(e.graphicsInfo.getGraphics()),this.focusGraphics(e.graphicsInfo.getGraphics()),this.afterInteract()},this.handleDrawCancel=()=>{this.afterInteract(),"function"==typeof this.props.onDrawCancel&&this.props.onDrawCancel()},this.getPickBtnContent=()=>Object(n.jsx)(m,{jimuMapView:this.props.jimuMapView,intl:this.props.intl,isPlaying:this.props.isPlaying,isDrawHelperLoaded:this.state.isDrawHelperLoaded,drawingMode:this.state.drawingMode,isPicking:this.state.isPicking,onPicked:this.handlePicked,onPickingStateCahnged:this.handlePickingStateCahnged,onHoverPicking:this.handleHoverPicking,hoveredGraphic:this.state.hoveredGraphic}),this.handleHoverPicking=e=>{this.setState({hoverPickingGraphics:e})},this.handlePickingStateCahnged=e=>{e?this.drawHelperRef.cancelDrawing():e||this.setState({hoverPickingGraphics:null}),this.setState({isPicking:e})},this.handlePicked=e=>{if(!this.validPickingByType(e))return;this.clearAll();let t=e.graphicsInfo.getGraphics();const i=t[0];setTimeout(()=>{if("polyline"===i.geometry.type){const e=this.drawHelperRef.drawPickedLineStartEndPoints(i);t=[i,e[1],e[2]]}this.highlightGraphics(t),this.focusGraphics(t),this.props.onPickHanlder(e)},10)},this.validPickingByType=e=>{let t=!1;return(this.props.flyStyle===v.a.Rotate&&"point"===e.pickMode||this.props.flyStyle===v.a.Path&&"polyline"===e.pickMode)&&(t=!0),t},this.highlight=e=>{null===e?this.clearHighlightGraphics():(this.highlightGraphics(e),this.focusGraphics(e))},this.clearHighlightGraphics=()=>{this.setState({selectedPickingGraphics:null}),this.setState({hoverPickingGraphics:null})},this.highlightGraphics=e=>{this.setState({selectedPickingGraphics:e})},this.getClearBtnContent=()=>{const e=i(127),t=this.props.intl.formatMessage({id:"triggerClear",defaultMessage:g.a.triggerClear}),s=this.props.isPlaying||null===this.props.focusedGraphic;return Object(n.jsx)(a.Button,{icon:!0,onClick:this.handleClearBtnClick,disabled:s,title:t,className:"btns clear-btn",type:"tertiary"},Object(n.jsx)(a.Icon,{icon:e}))},this.focusGraphics=e=>{this.props.onFocusedGraphicChanged(null);const t=null===e?null:e[0];this.props.onFocusedGraphicChanged(t)},this.handlePopupHelperCreated=e=>{this.popupHelperRef=e},this.beforInteract=()=>{var e,t;null===(e=this.popupHelperRef)||void 0===e||e.cacheMapPopupHightlightState(),null===(t=this.popupHelperRef)||void 0===t||t.disablePopupAndHighlight()},this.afterInteract=()=>{setTimeout(()=>{this.restoreMapPopupHightlightState()},10)},this.restoreMapPopupHightlightState=()=>{var e;null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHightlightState()},this.handleClearBtnClick=()=>{this.clearAll(),this.focusGraphics(null),this.props.onClearBtnClick()},this.clearAll=()=>{var e,t;this.highlight(null),null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHightlightState(),null===(t=this.drawHelperRef)||void 0===t||t.removeAll()},this.onRenderStateChange=e=>{void 0!==(null==e?void 0:e.drawingMode)&&(this.handleDrawingModeChanged(e.drawingMode),this.onDrawBtnClick(e.drawingMode,{isTriggerCancel:!1})),null==e||e.isPicking},this.drawOrUpdateGraphics=e=>{var t;const i=e.storedGraphicsInfo.rawData,s=i.graphics[0],n=i.isPicked,a=null===(t=e.controllerConfig)||void 0===t?void 0:t.liveviewSettingState;let o;if(n){const e=s;o="polyline"===e.geometry.type||Object(c.p)(e.geometry.paths)?this.drawHelperRef.createOrUpdateGraphic(e,a,n):i.graphics}else o=this.drawHelperRef.createOrUpdateGraphic(s,a,n);return new d.c({graphics:o,isPicked:n})},this.removeGraphics=e=>{var t;null===(t=this.drawHelperRef)||void 0===t||t.removeGraphics(e)},this.removeAllGraphics=()=>{this.drawLayersGroup.removeAllGraphics()},this.query=()=>null,this.state={apiLoaded:!1,layersGroup:{layerRelativeToGround:null,layerOnTheGround:null},isDrawHelperLoaded:!1,drawingMode:I.Null,isPicking:!1,hoveredGraphic:null,hoverPickingGraphics:null,selectedPickingGraphics:null}}componentDidMount(){return b(this,void 0,void 0,(function*(){this.state.apiLoaded||(this.drawLayersGroup=yield(new l).setup(this.props.jimuMapView,this.props.widgetId),this.setState({apiLoaded:!0}),this.setState({layersGroup:this.drawLayersGroup.layersGroup}))}))}componentWillUnmount(){this.drawLayersGroup&&(this.drawLayersGroup=null),this.props.onRef(null)}componentDidUpdate(e,t){var i,s;this.props.jimuMapView!==e.jimuMapView&&(this.setState({hoverPickingGraphics:null}),this.setState({selectedPickingGraphics:null}),null===(i=this.drawLayersGroup)||void 0===i||i.resetJimuMapView(this.props.jimuMapView),null===(s=this.drawLayersGroup)||void 0===s||s.resetGraphicsLayers(),this.state.apiLoaded&&this.setState({layersGroup:this.drawLayersGroup.layersGroup}))}render(){let e=null;return e=Object(n.jsx)("div",null,Object(n.jsx)(n.React.Fragment,null,(!this.state.apiLoaded||!this.state.isDrawHelperLoaded||this.props.isDisabled)&&Object(n.jsx)(n.React.Fragment,null,this._isInCludeShowItem(C.Point)&&Object(n.jsx)(w,{theme:this.props.theme,className:"draw-btn"}),this._isInCludeShowItem(C.Pick)&&Object(n.jsx)(w,{theme:this.props.theme,className:"pick-btn"}),this._isInCludeShowItem(C.Line)&&Object(n.jsx)(w,{theme:this.props.theme,className:"clear-btn"})),this.state.apiLoaded&&this.state.isDrawHelperLoaded&&!this.props.isDisabled&&Object(n.jsx)(n.React.Fragment,null,this.getDrawBtnContent(),this._isInCludeShowItem(C.Pick)&&this.getPickBtnContent(),this._isInCludeShowItem(C.Clear)&&this.getClearBtnContent()),Object(n.jsx)(u,{jimuMapView:this.props.jimuMapView,onDrawHelperCreated:this.handleDrawHelperCreated,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawFinish:this.handleDrawFinish,onDrawCancel:this.handleDrawCancel,layersGroup:this.state.layersGroup}),Object(n.jsx)(f,{jimuMapView:this.props.jimuMapView,flyStyle:this.props.flyStyle,hoverPickingGraphics:this.state.hoverPickingGraphics,selectedPickingGraphics:this.state.selectedPickingGraphics}),Object(n.jsx)(y,{jimuMapView:this.props.jimuMapView,onPopupHelperCreated:this.handlePopupHelperCreated}))),e}getBtnStyleForBuilder(){var e,t,i;const s=null===(e=this.props.theme)||void 0===e?void 0:e.arcgis,a=null===(t=null==s?void 0:s.components)||void 0===t?void 0:t.button,{default:o}=null!==(i=null==a?void 0:a.variants)&&void 0!==i?i:{},r=null==o?void 0:o.active;return n.css`
      &.btns.active {
        color: ${r.color} !important;
        background-color: ${r.bg} !important;
        border-radius: ${r.borderRadius} !important;
        box-shadow: ${r.shadow} !important;
      }
    `}}},51:function(e,t){e.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M7.745 7l4.1 4.1a.527.527 0 01-.745.746L7 7.746l-4.1 4.1a.527.527 0 01-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 01.746-.746l4.1 4.1 4.1-4.1a.527.527 0 01.746.746L7.746 7z" fill="#000"></path><path d="M1 1h12v12H1z"></path></g></svg>'},63:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 3.146a.5.5 0 01.708 0L6 8.5l5.146-5.354a.5.5 0 01.708.708l-5.5 5.707a.5.5 0 01-.708 0l-5.5-5.707a.5.5 0 010-.708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},64:function(e,t){e.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M.146 9.56a.5.5 0 00.708 0L6 4.208l5.146 5.354a.5.5 0 00.708-.708l-5.5-5.707a.5.5 0 00-.708 0l-5.5 5.707a.5.5 0 000 .708z" fill="#000"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h12v12H0z"></path></clipPath></defs></svg>'},69:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14 8a.522.522 0 01-.516.527H3.976L7.473 12.1a.535.535 0 010 .746.508.508 0 01-.73 0L2 8l4.743-4.846a.508.508 0 01.73 0 .535.535 0 010 .746L3.976 7.473h9.508c.285 0 .516.236.516.527z" fill="#000" fill-rule="nonzero"></path></svg>'},75:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2.212 9.936L2 12.27l2.333-.212L13.27 3.12 11.149 1 2.212 9.936zm-.707-.707L10.441.293a1 1 0 011.415 0l2.12 2.121a1 1 0 010 1.414l-8.935 8.937a1 1 0 01-.617.289l-2.333.212a1 1 0 01-1.087-1.087l.212-2.333a1 1 0 01.289-.617zm7.434-6.497l2.829 2.829-.707.707-2.829-2.829.707-.707zM.5 15h15a.5.5 0 010 1H.5a.5.5 0 010-1z" fill="#000" fill-rule="nonzero"></path></svg>'},8:function(e,t,i){"use strict";var s,n,a,o,r;i.d(t,"a",(function(){return s})),i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return r})),function(e){e.Rotate="ROTATE",e.Path="PATH",e.Route="ROUTE"}(s||(s={})),function(e){e.CW="CW",e.CCW="CCW"}(n||(n={})),function(e){e.Smoothed="CURVED",e.RealPath="LINE"}(a||(a={})),function(e){e.Forward="FORWARD",e.Backward="BACKWARD"}(o||(o={})),function(e){e.Horizontal="HORIZONTAL",e.Vertical="VERTICAL",e.Palette="PALETTE"}(r||(r={}))},86:function(e,t){e.exports=l},97:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.582 5L11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2h-1.418z" fill="#363636"></path></svg>'}}))}}}));