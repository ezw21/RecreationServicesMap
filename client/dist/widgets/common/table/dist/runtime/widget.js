System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-layouts/layout-runtime"],(function(e){var t,i,a,o;return{setters:[function(e){t=e},function(e){i=e},function(e){a=e},function(e){o=e}],execute:function(){e(function(e){var t={};function i(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=509)}({0:function(e,i){e.exports=t},1:function(e,t){e.exports=i},122:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M13.444 3.582A7.011 7.011 0 008 1 7.014 7.014 0 001.05 7.03c-.017.122-.031.281-.044.477A.525.525 0 01.481 8 .48.48 0 010 7.492c.01-.195.024-.354.039-.476C.526 3.062 3.904 0 8 0c2.482 0 4.7 1.124 6.172 2.89l.19-1.356a.502.502 0 01.994.138l-.441 3.126-3.03-.425a.5.5 0 01.14-.99l1.419.199zM1.936 13.236l-.163 1.322a.502.502 0 01-.996-.121l.387-3.133 3.036.371a.5.5 0 01-.122.993l-1.463-.179A7.01 7.01 0 008 15a7.014 7.014 0 006.947-6c.019-.128.034-.297.048-.507A.526.526 0 0115.519 8a.48.48 0 01.48.507 7.579 7.579 0 01-.042.505C15.458 12.952 12.087 16 8 16a8.01 8.01 0 01-6.064-2.764z" fill="#000" fill-rule="nonzero"></path></svg>'},146:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 4.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM16 12.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM5.146 2.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057L.146 4.327a.5.5 0 01.708-.707l1.264 1.265 2.323-2.71a.5.5 0 01.705-.055zM5.146 10.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057L.146 12.328a.5.5 0 11.708-.708l1.264 1.265 2.323-2.71a.5.5 0 01.705-.055z" fill="#000"></path></svg>'},147:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.88 2.825a.5.5 0 00-.759-.65l-2.323 2.71-1.264-1.265a.5.5 0 10-.708.707l1.265 1.265a1 1 0 001.466-.056l2.324-2.71zm0 8a.5.5 0 00-.759-.65l-2.323 2.71-1.264-1.265a.5.5 0 00-.708.708l1.265 1.264a1 1 0 001.466-.056l2.324-2.71zM9 4.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zm-.5 8.5a.5.5 0 000-1h-8a.5.5 0 000 1h8z" fill="#000"></path></svg>'},148:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M10 0c.796 0 1.5.47 1.5 1.167V3h4a.5.5 0 010 1H14l-.929 11.077a1 1 0 01-.878.916l-.119.007H3.926a1 1 0 01-.997-.923L2 4H.5a.5.5 0 010-1h4V1.167C4.5.469 5.204 0 6 0h4zm2.997 4H3.003l.923 11h8.148l.923-11zm-2.889 3l.892.87-3.325 3.73L5 8.991l.831-.933 1.783 1.74L10.108 7zM5.5 1v2h5V1c0-.04-5-.04-5 0z" fill="#000" fill-rule="nonzero"></path></svg>'},149:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity=".01" fill="#E3E3E3" d="M0 0h16v16H0z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M.5 1a.5.5 0 000 1h15a.5.5 0 000-1H.5zM0 7.5A.5.5 0 01.5 7h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5zm0 6a.5.5 0 01.5-.5h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5z" fill="#000"></path></svg>'},4:function(e,t){e.exports=a},415:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 0H0v1h16V0zM8 6c2.583 0 5.166 1.45 7.75 4.349a.972.972 0 010 1.302C13.166 14.551 10.583 16 8 16S2.834 14.55.25 11.651a.972.972 0 010-1.302C2.834 7.449 5.417 6 8 6zm0 1c-2.237 0-4.558 1.303-6.961 4C3.442 13.697 5.763 15 8 15s4.558-1.303 6.961-4C12.558 8.303 10.237 7 8 7zm-3 4a3 3 0 106 0 3 3 0 00-6 0zm3 2a2 2 0 100-4 2 2 0 000 4zM0 3h13v1H0V3zm3 3H0v1h3V6z" fill="#000"></path></svg>'},416:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M0 0h400v40H0z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M80 55H20v9h60v-9zm100 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 135h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 215h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 295h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 95h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 175h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 255h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 334h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9zM20 374h60v9H20v-9zm160 0h-60v9h60v-9zm40 0h60v9h-60v-9zm160 0h-60v9h60v-9z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M0 39h1v40h98V39h1v40h99V39h1v40h99V39h1v40h99V39h1v360h-1v-40h-99v40h99v1H0V39zm1 320v40h98v-40H1zm98-1H1v-39h98v39zm1 1v40h99v-40h-99zm99-1h-99v-39h99v39zm1 1v40h99v-40h-99zm99-1h-99v-39h99v39zm1 0h99v-39h-99v39zM1 318v-38h98v38H1zm99 0v-38h99v38h-99zm0-39h99v-39h-99v39zm100 39v-38h99v38h-99zm0-39h99v-39h-99v39zm100 39v-38h99v38h-99zm0-39h99v-39h-99v39zM1 279h98v-39H1v39zm0-79v39h98v-39H1zm98-1H1v-39h98v39zm1 1v39h99v-39h-99zm99-1h-99v-39h99v39zm1 1v39h99v-39h-99zm99-1h-99v-39h99v39zm1 1v39h99v-39h-99zm99-1h-99v-39h99v39zM1 159v-39h98v39H1zm99 0v-39h99v39h-99zm0-40h99V80h-99v39zm100 40v-39h99v39h-99zm0-40h99V80h-99v39zm100 40v-39h99v39h-99zm0-40h99V80h-99v39zM1 119h98V80H1v39z" fill="#000"></path></svg>'},417:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 4.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM16 12.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM5.146 2.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057L.146 4.327a.5.5 0 01.708-.707l1.264 1.265 2.323-2.71a.5.5 0 01.705-.055zM5.146 10.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057L.146 12.328a.5.5 0 11.708-.708l1.264 1.265 2.323-2.71a.5.5 0 01.705-.055z" fill="#C5C5C5"></path></svg>'},418:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)" fill-rule="evenodd" clip-rule="evenodd" fill="#C5C5C5"><path d="M9 4.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM9 12.12a.5.5 0 01-.5.5h-8a.5.5 0 010-1h8a.5.5 0 01.5.5zM15.826 2.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057l-1.265-1.265a.5.5 0 01.707-.707l1.265 1.265 2.323-2.71a.5.5 0 01.705-.055zM15.826 10.12a.5.5 0 01.055.705l-2.324 2.71a1 1 0 01-1.466.057l-1.265-1.264a.5.5 0 01.707-.708l1.265 1.265 2.323-2.71a.5.5 0 01.705-.055z"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},419:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M.5 1a.5.5 0 000 1h15a.5.5 0 000-1H.5zM0 7.5A.5.5 0 01.5 7h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5zm0 6a.5.5 0 01.5-.5h15a.5.5 0 010 1H.5a.5.5 0 01-.5-.5z" fill="#C5C5C5"></path></svg>'},420:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.366 7.841l-.732-.682-3.125 3.349-1.635-1.84-.748.664 2.365 2.66 3.875-4.15z" fill="#C5C5C5"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 3V1.167C4.5.469 5.204 0 6 0h4c.796 0 1.5.47 1.5 1.167V3h4a.5.5 0 010 1H14l-.929 11.077a1 1 0 01-.997.923H3.926a1 1 0 01-.997-.923L2 4H.5a.5.5 0 010-1h4zM3.003 4h9.994l-.923 11H3.926L3.003 4zM10.5 1v2h-5V1c0-.04 5-.04 5 0z" fill="#C5C5C5"></path></svg>'},421:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)" fill="#C5C5C5"><path d="M14.17 2.89l.191-1.357a.501.501 0 11.993.14l-.44 3.125-3.03-.424a.5.5 0 01.139-.99l1.42.198A7.011 7.011 0 007.998 1a7.014 7.014 0 00-6.952 6.03 7.162 7.162 0 00-.043.486A.513.513 0 01.496 8 .492.492 0 010 7.483a7.89 7.89 0 01.037-.467C.524 3.062 3.903 0 7.998 0c2.482 0 4.7 1.124 6.172 2.89zM15.996 8.518A.492.492 0 0015.5 8a.513.513 0 00-.509.484c-.011.183-.027.38-.047.517A7.014 7.014 0 018 15a7.01 7.01 0 01-5.386-2.51l1.463.178a.5.5 0 00.122-.993l-3.036-.37-.386 3.13a.501.501 0 10.995.123l.163-1.322A8.01 8.01 0 007.999 16c4.086 0 7.458-3.047 7.957-6.988.016-.131.03-.317.04-.494z"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h15.997v16H0z"></path></clipPath></defs></svg>'},422:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)" fill="#C5C5C5"><path d="M16 0H0v1h16V0z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M5 11a3 3 0 106 0 3 3 0 00-6 0zm3 2a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 6c2.583 0 5.166 1.45 7.75 4.349a.972.972 0 010 1.302C13.166 14.551 10.583 16 8 16S2.834 14.55.25 11.651a.972.972 0 010-1.302C2.834 7.449 5.417 6 8 6zm0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.697 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7z"></path><path d="M0 3h13v1H0V3zM3 6H0v1h3V6z"></path></g><defs><clipPath id="clip0"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},423:function(e,t){e.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 1h16a1 1 0 011 1v5H1V2a1 1 0 011-1zm11 7H7v3h6V8zm0 4H7v3h6v-3zm1 3v-3h5v3h-5zm-1 1H7v3h6v-3zm1 3h4a1 1 0 001-1v-2h-5v3zm0-8V8h5v3h-5zM1 8h5v3H1V8zm0 4h5v3H1v-3zm0 4h5v3H2a1 1 0 01-1-1v-2zM0 2a2 2 0 012-2h16a2 2 0 012 2v16a2 2 0 01-2 2H2a2 2 0 01-2-2V2z" fill="#000"></path></svg>'},48:function(e,t,i){"use strict";var a,o;i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return o})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(a||(a={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(o||(o={}))},509:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return R}));var a=i(0),o=i(48),s=i(4),l={_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",refresh:"Refresh",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLable:"{layer} table selection"},n=i(1),r=i(7);function d(e,t,i){var o,s,l,n,r,d;const{id:c,enableDataAction:h,isHeightAuto:u,isWidthAuto:v}=i,p="themes/morandi/"===(null===(s=null===(o=Object(a.getAppStore)().getState())||void 0===o?void 0:o.appConfig)||void 0===s?void 0:s.theme);return a.css`
    ${"&.table-widget-"+c} {
      .table-indent{
        width: calc(100% - 32px);
        height: calc(100% - 26px);
        margin: 10px 16px 16px;
        ${u&&"min-height: 240px;"};
        ${v&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          position: absolute;
          right: 17px;
          top: 55px;
          padding-left: 8px;
          border-left: 1px solid ${e.colors.palette.light[200]};
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.colors.palette.light[400]};
        }
        .data-action-btn{
          position: relative;
          top: 1px;
        }
      }
      .tab-flex{
        width: 100%;
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.colors.palette.light[300]};
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tag-list{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tag-list{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tag-list,
      .horizontal-tag-list{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tag-list{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 30px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: 100%;
      }
      .top-button-list{
        margin: 8px 0;
        position: absolute;
        right: 17px;
        top: 47px;
        ${t&&"display: none"};
        .top-button{
          display: inline-flex;
          button{
            width: 32px;
            height: 32px;
          }
        }
      }
      .table-search-div{
        position: absolute;
        left: 21px;
        .table-search{
          .search-icon{
            z-index: 2;
          }
          .search-input{
            border: 1px solid ${e.colors.palette.light[400]};
            border-radius: 2px;
            padding-left: 30px;
            margin-left: -30px;
            .input-wrapper{
              height: 30px;
              border: none;
            }
          }
        }
      }
      .table-con{
        width: 100%;
        height: calc(100% - 46px);
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__title{
          display: none
        }
        .esri-feature-table__menu{
          position: absolute;
          right: ${h?"60px":"11px"};
          top: 51px;
          ${!t&&"display: none"};
          .esri-button-menu{
            button{
              :hover{
                background-color: ${e.darkTheme?p?e.colors.palette.light[800]:e.colors.palette.light[600]:e.colors.palette.light[100]};
              }
              background-color: ${e.darkTheme?e.colors.palette.light[500]:e.colors.white};
              color: ${e.colors.black};
              border-radius: ${p?"50%":"2px"};
              border: 1px solid ${e.darkTheme?e.colors.palette.light[500]:e.colors.palette.light[400]};
            }
          }
        }
        .esri-column__sorter{
          overflow-x: hidden;
        }
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .placeholder-table-con{
        height: calc(100% - 85px);
        width: 100%;
        position: relative;
        top: 40px;
        .jimu-widget-placeholder{
          width: 100%;
        }
        .placeholder-alert-con{
          position: absolute;
          right: 10px;
          bottom: 10px;
        }
      }
      .placeholder-reset-con{
        height: calc(100% - 114px);
        width: calc(100% - 32px);
        position: absolute;
        top: 95px;
        z-index: 1001;
        .placeholder-reset-button{
          position: absolute;
          top: calc(50% + 42px);
          left: 50%;
          transform: translateX(-50%) translateY(-50%);
        }
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
      .refresh-loading-con {
        right: 0;
        bottom: 1px;
        height: ${a.polished.rem(24)};
        .auto-refresh-loading {
          background: ${a.polished.rgba(null===(r=null===(n=null===(l=e.colors)||void 0===l?void 0:l.palette)||void 0===n?void 0:n.dark)||void 0===r?void 0:r[100],.2)};
          color: ${null===(d=e.colors)||void 0===d?void 0:d.black};
          font-size: ${a.polished.rem(12)};
          line-height: ${a.polished.rem(24)};
          padding: 0 ${a.polished.rem(7)};
        }
      }
    }
  `}var c=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};function h(e,t){return c(this,void 0,void 0,(function*(){return t&&t.type===a.DataSourceTypes.FeatureLayer?yield t.query(e).then(e=>c(this,void 0,void 0,(function*(){return yield function(e,t){return c(this,void 0,void 0,(function*(){return yield Promise.resolve((null==t?void 0:t.records)||[])}))}(0,e)}))):yield Promise.resolve([])}))}function u(e,t){if(!t)return e;const i=new RegExp(`(${t})`,"gi");return e.replace(i,"<strong >$1</strong>")}function v(e,t,i){var o;return c(this,void 0,void 0,(function*(){const s={page:1,pageSize:10},l=t.searchFields.split(",");if(t.enableSearch&&t.searchFields){const l=null===(o=function(e,t,i){const o=a.dataSourceUtils.isHostedService(i.url),s=t.searchFields.split(",");if(t.enableSearch&&t.searchFields){const t={sql:"1=1",displaySQL:"",logicalOperator:"OR",parts:s.map(t=>({type:"SINGLE",jimuFieldName:t,operator:"STRING_OPERATOR_CONTAINS",valueOptions:{isValid:!0,sourceType:"USER_INPUT",inputEditor:"TEXT_BOX",value:Object(a.Immutable)([{value:e,label:t}])},displayType:"NONE",caseSensitive:o}))};return a.dataSourceUtils.getArcGISSQL(t,i)}}(e,t,i))||void 0===o?void 0:o.sql;s.where=l}const n=new RegExp(`(${e})`,"gi");return h(s,i).then(t=>c(this,void 0,void 0,(function*(){let i=[];return l.forEach(a=>{t.forEach(t=>{var o;const s=null===(o=null==t?void 0:t.feature)||void 0===o?void 0:o.attributes[a];if(s&&!i.includes(s)&&s.match(n)){const t={suggestionHtml:u(s,e),suggestion:s};i.push(t)}})}),i=function(e,t){for(var i=e[0]?[e[0]]:[],a=1;a<e.length;a++){for(var o=e[a],s=!1,l=0;l<i.length;l++)if(o[t]==i[l][t]){s=!0;break}s||i.push(o)}return i}(i,"suggestion"),Promise.resolve(i)})))}))}var p=function(e,t,i,a){return new(i||(i=Promise))((function(o,s){function l(e){try{r(a.next(e))}catch(e){s(e)}}function n(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,n)}r((a=a.apply(e,t||[])).next())}))};const{BREAK_POINTS:g,SELECTION_DATA_VIEW_ID:b,DATA_VIEW_ID_FOR_NO_SELECTION:m}=a.CONSTANTS,f=i(146),S=i(147),w=i(149),x=i(148),y=i(122),j=i(415),T=i(66),C=i(416),z=i(417),I=i(418),O=i(419),M=i(420),A=i(421),D=i(422),F=[a.DataSourceStatus.NotReady,a.DataSourceStatus.LoadError],L=new(0,a.esri.Sanitizer);class R extends a.React.PureComponent{constructor(e){super(e),this.FeatureTable=null,this.FeatureLayer=null,this.getFieldsFromDatasource=()=>{var e;const{config:t}=this.props,{layersConfig:i}=t,{activeTabId:a}=this.state,o=this.getDataActionTable(),s=i.asMutable({deep:!0}).concat(o).find(e=>e.id===a),l=this.dsManager.getDataSource(null===(e=s.useDataSource)||void 0===e?void 0:e.dataSourceId),n=null==l?void 0:l.getSchema(),r=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[],d=["CreationDate","Creator","EditDate","Editor","GlobalID"];let c=r.filter(e=>!d.includes(e.jimuName));return(null==c?void 0:c.length)>50&&(c=c.slice(0,50)),{allFields:r,tableFields:c}},this.onToolStyleChange=(e,t)=>{e<g[0]?this.setState({mobileFlag:!0}):this.setState({mobileFlag:!1}),e<220?this.setState({searchToolFlag:!0}):this.setState({searchToolFlag:!1})},this.minusArray=(e,t,i)=>{const a=i||"jimuName",o=e.length>t.length,s=o?t:e;return(o?e:t).filter(e=>!s.some(t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))},this.onDataSourceCreated=e=>{this.setState({dataSource:e});const t=(null==e?void 0:e.dataViewId)===b,i=!!e.getMainDataSource().getDataView(m);t&&i&&this.destoryTable().then(()=>{this.createTable(e)})},this.updateGeometryAndSql=e=>{var t;if(!(null===(t=this.table)||void 0===t?void 0:t.layer))return;const i=null==e?void 0:e.getCurrentQueryParams();this.table.layer.definitionExpression!==(null==i?void 0:i.where)&&(this.table.layer.definitionExpression=null==i?void 0:i.where),a.dataSourceUtils.changeJimuFeatureLayerQueryToJSAPILayerQuery(e,Object(a.Immutable)(i)).then(e=>{var t,i,o;if(!(null==e?void 0:e.geometry))return;const s=e.geometry,l=null===(t=s)||void 0===t?void 0:t.toJSON(),n=null===(o=null===(i=this.table)||void 0===i?void 0:i.filterGeometry)||void 0===o?void 0:o.toJSON();a.lodash.isDeepEqual(n,l)||(this.table.filterGeometry=s)})},this.onDataSourceInfoChange=(e,t)=>{var i,o,s,l;if(!e)return void this.destoryTable().then(()=>{this.setState({emptyTable:!0})});this.dataSourceChange=!0,(null==e?void 0:e.status)===a.DataSourceStatus.Loaded&&(null==t?void 0:t.status)===a.DataSourceStatus.Loaded&&(this.dataSourceChange=!1);let{dataSource:n}=this.state;const{selectQueryFlag:r,activeTabId:d,selfDsChange:c}=this.state,{config:h}=this.props,{layersConfig:u}=h,v=this.getDataActionTable(),p=u.asMutable({deep:!0}).concat(v).find(e=>e.id===d),g=null==p?void 0:p.useDataSource;if(!n&&g||(null==n?void 0:n.id)!==(null==g?void 0:g.dataSourceId)){if(n=this.dsManager.getDataSource(null==g?void 0:g.dataSourceId),!n)return void this.setState({emptyTable:!0})}else if(!n&&!g)return;if(!(null==e?void 0:e.status)||(null==e?void 0:e.status)===a.DataSourceStatus.NotReady)return void this.destoryTable().then(()=>{this.setState({notReady:!0,emptyTable:!0})});this.setState({notReady:!1,emptyTable:!1});const b=this.getLoadingStatus(n,null==e?void 0:e.status),m=(null==n?void 0:n.getAutoRefreshInterval())||0;this.toggleAutoRefreshLoading(n,b,m),this.setState({showLoading:b,interval:m});const f=n&&n.getCurrentQueryParams();!p.dataActionObject&&(null==e?void 0:e.widgetQueries)!==(null==t?void 0:t.widgetQueries)&&this.updateGeometryAndSql(n);const S=null==t?void 0:t.selectedIds,w=null==e?void 0:e.selectedIds,x=null==t?void 0:t.sourceVersion,y=null==e?void 0:e.sourceVersion,j=null==e?void 0:e.gdbVersion,T=null==t?void 0:t.gdbVersion,C=(null===(i=null==p?void 0:p.useDataSource)||void 0===i?void 0:i.dataSourceId)===(null==n?void 0:n.id)&&(null==t?void 0:t.status)===(null==e?void 0:e.status)&&(null==t?void 0:t.instanceStatus)===(null==e?void 0:e.instanceStatus)&&(null==e?void 0:e.widgetQueries)===(null==t?void 0:t.widgetQueries)&&S===w&&x===y&&j===T;if(F.includes(null==e?void 0:e.status)||this.updatingTable||C)return;if(this.setState({selectRecords:null==n?void 0:n.getSelectedRecords()}),T&&j&&j!==T&&this.table)return this.updatingTable=!0,void this.destoryTable().then(()=>{this.createTable()});const z=(null===(o=null==p?void 0:p.useDataSource)||void 0===o?void 0:o.dataSourceId)!==(null==n?void 0:n.id),I=(!(null==t?void 0:t.status)||F.includes(null==t?void 0:t.status))&&e&&!F.includes(null==e?void 0:e.status),O=S!==w&&(0!==(null==S?void 0:S.length)||0!==(null==w?void 0:w.length)),M=(null==e?void 0:e.status)===(null==t?void 0:t.status)&&(null==e?void 0:e.instanceStatus)===(null==t?void 0:t.instanceStatus),A=null===(s=null==n?void 0:n.getDataSourceJson())||void 0===s?void 0:s.isOutputFromWidget,D=!(p.dataActionObject||(null==e?void 0:e.status)!==a.DataSourceStatus.Unloaded||(null==e?void 0:e.instanceStatus)!==a.DataSourceStatus.Created||O||M||A);if(I||z||D||x!==y){if(!this.dataActionCanLoad)return;return this.updatingTable=!0,void this.destoryTable().then(()=>{this.createTable(n)})}p.dataActionObject||S===w||(r?(this.asyncSelectedWhenSelection(w||Object(a.Immutable)([])),setTimeout(()=>{this.asyncSelectedRebuild(n)},500)):c?this.setState({selfDsChange:!1}):setTimeout(()=>{this.asyncSelectedRebuild(n)},500)),!p.dataActionObject&&(null===(l=this.table)||void 0===l?void 0:l.layer)&&S===w&&(this.table.layer.definitionExpression=f.where)},this.onQueryRequired=e=>{var t;const{dataSource:i}=this.state,a=null==i?void 0:i.id;(null===(t=null==e?void 0:e[a])||void 0===t?void 0:t.needRefresh)&&(this.updatingTable=!0,this.destoryTable().then(()=>{this.createTable(i)}))},this.getLayerObjectIdField=()=>{var e,t,i,a;const{dataSource:o}=this.state;return(null===(t=null===(e=this.table)||void 0===e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(a=null===(i=o)||void 0===i?void 0:i.layer)||void 0===a?void 0:a.objectIdField)||"OBJECTID"},this.asyncSelectedWhenSelection=e=>{const{dataSource:t}=this.state,i=this.getLayerObjectIdField(),a=t&&t.getCurrentQueryParams();let o=!0;e.forEach(e=>{e||(o=!1)});const s=e.length>0&&o?`${i} IN (${e.map(e=>e).join()})`:a.where;0===e.length&&this.setState({selectQueryFlag:!1}),this.table&&this.table.layer&&(this.table.layer.definitionExpression=s)},this.getFeatureLayer=(e,t)=>{var i;const{id:o}=this.props,s=e,l=null===(i=null==e?void 0:e.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance;let n;if(t&&t.length>0){const i={objectIds:t.map(e=>parseInt(e)),where:"1=1"};return e.query(i,{scope:a.QueryScope.InAllData}).then(e=>p(this,void 0,void 0,(function*(){const t=yield Promise.resolve(null==e?void 0:e.records);return a.dataSourceUtils.createFeatureLayerByRecords(s,t)})))}{const t=e&&e.getCurrentQueryParams();if(l)return s.load({returnGeometry:!0},{widgetId:o}).then(e=>p(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return a.dataSourceUtils.createFeatureLayerByRecords(s,t)})));if(!this.FeatureLayer)return Promise.resolve(n);if(s.itemId){const e=parseInt(s.layerId),i={portalItem:{id:s.itemId,portal:{url:s.portalUrl}},definitionExpression:t.where,layerId:e||void 0};s.url&&(i.url=s.url),n=new this.FeatureLayer(i)}else{if(!s.url)return s.layer?s.load({returnGeometry:!0},{widgetId:o}).then(e=>p(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return a.dataSourceUtils.createFeatureLayerByRecords(s,t)}))):Promise.resolve(n);n=new this.FeatureLayer({definitionExpression:t.where,url:s.url})}}return l?Promise.resolve(n):n.load().then(()=>p(this,void 0,void 0,(function*(){return yield Promise.resolve(n)})))},this.createTable=e=>{var t,i;const{config:s,id:l}=this.props,{layersConfig:n}=s,{activeTabId:r}=this.state;let{dataSource:d}=this.state;if(!d&&e&&(d=e),(null==d?void 0:d.dataViewId)===b){if(!(null===(t=null==d?void 0:d.getDataSourceJson())||void 0===t?void 0:t.isDataInDataSourceInstance)||0===(null==d?void 0:d.getSourceRecords().length))return this.setState({emptyTable:!0}),this.dataSourceChange=!1,this.dataActionCanLoad=!0,void(this.updatingTable=!1);this.setState({emptyTable:!1})}const c=this.getDataActionTable(),h=n.asMutable({deep:!0}).concat(c).find(e=>e.id===r);if(!h)return;let u;0===document.getElementsByClassName("table-container-"+l).length?(u=document&&document.createElement("div"),u.className="table-container-"+l,this.refs.tableContainer&&this.refs.tableContainer.appendChild(u)):u=document.getElementsByClassName("table-container-"+l)[0];const{allFields:v}=this.getFieldsFromDatasource(),g=this.minusArray(v,h.tableFields).map(e=>e.jimuName),m=h.tableFields.map(e=>({name:e.jimuName,label:e.alias,visible:g.indexOf(e.jimuName)<0}));if(0===(null==m?void 0:m.length))return this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.updatingTable=!1,void this.setState({emptyTable:!1});let f=[];h.enableSelect&&(f=f.concat([{label:this.formatMessage("showSelection"),iconClass:"widget-table-tool-icon-show-selection",clickFunction:()=>{this.onShowSelection()}},{label:this.formatMessage("clearSelection"),iconClass:"widget-table-tool-icon-selection-clear",clickFunction:()=>{this.onSelectionClear()}}])),h.enableRefresh&&f.push({label:this.formatMessage("refresh"),iconClass:"widget-table-tool-icon-refresh",clickFunction:()=>{this.onTableRefresh()}}),f.push({label:this.formatMessage("showHideCols"),iconClass:"widget-table-tool-icon-show-hide-cols",clickFunction:()=>{this.popupShowHideCols()}});const S=h.dataActionObject;let w=void 0;if(S){w=S.dataActionRecordIds;const e=null===(i=h.useDataSource)||void 0===i?void 0:i.dataSourceId;e&&(d=this.dsManager.getDataSource(e))}(()=>{const e=this.currentRequestId+1;this.currentRequestId++,d&&this.getFeatureLayer(d,w).then(t=>p(this,void 0,void 0,(function*(){if(e!==this.currentRequestId)return;if(!t)return;if(!this.FeatureTable)return;let i;if(i=t.layer?t.layer:t,!this.refs.currentEl)return;const s=yield this.getDsAccessibleInfo(null==t?void 0:t.url),n=yield a.privilegeUtils.checkExbAccess(a.privilegeUtils.CheckTarget.Experience).then(e=>{var t;return h.enableEdit&&(null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.canEditFeature)}),r=this.getLayerObjectIdField(),c=h.enableEdit&&(s||n);if(c){const e=null==i?void 0:i.objectIdField;i.on("edits",(function(t){var i,a,o,s;const{addedFeatures:l,updatedFeatures:n,deletedFeatures:c}=t,h=l&&l.length>0,u=n&&n.length>0,v=c&&c.length>0;if(h||u||v){const l=null===(a=null===(i=null==t?void 0:t.edits)||void 0===i?void 0:i.updateFeatures)||void 0===a?void 0:a[0],n=null===(s=null===(o=null==l?void 0:l.attributes)||void 0===o?void 0:o[e||r])||void 0===s?void 0:s.toString(),c=n?d.getRecordById(n):void 0;c&&c.setFeature(l),d.addVersion(),d.addSourceVersion()}}))}const v=d.getGDBVersion();v&&(i.gdbVersion=v),this.table=new this.FeatureTable({layer:i,container:u,visibleElements:{header:!0,menu:!0,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1}},menuConfig:{items:f},fieldConfigs:m,attachmentsEnabled:h.enableAttachements,editingEnabled:c}),S||setTimeout(()=>{this.asyncSelectedRebuild(d)},500);const p=this.table;p.grid.visibleElements.selectionColumn=!1,h.enableSelect&&p.grid.on("row-click",({context:e,native:t})=>{var i,s;this.setState({selfDsChange:!0});const n=e.item.feature;h.selectMode===o.a.Single&&this.table.clearSelection(),e.selected?this.table.deselectRows(n):this.table.selectRows(n);const r=null===(s=null===(i=p.grid)||void 0===i?void 0:i.selectedItems)||void 0===s?void 0:s.toArray(),c=this.getLayerObjectIdField(),u=r&&r.length>0?`${c} IN (${r.map(e=>{var t;return(null===(t=e.feature)||void 0===t?void 0:t.attributes[c])||e.objectId}).join()})`:"1=2";d.query({where:u,returnGeometry:!0}).then(e=>{const t=null==e?void 0:e.records;t&&(a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(l,e.records)),p.layer.queryFeatureCount().then(e=>{0===e?this.setState({emptyData:!0}):this.setState({emptyData:!1})}),t.length>0?d.selectRecordsByIds(t.map(e=>e.getId()),t):d.clearSelection())})}),this.updateGeometryAndSql(d),this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.updatingTable=!1,this.setState({emptyTable:!1})})))})()},this.asyncSelectedRebuild=e=>{var t,i;const a=e&&e.getSelectedRecords();if((null===(t=this.table)||void 0===t?void 0:t.clearSelection)&&this.table.clearSelection(),a&&a.length>0){const e=[];a.forEach(t=>{const i=null==t?void 0:t.getId();i&&e.push(parseInt(i))}),(null===(i=this.table)||void 0===i?void 0:i.selectRows)&&this.table.selectRows(e)}},this.formatMessage=(e,t)=>{const i=Object.assign({},l,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.onTagClick=e=>{const{id:t}=this.props;this.setState({activeTabId:e,selectQueryFlag:!1,tableShowColumns:void 0}),this.props.dispatch(a.appActions.widgetStatePropChange(t,"activeTabId",e))},this.handleTagChange=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,{id:o}=this.props;this.setState({activeTabId:i,selectQueryFlag:!1}),this.props.dispatch(a.appActions.widgetStatePropChange(o,"activeTabId",i))},this.onShowSelection=()=>{const{dataSource:e,selectQueryFlag:t}=this.state;if(t){const t=e&&e.getCurrentQueryParams();this.table.layer.definitionExpression=t.where,this.changeMenuConfig("showSelection")}else{const e=this.table.grid.selectedItems.items;if(0===e.length)return;const t=this.getLayerObjectIdField(),i=`${t} IN (${e.map(e=>{var i;return(null===(i=e.feature)||void 0===i?void 0:i.attributes[t])||e.objectId}).join()})`;this.table.layer.definitionExpression=i,this.changeMenuConfig("showAll")}setTimeout(()=>{this.asyncSelectedRebuild(e)},500),this.setState({selectQueryFlag:!t})},this.resetTable=()=>{var e;const{id:t}=this.props,{selectQueryFlag:i,dataSource:o}=this.state;if(i){if(this.changeMenuConfig("showSelection"),null===(e=this.table)||void 0===e?void 0:e.layer){const e=o&&o.getCurrentQueryParams();this.table.layer.definitionExpression=e.where}this.setState({selectQueryFlag:!1,selfDsChange:!0})}this.setState({searchText:""}),this.table&&this.table.clearSelection(),o.clearSelection(),o.updateQueryParams({where:"1=1"},t),a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(t,[]))},this.onSelectionClear=()=>{this.resetTable()},this.onTableRefresh=()=>{const{dataSource:e}=this.state;this.table&&this.table.refresh(),setTimeout(()=>{this.asyncSelectedRebuild(e)},0)},this.changeMenuConfig=e=>{var t;const i={showSelection:"widget-table-tool-icon-show-selection",showAll:"widget-table-tool-icon-show-all"},a=(null===(t=this.table.menuConfig)||void 0===t?void 0:t.items)||[];a.length>0&&(a[0].label=this.formatMessage(e),a[0].iconClass=i[e]),this.table.menuConfig={items:a}},this.popupShowHideCols=()=>{const e=this.refs.advancedSelect.getElementsByTagName("button")[0];e&&e.click()},this.getQueryOptions=e=>{let t="1=1";const{useDataSources:i}=this.props,{searchText:o,dataSource:s}=this.state,l=i&&i[0];if(!s||!l)return null;const n=a.dataSourceUtils.isHostedService(null==s?void 0:s.url)&&a.dataSourceUtils.containsNonLatinCharacter(o)?"N":"";return s.query?(o&&e.enableSearch&&e.searchFields&&(t=(t||"1=1")+" AND ",t+=`(${e.searchFields.split(",").map(t=>e.searchExact?`LOWER(${t}) = ${n}'${o.trim().toLowerCase()}'`:`LOWER(${t}) LIKE ${n}'%${o.trim().toLowerCase()}%'`).join(" OR ")})`),{where:t}):null},this.handleChange=e=>{e?this.setState({searchText:e,isShowSuggestion:!0},()=>{clearTimeout(this.suggestionsQueryTimeout),this.suggestionsQueryTimeout=setTimeout(()=>{this.getSearchSuggestions(e)},200)}):this.setState({searchText:e},()=>{this.handleSubmit()})},this.getSearchSuggestions=e=>{var t;const{config:i}=this.props,{dataSource:a,activeTabId:o}=this.state;v(e,null===(t=i.layersConfig)||void 0===t?void 0:t.find(e=>e.id===o),a).then(e=>{this.setState({searchSuggestion:e})})},this.handleSubmit=()=>{const{dataSource:e}=this.state,{id:t}=this.props,i=this.props.config.layersConfig.find(e=>e.id===this.state.activeTabId),a=this.getQueryOptions(i);e.updateQueryParams(a,t)},this.onKeyUp=e=>{e&&e.target&&13===e.keyCode&&this.handleSubmit()},this.renderSearchTools=()=>{const{searchText:e,searchToolFlag:t,isOpenSearchPopper:o}=this.state,{theme:s}=this.props;return Object(a.jsx)("div",{className:"table-search-div"},t?Object(a.jsx)("div",{className:"float-right",ref:e=>this.refs.searchPopup=e},Object(a.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:this.formatMessage("search"),onClick:e=>{this.setState({isOpenSearchPopper:!o})}},Object(a.jsx)(n.Icon,{icon:i(91)})),Object(a.jsx)(n.Popper,{placement:"right-start",reference:this.refs.searchPopup,offset:[-10,-30],open:o,showArrow:!1,toggle:e=>{this.setState({isOpenSearchPopper:!o})}},Object(a.jsx)("div",{className:"d-flex align-items-center table-popup-search m-2"},Object(a.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{this.setState({isOpenSearchPopper:!1})},className:"search-back mr-1"},Object(a.jsx)(n.Icon,{icon:i(69),color:s.colors.palette.dark[800]})),Object(a.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>this.handleSubmit(),className:"search-icon"},Object(a.jsx)(n.Icon,{icon:i(91),color:s.colors.palette.light[800]})),Object(a.jsx)(n.TextInput,{className:"popup-search-input",placeholder:this.formatMessage("search"),onChange:e=>this.handleChange(e.target.value),value:e||"",onKeyDown:e=>this.onKeyUp(e)})))):Object(a.jsx)("div",{className:"d-flex align-items-center table-search"},Object(a.jsx)(n.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>this.handleSubmit(),className:"search-icon"},Object(a.jsx)(n.Icon,{icon:i(91),color:s.colors.palette.light[800]})),Object(a.jsx)(n.TextInput,{className:"search-input",placeholder:this.formatMessage("search"),onChange:e=>this.handleChange(e.target.value),value:e||"",onKeyDown:e=>this.onKeyUp(e)})))},this.getInitFields=()=>{const{activeTabId:e}=this.state,{config:t}=this.props,{layersConfig:i}=t,a=this.getDataActionTable(),o=i.asMutable({deep:!0}).concat(a).find(t=>t.id===e),{tableFields:s}=o,l=[];for(const e in s){const t=s[e];l.push({value:t.name,label:t.alias})}return l},this.onValueChangeFromRuntime=e=>{e||(e=[]);const{tableShowColumns:t}=this.state,i=this.getInitFields(),a=t||i,o=e.length>a.length;this.minusArray(a,e,"value").forEach(e=>{o?this.table.showColumn(e.value):this.table.hideColumn(e.value)}),this.setState({tableShowColumns:e})},this.getGlobalTableTools=(e,t)=>{const i=null==e?void 0:e.darkTheme,o=i?t?I:z:t?S:f;return a.css`
      .widget-table-tool-icon-show-selection{
        background: url('data:image/svg+xml;utf8,${encodeURIComponent(o)}') no-repeat center;
        background-size: 100%;
        width: 16px;
        height: 16px;
      }
      .widget-table-tool-icon-show-all{
        background: url('data:image/svg+xml;utf8,${encodeURIComponent(i?O:w)}') no-repeat center;
        background-size: 100%;
        width: 16px;
        height: 16px;
      }
      .widget-table-tool-icon-selection-clear{
        background: url('data:image/svg+xml;utf8,${encodeURIComponent(i?M:x)}') no-repeat center;
        background-size: 100%;
        width: 16px;
        height: 16px;
      }
      .widget-table-tool-icon-refresh{
        background: url('data:image/svg+xml;utf8,${encodeURIComponent(i?A:y)}') no-repeat center;
        background-size: 100%;
        width: 16px;
        height: 16px;
      }
      .widget-table-tool-icon-show-hide-cols{
        background: url('data:image/svg+xml;utf8,${encodeURIComponent(i?D:j)}') no-repeat center;
        background-size: 100%;
        width: 16px;
        height: 16px;
      }
      .esri-button-menu__item .esri-button-menu__item-label{
        padding: 4px 15px !important;
      }
      .table-popup-search{
        .search-icon{
          z-index: 2;
        }
        .popup-search-input{
          border: 1px solid ${e.colors.palette.light[400]};
          border-radius: 2px;
          padding-left: 30px;
          margin-left: -30px;
          .input-wrapper{
            height: 30px;
            border: none;
          }
        }
      }
      .table-action-option{
        width: 100%;
        display: inline-flex;
        flex-direction: row;
        .table-action-option-tab{
          margin: auto 8px;
        }
        .table-action-option-close{
          flex: 1;
          button{
            :hover {
              color: ${e.colors.white};
            }
            float: right;
          }
        }
      }
      .esri-popover--open{
        z-index: 1005 !important;
      }
      .jimu-dropdown-menu{
        z-index: 1006 !important;
      }
    `},this.getDataActionTable=()=>{const{viewInTableObj:e}=this.props,t=[];for(const i in e)t.push(Object.assign({},e[i]));return t},this.onCloseTab=(e,t)=>{const{id:i,viewInTableObj:o}=this.props;t&&t.stopPropagation(),this.removeConfig=!0,this.setState({tableShowColumns:void 0});const s=o;delete s[e],a.MutableStoreManager.getInstance().updateStateValue(i,"viewInTableObj",s)},this.getLoadingStatus=(e,t)=>{const{stateShowLoading:i}=this.props;let o=!1;return(i||window.jimuConfig.isInBuilder||e&&t===a.DataSourceStatus.Loading)&&(o=!0),o},this.setRefreshLoadingString=(e=!1)=>{if(!e)return!1;let t=0;const i=this;clearInterval(this.autoRefreshLoadingTime),this.autoRefreshLoadingTime=setInterval(()=>{t++,i.setState({autoRefreshLoadingString:i.getLoadingString(t)})},6e4)},this.getLoadingString=e=>{let t=this.formatMessage("lastUpdateAFewTime");return e>1&&e<=2?t=this.formatMessage("lastUpdateAMinute"):e>2&&(t=this.formatMessage("lastUpdateTime",{updateTime:e})),t},this.toggleAutoRefreshLoading=(e,t,i)=>{this.resetAutoRefreshTimes(t,i),i>0&&this.setRefreshLoadingString(t)},this.resetAutoRefreshTimes=(e=!1,t)=>{const i=this;clearTimeout(this.resetAutoRefreshTime),t<=0&&clearInterval(this.autoRefreshLoadingTime),this.resetAutoRefreshTime=setTimeout(()=>{e&&t>0&&i.setState({autoRefreshLoadingString:i.formatMessage("lastUpdateAFewTime")}),i.setState({showLoading:e})},0)},this.renderLoading=(e,t)=>{const{autoRefreshLoadingString:i}=this.state;return Object(a.jsx)("div",{className:"position-absolute refresh-loading-con d-flex align-items-center"},e&&Object(a.jsx)("div",{className:"loading-con"}),t>0&&Object(a.jsx)("div",{className:"flex-grow-1 auto-refresh-loading"},i))},this.onSuggestionConfirm=e=>{this.setState({searchText:e,isShowSuggestion:!1},()=>{this.handleSubmit()})},this.clearMessageAction=()=>{a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(this.props.id,[])),this.setState({emptyData:!1})},this.state={apiLoaded:!1,dataSource:void 0,activeTabId:void 0,downloadOpen:!1,searchText:"",selectQueryFlag:!1,mobileFlag:!1,searchToolFlag:!1,tableShowColumns:void 0,isOpenSearchPopper:!1,emptyTable:!1,emptyData:!1,selectRecords:[],notReady:!1,selfDsChange:!1,advancedField:void 0,advancedTableField:[],showLoading:!1,interval:0,autoRefreshLoadingString:"",isShowSuggestion:!1,searchSuggestion:[]},this.dataSourceChange=!1,this.dataActionCanLoad=!0,this.updatingTable=!1,this.removeConfig=!1,this.currentRequestId=0,this.debounceOnResize=a.lodash.debounce((e,t)=>this.onToolStyleChange(e,t),200),this.dsManager=a.DataSourceManager.getInstance()}static getDerivedStateFromProps(e,t){var i;const{config:a}=e,{layersConfig:o}=a,{activeTabId:s}=t,l=new R(e).getDataActionTable(),n=o.asMutable({deep:!0}).concat(l);if((!s||n.findIndex(e=>e.id===s)<0)&&n.length>0){const e=n.find(e=>{var t;return e.id===(null===(t=n[0])||void 0===t?void 0:t.id)}),t=e&&e.allFields[0],a=e&&e.tableFields.map(e=>({value:e.name,label:e.alias}));return{activeTabId:null===(i=n[0])||void 0===i?void 0:i.id,advancedField:t,advancedTableField:a}}return null}componentDidMount(){this.state.apiLoaded||Object(s.loadArcGISJSAPIModules)(["esri/widgets/FeatureTable","esri/layers/FeatureLayer"]).then(e=>{[this.FeatureTable,this.FeatureLayer]=e,this.setState({apiLoaded:!0}),this.destoryTable().then(()=>{this.createTable()})})}componentWillUnmount(){const{id:e}=this.props;this.table&&(this.table.menu.open=!1),clearTimeout(this.suggestionsQueryTimeout),clearInterval(this.autoRefreshLoadingTime),a.MutableStoreManager.getInstance().updateStateValue(e,"viewInTableObj",{})}componentDidUpdate(e,t){var i,o,s,l,n,r,d,c,h,u,v,p,g,b;const{activeTabId:m,dataSource:f,advancedTableField:S}=this.state,{id:w,config:x,currentPageId:y,state:j,belongToDataSourceInfos:T,appMode:C}=this.props,{layersConfig:z}=x,I=this.getDataActionTable(),O=z.asMutable({deep:!0}).concat(I),M=(null===(o=null===(i=this.props)||void 0===i?void 0:i.stateProps)||void 0===o?void 0:o.removeLayerFlag)||!1,A=null===(l=null===(s=this.props)||void 0===s?void 0:s.stateProps)||void 0===l?void 0:l.dataActionActiveObj,D=(null==A?void 0:A.dataActionTable)?null==A?void 0:A.activeTabId:m;if(M){const e=document.getElementsByClassName("esri-popover esri-popover--open");e&&e.length>0&&e[0].remove(),this.props.dispatch(a.appActions.widgetStatePropChange(w,"removeLayerFlag",!1))}const L=j===a.WidgetState.Closed,R=e.currentPageId!==y,N=e.appMode===a.AppMode.Run&&C===a.AppMode.Design;(L||R||N)&&this.table&&(this.table.menu.open=!1);const P=e.config.layersConfig.concat(I).find(e=>e.id===t.activeTabId),H=O.find(e=>e.id===D);if(this.removeConfig){if(this.removeConfig=!1,!H)return}else if(!P||!H)return;const{allFields:E}=this.getFieldsFromDatasource(),k=null===(n=H.tableFields)||void 0===n?void 0:n.map(e=>({value:e.name,label:e.alias}));a.lodash.isDeepEqual(k,S)&&D===t.activeTabId||this.setState({advancedField:null==E?void 0:E[0],advancedTableField:k});const V=["enableAttachements","enableEdit","allowCsv","enableSearch","searchFields","enableRefresh","enableSelect","selectMode","tableFields"];let B=!1;for(const e in V){const t=V[e];if("tableFields"!==t?(null==P?void 0:P[t])!==(null==H?void 0:H[t]):!a.lodash.isDeepEqual(null==P?void 0:P[t],null==H?void 0:H[t])){B=!0;break}}const $=null===(r=null==P?void 0:P.useDataSource)||void 0===r?void 0:r.dataSourceId,_=null===(d=null==H?void 0:H.useDataSource)||void 0===d?void 0:d.dataSourceId,Q=null===(h=null===(c=null==e?void 0:e.belongToDataSourceInfos)||void 0===c?void 0:c[$])||void 0===h?void 0:h.widgetQueries,U=null===(u=null==T?void 0:T[_])||void 0===u?void 0:u.widgetQueries,q=null===(p=null===(v=null==e?void 0:e.belongToDataSourceInfos)||void 0===v?void 0:v[$])||void 0===p?void 0:p.sourceVersion,G=null===(g=null==T?void 0:T[_])||void 0===g?void 0:g.sourceVersion,W=null===(b=null==T?void 0:T[_])||void 0===b?void 0:b.status;H.dataActionObject||$!==_||Q===U||this.updateGeometryAndSql(f);if((null==A?void 0:A.dataActionTable)&&this.dataActionCanLoad&&!this.updatingTable)return this.dataActionCanLoad=!1,this.props.dispatch(a.appActions.widgetStatePropChange(w,"dataActionActiveObj",{activeTabId:D,dataActionTable:!1})),this.updatingTable=!0,void this.setState({activeTabId:D,searchText:"",tableShowColumns:void 0},()=>{this.destoryTable().then(()=>{this.createTable()})});(()=>{const e=!F.includes(W),t=e&&(null==P?void 0:P.id)!==(null==H?void 0:H.id),i=e&&(null==P?void 0:P.id)===(null==H?void 0:H.id)&&B;return t||i||f&&G&&q!==G})()&&(this.updatingTable=!0,this.setState({searchText:"",tableShowColumns:void 0},()=>{this.destoryTable().then(()=>{this.createTable()})}))}getDsAccessibleInfo(e){return e?fetch(e+"?f=pjson").then(e=>p(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>!(Object.keys(e).indexOf("error")>-1)):Promise.resolve(!1)}destoryTable(){return p(this,void 0,void 0,(function*(){return this.table&&(this.table.menu.open=!1,!this.table.destroyed&&this.table.destroy()),yield Promise.resolve()}))}render(){var e,t,s,l,r,c;const{activeTabId:h,dataSource:u,selectQueryFlag:v,tableShowColumns:p,mobileFlag:g,emptyTable:b,selectRecords:m,notReady:z,advancedField:I,advancedTableField:O,showLoading:M,interval:A,isShowSuggestion:D,searchSuggestion:F}=this.state,{config:R,id:N,theme:P,isRTL:H,enableDataAction:E,isHeightAuto:k,isWidthAuto:V}=this.props,{layersConfig:B,arrangeType:$}=R,_=this.getDataActionTable(),Q=B.asMutable({deep:!0}).concat(_);let U;const q=Q.find(e=>e.id===h);Q.length>0&&(U=q?q.useDataSource:Q[0].useDataSource);const G=Object(a.classNames)("jimu-widget","widget-table","surface-1","table-widget-"+N);if(!U)return Object(a.jsx)(n.WidgetPlaceholder,{widgetId:N,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:C,"data-testid":"tablePlaceholder"});const W=$===o.b.Tabs,J=this.getInitFields(),K=null==u?void 0:u.getLabel(),X=a.appConfigUtils.getWidgetIdByOutputDataSource(U),Y=null===(e=Object(a.getAppStore)().getState())||void 0===e?void 0:e.appConfig,Z=null===(s=null===(t=null==Y?void 0:Y.widgets)||void 0===t?void 0:t[X])||void 0===s?void 0:s.label,ee=this.formatMessage("tableDataActionLable",{layer:(null===(r=null===(l=u)||void 0===l?void 0:l.layerDefinition)||void 0===r?void 0:r.name)||""}),te=(null===(c=null==u?void 0:u.getSelectedRecords())||void 0===c?void 0:c.length)>0,ie={id:N,enableDataAction:E,isHeightAuto:k,isWidthAuto:V};return Object(a.jsx)("div",{className:G,css:d(P,g,ie),ref:e=>this.refs.currentEl=e},Object(a.jsx)("div",{className:"table-indent"},Object(a.jsx)("div",{className:"d-flex "+(W?"horizontal-tag-list":"dropdown-tag-list")},W?Object(a.jsx)(n.Tabs,{type:"underline",onChange:this.onTagClick,className:"tab-flex",value:h,onClose:this.onCloseTab},Q.map(e=>{const t=!!e.dataActionObject;return Object(a.jsx)(n.Tab,{key:e.id,id:e.id,title:e.name,className:"text-truncate tag-size",closeable:t},Object(a.jsx)("div",{className:"mt-2"}))})):Object(a.jsx)(n.Select,{size:"sm",value:h,onChange:this.handleTagChange,className:"top-drop"},Q.map(e=>Object(a.jsx)("option",{key:e.id,value:e.id,title:e.name},Object(a.jsx)("div",{className:"table-action-option"},Object(a.jsx)("div",{className:"table-action-option-tab",title:e.name},e.name),e.dataActionObject&&Object(a.jsx)("div",{className:"table-action-option-close"},Object(a.jsx)(n.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>this.onCloseTab(e.id,t)},Object(a.jsx)(n.Icon,{icon:T,size:10})))))))),Object(a.jsx)("div",{className:""+($===o.b.Tabs?"horizontal-render-con":"dropdown-render-con")},q.enableSearch&&q.searchFields&&this.renderSearchTools(),Object(a.jsx)("div",{ref:"suggestPopup",style:{position:"relative",top:25}},Object(a.jsx)(n.Popper,{css:a.css`
    & {
      max-height: ${a.polished.rem(300)};
      min-width: ${a.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:this.refs.suggestPopup,offset:[0,8],open:D,a11yVersion:-1,toggle:e=>{this.setState({isShowSuggestion:!D})}},F.map((e,t)=>{const i=L.sanitize(e.suggestionHtml);return Object(a.jsx)(n.Button,{key:t,type:"secondary",size:"sm",onClick:()=>this.onSuggestionConfirm(e.suggestion),dangerouslySetInnerHTML:{__html:i}})}))),u&&g&&m&&E&&!b&&Object(a.jsx)("div",{className:"horizontal-action-dropdown"},Object(a.jsx)(n.DataActionDropDown,{dataName:ee,widgetId:N,dataSource:u,records:m})),Object(a.jsx)("div",{className:"top-button-list"},q.enableSelect&&Object(a.jsx)("div",{className:"top-button ml-2"},Object(a.jsx)(n.Button,{size:"sm",onClick:this.onShowSelection,icon:!0,title:v?this.formatMessage("showAll"):this.formatMessage("showSelection"),disabled:b||!te},Object(a.jsx)(n.Icon,{icon:v?w:H?S:f,size:14}))),q.enableSelect&&Object(a.jsx)("div",{className:"top-button ml-2"},Object(a.jsx)(n.Button,{size:"sm",onClick:this.onSelectionClear,icon:!0,title:this.formatMessage("clearSelection"),disabled:b||!te},Object(a.jsx)(n.Icon,{icon:x,size:14}))),q.enableRefresh&&Object(a.jsx)("div",{className:"top-button ml-2"},Object(a.jsx)(n.Button,{size:"sm",onClick:this.onTableRefresh,icon:!0,title:this.formatMessage("refresh"),disabled:b},Object(a.jsx)(n.Icon,{icon:y,size:14}))),Object(a.jsx)("div",{className:"top-button ml-2"},Object(a.jsx)(n.Button,{size:"sm",onClick:this.popupShowHideCols,icon:!0,title:this.formatMessage("showHideCols"),disabled:b},Object(a.jsx)(n.Icon,{icon:j,size:14}))),u&&!g&&m&&E&&!b&&Object(a.jsx)(a.React.Fragment,null,Object(a.jsx)("span",{className:"tool-dividing-line mx-1"}),Object(a.jsx)("div",{className:"top-button data-action-btn"},Object(a.jsx)(n.DataActionDropDown,{dataName:ee,widgetId:N,dataSource:u,records:m})))),u&&Object(a.jsx)("div",{ref:"advancedSelect",className:"adv-select-con"},Object(a.jsx)(n.AdvancedSelect,{fluid:!0,dataSource:u,field:I,codedValues:O,isMultiple:!0,values:Object(a.Immutable)(p||J),isEmptyOptionHidden:!1,onChange:this.onValueChangeFromRuntime})),b&&Object(a.jsx)("div",{className:"placeholder-table-con"},Object(a.jsx)(n.WidgetPlaceholder,{icon:i(423),message:this.formatMessage("noData")}),z&&Object(a.jsx)("div",{className:"placeholder-alert-con"},Object(a.jsx)(n.Alert,{form:"tooltip",size:"small",type:"warning",text:this.formatMessage("outputDataIsNotGenerated",{outputDsLabel:K,sourceWidgetName:Z})}))),Object(a.jsx)("div",{ref:"tableContainer",className:"table-con"}),(M||A>0)&&this.renderLoading(M,A),Object(a.jsx)("div",{className:"ds-container"},Object(a.jsx)(a.DataSourceComponent,{widgetId:N,useDataSource:Object(a.Immutable)(U),onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onQueryRequired:this.onQueryRequired})),Object(a.jsx)(a.Global,{styles:this.getGlobalTableTools(P,H)}),Object(a.jsx)(a.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize}))))}}R.mapExtraStateProps=(e,t)=>{var i,o,s,l,n,d,c,h,u,v,p,g,b,m,f,S;const{layoutId:w,layoutItemId:x,id:y}=t,j=null===(o=null===(i=null==e?void 0:e.appConfig)||void 0===i?void 0:i.widgets)||void 0===o?void 0:o[y],T=null==j?void 0:j.enableDataAction,C=null===(s=null==j?void 0:j.useDataSources)||void 0===s?void 0:s.map(e=>e.dataSourceId),z=a.DataSourceManager.getInstance(),I={};null==C||C.forEach(t=>{var i,a;const o=null===(i=z.getDataSource(t))||void 0===i?void 0:i.belongToDataSource;I[t]=null===(a=null==e?void 0:e.dataSourcesInfo)||void 0===a?void 0:a[null==o?void 0:o.id]});const O=null===(l=(e&&e.appConfig).layouts)||void 0===l?void 0:l[w],M=null===(d=null===(n=null==O?void 0:O.content)||void 0===n?void 0:n[x])||void 0===d?void 0:d.setting,A=(null===(c=null==M?void 0:M.autoProps)||void 0===c?void 0:c.height)===r.LayoutItemSizeModes.Auto||!0===(null===(h=null==M?void 0:M.autoProps)||void 0===h?void 0:h.height),D=(null===(u=null==M?void 0:M.autoProps)||void 0===u?void 0:u.width)===r.LayoutItemSizeModes.Auto||!0===(null===(v=null==M?void 0:M.autoProps)||void 0===v?void 0:v.width);return{appMode:null===(p=null==e?void 0:e.appRuntimeInfo)||void 0===p?void 0:p.appMode,isRTL:null===(g=null==e?void 0:e.appContext)||void 0===g?void 0:g.isRTL,stateShowLoading:null===(m=null===(b=null==e?void 0:e.widgetsState)||void 0===b?void 0:b[t.id])||void 0===m?void 0:m.showLoading,currentPageId:null===(f=null==e?void 0:e.appRuntimeInfo)||void 0===f?void 0:f.currentPageId,viewInTableObj:null===(S=null==t?void 0:t.mutableStateProps)||void 0===S?void 0:S.viewInTableObj,enableDataAction:void 0===T||T,belongToDataSourceInfos:I,isHeightAuto:A,isWidthAuto:D}}},66:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},69:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14 8a.522.522 0 01-.516.527H3.976L7.473 12.1a.535.535 0 010 .746.508.508 0 01-.73 0L2 8l4.743-4.846a.508.508 0 01.73 0 .535.535 0 010 .746L3.976 7.473h9.508c.285 0 .516.236.516.527z" fill="#000" fill-rule="nonzero"></path></svg>'},7:function(e,t){e.exports=o},91:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7 1a6 6 0 100 12A6 6 0 007 1zm0 13a7 7 0 115.621-2.828l-.222.284 3.405 3.404a.668.668 0 01-.944.944L11.456 12.4A6.974 6.974 0 017 14z" fill="#000" fill-rule="evenodd"></path></svg>'}}))}}}));