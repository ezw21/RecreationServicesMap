System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/advanced/data-source-selector","jimu-ui/basic/list-tree","jimu-core/react"],(function(e){var t,i,a,s,o,n,l;return{setters:[function(e){t=e},function(e){i=e},function(e){a=e},function(e){s=e},function(e){o=e},function(e){n=e},function(e){l=e}],execute:function(){e(function(e){var t={};function i(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=510)}({0:function(e,i){e.exports=t},1:function(e,t){e.exports=i},10:function(e,t){e.exports=s},14:function(e,t){e.exports=o},15:function(e,t){e.exports=n},2:function(e,t){e.exports=a},22:function(e,t){e.exports=l},425:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iODUiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iMTYiIGhlaWdodD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTIiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMzAiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNDgiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},426:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMzgiIGhlaWdodD0iOCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTQiIHk9IjE0IiB3aWR0aD0iMjgiIGhlaWdodD0iNCIgZmlsbD0iIzE4MTgxOCIvPg0KPHBhdGggZD0iTTQ0IDE1SDQ4TDQ2IDE3TDQ0IDE1WiIgZmlsbD0iIzE4MTgxOCIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},48:function(e,t,i){"use strict";var a,s;i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(a||(a={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(s||(s={}))},510:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return b}));var a=i(0),s=i(1),o=i(2),n=i(14),l=i(48),r={newSheet:"New sheet",sheetStyle:"Arrangement style",layerConfig:"Sheet configuration",enableAttachements:"Show attachments",enableSearch:"Search",searchFields:"Select searching fields",countSelected:"{selectedCount} items selected",fullMatch:"Exact match",allowCsv:"Allow exporting to CSV",enableSelect:"Select records",enableEdit:"Allow editing",enableRefresh:"Refresh",configFields:"Configure fields",dropdown:"Dropdown",configTips:"Select fields for initial display",selectMode:"Select mode",tableBlankStatus:'Click the "{SheetString}" button to add and configure data sheets.',selectFields:"Select fields"},c=i(22),d=i(15);const{OUTPUT_DATA_VIEW_ID:I}=a.CONSTANTS;class g extends a.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=Object(a.Immutable)([n.AllDataSourceTypes.FeatureLayer]),this.nameChange=e=>{if(e&&e.target&&e.target.value){const t=e.target.value.trim();this.props.optionChange("name",t)}},this.handleCheckboxChange=e=>{const t=e.currentTarget;t&&this.props.optionChange(t.dataset.field,t.checked)},this.formatMessage=(e,t)=>{const i=Object.assign({},r,s.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.displaySelectedFields=e=>this.formatMessage("numSelected",{number:e.length}),this.filterSearchFields=e=>{const{searchFields:t}=this.props,i=t.split(","),a=e.map(e=>e.jimuName);return i.filter(e=>a.includes(e)).join(",")},this.onFieldChange=e=>{if(!e)return;const t=e.filter(e=>e),i=this.filterSearchFields(t);this.props.multiOptionsChange({searchFields:i,tableFields:t})},this.onDataSourceCreated=e=>{this.setState({dataSource:e})},this.getSearchingFields=()=>{const e=[],{tableFields:t}=this.props;return t.length>0&&t.forEach(t=>{t.type==a.JimuFieldType.String&&e.push({value:t.jimuName||t.name,label:t.alias||t.name})}),e},this.handleChooseSearchingFieldsChange=(e,t,i)=>{this.props.optionChange("searchFields",i.join(","))},this.getSelectModeOptions=()=>[Object(a.jsx)("option",{key:l.a.Single,value:l.a.Single},this.formatMessage("single")),Object(a.jsx)("option",{key:l.a.Multiple,value:l.a.Multiple},this.formatMessage("multiple"))],this.getFieldsFromDatasource=()=>{const{useDataSource:e}=this.props,t=a.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),i=null==t?void 0:t.getSchema(),s=(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[],o=["CreationDate","Creator","EditDate","Editor","GlobalID"];let n=s.filter(e=>!o.includes(e.jimuName));return(null==n?void 0:n.length)>50&&(n=n.slice(0,50)),{allFields:s,tableFields:n}},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.state={dataSource:void 0},this.colRef=a.React.createRef()}getStyle(e){return a.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: calc(100% - ${a.polished.rem(58)});
          overflow: auto;
          .selected-fields-list {
            flex: 1;
            max-height: 265px;
            overflow-y: auto;
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
        }
      }
    `}render(){const{useDataSource:e,optionChange:t,theme:i,tableFields:r,searchFields:g}=this.props,{dataSource:h}=this.state,m=h&&h.getLayerDefinition(),p=[];r&&r.length>0&&r.map(e=>{p.push(e.jimuName)});const{allFields:u}=this.getFieldsFromDatasource(),b=null==m?void 0:m.capabilities;let D=!1;b&&(D=Array.isArray(b)?b.join().toLowerCase().includes("editing"):null==m?void 0:m.capabilities.toLowerCase().includes("editing"));const j=(null==h?void 0:h.url)&&(null==h?void 0:h.dataViewId)!==I&&D,S={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:d.TreeItemActionType.RenderOverrideItem,children:[{name:d.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:d.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:d.TreeItemActionType.RenderOverrideItemBody,children:[{name:d.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:d.TreeItemActionType.RenderOverrideItemDragHandle},{name:d.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:d.TreeItemActionType.RenderOverrideItemTitle},{name:d.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return Object(a.jsx)("div",{className:"w-100 h-100",css:this.getStyle(i)},Object(a.jsx)("div",{className:"w-100 h-100 layer-config-panel"},Object(a.jsx)("div",{className:"w-100 d-flex px-3 py-0"},Object(a.jsx)(s.PanelHeader,{level:1,className:"py-3 panel-inner",showClose:!!this.props.onClose,onClose:this.props.onClose,title:this.formatMessage("layerConfig")})),Object(a.jsx)("div",{className:"setting-container"},Object(a.jsx)(o.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},Object(a.jsx)(o.SettingRow,null,Object(a.jsx)(n.DataSourceSelector,{types:this.supportedDsTypes,disableRemove:()=>!0,useDataSources:e?Object(a.Immutable)([e]):Object(a.Immutable)([]),mustUseDataSource:!0,onChange:this.props.dataSourceChange,closeDataSourceListOnChange:!0}))),e&&Object(a.jsx)(a.React.Fragment,null,Object(a.jsx)(o.SettingSection,{title:this.formatMessage("label")},Object(a.jsx)(o.SettingRow,null,Object(a.jsx)(s.TextInput,{type:"text",className:"w-100",value:this.props.name?this.props.name:"",onChange:this.nameChange}))),Object(a.jsx)(o.SettingSection,{title:this.formatMessage("configFields")},Object(a.jsx)(o.SettingRow,null,this.formatMessage("configTips")),Object(a.jsx)(o.SettingRow,null,Object(a.jsx)(n.FieldSelector,{useDataSources:e?Object(a.Immutable)([e]):Object(a.Immutable)([]),onChange:this.onFieldChange,selectedFields:Object(a.Immutable)(p),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),Object(a.jsx)(o.SettingRow,null,Object(a.jsx)(d.List,Object.assign({className:"selected-fields-list",itemsJson:Array.from(r).map((e,t)=>({itemStateDetailContent:e,itemStateDisabled:!this.checkFieldsExist(u,e),itemKey:""+t,itemStateIcon:n.dataComponentsUtils.getIconFromFieldType(e.type,i),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,a]=i,s=a.map(e=>e.itemStateDetailContent);this.props.optionChange("tableFields",s)},isItemFocused:()=>!1},S))),j&&Object(a.jsx)(o.SettingRow,null,Object(a.jsx)("div",{className:"d-flex w-100"},Object(a.jsx)(s.Checkbox,{id:"editable-cb","data-field":"enableEdit",onClick:this.handleCheckboxChange,checked:this.props.enableEdit}),Object(a.jsx)(s.Label,{for:"editable-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("enableEdit")},this.formatMessage("enableEdit"))))),Object(a.jsx)(o.SettingSection,{title:this.formatMessage("tools")},Object(a.jsx)("div",{className:"w-100 table-options"},Object(a.jsx)("div",{className:"table-options-item",key:"enableSearch"},Object(a.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("enableSearch")),Object(a.jsx)(s.Switch,{className:"can-x-switch",checked:this.props.enableSearch||!1,onChange:e=>{t("enableSearch",e.target.checked)}}))),Object(a.jsx)("div",{className:"ds-container"},Object(a.jsx)(a.DataSourceComponent,{useDataSource:Object(a.Immutable)(e),onDataSourceCreated:this.onDataSourceCreated})),this.props.enableSearch&&Object(a.jsx)(o.SettingRow,{flow:"wrap",label:this.formatMessage("searchFields")},Object(a.jsx)("div",{className:"d-flex w-100 search-container",style:{zIndex:3}},Object(a.jsx)(s.MultiSelect,{items:Object(a.Immutable)(this.getSearchingFields()),values:g?Object(a.Immutable)(g.split(",")):Object(a.Immutable)([]),className:"search-multi-select",fluid:!0,onClickItem:this.handleChooseSearchingFieldsChange,displayByValues:this.displaySelectedFields})),Object(a.jsx)("div",{className:"d-flex w-100",style:{marginTop:"10px"}},Object(a.jsx)(s.Checkbox,{id:"fullMatch-cb","data-field":"searchExact",onClick:this.handleCheckboxChange,checked:this.props.searchExact}),Object(a.jsx)(s.Label,{for:"fullMatch-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("fullMatch")},this.formatMessage("fullMatch")))),Object(a.jsx)(o.SettingRow,null,Object(a.jsx)("div",{className:"w-100 table-options"},["enableSelect","enableRefresh"].map((e,i)=>Object(a.jsx)(c.Fragment,{key:i},Object(a.jsx)("div",{className:"table-options-item"},Object(a.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage(e)),Object(a.jsx)(s.Switch,{className:"can-x-switch",checked:this.props[e]||!1,onChange:i=>{t(e,i.target.checked)}})),"enableSelect"===e&&this.props[e]&&Object(a.jsx)(o.SettingRow,{flow:"wrap",label:this.formatMessage("selectMode"),className:"select-option"},Object(a.jsx)(s.Select,{value:this.props.selectMode||l.a.Multiple,onChange:e=>{t("selectMode",e.target.value)}},this.getSelectModeOptions())))))))))))}}var h=i(10);class m extends a.React.PureComponent{constructor(e){super(e),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}componentWillUnmount(){}render(){return Object(a.jsx)(a.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}const p=i(66),u=i(71);class b extends a.React.PureComponent{constructor(e){super(e),this.sidePopperTrigger=a.React.createRef(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.map(e=>{this.dsHash[t]=e.useDataSource,t++})},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.dataSourceChangeSave=e=>{if(!e)return;const t=Object(a.Immutable)(e[0]),i=this.dsManager.getDataSource(t.dataSourceId),s=i&&i.getSchema(),o=["CreationDate","Creator","EditDate","Editor","GlobalID"],n=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[];let r=n.filter(e=>!o.includes(e.jimuName));(null==r?void 0:r.length)>50&&(r=r.slice(0,50)),this.dsManager.createDataSourceByUseDataSource(Object(a.Immutable)(e[0])).then(e=>{const i={id:this.getNewConfigId(e.id),name:e.getLabel(),useDataSource:t,allFields:n,tableFields:r,enableAttachements:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:"",enableRefresh:!0,enableSelect:!0,selectMode:l.a.Single};let s;if(this.props.config.layersConfig[this.index]){const e=this.props.config.layersConfig.asMutable({deep:!0});e.splice(this.index,1,i),s=Object(a.Immutable)(e)}else s=this.props.config.layersConfig.concat([Object(a.Immutable)(i)]);this.dsHash[this.index]=t,this.updateDsHash(s);const o={id:this.props.id,config:this.props.config.set("layersConfig",s),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(o)})},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t})),this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).map(t=>{const i=this.dsHash[t].dataSourceId;let s;s=e[i]?Object(a.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[i].fields,this.dsHash[t].fields)}):this.dsHash[t],e[i]=s});const t=[];return Object.keys(e).map(i=>{t.push(e[i])}),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);const i=this.props.config.set("layersConfig",t);delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.getStyle=e=>a.css`
      .widget-setting-table {
        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.colors.secondary};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .filter-item-active {
          border-left: 2px solid ${e.colors.palette.primary[600]};
        }

        .arrange-style-container {
          .arrange_container {
            margin-top: 10px;
            display: flex;
            .jimu-btn {
              padding: 0;
              background: ${e.colors.palette.light[200]};
              &.active {
                border: 2px solid ${e.colors.palette.primary[600]};
              }
            }
          }
        }
        .table-blank-placeholder {
          .placeholder-icon {
            color: ${e.colors.palette.dark[200]};
          }
          & > div {
            top: 50%;
            transform: translateY(-50%);
            padding: 1rem;
          }
          p {
            font-size: ${a.polished.rem(14)};
            margin-top: ${a.polished.rem(16)};
            line-height: ${a.polished.rem(19)};
            color: ${e.colors.palette.dark[500]};
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${a.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${a.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>{const i=Object.assign({},r,s.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.onShowLayerPanel=e=>{const{showLayerPanel:t}=this.state;e===this.index?this.setState({showLayerPanel:!t}):(this.setState({showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.switchTableType=e=>{if(e!==this.props.config.arrangeType){const t={id:this.props.id,config:this.props.config.set("arrangeType",e)};this.props.onSettingChange(t)}},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map(e=>e.itemStateDetailContent),o={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.onShowLayerPanel(t),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState(i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}})},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter(t=>e===t.dataSourceId).length)>0;return null!==this.state.dataSources[e]&&i},this.index=0,this.dsManager=a.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={showLayerPanel:!1,refreshPanel:!1,dataSources:{}}}getArrayMaxId(e){const t=e.map(e=>e.id.split("-").reverse()[0]);return t.length>0?Math.max.apply(null,t):0}render(){var e,t;const{showLayerPanel:n}=this.state,{theme:r,config:c}=this.props,I=this.formatMessage("newSheet"),h=c.layersConfig.length,b={isItemFocused:(e,t)=>{const{itemJsons:[i,a]}=t.props;return n&&a.indexOf(i)===this.index},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:d.TreeItemActionType.RenderOverrideItem,children:[{name:d.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:d.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:d.TreeItemActionType.RenderOverrideItemBody,children:[{name:d.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:d.TreeItemActionType.RenderOverrideItemDragHandle},{name:d.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:d.TreeItemActionType.RenderOverrideItemTitle},{name:d.TreeItemActionType.RenderOverrideItemDetailToggle},{name:d.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return Object(a.jsx)("div",{css:this.getStyle(r)},Object(a.jsx)("div",{className:"widget-setting-table"},null===(e=this.props.useDataSources)||void 0===e?void 0:e.map((e,t)=>Object(a.jsx)(m,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed})),Object(a.jsx)(o.SettingSection,{className:"p-0 m-0 "+(h>0?"":"border-0")},Object(a.jsx)("div",{ref:this.sidePopperTrigger},Object(a.jsx)(o.SettingSection,{className:"border-0"},Object(a.jsx)(o.SettingRow,null,Object(a.jsx)(s.Button,{className:"w-100 text-dark set-link-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(h)}},Object(a.jsx)("div",{className:"w-100 px-2 text-truncate"},I)))),Object(a.jsx)(o.SettingSection,{className:"pt-0 border-0"},Object(a.jsx)("div",{className:"setting-ui-unit-list"},!!h&&Object(a.jsx)(d.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(c.layersConfig).map((e,t)=>({itemStateDetailContent:e,itemKey:""+t,itemStateTitle:e.name,itemStateCommands:[{label:this.formatMessage("close"),iconProps:()=>({icon:p,size:12}),action:()=>{this.removeLayer(t)}}]})),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var i,o;const{itemJsons:n}=t.props,[l]=n,r=null===(o=null===(i=null==l?void 0:l.itemStateDetailContent)||void 0===i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId;return this.isDataSourceAccessible(r)?"":Object(a.jsx)(s.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;this.onShowLayerPanel(+i.itemKey)}},b)),h===this.index&&n&&Object(a.jsx)(d.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map((e,t)=>({itemStateDetailContent:e,itemKey:""+this.index,itemStateTitle:e.name,itemStateCommands:[]})),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},b,{isItemFocused:()=>!0})))))),0==h&&Object(a.jsx)("div",{className:"w-100 text-center table-blank-placeholder"},Object(a.jsx)("div",{className:"position-absolute w-100"},Object(a.jsx)(s.Icon,{size:48,icon:u,className:"placeholder-icon"}),Object(a.jsx)("p",null,this.formatMessage("tableBlankStatus",{SheetString:I})))),h>0&&Object(a.jsx)(o.SettingSection,{className:"arrange-style-container",title:this.formatMessage("sheetStyle")},Object(a.jsx)(o.SettingRow,{className:"arrange_container"},Object(a.jsx)(s.Tooltip,{title:this.formatMessage("tabs"),placement:"bottom"},Object(a.jsx)(s.Button,{onClick:()=>this.switchTableType(l.b.Tabs),icon:!0,size:"sm",type:"tertiary",active:c.arrangeType===l.b.Tabs},Object(a.jsx)(s.Icon,{autoFlip:!0,width:109,height:70,icon:i(425)}))),Object(a.jsx)(s.Tooltip,{title:this.formatMessage("dropdown"),placement:"bottom"},Object(a.jsx)(s.Button,{onClick:()=>this.switchTableType(l.b.Dropdown),className:"ml-2",icon:!0,size:"sm",type:"tertiary",active:c.arrangeType===l.b.Dropdown},Object(a.jsx)(s.Icon,{autoFlip:!0,width:109,height:70,icon:i(426)}))))),Object(a.jsx)(o.SidePopper,{isOpen:n&&!a.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.onCloseLayerPanel,trigger:null===(t=this.sidePopperTrigger)||void 0===t?void 0:t.current},Object(a.jsx)(g,Object.assign({},c.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:r,dataSourceChange:this.dataSourceChangeSave,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onClose:this.onCloseLayerPanel})))))}}b.mapExtraStateProps=(e,t)=>{var i,a;return{dsJsons:e.appStateInBuilder.appConfig.dataSources,activeTabId:e&&(null===(a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId)}}},66:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},71:function(e,t){e.exports='<svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M35.477 22.045c-.53-.142-.844-.686-.74-1.226.653-3.414.13-7.07-1.744-10.316-4.142-7.175-13.316-9.633-20.49-5.49-7.175 4.142-9.633 13.315-5.49 20.49a14.944 14.944 0 008.24 6.728c.526.176.848.723.704 1.258-.142.531-.688.85-1.21.681a16.938 16.938 0 01-9.467-7.667C.586 18.372 3.372 7.975 11.503 3.28c8.13-4.694 18.528-1.908 23.222 6.223a16.936 16.936 0 011.95 11.823c-.108.543-.662.863-1.198.72zm-5.8-1.554c-.529-.142-.84-.683-.763-1.225a8.961 8.961 0 00-1.117-5.763 9 9 0 10-10.989 12.914c.52.197.845.743.701 1.28-.142.53-.686.85-1.202.667a10.957 10.957 0 01-5.83-4.861c-3.038-5.261-1.235-11.989 4.026-15.026 5.261-3.038 11.988-1.235 15.026 4.026a10.954 10.954 0 011.332 7.262c-.09.55-.646.87-1.183.726zM43.78 35.583l-12.512 1.648-7.682 10.011c-.564.736-1.738.375-1.792-.55L20.24 19.918a1 1 0 011.548-.893l22.41 14.731c.774.51.5 1.706-.42 1.827zm-14.099.43l-6.046 7.88-1.282-22.104 18.501 12.162-9.847 1.297a2 2 0 00-1.326.765z" fill="#000"></path></svg>'}}))}}}));