System.register(["jimu-core","jimu-ui"],(function(t){var e,i;return{setters:[function(t){e=t},function(t){i=t}],execute:function(){t(function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=517)}({0:function(t,i){t.exports=e},1:function(t,e){t.exports=i},517:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return c}));var s=i(0),o=i(1),n=i(78);class r extends s.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:t=>{let e=t;return e.getIn(["styleConfig","name"])&&(e=e.set("styleConfig",e.styleConfig.without("name"))),e.getIn(["styleConfig","customStyle"])&&(e=e.set("styleConfig",e.styleConfig.without("customStyle"))),e.getIn(["styleConfig","themeStyle","quickStyleType"])&&(e=e.setIn(["styleConfig","themeStyle"],{quickStyleType:e.styleConfig.themeStyle.quickStyleType})),e=e.setIn(["styleConfig","useCustom"],!1),e}},{version:"1.1.0",description:"1.1.0",upgrader:t=>{let e=t;return e.getIn(["styleConfig","useCustom"])&&e.getIn(["styleConfig","customStyle","regular","border","width"])&&(e=e.setIn(["styleConfig","customStyle","regular","border","width"],o.utils.stringOfLinearUnit(e.getIn(["styleConfig","customStyle","regular","border","width"])))),e.getIn(["styleConfig","useCustom"])&&e.getIn(["styleConfig","customStyle","hover","border","width"])&&(e=e.setIn(["styleConfig","customStyle","hover","border","width"],o.utils.stringOfLinearUnit(e.getIn(["styleConfig","customStyle","hover","border","width"])))),e}}]}}const p=new r;var l,u=i(87);!function(t){t[t.None=0]="None",t[t.Main=1]="Main",t[t.Sub=2]="Sub"}(l||(l={}));class c extends s.React.PureComponent{constructor(t){super(t),this.repeat=0,this.getTextFromProps=()=>{var t,e,i,s;return"string"==typeof(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===e?void 0:e.text)?null===(s=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===s?void 0:s.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:o.defaultMessages.variableButton})},this.setRepeatType=()=>{const t=this.props.repeatedDataSource;let e;e=t?0===t.recordIndex?l.Main:l.Sub:l.None,this.repeat=e},this.getTipExpression=()=>{var t,e;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||Object(s.Immutable)({name:"",parts:[{type:s.ExpressionPartType.String,exp:`"${(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===e?void 0:e.toolTip)||""}"`}]})},this.getTextExpression=()=>{var t,e;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||Object(s.Immutable)({name:"",parts:[{type:s.ExpressionPartType.String,exp:`"${(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.functionConfig)||void 0===e?void 0:e.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=t=>{if(t.isSuccessful)this.setState({text:t.value});else{let e="";t.value===s.ExpressionResolverErrorCode.Failed&&(e=this.state.textExpression&&this.state.textExpression.name),this.setState({text:e})}},this.onTipExpResolveChange=t=>{if(t.isSuccessful)this.setState({toolTip:t.value});else{let e="";t.value===s.ExpressionResolverErrorCode.Failed&&(e=this.state.tipExpression&&this.state.tipExpression.name),this.setState({toolTip:e})}},this.onUrlExpResolveChange=t=>{if(t.isSuccessful)this.setState({url:t.value});else{let e="";t.value===s.ExpressionResolverErrorCode.Failed&&(e=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:e})}},this.showQuickStylePanel=()=>{if(!window.jimuConfig.isInBuilder)return!1;const t=this.repeat,{active:e}=this.props;return this.props.showQuickStyle&&e&&t!==l.Sub},this.getWhetherUseQuickStyle=t=>!!(t&&t.styleConfig&&t.styleConfig.themeStyle&&t.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(t,e)=>{const i=t||{},n=e||{};return s.css`
      & img, & svg{
        color: ${i.color};
        fill: ${i.color};
        width: ${i.size}${o.UnitTypes.PIXEL};
        height: ${i.size}${o.UnitTypes.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${o.UnitTypes.PIXEL};
          height: ${n.size}${o.UnitTypes.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=t=>{if(!t)return t;const e={};return Object.keys(t).forEach(i=>{("string"==typeof t[i]&&t[i].indexOf("undefined")<0||"number"==typeof t[i])&&(e[i]=t[i])}),e},this.getLinkComponent=()=>{const t=this.props.config,e=t.functionConfig.linkParam,i=this.state.text,r=this.state.toolTip;let p,l;if(t.styleConfig&&t.styleConfig.customStyle){const e=t.styleConfig.customStyle.regular,i=t.styleConfig.customStyle.hover;if(t.styleConfig.useCustom){const t=o.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),n=o.styleUtils.toCSSStyle(i&&i.without("iconProps").asMutable({deep:!0}));if(this.props.active&&this.props.appMode!==s.AppMode.Run){const o=Object(s.getAppStore)().getState().widgetsState[this.props.id]||Object(s.Immutable)({});p={style:o.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(t)),this.removeUndefinedStyle(n)):t,hoverStyle:n},l=this.getIconStyle(o.isConfiguringHover?Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==i?void 0:i.iconProps):null==e?void 0:e.iconProps,null==i?void 0:i.iconProps)}else p={style:t,hoverStyle:n},l=this.getIconStyle(e&&e.iconProps,i&&i.iconProps)}}const u=this.getWhetherUseQuickStyle(t)?{type:t.styleConfig.themeStyle.quickStyleType}:null;let c,a,h;e&&e.linkType&&(a=e.openType,h={linkType:e.linkType},e.linkType===s.LinkType.WebAddress?h.value=this.state.url:(h.value=e.value,c=this.props.queryObject));const f=t.functionConfig.icon;return Object(s.jsx)(o.Link,{to:h,target:a,queryObject:c,title:r,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",customStyle:p,themeStyle:u,css:l},Object(s.jsx)("span",{className:"text-truncate widget-button-text"},f&&(!f.position||f.position===n.a.Left)&&Object(s.jsx)(o.Icon,{icon:f.data,className:Object(s.classNames)({"mr-2 ml-0":!!i,"mx-0":!i})}),i,f&&f.position&&f.position===n.a.Right&&Object(s.jsx)(o.Icon,{icon:f.data,className:Object(s.classNames)({"ml-2 mr-0":!!i,"mx-0":!i})})))},this.onQuickStyleChange=t=>{let{config:e}=this.props;const i=this.props.id,s=this.props.builderSupportModules,o=s&&s.jimuForBuilderLib.getAppConfigAction;o&&(e=e.setIn(["styleConfig","useCustom"],!1),e=e.setIn(["styleConfig","themeStyle","quickStyleType"],t),e=e.setIn(["styleConfig","customStyle","regular"],{iconProps:Object(u.a)(!0,t,this.props.theme)}),e=e.setIn(["styleConfig","customStyle","hover"],{iconProps:Object(u.a)(!1,t,this.props.theme)}),o().editWidgetProperty(i,"config",e).exec())},this.onClick=t=>{t.exbEventType="linkClick"},this.onQuickStyleClose=()=>this.props.dispatch(s.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1)),this.getQuickStyleComponent=()=>{var t,e,i,o,n;const r=this.props.builderSupportModules&&this.props.builderSupportModules.widgetModules&&this.props.builderSupportModules.widgetModules.QuickStyle;return r?Object(s.jsx)(r,{onChange:this.onQuickStyleChange,reference:this.domNode&&this.domNode.current,onClose:this.onQuickStyleClose,selectedType:!(null===(e=null===(t=this.props.config)||void 0===t?void 0:t.styleConfig)||void 0===e?void 0:e.useCustom)&&(null===(n=null===(o=null===(i=this.props.config)||void 0===i?void 0:i.styleConfig)||void 0===o?void 0:o.themeStyle)||void 0===n?void 0:n.quickStyleType)}):null},this.state={text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip||"",url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression()},this.domNode=s.React.createRef()}componentDidMount(){this.setRepeatType(),window.jimuConfig.isInBuilder&&this.props.active&&this.props.dispatch(s.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0))}componentDidUpdate(t,e){this.props.useDataSourcesEnabled||this.props.config===t.config&&!t.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===t.config&&t.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),window.jimuConfig.isInBuilder&&(this.props.appMode!==t.appMode&&this.props.appMode===s.AppMode.Run||!this.props.active&&t.active)&&this.props.dispatch(s.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1))}render(){const t=this.props.useDataSourcesEnabled,e=this.showQuickStylePanel(),i=this.getLinkComponent(),o=this.getQuickStyleComponent();return Object(s.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,s.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .widget-button-text{
      line-height: initial;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},i,e&&o,Object(s.jsx)("div",{style:{display:"none"}},t&&Object(s.jsx)("div",null,Object(s.jsx)(s.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),Object(s.jsx)(s.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),Object(s.jsx)(s.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}c.mapExtraStateProps=(t,e)=>{let i=!1;const o=t.appRuntimeInfo.selection;if(o&&t.appConfig.layouts[o.layoutId]){const s=t.appConfig.layouts[o.layoutId].content[o.layoutItemId];i=s&&s.widgetId===e.id}const n=t.appContext.isInBuilder&&i;return{active:n,showQuickStyle:!!(t.widgetsState[e.id]||Object(s.Immutable)({})).showQuickStyle,appMode:n?t.appRuntimeInfo.appMode:null,queryObject:t.queryObject}},c.versionManager=p},78:function(t,e,i){"use strict";var s;i.d(e,"a",(function(){return s})),function(t){t.Left="LEFT",t.Right="RIGHT"}(s||(s={}))},87:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i(0),o=i(1);function n(t,e,i){const n=t?"default":"hover",r=Object(s.Immutable)(i),p=r.getIn(["components","button","variants",e,n,"color"]),l=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(o.styleUtils.remToPixel(l))}}}}))}}}));