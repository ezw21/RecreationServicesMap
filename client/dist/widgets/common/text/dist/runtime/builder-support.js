System.register(["jimu-core","jimu-ui","jimu-ui/advanced/rich-text-editor"],(function(e){var t,n,r;return{setters:[function(e){t=e},function(e){n=e},function(e){r=e}],execute:function(){e(function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=502)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},19:function(e,t){e.exports=r},502:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DATA_SOURCE_ID_REGEXP",(function(){return a})),n.d(r,"getDataSourceIds",(function(){return s})),n.d(r,"getUseDataSourceIds",(function(){return l})),n.d(r,"getInvalidDataSourceIds",(function(){return i})),n.d(r,"getExpressionParts",(function(){return d})),n.d(r,"BLANK_CHARATER",(function(){return f})),n.d(r,"shouldShowPlaceholder",(function(){return g})),n.d(r,"sanitizeHTML",(function(){return b})),n.d(r,"removeTextContent",(function(){return h})),n.d(r,"getDefaultValue",(function(){return m}));var o=n(0),u=n(1),c=n(19);const a=/data-dsid=\"(((?![\=|\>|\"]).)*)[\"\>|"\s)]/gm,s=(e=Object(o.Immutable)([]))=>e.map(e=>e.dataSourceId),l=e=>{const t=a;let n,r=[];for(;null!==(n=t.exec(e));){let e=n[1];e.indexOf(",")>0?(e=e.split(","),r=r.concat(e)):r.push(e)}return r},i=(e,t)=>{const n=l(e);if(null==n||n.length<=0)return;const r=s(t),o=n.filter(e=>!r.includes(e));return o.length>=0?o:void 0},d=e=>{let t=[];for(const n in e){const r=e[n],o=null==r?void 0:r.parts;null!=o&&(t=t.concat(o))}return t},f="\ufeff",p=document.createElement("div"),g=(e,t,n)=>{const r=u.richTextUtils.isBlankRichText(e)&&null!=t&&""!==t;return void 0!==n?!n&&r:r},b=(e="")=>""!==e?u.sanitizer.sanitize(e):e,h=(e="")=>{if(""===e)return e;const t=(e=>(p.innerHTML=e,p.textContent))(e);return null==e?void 0:e.replace(null==t?void 0:t.trim(),f)},m=(e,t,n,r)=>{let o=t;const u=g(t,n);return e?u&&(o=h(n)):o=u?n:t,b(o)};var v=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};const{useEffect:y,useRef:O,useState:x,useMemo:S}=o.React,j={toolbar:!1,autoformat:{link:{trigger:/[\s]/,find:/https?:\/\/[\S]+|(www\.[\S]+)/gi,transform:function(e,t){return t?"http://"+e:e},format:"link"}},clipboard:{matchers:[["img",()=>new c.Delta]]}},E=/(?!^\n$)[\n]/gm,w=(e,t)=>(t.forEach(e=>{"string"==typeof e.insert&&(e.insert=e.insert.replace(E," "))}),t),C=e=>{e.clipboard.addMatcher("*",w)},R=(e,t)=>{if(null==e)return;const n=(e=>{const t=e.clipboard.matchers;let n=-1;if(t.some(([e,t],r)=>{if("*"===e&&t===w)return n=r,!0}),n>-1)return e.clipboard.matchers.splice(n,1),!0})(e);t=b(t);const r=e.clipboard.convert(t);e.setContents(r,"silent"),c.richTextEditorUtils.setEditorCursorEnd(e,"silent"),n&&C(e)},P=e=>{const{editorRef:t,value:n,placeholder:r,enabled:a,onChange:s}=e,l=v(e,["editorRef","value","placeholder","enabled","onChange"]),[i,d]=u.hooks.useForwardRef(t),[f,p]=x(n),[b,E]=x(r),w=((e,t,n,r)=>{const o=O({enabled:e,value:t,placeholder:n,onChange:r});return y(()=>{o.current={enabled:e,value:t,placeholder:n,onChange:r}},[e,t,n,r]),o})(a,f,b,s),P=S(()=>m(a,f,b,i.current),[]),D=u.hooks.useEventCallback((e,t,n)=>{"silent"!==n&&(g(f,b,a)?E(e):p(e))});return u.hooks.useUpdateEffect(()=>{const{value:e,placeholder:t,onChange:n}=w.current,r=i.current;if(a){const n=i.current;if(g(e,t)){const e=h(t);R(n,e),n.focus()}}else g(e,t)&&R(r,t),null==n||n(e,t)},[a]),y(()=>{const e=i.current;null!=e&&C(e)},[i]),u.hooks.useUnmount(()=>{const{value:e,placeholder:t,onChange:n}=w.current;null==n||n(e,t)}),o.React.createElement(c.RichTextEditor,Object.assign({autoFocus:!0,enabled:a,editorRef:d,onChange:D,defaultValue:P,modules:j},l))},D=e=>{const{editor:t,formats:n,selection:r,useDataSources:a,widgetId:s}=e,l=o.ReactRedux.useSelector(e=>{var t;return null===(t=e.widgetsState[s])||void 0===t?void 0:t.showExpression}),i=u.hooks.useTranslate(u.defaultMessages),d=o.React.useMemo(()=>({title:i("dynamicContent"),onClose:()=>Object(o.getAppStore)().dispatch(o.appActions.widgetStatePropChange(s,"showExpression",!1))}),[s,i]);return o.React.createElement(o.React.Fragment,null,o.React.createElement(c.Bubble,{editor:t,formats:n,selection:r,source:"user"}),o.React.createElement(c.Expression,{source:"user",editor:t,formats:n,selection:r,open:l,useDataSources:a,header:d,widgetId:s}))};var I=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};const{useMemo:M,useCallback:T}=o.React,k=o.css`
  opacity: 0.5;
  background: red;
  outline: 1px solid white;
`;t.default={Editor:e=>{const{value:t,widgetId:n,useDataSources:r,onChange:u,onCreate:c,onDestory:a}=e,s=I(e,["value","widgetId","useDataSources","onChange","onCreate","onDestory"]),l=((e,t)=>T(n=>null!=n?null==e?void 0:e(n):null==t?void 0:t(),[e,t]))(c,a),d=((e,t)=>o.React.useMemo(()=>({editor:n,selection:r,formats:u})=>Object(o.jsx)(D,{editor:n,selection:r,formats:u,widgetId:e,useDataSources:t}),[t,e]))(n,r),f=((e,t)=>M(()=>{const n=i(e,t);let r;return null!=n&&n.length>0&&(r=n.map(e=>o.css`
          exp[data-dsid*="${e}"] {
           ${k}
          }
        `)),o.css`${r}`},[e,t]))(t,r);return Object(o.jsx)(P,Object.assign({editorRef:l,css:f,value:t,plugin:d,onChange:u},s))},builderUtils:r}}}))}}}));