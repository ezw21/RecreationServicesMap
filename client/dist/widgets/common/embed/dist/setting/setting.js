System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/dynamic-url-editor"],(function(e){var t,s,n,a,o;return{setters:[function(e){t=e},function(e){s=e},function(e){n=e},function(e){a=e},function(e){o=e}],execute:function(){e(function(e){var t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=521)}({0:function(e,s){e.exports=t},1:function(e,t){e.exports=s},14:function(e,t){e.exports=a},179:function(e,t){e.exports=o},2:function(e,t){e.exports=n},333:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 32"><path d="M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 11.001 3.999 2 2 0 01-.001-3.999zm0-2.666a2 2 0 01-2-2v-8a2 2 0 114 0v8a2 2 0 01-2 2z"></path></svg>'},42:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e.Url="url",e.Code="code"}(n||(n={}))},521:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return u}));var n=s(0),a=s(2),o=s(1),i={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",codePlaceholder:"Paste the HTML code you want to embed.",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression",autoRefresh:"Auto refresh",autoInterval:"Interval",autoUnit:"Minute",reloadSetting:"Do not reload iframe when URL changes"},r=s(42);var c=s(14),l=s(179);class u extends n.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=Object(n.Immutable)([c.AllDataSourceTypes.FeatureLayer,c.AllDataSourceTypes.SceneLayer]),this.embedTypeChange=e=>{const{config:t}=this.props;this.props.config.embedType!==e&&this.props.onSettingChange({id:this.props.id,config:t.set("embedType",e)})},this.checkURL=e=>{if(!e||""===e)return this.setState({urlError:""}),!0;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return this.setState({urlError:this.formatMessage("httpsUrlMessage")}),!1;if(new RegExp("^(([h][t]{2}[p][s])?://localhost)").test(e))return this.setState({urlError:""}),!0;const t=e.indexOf(".");return t<0||t===e.length-1?(this.setState({urlError:this.formatMessage("invalidUrlMessage")}),!1):(this.setState({urlError:""}),!0)},this.embedCodeChangeRightAway=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({config:t.set("embedCode",e),id:s})},this.formatMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},o.defaultMessages),i)[e]}),this.onDataSourceChange=e=>{e&&this.props.onSettingChange({id:this.props.id,useDataSources:e})},this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onSwitchChanged=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t,e)})},this.handleAutoInterval=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({id:s,config:t.set("autoInterval",e)})},this.labelChange=e=>{var t;const{config:s,id:n}=this.props,a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.props.onSettingChange({id:n,config:s.set("label",a)})},this.webAddressExpressionChange=e=>{const{config:t,onSettingChange:s,id:n,useDataSourcesEnabled:a,useDataSources:o}=this.props,{embedType:i}=t,c=/\<exp((?!\<exp).)+\<\/exp\>/gim,l=null==e?void 0:e.match(/\<urlsearch((?!\<urlsearch).)+\<\/urlsearch\>/gim),u=null==e?void 0:e.match(c),d=e&&e.replace(/<[^>]+>/g,"").replace(/(^\s*|\s*$)/g,"");(l||u)&&0===d.indexOf("{")||this.checkURL(d)?this.setState({showUrlError:!1}):this.setState({showUrlError:!0});const h=null==e?void 0:e.match(c);s(i===r.a.Url&&a&&(null==o?void 0:o.length)>0&&h?{id:n,config:t.set("expression",e)}:{id:n,config:t.set("expression",e).set("enableLabel",!1)})},this.isUsedDataSource=()=>{const{useDataSources:e,useDataSourcesEnabled:t}=this.props;return t&&e&&e.length>0},this.hasExpressionTag=e=>null==e?void 0:e.match(/\<exp((?!\<exp).)+\<\/exp\>/gim),this.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1}}render(){const{showUrlError:e,urlError:t}=this.state,{theme:i,useDataSources:u,config:d,useDataSourcesEnabled:h,id:p,selectWidgets:g}=this.props,{embedType:f,enableLabel:b,label:m}=d,x=f===r.a.Url&&h&&(null==u?void 0:u.length)>0&&this.hasExpressionTag(d.expression);return Object(n.jsx)("div",{css:(this.props.theme,n.css`
    label {
      cursor: pointer;
    }
    .embed-dynamic-con{
      z-index: 3;
      .ql-editor{
        min-height: 174px;
      }
    }
  `)},Object(n.jsx)("div",{className:"widget-iframe jimu-widget"},Object(n.jsx)("div",null,Object(n.jsx)(a.SettingSection,null,Object(n.jsx)(a.SettingRow,{label:this.formatMessage("embedBy")}),Object(n.jsx)(a.SettingRow,null,Object(n.jsx)(o.ButtonGroup,{className:"w-100"},Object(n.jsx)(o.Button,{className:"w-50",type:f===r.a.Url?"primary":"default",onClick:()=>this.embedTypeChange(r.a.Url)},this.formatMessage("url")),Object(n.jsx)(o.Button,{className:"w-50",type:f===r.a.Code?"primary":"default",onClick:()=>this.embedTypeChange(r.a.Code)},this.formatMessage("code")))),f===r.a.Url&&Object(n.jsx)(a.SettingRow,null,Object(n.jsx)("div",{className:"choose-ds w-100"},Object(n.jsx)(c.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:h,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id}))),Object(n.jsx)(a.SettingRow,null,f===r.a.Url?Object(n.jsx)("div",{className:"d-flex flex-column w-100 embed-dynamic-con"},Object(n.jsx)(l.DynamicUrlEditor,{widgetId:p,useDataSourcesEnabled:h,useDataSources:u,selectWidgets:g,onChange:this.webAddressExpressionChange,value:d.expression}),e&&Object(n.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},Object(n.jsx)(o.Icon,{size:16,icon:s(333),color:i.colors.danger}),Object(n.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:i.colors.danger}},t))):Object(n.jsx)(o.TextArea,{style:{height:"300px"},className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),value:d.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway})),x&&Object(n.jsx)(n.React.Fragment,null,Object(n.jsx)(a.SettingRow,null,Object(n.jsx)("div",{className:"d-flex justify-content-between w-100"},Object(n.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("label")),Object(n.jsx)(o.Switch,{className:"can-x-switch",checked:b||!1,"data-key":"enableLabel",onChange:e=>{this.onSwitchChanged(e.target.checked,"enableLabel")}}))),b&&Object(n.jsx)(a.SettingRow,null,Object(n.jsx)(o.TextInput,{type:"text",className:"w-100",value:m||"",onChange:this.labelChange}))),Object(n.jsx)(a.SettingRow,null,Object(n.jsx)("div",{className:"d-flex justify-content-between w-100"},Object(n.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("autoRefresh")),Object(n.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.autoRefresh||!1,"data-key":"autoRefresh",onChange:e=>{this.onSwitchChanged(e.target.checked,"autoRefresh")}}))),d.autoRefresh&&Object(n.jsx)(a.SettingRow,{flow:"wrap",label:`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`},Object(n.jsx)(o.NumericInput,{style:{width:"100%"},value:d.autoInterval||1,precision:2,min:.2,max:1440,onChange:this.handleAutoInterval}))))))}}u.mapExtraStateProps=(e,t)=>{var s,n;const a=e&&(null===(n=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===n?void 0:n.widgets),o=[];if(a)for(const e in a){const s=a[e];"widgets/common/embed/"==s.uri&&s.id!==t.id&&o.push(s)}return{appConfig:e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig,appTheme:e&&e.appStateInBuilder&&e.appStateInBuilder.theme,selectWidgets:o}}}}))}}}));