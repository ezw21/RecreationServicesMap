System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime"],(function(t){var e,i,o;return{setters:[function(t){e=t},function(t){i=t},function(t){o=t}],execute:function(){t(function(t){var e={};function i(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(o,s,function(e){return t[e]}.bind(null,s));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=497)}({0:function(t,i){t.exports=e},1:function(t,e){t.exports=i},135:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M3.433.822l8 13.856-.866.5L9.31 13H1.5v-3h1v2h6.232L4.114 4H2.5v2h.95l-1.5 2-1.5-2H1.5V3h2.036l-.97-1.678.867-.5zM14.049 8l1.5 2H14.5v3h-3.035l-.576-1H13.5v-2h-.951l1.5-2zm.451-5v3h-1V4H6.268L5.69 3h8.81z" fill="#FFF" fill-rule="evenodd"></path></svg>'},136:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.049 8l1.5 2h-1.05v3H1.502v-3H2.5v2h11v-2h-.951l1.5-2zm.451-5v3h-1V4h-11v2h.951l-1.5 2-1.5-2h1.05V3h13z" fill="#FFF" fill-rule="evenodd"></path></svg>'},16:function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return a}));var o=i(0);const s={transition:{type:o.TransitionType.None,direction:o.TransitionDirection.Horizontal},oneByOneEffect:null};var n,a,l;!function(t){t.Style0="STYLE0",t.Style1="STYLE1",t.Style2="STYLE2",t.Style3="STYLE3",t.Style4="STYLE4",t.Style5="STYLE5",t.Style6="STYLE6",t.Style7="STYLE7",t.Style8="STYLE8",t.Style9="STYLE9",t.Style10="STYLE10"}(n||(n={})),function(t){t.Regular="REGULAR",t.Hover="HOVER"}(a||(a={})),function(t){t.Horizontal="Horizontal",t.Vertical="Vertical"}(l||(l={}))},279:function(t,e){t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2 3a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4zm5-3a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zm0 7a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zm0 7a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zM2 9a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4zm0 5a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4z" fill="#FFF" fill-rule="nonzero"></path></svg>'},497:function(t,e,i){"use strict";i.r(e),i.d(e,"Widget",(function(){return y}));var o=i(0),s=i(1),n=i(16),a=i(7);class l extends o.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(t,e)=>this.props.formatMessage(t,e),this.getStyle=t=>{const{widgetId:e}=this.props,i=this.checkIsBackgroundTransparent(t);return o.css`
      &,
      .animation-list {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      ${"&.card-"+e} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent;
        z-index: 100;
      }
      .clear-background:focus {
        outline: none;
      }
      .surface-1 {
        border: none !important;
        background: ${i&&"none !important"};
      }
      ${"&.card-"+e}:hover {
      }
    `}}checkIsBackgroundTransparent(t){var e,i,o;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"==(null===(o=null===(i=null===(e=null==s?void 0:s[t])||void 0===e?void 0:e.backgroundStyle)||void 0===i?void 0:i.background)||void 0===o?void 0:o.color)}}const r=i(135),d=i(136),u=[0,5],c=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],p=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}];var h=o.ReactRedux.connect((t,e)=>{var i;const{appMode:s}=e;if(!window.jimuConfig.isInBuilder||s===o.AppMode.Run)return{selection:void 0};return{selection:e.selectionIsInCard&&(null===(i=null==t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.selection)}})(class extends l{constructor(t){super(t),this.lastResizeCall=null,this.handleCopyTo=(t,e,i,s)=>{if(!i)return;const{layouts:n,builderSupportModules:l,browserSizeMode:r,builderStatus:d}=this.props,u=l.jimuForBuilderLib.getAppConfigAction(),c=u.appConfig,p=a.searchUtils.findLayoutId(n[d],r,c.mainSizeMode),h=a.searchUtils.findLayoutId(n[e],r,c.mainSizeMode);if(s){const t=l.widgetModules.searchUtils.getContainerLayoutItem(c.layouts[h],i.widgetId,o.LayoutItemType.Widget);t&&u.removeLayoutItem({layoutId:h,layoutItemId:t.id},!1)}u.duplicateLayoutItem(p,h,i.id,!1,s),this.setState({widgetsUpdate:Symbol()}),u.exec(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()},this.editStatus=(t,e)=>{const{dispatch:i,widgetId:s}=this.props;i(o.appActions.widgetStatePropChange(s,t,e))},this.toggleStatus=t=>{var e;const{cardConfigs:i}=this.props,o=null===(e=null==i?void 0:i.HOVER)||void 0===e?void 0:e.enable,s=t===n.b.Hover;let{previousIndex:a,currentIndex:l,hoverPlayId:r,regularPlayId:d}=this.state;o&&(a=s?0:1,l=s?1:0,r=s?Symbol():null,d=s?null:Symbol()),this.setState({previousIndex:a,currentIndex:l,hoverPlayId:r,regularPlayId:d})},this.handleBreakLink=t=>{const{layouts:e,builderSupportModules:i,browserSizeMode:s,selection:n,builderStatus:l,dispatch:r}=this.props,d=i.jimuForBuilderLib.getAppConfigAction(),u=d.appConfig,c=a.searchUtils.findLayoutItem(u,n);if(!c)return;const p=a.searchUtils.findLayoutId(e[l],s,u.mainSizeMode);d.duplicateLayoutItem(p,p,c.id,!0),d.removeLayoutItem({layoutId:p,layoutItemId:c.id},!1),d.exec(),n.layoutId===p&&n.layoutItemId===c.id&&r(o.appActions.selectionChanged(null));const h=d.appConfig.layouts[p].content,g=Object.keys(h)[Object.keys(h).length-1];if(g){const t=h[g];r(o.appActions.selectionChanged({layoutId:p,layoutItemId:t.id}))}t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()},this.getCopyDropdownItems=t=>{const{cardConfigs:e,layouts:i,browserSizeMode:s,selection:l,builderStatus:r,builderSupportModules:d}=this.props,u=d.jimuForBuilderLib.getAppConfigAction().appConfig,c=a.searchUtils.findLayoutItem(u,l);if(!l||!c||!window.jimuConfig.isInBuilder)return{items:Object(o.Immutable)([]),title:""};const p=[];let h="",g=!0,v=!0;const y=(t,e)=>d.widgetModules.searchUtils.getContentsInLayoutWithLayoutWidgetOnly(u,t,o.LayoutItemType.Widget,s).indexOf(e)>-1,f=()=>{if(e[n.b.Hover]){const t=a.searchUtils.findLayoutId(i[n.b.Hover],s,u.mainSizeMode);y(t,u.layouts[l.layoutId].content[l.layoutItemId].widgetId)||(v=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:t=>{this.handleCopyTo(t,n.b.Hover,c,v)}})}},b=()=>{const t=a.searchUtils.findLayoutId(i[n.b.Regular],s,u.mainSizeMode);y(t,u.layouts[l.layoutId].content[l.layoutItemId].widgetId)||(g=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("regular").toLocaleLowerCase()}),event:t=>{this.handleCopyTo(t,n.b.Regular,c,g)}})};return r===n.b.Regular?(f(),h=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):r===n.b.Hover&&(b(),h=this.formatMessage("linkedTo",{where:this.formatMessage("regular").toLocaleLowerCase()})),t?p.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):h=this.formatMessage("isolate"),{items:Object(o.Immutable)(p),title:h}},this.getCardToolsStyle=t=>o.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:t,widgetId:e,builderSupportModules:i,browserSizeMode:a,builderStatus:l,selectionIsCard:h,selectionIsInCard:g,appMode:v,hideCardTool:y,cardConfigs:f}=this.props,b=i.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:S,BuilderDropDown:m,BuilderPopper:I,GLOBAL_RESIZING_CLASS_NAME:w,GLOBAL_H5_DRAGGING_CLASS_NAME:C,GLOBAL_DRAGGING_CLASS_NAME:j,BuilderButton:x,withBuilderTheme:O}=i.widgetModules,M=h;let L=!0;const R=!M&&t&&S&&S.getRelatedLayoutItemsInWidgetByLayoutInfo(b,t,e,a).length>1,{items:T,title:k}=this.getCopyDropdownItems(R),A=T&&T.length>0;(!g&&!M||v===o.AppMode.Run||y)&&(L=!1);const P=O(t=>Object(o.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(t)},Object(o.jsx)(x,{active:l===n.b.Regular,onClick:t=>this.handleBuilderStatusChange(t,n.b.Regular)},this.formatMessage("regular")),Object(o.jsx)(x,{active:l===n.b.Hover,className:"mt-1",onClick:t=>this.handleBuilderStatusChange(t,n.b.Hover)},this.formatMessage("hover")),!M&&(A||R)&&Object(o.jsx)(m,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:k,toggleType:"default",direction:"left",toggleContent:t=>Object(o.jsx)(s.Icon,{icon:R?d:r,size:16}),modifiers:p,items:T})));return this.props.isEditing&&f[n.b.Hover].enable&&Object(o.jsx)(I,{placement:"left-start",a11yVersion:-1,css:o.css`
            .${j} &,
            .${w} &,
            .${C} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:u,modifiers:c,open:L},P())},this.getEditorStyle=()=>o.css`
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{const{cardConfigs:t,LayoutEntry:e,layouts:i}=this.props,{hoverPlayId:a,regularPlayId:l}=this.state,r=i[n.b.Regular],d=i[n.b.Hover],u=t[n.b.Regular].backgroundStyle.setIn(["boxShadow","color"],"transparent"),c=t[n.b.Hover].backgroundStyle.setIn(["boxShadow","color"],"transparent"),p=t.transitionInfo,h=[],g=Object.assign({},s.styleUtils.toCSSStyle(u||{})),v=Object(o.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.regularLayoutRef,key:n.b.Regular},Object(o.jsx)("div",{className:"w-100, h-100 animation-list",style:g},Object(o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:l,depth:100}},Object(o.jsx)(e,{className:"h-100",isRepeat:!0,layouts:r,isInWidget:!0}))));if(h.push(v),!t[n.b.Hover].enable)return h;const y=Object.assign({},s.styleUtils.toCSSStyle(c||{})),f=Object(o.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.hoverLayoutRef,key:n.b.Hover},Object(o.jsx)("div",{className:"w-100, h-100 animation-list",style:y},Object(o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:a,depth:100}},Object(o.jsx)(e,{className:"h-100",isRepeat:!0,layouts:d,isInWidget:!0}))));return h.push(f),h},this.getCardStyle=()=>{var t,e,i,o;const{builderStatus:a,cardConfigs:l}=this.props,r=l[n.b.Hover].enable?a:n.b.Regular,d={boxShadow:null===(e=null===(t=l[r])||void 0===t?void 0:t.backgroundStyle)||void 0===e?void 0:e.boxShadow,borderRadius:null===(o=null===(i=l[r])||void 0===i?void 0:i.backgroundStyle)||void 0===o?void 0:o.borderRadius};return Object.assign({},s.styleUtils.toCSSStyle(d))},this.state={didMount:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null,widgetsUpdate:null},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.layoutRef=o.React.createRef(),this.isUpdateFirst=!0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(t){var e,i;const{cardConfigs:o,builderStatus:s}=this.props,a=t.cardConfigs,l=(null===(e=null==a?void 0:a.transitionInfo)||void 0===e?void 0:e.previewId)==(null===(i=null==o?void 0:o.transitionInfo)||void 0===i?void 0:i.previewId),r=t.builderStatus&&t.builderStatus!=s&&!this.isUpdateFirst,d=a[n.b.Hover].enable!=o[n.b.Hover].enable;(!l||r||d)&&this.toggleStatus(s),this.isUpdateFirst&&(this.isUpdateFirst=!1)}handleBuilderStatusChange(t,e){var i;this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e),null===(i=null==this?void 0:this.props)||void 0===i||i.selectSelf(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()}render(){var t,e;const{cardConfigs:i,widgetId:s,isEditing:n,builderStatus:a}=this.props,{didMount:l,previousIndex:r,currentIndex:d}=this.state,u=i.transitionInfo,c="card-"+s,p=(null==u?void 0:u.previewId)||null;return Object(o.jsx)("div",{css:this.getStyle(a),style:this.getCardStyle(),className:c},l&&this.renderCardTools(),Object(o.jsx)("div",{className:"w-100, h-100",ref:this.layoutRef},Object(o.jsx)(o.TransitionContainer,{previousIndex:r,currentIndex:d,transitionType:null===(t=null==u?void 0:u.transition)||void 0===t?void 0:t.type,direction:null===(e=null==u?void 0:u.transition)||void 0===e?void 0:e.direction,playId:l?p:null,withOneByOne:!!(null==u?void 0:u.oneByOneEffect)},this.renderCardEditor())),!n&&Object(o.jsx)("div",{className:"edit-mask position-absolute"}))}});class g extends l{constructor(t){super(t),this.handleItemClick=t=>{const{linkRef:e}=this,i=t.target&&t.target.tagName||"";"a"!==i.toLowerCase()&&"button"!==i.toLowerCase()&&"linkClick"!==t.exbEventType&&e.current&&e.current.click(),"linkClick"===t.exbEventType&&delete t.exbEventType},this.handleLinkClick=t=>{t.stopPropagation()},this.onMouse=(t,e=!1)=>{var i;t.stopPropagation();const{cardConfigs:o}=this.props,s=null===(i=null==o?void 0:o.HOVER)||void 0===i?void 0:i.enable;let{previousIndex:n,currentIndex:a,hoverPlayId:l,regularPlayId:r}=this.state;s&&(n=e?0:1,a=e?1:0,l=e?Symbol():null,r=e?null:Symbol()),this.setState({isHover:e,previousIndex:n,currentIndex:a,hoverPlayId:l,regularPlayId:r})},this.getCardContent=()=>{var t;const{cardConfigs:e,layouts:i,appMode:l,linkParam:r}=this.props;let{queryObject:d}=this.props;const{hoverPlayId:u,regularPlayId:c}=this.state,p=null==e?void 0:e.transitionInfo,h=null===(t=null==e?void 0:e.HOVER)||void 0===t?void 0:t.enable,g=[];let v,y,f,b,S,m;window.jimuConfig.isInBuilder&&l!==o.AppMode.Run?(y=this.getBackgroundStyle(n.b.Regular),v=i[n.b.Regular],h&&(b=this.getBackgroundStyle(n.b.Hover),f=i[n.b.Hover])):(v=i[n.b.Regular],y=this.getBackgroundStyle(n.b.Regular),r&&r.linkType&&(S=r.openType,m={linkType:r.linkType},r.linkType===o.LinkType.WebAddress?(m.value=(null==r?void 0:r.value)||"",d=void 0):m.value=r.value),h&&(f=i[n.b.Hover],b=this.getBackgroundStyle(n.b.Hover)));const I=Object.assign({},s.styleUtils.toCSSStyle(y||{})),w=(null==r?void 0:r.linkType)&&(null==r?void 0:r.linkType)!=o.LinkType.None,C=Object(o.jsx)("div",{className:Object(o.classNames)("card-content d-flex surface-1",w?"card-link":""),key:n.b.Regular},Object(o.jsx)("div",{className:"w-100 animation-list",style:I},w&&Object(o.jsx)(s._Link,{className:"p-0 w-100 h-100 position-absolute  border-0 clear-background",ref:this.linkRef,to:m,onClick:this.handleLinkClick,target:S,queryObject:d}),Object(o.jsx)("div",{className:"d-flex w-100 h-100",ref:this.regularLayoutRef},Object(o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:c,depth:100}},Object(o.jsx)(a.LayoutEntry,{layouts:v})))));if(g.push(C),h){const t=Object.assign({},s.styleUtils.toCSSStyle(b||{})),e=Object(o.jsx)("div",{className:Object(o.classNames)("card-content d-flex surface-1",w?"card-link":""),key:n.b.Hover},Object(o.jsx)("div",{className:"w-100 animation-list",style:t},w&&Object(o.jsx)(s._Link,{className:"p-0 w-100 h-100 position-absolute border-0 clear-background",ref:this.linkRef,to:m,onClick:this.handleLinkClick,target:S,queryObject:d}),Object(o.jsx)("div",{className:"d-flex w-100 h-100",ref:this.hoverLayoutRef},Object(o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:u,depth:100}},Object(o.jsx)(a.LayoutEntry,{layouts:f})))));g.push(e)}return g},this.getBackgroundStyle=t=>{const{cardConfigs:e}=this.props,i=e[t].backgroundStyle;return(null==i?void 0:i.boxShadow)?i.setIn(["boxShadow","color"],"transparent"):i},this.getCardShadowStyle=()=>{var t,e;const{cardConfigs:i}=this.props,{isHover:o}=this.state,a=o&&i[n.b.Hover].enable?n.b.Hover:n.b.Regular,l={boxShadow:null===(t=i[a].backgroundStyle)||void 0===t?void 0:t.boxShadow,borderRadius:null===(e=i[a].backgroundStyle)||void 0===e?void 0:e.borderRadius};return Object.assign({},s.styleUtils.toCSSStyle(l))},this.state={url:"",isHover:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.linkRef=o.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(t){var e,i;const o=this.props.cardConfigs,{cardConfigs:s}=t;(null===(e=null==o?void 0:o.transitionInfo)||void 0===e?void 0:e.previewId)==(null===(i=null==s?void 0:s.transitionInfo)||void 0===i?void 0:i.previewId)||this.setState({hoverPlayId:Symbol(),regularPlayId:Symbol()})}render(){var t,e;const{widgetId:i,cardConfigs:s}=this.props,{previousIndex:a,currentIndex:l}=this.state,r=s.transitionInfo,d="card-"+i,u=(null==r?void 0:r.previewId)||null,c=0==l?n.b.Regular:n.b.Hover;return Object(o.jsx)("div",{css:this.getStyle(c),style:this.getCardShadowStyle(),className:d,onMouseLeave:t=>{this.onMouse(t,!1)},onMouseEnter:t=>{this.onMouse(t,!0)},onClick:this.handleItemClick},Object(o.jsx)(o.TransitionContainer,{previousIndex:a,currentIndex:l,transitionType:null===(t=null==r?void 0:r.transition)||void 0===t?void 0:t.type,direction:null===(e=null==r?void 0:r.transition)||void 0===e?void 0:e.direction,playId:this.didMount?u:null,withOneByOne:!!(null==r?void 0:r.oneByOneEffect)},this.getCardContent()))}}var v={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class y extends o.React.PureComponent{constructor(t){super(t),this.setSelectionStatus=()=>{const{id:t,selectionIsInSelf:e}=this.props;this.props.dispatch(o.appActions.widgetStatePropChange(t,"selectionIsInSelf",e))},this.setSettinglayout=()=>{const{layoutId:t,layoutItemId:e,id:i,selectionIsSelf:s}=this.props,{isSetlayout:n}=this.state;t&&i&&e&&!n&&s&&(this.props.dispatch(o.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:t,layoutItemId:e})),this.setState({isSetlayout:!0}))},this.onResize=(t,e)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:t}=this.props;t&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout(()=>{this.setState({hideCardTool:!1})},500))},this.formatMessage=(t,e)=>this.props.intl.formatMessage({id:t,defaultMessage:Object.assign(Object.assign({},v),o.defaultMessages)[t]},e),this.editStatus=(t,e)=>{const{dispatch:i,id:s}=this.props;i(o.appActions.widgetStatePropChange(s,t,e))},this.editWidgetConfig=t=>{if(!window.jimuConfig.isInBuilder)return;this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,t).exec()},this.isEditing=()=>{const{appMode:t,config:e,selectionIsSelf:i,selectionIsInSelf:s}=this.props;return!!window.jimuConfig.isInBuilder&&((i||s)&&window.jimuConfig.isInBuilder&&t!==o.AppMode.Run&&e.isItemStyleConfirm)},this.editBuilderAndSettingStatus=t=>{this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t)},this.getAppConfig=()=>Object(o.getAppStore)().getState().appConfig,this.getStyle=t=>{const{id:e}=this.props;return o.css`
      ${"&.card-widget-"+e} {
        overflow: visible;
        background-color: transparent;
        border: ${o.polished.rem(0)} solid
          ${o.polished.rgba(t.colors.black,window.jimuConfig.isInBuilder&&this.isEditing()?.2:0)};
        width: 100%;
        height: 100%;
      }
    `},this.getCardProps=()=>{const{config:t,selectionIsInSelf:e,selectionIsSelf:i,builderStatus:s,appMode:n,queryObject:a}=this.props,l=window.jimuConfig.isInBuilder&&n===o.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:i,selectionIsInCard:e,isEditing:this.isEditing(),builderStatus:s,selectSelf:this.selectSelf}:{linkParam:t.linkParam,queryObject:a};return Object.assign(Object.assign({},this.getOtherProps()),l)},this.getOtherProps=()=>{const{config:t,theme:e,id:i,appMode:o,builderSupportModules:s,layouts:n,browserSizeMode:a,dispatch:l,isRTL:r,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:a,isRTL:r,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:l,widgetId:i,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:o,theme:e,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:t,isHeightAuto:d,isWidthAuto:u}},this.cardRender=()=>{const t=this.getCardProps(),{appMode:e}=this.props,i=window.jimuConfig.isInBuilder&&e===o.AppMode.Design?h:g;return Object(o.jsx)(i,Object.assign({},t))};const e={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?e.LayoutEntry=this.props.builderSupportModules.LayoutEntry:e.LayoutEntry=a.LayoutEntry,this.state=e,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=o.lodash.debounce((t,e)=>this.onResize(t,e),200)}componentDidUpdate(t,e){var i;const{appMode:s,selectionStatus:a,builderStatus:l,left:r,top:d}=this.props;s!==o.AppMode.Run&&a!==l&&a&&this.editBuilderAndSettingStatus(a),t.appMode!=s&&s===o.AppMode.Run&&this.editBuilderAndSettingStatus(n.b.Regular),(null==t?void 0:t.selectionIsInSelf)!==(null===(i=this.props)||void 0===i?void 0:i.selectionIsInSelf)&&this.setSelectionStatus(),d===t.top&&r===t.left||this.updateCardToolPosition(),this.setSettinglayout()}selectSelf(){if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:t,layoutItemId:e}=this.props,i={layoutId:t,layoutItemId:e};this.props.dispatch(o.appActions.selectionChanged(i))}render(){const{config:t,id:e}=this.props,n=Object(o.classNames)("jimu-widget","widget-card","card-widget-"+e);return t.itemStyle?Object(o.jsx)("div",{className:n,css:this.getStyle(this.props.theme)},this.cardRender(),Object(o.jsx)(o.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})):Object(o.jsx)(s.WidgetPlaceholder,{widgetId:this.props.id,icon:i(279),message:this.formatMessage("placeHolderTip")})}}y.mapExtraStateProps=(t,e)=>{var i,o,s,l,r,d,u,c,p,h,g,v,y,f;const b=t&&t.appConfig,{layouts:S,layoutId:m,layoutItemId:I,builderSupportModules:w,id:C}=e,j=null==t?void 0:t.browserSizeMode,x=(null==t?void 0:t.widgetsState[e.id])&&(null===(i=null==t?void 0:t.widgetsState[e.id])||void 0===i?void 0:i.builderStatus)||n.b.Regular,O=t&&t.appRuntimeInfo&&t.appRuntimeInfo.selection,M=O&&w&&w.widgetModules&&w.widgetModules.selectionInCard(O,C,b,!1);let L;M&&(L=Object.keys(S).find(t=>a.searchUtils.findLayoutId(S[t],j,b.mainSizeMode)===O.layoutId));const R=null===(o=b.layouts)||void 0===o?void 0:o[m],T=null===(l=null===(s=null==R?void 0:R.content)||void 0===s?void 0:s[I])||void 0===l?void 0:l.setting,k=(null===(r=null==T?void 0:T.autoProps)||void 0===r?void 0:r.height)===a.LayoutItemSizeModes.Auto||!0===(null===(d=null==T?void 0:T.autoProps)||void 0===d?void 0:d.height),A=(null===(u=null==T?void 0:T.autoProps)||void 0===u?void 0:u.width)===a.LayoutItemSizeModes.Auto||!0===(null===(c=null==T?void 0:T.autoProps)||void 0===c?void 0:c.width);let P;if(window.jimuConfig.isInBuilder){const t=null===(v=null===(g=null===(h=null===(p=b.layouts)||void 0===p?void 0:p[m])||void 0===h?void 0:h.content)||void 0===g?void 0:g[I])||void 0===v?void 0:v.bbox;P=t&&{left:t.left,top:t.top}}return{selectionIsSelf:(null==O?void 0:O.layoutId)===m&&(null==O?void 0:O.layoutItemId)===I,selectionIsInSelf:M,selectionStatus:L,appMode:null===(y=null==t?void 0:t.appRuntimeInfo)||void 0===y?void 0:y.appMode,browserSizeMode:null==t?void 0:t.browserSizeMode,builderStatus:x,isRTL:null===(f=null==t?void 0:t.appContext)||void 0===f?void 0:f.isRTL,left:P&&P.left,top:P&&P.top,isHeightAuto:k,isWidthAuto:A,queryObject:t.queryObject}};e.default=y},7:function(t,e){t.exports=o}}))}}}));