System.register(["jimu-core","jimu-ui","jimu-ui/advanced/chart","jimu-ui/basic/sql-expression-runtime"],(function(e){var t,n,l,o;return{setters:[function(e){t=e},function(e){n=e},function(e){l=e},function(e){o=e}],execute:function(){e(function(e){var t={};function n(l){if(t[l])return t[l].exports;var o=t[l]={i:l,l:!1,exports:{}};return e[l].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(l,o,function(t){return e[t]}.bind(null,o));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=481)}({0:function(e,n){e.exports=t},1:function(e,t){e.exports=n},13:function(e,t){e.exports=l},18:function(e,t,n){"use strict";n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return h})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return g})),n.d(t,"o",(function(){return m})),n.d(t,"g",(function(){return y})),n.d(t,"b",(function(){return b})),n.d(t,"i",(function(){return M})),n.d(t,"j",(function(){return z})),n.d(t,"n",(function(){return R})),n.d(t,"k",(function(){return E})),n.d(t,"l",(function(){return x})),n.d(t,"m",(function(){return w}));var l=n(0),o=n(13),r=n(21),a=n(29);const i={},u=e=>{if(null!=i[e])return i[e];const t=l.DataSourceManager.getInstance().getDataSource(e);if(null==t)return void console.error("Invalid data source id: "+e);const n=t.getIdField();return i[e]=n,n},s={},v=(e,t)=>{var n;if(null!=s[e])return s[e];const o=l.DataSourceManager.getInstance().getDataSource(t),r=null==o?void 0:o.getSchema(),a=null===(n=null==r?void 0:r.fields)||void 0===n?void 0:n[e];return s[e]=a,a},c={},d=e=>{if(null!=c[e])return c[e];const t=l.DataSourceManager.getInstance().getDataSource(e),n=null==t?void 0:t.getSchema(),o=null==n?void 0:n.fields;return c[e]=o,o},h=(e,t,n,l)=>n&&l?`${e}${a.e}${n}${a.e}${l}${a.e}${t}`:`${e}${a.e}${t}`,f=e=>null!=(null==e?void 0:e.groupByFieldsForStatistics)?r.a.ByGroup:null!=(null==e?void 0:e.outStatistics)?r.a.ByField:null!=(null==e?void 0:e.outFields)?r.a.ByFeature:void 0,p=e=>{let t,n=!1;if(null!=(null==e?void 0:e.groupByFieldsForStatistics)){t=r.a.ByGroup;const l=null==e?void 0:e.where;!1===Object(o.isAbsoluteTruthWhereClause)(l)&&(n=!0)}else null!=(null==e?void 0:e.outStatistics)?t=r.a.ByField:null!=(null==e?void 0:e.outFields)&&(t=r.a.ByFeature);return[t,n]},g=e=>{var t;return f(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query)},S=e=>{var t,n;const o=f(e);let a=Object(l.Immutable)([]);switch(o){case r.a.ByFeature:a=null===(t=null==e?void 0:e.outFields)||void 0===t?void 0:t.slice(1);break;case r.a.ByGroup:case r.a.ByField:a=null===(n=null==e?void 0:e.outStatistics)||void 0===n?void 0:n.map(e=>e.onStatisticField)}return a=a.filter(e=>null!=e&&""!==e),a},m=e=>{if(null==e)return e;const t=[];return e.forEach(e=>{t.includes(e)||t.push(e)}),t},y=e=>{const t=null==e?void 0:e.reduce((e,t)=>{var n;return e.concat(null!==(n=S(t.query))&&void 0!==n?n:[])},[]);return Object(l.Immutable)(m(t))},b=e=>{var t;return null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.x},M=e=>{var t,n;return null===(n=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query)||void 0===n?void 0:n.orderByFields},z=e=>{var t,n;return null===(n=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query)||void 0===n?void 0:n.pageSize},R=e=>{var t;return(e=>{var t,n;switch(f(e)){case r.a.ByGroup:case r.a.ByField:return null===(n=null===(t=null==e?void 0:e.outStatistics)||void 0===t?void 0:t[0])||void 0===n?void 0:n.statisticType;case r.a.ByFeature:}})(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query)},E=e=>{var t,n;return(null===(t=null==e?void 0:e.query)||void 0===t?void 0:t.where)?Object(o.getSplitByField)(null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.where):""},x=e=>{return(null==(t=null==e?void 0:e.query)?void 0:t.where)?Object(o.getSplitByValue)({where:t.where}):"";var t},w=e=>{var t;return null===(t=null==e?void 0:e.map(e=>x(e)))||void 0===t?void 0:t.filter(e=>!!e)}},21:function(e,t,n){"use strict";var l;n.d(t,"a",(function(){return l})),function(e){e.ByGroup="BYGROUP",e.ByField="BYFIELD",e.ByFeature="BYFEATURE"}(l||(l={}))},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return i})),n.d(t,"f",(function(){return u}));const l="FieldName",o="FieldValue",r=1e3,a=20,i="__",u="objectid"},30:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"n",(function(){return i})),n.d(t,"o",(function(){return u})),n.d(t,"i",(function(){return s})),n.d(t,"g",(function(){return v})),n.d(t,"h",(function(){return c})),n.d(t,"l",(function(){return d})),n.d(t,"k",(function(){return h})),n.d(t,"p",(function(){return f})),n.d(t,"m",(function(){return p})),n.d(t,"f",(function(){return g})),n.d(t,"j",(function(){return S})),n.d(t,"c",(function(){return m})),n.d(t,"b",(function(){return y})),n.d(t,"t",(function(){return b})),n.d(t,"r",(function(){return w})),n.d(t,"u",(function(){return O})),n.d(t,"s",(function(){return j})),n.d(t,"q",(function(){return T})),n.d(t,"d",(function(){return I})),n.d(t,"e",(function(){return k}));var l=n(0),o=n(1),r=n(13);const a="var(--white)",i=()=>"var(--dark)",u=()=>"var(--black)",s=()=>"var(--dark-800)",v=()=>"var(--dark-500)",c=()=>"var(--dark-800)",d=()=>"var(--dark-800)",h=()=>"var(--dark-800)",f=()=>"var(--dark-600)",p=()=>"var(--light-900)",g=()=>"var(--light-800)",S=()=>"var(--light-300)",m=["#5E8FD0","#77B484","#DF6B35","#DBCF4E","#41546D","#8257C2","#D6558B"],y="var(--light-900)",b=(e=0)=>{var t;const n=null!==(t=null==m?void 0:m.length)&&void 0!==t?t:0;if(!(n<0))return(e%=n)<0&&(e=0),m[e]},M={family:"Arial",size:14,style:r.RESTFontStyle.Normal,weight:r.RESTFontWeight.Normal,decoration:r.RESTFontDecoration.None},z={type:r.RESTSymbolType.TS,color:"var(--dark)",font:M,horizontalAlignment:r.RESTHorizontalAlignment.Center},R={type:r.RESTSymbolType.SLS,style:r.RESTSimpleLineSymbolStyle.Solid,color:"var(--light-900)",width:1},E={type:r.RESTSymbolType.SFS,style:r.RESTSimpleFillSymbolStyle.Solid,color:"var(--primary)",outline:R},x=()=>{const e=(()=>{var e,t;let n=Object(l.getAppStore)().getState();n=null!==(e=null==n?void 0:n.appStateInBuilder)&&void 0!==e?e:n;const r=null===(t=null==n?void 0:n.theme)||void 0===t?void 0:t.colors,a=null!=(null==r?void 0:r.getPalette)?r.getPalette():null==r?void 0:r.palette,i=[];return Object.keys(a).forEach(e=>{for(let t=1;t<=9;t++){const n=100*t,l=o.utils.toColorVariable(e,n);i.push(l)}}),i})(),t=e.length;return e[Math.floor(Math.random()*t)]},w=(e=14)=>Object.assign(Object.assign({},M),{size:e}),O=(e="",t=14,n="var(--dark)")=>Object.assign(Object.assign({},z),{text:e,color:n,font:w(t)}),j=(e=1,t="var(--light-900)",n=r.RESTSimpleLineSymbolStyle.Solid)=>Object.assign(Object.assign({},R),{width:e,color:t,style:n}),T=e=>{var t,n;const l=null!==(t=null==e?void 0:e.useRandomColor)&&void 0!==t&&t,o=null==e?void 0:e.useRampColor,r=null!==(n=null==e?void 0:e.outlineWidth)&&void 0!==n?n:1;let a="var(--dark)";return l?a=x():void 0!==o&&(a=b(o.colorIndex)),Object.assign(Object.assign({},E),{color:a,outline:j(r)})},F=(e="",t=!0,n,l="var(--dark)")=>({type:r.WebChartTypes.Text,visible:t,content:O(e,n,l)}),C=(e="",t)=>{const n=F(e,!1,20,"var(--dark-800)");return t?(n.content.horizontalAlignment=void 0,n.content.verticalAlignment=r.RESTVerticalAlignment.Middle,n.content.angle=270):n.content.horizontalAlignment=r.RESTHorizontalAlignment.Center,{type:r.WebChartTypes.Axis,visible:!0,title:n,labels:F("",!1,14,"var(--dark-500)"),valueFormat:{type:r.WebChartTypes.NumberAxisFormat,intlOptions:{style:"decimal",useGrouping:!0,minimumFractionDigits:0,maximumFractionDigits:3}},lineSymbol:j(1,"var(--light-800)")}};function D(e){const t=[],n=C("",!0),l=j(1,"var(--light-300)",r.RESTSimpleLineSymbolStyle.Dash);switch(e){case r.WebChartTypes.BarSeries:n.minimum=0,n.grid=l,t.push(((e="")=>{const t=F(e,!1,20,"var(--dark-800)");return t.content.horizontalAlignment=r.RESTHorizontalAlignment.Center,{type:r.WebChartTypes.Axis,visible:!0,title:t,labels:F("",!1,14,"var(--dark-500)"),valueFormat:Object(r.getDefaultCategoryFormat)(),lineSymbol:j(1,"var(--light-800)")}})(""),n);break;case r.WebChartTypes.ScatterSeries:{const e=C("");e.grid=l,n.grid=l,t.push(e,n);break}case r.WebChartTypes.HistogramSeries:n.grid=l,t.push(C(""),n)}return t}const I=e=>{let t=Object(l.Immutable)(e),n=null;if(t.version||(t=t.set("version",r.WebChartCurrentVersion)),""===t.background||null==t.background)t=t.set("background",a);else{const e=o.utils.convertJsAPISymbolColorToStringColor(t.background);t=t.set("background",e)}if(null==t.axes)n=D("barSeries"),t=t.set("axes",n);else if(null==t.axes[0].grid){const e=j(1,"var(--light-300)",r.RESTSimpleLineSymbolStyle.Dash);n=t.axes.map(t=>t.set("grid",e)),t=t.set("axes",n)}if(null==t.series){const e=(i=0,{type:r.WebChartTypes.BarSeries,id:"",name:"",x:"",y:"",colorType:r.WebChartColoringPatterns.Single,multipleBarType:r.WebChartBarSeriesKinds.Side,fillSymbol:T({useRampColor:{colorIndex:i},outlineWidth:0}),query:{groupByFieldsForStatistics:[],outStatistics:[{onStatisticField:"",statisticType:"sum",outStatisticFieldName:""}]},dataLabels:F("",!1,10,"var(--dark-600)"),rotated:!1});t=t.set("series",[e])}var i;if(null==t.title){const e=F("",!0,24,"var(--black)");t=t.set("title",e)}if(null==t.footer){const e=F("",!0,14,"var(--dark-800)");t=t.set("footer",e)}if(null==t.legend){const e=((e=!0)=>({type:r.WebChartTypes.Legend,visible:e,title:F("",!0,20,"var(--dark-800)"),body:O("",14,"var(--dark-800)"),position:r.WebChartLegendPositions.Right}))(!1);t=t.set("legend",e)}return t},B=["barSeries","lineSeries"],k=e=>{if(null==e||(null==e?void 0:e.length)<=0)return;return(e=>{if(null==e||""===e)return;const t="string"==typeof e?e:Object(r.getSeriesType)(e);return B.includes(t)})(e)?"serial":void 0}},301:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity=".01" fill="#E3E3E3" d="M0 0h16v16H0z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M16 11V0H5v3.5h1V1h9v9H8.5v1H16zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595L.25 3zm.996 1.726l-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48-4.893-2.814z" fill="#E3E3E3"></path></svg>'},302:function(e,t){e.exports='<svg viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 4a.5.5 0 01.5.5V7H10a.5.5 0 010 1H7.5v2.5a.5.5 0 01-1 0V8H4a.5.5 0 010-1h2.5V4.5A.5.5 0 017 4z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M0 7.5a7 7 0 0011.456 5.399l3.404 3.406a.668.668 0 00.945-.945l-3.406-3.404.222-.284A7 7 0 100 7.5zm1 0a6 6 0 1112 0 6 6 0 01-12 0z" fill="#000"></path></svg>'},303:function(e,t){e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.366 7.841l-.732-.682-3.125 3.349-1.635-1.84-.748.664 2.365 2.66 3.875-4.15z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 3V1.167C4.5.469 5.204 0 6 0h4c.796 0 1.5.47 1.5 1.167V3h4a.5.5 0 010 1H14l-.929 11.077a1 1 0 01-.997.923H3.926a1 1 0 01-.997-.923L2 4H.5a.5.5 0 010-1h4zM3.003 4h9.994l-.923 11H3.926L3.003 4zM10.5 1v2h-5V1c0-.04 5-.04 5 0z" fill="#000"></path></svg>'},304:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M326 58v12H45V58zM258.473 73v12H45V73zM204.015 88v12H45V88zM159 119v12H45v-12zM131.605 134v12H45v-12zM109.512 149v12H45v-12zM195 180v12H45v-12zM158.953 195v12H45v-12zM129.884 210v12H45v-12zM245 241v12H45v-12zM196.938 256v12H45v-12zM158.178 271v12H45v-12zM174 302v12H45v-12zM143 317v12H45v-12zM118 332v12H45v-12zM24 83v-8h16v8zM24 144v-8h16v8zM24 204v-8h16v8zM24 266v-8h16v8zM24 327v-8h16v8zM135 376v-8h24v8zM85 376v-8h24v8zM33 376v-8h24v8zM185 376v-8h24v8zM237 376v-8h24v8zM289 376v-8h24v8zM341 376v-8h24v8z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M376 354.501v.999h-75.5v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-22h.998v327.001H376zm-24.5.999v4h-1v-4h1z" fill="#000"></path></svg>'},305:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M24 107v-8h16v8zM24 56v-8h16v8zM24 158v-8h16v8zM24 209v-8h16v8zM24 261v-8h16v8zM24 311v-8h16v8zM24 362v-8h16v8zM128 376v-8h24v8zM72 376v-8h24v8zM189 376v-8h24v8zM250 376v-8h24v8zM311 376v-8h24v8zM58 77h12v281H58zM73 144.527h12V358H73zM88 198.984h12V358H88zM119 244h12v114h-12zM134 271.395h12V358h-12zM149 293.488h12V358h-12zM180 208h12v150h-12zM195 244.046h12v113.953h-12zM210 273.116h12V358h-12zM241 158h12v200h-12zM256 206.062h12V358h-12zM271 244.822h12V358h-12zM302 229h12v129h-12zM317 260h12v98h-12zM332 285h12v73h-12z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M49 24h-1v28h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h22v-.998H49V24z" fill="#000"></path></svg>'},306:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M132.5 67v20h-87V67zM195.5 67v20h-61V67zM243.5 67v20h-46V67zM188.5 130v20h-143v-20zM259.5 130v20h-69v-20zM325.5 130v20h-64v-20zM158.5 191v20h-113v-20zM234.5 191v20h-74v-20zM282.5 191v20h-46v-20zM114.5 253v20h-69v-20zM158.5 253v20h-42v-20zM197.5 253v20h-37v-20zM100.5 315v20h-55v-20zM163.5 315v20h-61v-20zM228.5 315v20h-63v-20zM24 79v-8h16v8zM24 140v-8h16v8zM24 200v-8h16v8zM24 262v-8h16v8zM24 323v-8h16v8zM135 372v-8h24v8zM85 372v-8h24v8zM33 372v-8h24v8zM185 372v-8h24v8zM237 372v-8h24v8zM289 372v-8h24v8zM341 372v-8h24v8z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M376 350.501v.999h-75.5v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-22h.998v327.001H376zm-24.5.999v4h-1v-4h1z" fill="#000"></path></svg>'},307:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M132 64v20H45V64zM195 64v20h-61V64zM350 64v20H197V64zM188 124v20H45v-20zM286 124v20h-96v-20zM350 124v20h-62v-20zM158 184v20H45v-20zM234 184v20h-74v-20zM350 184v20H236v-20zM114 246v20H45v-20zM272 246v20H116v-20zM350 246v20h-76v-20zM100 307v20H45v-20zM184 307v20h-82v-20zM350 307v20H186v-20zM24 79v-8h16v8zM24 140v-8h16v8zM24 200v-8h16v8zM24 262v-8h16v8zM24 323v-8h16v8zM135 372v-8h24v8zM85 372v-8h24v8zM33 372v-8h24v8zM185 372v-8h24v8zM237 372v-8h24v8zM289 372v-8h24v8zM341 372v-8h24v8z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M376 350.501v.999h-75.5v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-50v4h-1v-4h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-60h-4v-1h4v-22h.998v327.001H376zm-24.5.999v4h-1v-4h1z" fill="#000"></path></svg>'},308:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M24 107v-8h16v8zM24 56v-8h16v8zM24 158v-8h16v8zM24 209v-8h16v8zM24 261v-8h16v8zM24 311v-8h16v8zM24 362v-8h16v8zM128 376v-8h24v8zM68 376v-8h24v8zM189 376v-8h24v8zM250 376v-8h24v8zM311 376v-8h24v8zM70 271h20v87H70zM70 208h20v61H70zM70 160h20v46H70zM130 215h20v143h-20zM130 144h20v69h-20zM130 78h20v64h-20zM190 245h20v113h-20zM190 169h20v74h-20zM190 121h20v46h-20zM252 289h20v69h-20zM252 245h20v42h-20zM252 206h20v37h-20zM313 303h20v55h-20zM313 240h20v61h-20zM313 175h20v63h-20z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M49 24h-1v28h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h22v-.998H49V24z" fill="#000"></path></svg>'},309:function(e,t){e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#000" d="M24 107v-8h16v8zM24 56v-8h16v8zM24 158v-8h16v8zM24 209v-8h16v8zM24 261v-8h16v8zM24 311v-8h16v8zM24 362v-8h16v8zM128 376v-8h24v8zM68 376v-8h24v8zM189 376v-8h24v8zM250 376v-8h24v8zM311 376v-8h24v8zM70 271h20v87H70zM70 208h20v61H70zM70 72h20v134H70zM130 215h20v143h-20zM130 117h20v96h-20zM130 72h20v43h-20zM190 245h20v113h-20zM190 169h20v74h-20zM190 72h20v95h-20zM252 289h20v69h-20zM252 131h20v156h-20zM252 72h20v57h-20zM313 303h20v55h-20zM313 219h20v82h-20zM313 72h20v145h-20z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M49 24h-1v28h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v50h-4v1h4v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h60v4h1v-4h22v-.998H49V24z" fill="#000"></path></svg>'},40:function(e,t){e.exports=o},46:function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return v})),n.d(t,"f",(function(){return c}));var l=n(18),o=n(30),r=n(21);const a=e=>{if(null==e||0===e.length)return!1;const t=Object(l.d)(e),n=Object(l.b)(e),o=Object(l.g)(e),a=Object(l.n)(e);return t===r.a.ByFeature?null!=n&&""!==n&&o.length>0:t===r.a.ByGroup?null!=n&&""!==n&&o.length>0&&null!=a:t===r.a.ByField?o.length>0&&null!=a:void 0},i=(e,t,n)=>{var l;const r=null!==(l=null==t?void 0:t.fillSymbol)&&void 0!==l?l:Object(o.q)({useRampColor:{colorIndex:n},outlineWidth:0});let a=e;a=a.set("fillSymbol",r),a=a.without("id","name","y","x");return a=a.set("query",{groupByFieldsForStatistics:[],outStatistics:[{onStatisticField:"",statisticType:"sum",outStatisticFieldName:""}]}),a},u=({categoryField:e,numericField:t,statisticType:n,orderByFields:o,pageSize:r,splitByField:a,splitByValue:u,index:s},v,c)=>{const d=i(v,null==c?void 0:c[s],s),h=""+u,f=Object(l.a)(t,n,a,u),p=`${a}='${u}'`;let g=d.set("x",e).set("y",f).set("name",h).set("id",f);return g=g.setIn(["query","groupByFieldsForStatistics","0"],e),g=g.setIn(["query","outStatistics","0","onStatisticField"],t),g=g.setIn(["query","outStatistics","0","statisticType"],n),g=g.setIn(["query","outStatistics","0","outStatisticFieldName"],f),g=g.setIn(["query","where"],p),g=g.setIn(["query","orderByFields"],o),g=g.setIn(["query","pageSize"],r),g},s=e=>null==e?void 0:e[0].multipleBarType,v=e=>{var t,n;return null!==(n=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.rotated)&&void 0!==n&&n},c=e=>{if(!e||!e.includes(" "))return[];const t=e.lastIndexOf(" ");if(t!==e.indexOf(" ")){return[e.substring(0,t),e.substring(t+1)]}return e.split(" ")}},481:function(e,t,n){"use strict";n.r(t);var l,o=n(0),r=n(1),a=n(40);!function(e){e.NotReady="NOT_READY",e.Ready="READY",e.Loading="LOADING",e.Loaded="LOADED",e.LoadError="LOAD_ERROR",e.ExceedLimit="EXCEED_LIMIT"}(l||(l={}));const i={chart:null,filter:null,dataSource:null,outputDataSource:null,sourceStatus:l.NotReady},u=(e,t)=>{switch(t.type){case"SET_CHART":return Object.assign(Object.assign({},e),{chart:t.value});case"SET_FILTER":return Object.assign(Object.assign({},e),{filter:t.value});case"SET_DATA_SOURCE":return Object.assign(Object.assign({},e),{dataSource:t.value});case"SET_OUTPUT_DATA_SOURCE":return Object.assign(Object.assign({},e),{outputDataSource:t.value});case"SET_SOURCE_STATUS":return Object.assign(Object.assign({},e),{sourceStatus:t.value});default:return e}},s=o.React.createContext(void 0),v=o.React.createContext(void 0),c=e=>{const{defaultState:t,children:n}=e,[l,r]=o.React.useReducer(u,t||i);return o.React.createElement(s.Provider,{value:l},o.React.createElement(v.Provider,{value:r},n))},d=()=>o.React.useContext(s),h=()=>o.React.useContext(v),f=n(99),p=e=>{const{dataSource:t}=d(),n=h(),l=r.hooks.useTranslate(r.defaultMessages),i=o.React.useRef(null),{className:u,filter:s,widgetId:v}=e,[c,p]=o.React.useState(s),[g,S]=o.React.useState(!1),[m,y]=o.React.useState(!1);r.hooks.useUpdateEffect(()=>{null==p||p(s),S(!1),y(!1),n({type:"SET_FILTER",value:null})},[s]);return o.React.createElement(o.React.Fragment,null,o.React.createElement(r.Badge,{className:Object(o.classNames)("filter-picker",u),dot:!0,hideBadge:!g},o.React.createElement(r.Tooltip,{title:l("filter")},o.React.createElement(r.Button,{size:"sm",icon:!0,ref:i,type:"tertiary",onClick:()=>y(e=>!e)},o.React.createElement(r.Icon,{icon:f,size:16})))),m&&o.React.createElement(r.Popper,{open:m,reference:i.current,className:"p-2",toggle:()=>y(!1)},o.React.createElement("div",null,o.React.createElement(a.SqlExpressionRuntime,{widgetId:v,dataSource:t,expression:c,onChange:e=>{S(!1),null==p||p(e)}}),o.React.createElement("div",{className:Object(o.classNames)("d-flex w-100 filter-button-con",{"mt-3":m})},o.React.createElement(r.Button,{disabled:g,size:"sm",onClick:()=>{S(!0),n({type:"SET_FILTER",value:c})},type:"primary",title:l("apply")},l("apply")),o.React.createElement(r.Button,{className:"ml-3",disabled:!g,size:"sm",onClick:()=>{S(!1),n({type:"SET_FILTER",value:null})},title:l("clear")},l("clear"))))))},g=e=>{const t=null==e?void 0:e.id,n=o.ReactRedux.useSelector(e=>{var n,l;return null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[t])||void 0===l?void 0:l.sourceVersion});return o.React.useMemo(()=>{var t;return null!==(t=null==e?void 0:e.getSourceRecords())&&void 0!==t?t:[]},[e,n])},S=n(301),m=n(302),y=e=>{const t=r.hooks.useTranslate(),[n,l]=o.React.useState("selection"),{className:a,onChange:i}=e;return o.React.createElement("div",{className:Object(o.classNames)("range-cursor-mode",a)},o.React.createElement(r.Tooltip,{title:t("SelectLabel")},o.React.createElement(r.Button,{size:"sm",className:"mr-1",icon:!0,type:"tertiary",onClick:()=>{i("selection"),l("selection")},active:"selection"===n},o.React.createElement(r.Icon,{icon:S,size:16}))),o.React.createElement(r.Tooltip,{title:t("ZoomLabel")},o.React.createElement(r.Button,{size:"sm",icon:!0,type:"tertiary",onClick:()=>{i("zoom"),l("zoom")},active:"zoom"===n},o.React.createElement(r.Icon,{icon:m,size:16}))))},b=n(303),M=e=>{const t=r.hooks.useTranslate(),{className:n,onModeChange:l,onClearSelection:a}=e;return o.React.createElement("div",{className:Object(o.classNames)("selection-zoom d-flex",n)},o.React.createElement(y,{className:"mr-1",onChange:l}),o.React.createElement(r.Tooltip,{title:t("clearSelection")},o.React.createElement(r.Button,{size:"sm",icon:!0,type:"tertiary",onClick:a},o.React.createElement(r.Icon,{icon:b,size:16}))))},z=o.css`
  .tool-dividing-line {
    height: 16px;
    width: 1px;
    background-color: var(--light-400);
  }
`,R=e=>{var t,n,l;const{className:a,widgetId:i,tools:u,enableDataAction:s}=e,v=r.hooks.useTranslate()("outputStatistics",{name:null!==(l=null===(n=null===(t=Object(o.getAppStore)().getState().appConfig.widgets)||void 0===t?void 0:t[i])||void 0===n?void 0:n.label)&&void 0!==l?l:"Chart"}),{outputDataSource:c,chart:f}=d(),S=h(),m=g(c),y=null==u?void 0:u.filter,b=null==u?void 0:u.cursorEnable;o.React.useEffect(()=>{b?null==f||f.addSelectionEventListeners():null==f||f.removeSelectionEventListeners()},[b,f]);return Object(o.jsx)("div",{css:z,className:Object(o.classNames)("chart-tool-bar w-100 d-flex align-items-center justify-content-end px-2 pt-2",a)},null!=y&&Object(o.jsx)(p,{className:"mr-1",widgetId:i,filter:y,onChange:e=>{S({type:"SET_FILTER",value:e})}}),b&&Object(o.jsx)(M,{className:"mr-1",onModeChange:e=>{"selection"===e?null==f||f.enableSelection():"zoom"===e&&(null==f||f.enableZoom())},onClearSelection:()=>{null==f||f.clearSelection()}}),s&&Object(o.jsx)(o.React.Fragment,null,Object(o.jsx)("span",{className:"tool-dividing-line mx-1"}),Object(o.jsx)(r.DataActionDropDown,{type:"tertiary",dataName:v,widgetId:i,dataSource:c,records:m})))};var E=n(30),x=n(13),w=n(21),O=n(29),j=n(18),T=n(46);const F=(e,t,n)=>{const l=Object(o.useIntl)(),r=Object(j.d)(t),a=Object(j.b)(t),i=Object(j.i)(t),u=Object(j.k)(null==t?void 0:t[0]),[s,v]=o.React.useMemo(()=>((e,t,n)=>{const l=[],o=new Map;return null==e||e.forEach(e=>{const r=e.getData(),a=Object.assign({},r);if(t&&void 0!==a[t]){const l=e.getFieldValue(t),r=e.getFormattedFieldValue(t,n);if(r!==l){a[t]=r;const e=`${t}-${r}`;o.set(e,l)}}l.push(a)}),[l,o]})(e,a,l),[a,l,e]),[c,d]=o.React.useMemo(()=>C(s,t,n),[s,n]);return o.React.useMemo(()=>{(u||r===w.a.ByField)&&function(e,t,n=!1){if(null==e||null==t)return;e.sort((e,l)=>{let o=0;for(let r=0;r<t.length;r+=1){const[a,i]=Object(T.f)(t[r]),u=i===x.WebChartSortOrderKinds.Descending&&!n,s=e[a],v=l[a];if("string"==typeof s&&"string"==typeof v)o=s.localeCompare(v,void 0,{numeric:!0}),u&&(o*=-1);else if(null==s)o=u?-1:1;else if(null==v)o=u?1:-1;else{if(s>v){o=u?-1:1;break}if(s<v){o=u?1:-1;break}}}return o})}(c,i)},[r,u,c,i]),[c,v,d]},C=(e,t,n)=>{var l,o;const[r,a]=Object(j.c)(null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.query),i=new Map;let u=e;if(r===w.a.ByGroup&&a){const n=I(e,t);u=D(n,null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.x)}else r===w.a.ByField&&(u=B(e,t,n,i));return[u,i]},D=(e,t)=>{if(!t)return e;const n=[];return e.forEach(e=>{const l=n.find(n=>n[t]===e[t]),o=Object.assign({},e);l?Object.entries(o).forEach(([e,t])=>{null==l[e]&&(l[e]=t)}):n.push(o)}),n},I=(e,t)=>{var n;const l=Object(j.k)(null==t?void 0:t[0]),o=((e,t,n)=>{let l="";return e&&"object"==typeof e&&t&&n?(Object.keys(e).some(e=>{if(e!==t&&e!==n&&e!==O.f)return l=e,!0}),l):l})(null==e?void 0:e[0],null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.x,l);if(!o)return e;return e.map(e=>{var n,r;const a=Object.assign({},e),i=Object(x.normalizeString)({value:null!==(r=null===(n=a[l])||void 0===n?void 0:n.toString())&&void 0!==r?r:""}),u=((e,t)=>{var n;return null===(n=e.find(e=>Object(j.l)(e)===""+t))||void 0===n?void 0:n.y})(t,i);return u?(void 0!==a[o]&&u!==o&&(a[u]=a[o],delete a[o]),a):null})},B=(e,t,n,l)=>{var o,r;const a=Object(j.d)(t),i=Object(j.g)(t),u=Object(j.b)(t),s=null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.y;return a===w.a.ByField&&(e=null===(r=null==i?void 0:i.asMutable())||void 0===r?void 0:r.map(t=>{var o,r,a,i;const v=null!==(r=null===(o=Object(j.e)(t,n))||void 0===o?void 0:o.alias)&&void 0!==r?r:t;return v!==t&&l.set(v,t),{[u]:v,[s]:null!==(i=null===(a=null==e?void 0:e[0])||void 0===a?void 0:a[t])&&void 0!==i?i:0}})),e},k=(e,t)=>{if(null==e||null==t)return null;return e.find(e=>{const n=e.getData();return o=n,null!=(l=t)&&null!=l&&Object.entries(l).every(([e,t])=>o[e]===t);var l,o})},N=(e,t)=>null==e||null==t?null:t.map(t=>k(e,t));const H=e=>{if(!e||!e.includes(O.e))return;const t=e.split(O.e);if(2===t.length){const[e,n]=t;return{numericField:e,statisticType:n}}if(4===t.length){const[e,n,l,o]=t;return{numericField:e,splitByField:n,splitByValue:l,statisticType:o}}},A=(e,t,n)=>{var l;if(!(null==e?void 0:e.length)||!(null==t?void 0:t.length)||!n)return[];return((e,t)=>{if(!t)return e;let n=e.map(e=>{const n={};return Object.entries(e).forEach(([l,o])=>{if(l.includes(t,1)){const r=e[t],{numericField:a,splitByField:i,statisticType:u}=H(l),s=Object(j.a)(a,u,i,r);n[s]=o}else n[l]=o}),n});return n=n.map(e=>((null==e?void 0:e[O.f])&&delete e[O.f],(null==e?void 0:e[t])&&delete e[t],e)),n})(null!==(l=null==e?void 0:e.map(e=>e.getData()))&&void 0!==l?l:[],n)},L=(e,t,n,l)=>{if(!e||!(null==t?void 0:t.length))return;let o;if(l){const n=e.getSelectedRecords();o=A(n,t,l)}else{o=((e,t,n)=>{if(!(null==e?void 0:e.length)||!(null==t?void 0:t.length))return[];const l=t.filter(t=>{var n,l;const o=(null!==(l=null===(n=t)||void 0===n?void 0:n[O.f])&&void 0!==l?l:"")+"";return e.includes(o)});var o;return o=[n],l.map(e=>{const t={};return o.forEach(n=>{void 0!==e[n]&&(t[n]=e[n])}),t})})(e.getSelectedRecordIds(),t,n)}return o},V={type:"inline",data:[],processed:!0},_=(e,t,n,l)=>{const r=null==e?void 0:e.id,a=o.ReactRedux.useSelector(e=>{var t,n;return null===(n=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[r])||void 0===n?void 0:n.selectedIds}),i=o.React.useRef(),u=o.React.useRef();return o.React.useMemo(()=>{if(!e)return;if(r=u.current,s=a,!(null==r?void 0:r.length)&&!(null==s?void 0:s.length)||o.lodash.isDeepEqual(r,s))return i.current;var r,s;const v=L(e,t,n,l);return u.current=a,i.current=v,v},[e,t,n,l,a])};const U=o.React.memo((function(e){var t;const{webChart:n,widgetId:l}=e,{outputDataSource:a}=d(),i=h(),u=null==n?void 0:n.series,s=null==a?void 0:a.id,v=Object(j.d)(u),c=Object(j.b)(u),f=Object(j.k)(null==u?void 0:u[0]),p=g(a),S=((e,t)=>{const[n,l]=o.React.useState(0),a=null==e?void 0:e.title,i=null==e?void 0:e.axes,u=null==e?void 0:e.series,s=null==e?void 0:e.legend,v=null==e?void 0:e.footer;r.hooks.useUpdateEffect(()=>{l(e=>e+1)},[a,v,s,i,t]);const c=o.React.useRef(null);return r.hooks.useUpdateEffect(()=>{let e=!1;const t=null==u?void 0:u.map(e=>e.without("query")),n=null==t?void 0:t.asMutable({deep:!0});null!=n&&(e=!o.lodash.isDeepEqual(n,c.current)),c.current=n,e&&l(e=>e+1)},[u]),n})(n,null!==(t=null==u?void 0:u.length)&&void 0!==t?t:0),[m,y,b]=F(p,u,s),M=_(a,m,c,f),z=(e=[])=>{o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(l,e))},R=o.React.useMemo(()=>{var e;const t=l+"-"+(null!==(e=null==n?void 0:n.id)&&void 0!==e?e:"chart");return n.set("id",t).set("dataSource",V).set("series",null==u?void 0:u.map(e=>e.without("query"))).set("background",[0,0,0,0])},[S]),E=o.React.useCallback(e=>{i({type:"SET_CHART",value:e})},[i]);return r.hooks.useUnmount(()=>{i({type:"SET_CHART",value:null})}),o.React.createElement(x.Chart,{data:m,config:R,selectedDataItems:M,ref:E,arcgisChartsJSSelectionComplete:e=>{var t,n,l,o;if(!a)return;const r=(e=>{const{categoryType:t,selectedDataItems:n,records:l,x:o,y:r,xFormattedValueMap:a,xFieldAliasMap:i}=e;let u;u=t===w.a.ByField?null==n?void 0:n.map(e=>{const t=e[o];return{[i.get(t)]:e[r]}}):null==n?void 0:n.map(e=>{const t=Object.assign({},e),n=e[o],l=`${o}-${n}`,r=a.get(l);return t[o]=null!=r?r:n,t});return N(l,u)})({categoryType:v,selectedDataItems:null!==(t=e.detail)&&void 0!==t?t:[],records:p,x:c,y:null===(n=null==u?void 0:u[0])||void 0===n?void 0:n.y,xFormattedValueMap:y,xFieldAliasMap:b});z(r);const i=null!==(l=null==r?void 0:r.map(e=>null==e?void 0:e.getId()))&&void 0!==l?l:[],s=null!==(o=a.getSelectedRecordIds())&&void 0!==o?o:[];(i.length||s.length)&&a.selectRecordsByIds(i)}})})),q=e=>{const{widgetId:t,webChart:n}=e,l=Object(E.e)(null==n?void 0:n.series);return o.React.createElement("div",{className:"web-chart w-100"},"serial"===l&&o.React.createElement(U,{widgetId:t,webChart:n}))},W=e=>{const{widgetId:t,tools:n,enableDataAction:l=!0,webChart:r}=e,a=(e=>o.React.useMemo(()=>o.css`
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      .chart-tool-bar {
        height: 38px;
      }
      .web-chart {
        height: ${e?"calc(100% - 38px)":"100%"} !important;
      }
    `,[e]))((null==n?void 0:n.cursorEnable)||!!n.filter||l);return Object(o.jsx)("div",{css:a,className:"chart"},Object(o.jsx)(R,{tools:n,widgetId:t,enableDataAction:l}),Object(o.jsx)(q,{widgetId:t,webChart:r}))},P={bar:n(304),column:n(305),"stacked-bar":n(306),"stacked100-bar":n(307),"stacked-column":n(308),"stacked100-column":n(309)},$=e=>{const{iconSize:t,templateType:n}=e,l=o.React.useMemo(()=>(e=>P[e])(n),[n]);return o.React.createElement(r.WidgetPlaceholder,{iconSize:t,style:{position:"absolute",left:0,top:0},icon:l})};var G={_widgetLabel:"Chart",datalimitedTip:"Bar or column charts are limited 1,000 bars in total. Please filter or re-aggregate your data and try again."};const Y=e=>{const t=Object(T.c)(e),n=Object(T.d)(e);if(null==t||null==n)return;const l=n?"bar":"column",o="sideBySide"===t?"":t;return o?`${o}-${l}`:l},Q=(e,t)=>({dataSourceLabel:null==t?void 0:t.getLabel(),widgetLabel:(e=>{var t,n,l;const r=o.appConfigUtils.getWidgetIdByOutputDataSource(e);return null===(l=null===(n=null===(t=Object(o.getAppStore)().getState())||void 0===t?void 0:t.appConfig.widgets)||void 0===n?void 0:n[r])||void 0===l?void 0:l.label})(e)}),J=o.css`
  display: flex;
  justify-content: center;
  .alert-tooltip-button{
    position: absolute;
    right: 10px;
    bottom: 10px;
  }
  .alert-panel {
    position: absolute;
    max-width: calc(100% - 20px);
    width: auto !important;
    bottom: 10px;
  }
`,K=e=>{const{templateType:t,showMessage:n,message:l,messageType:a="tooltip",className:i}=e;return Object(o.jsx)("div",{className:Object(o.classNames)("placeholder-container w-100 h-100",i),css:J},Object(o.jsx)($,{iconSize:"large",templateType:t}),n&&Object(o.jsx)(r.Alert,{form:a,withIcon:!0,size:"small",type:"warning",text:l}))};var Z=function(e,t,n,l){return new(n||(n=Promise))((function(o,r){function a(e){try{u(l.next(e))}catch(e){r(e)}}function i(e){try{u(l.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}u((l=l.apply(e,t||[])).next())}))};const X=e=>{if(!e)return!1;const t=e.getInfo();return t&&Object.keys(t).length>0},ee=(e,t,n,r,a)=>{const i=h(),[u,s]=o.React.useState([]);return o.React.useEffect(()=>{let r=!1;const u=(e=>{if(!X(e))return!1;const t=e.getStatus();return t&&t!==o.DataSourceStatus.NotReady})(e),v=X(t);u&&v&&null!==n&&(r=!0),r&&Z(void 0,void 0,void 0,(function*(){try{i({type:"SET_SOURCE_STATUS",value:l.Loading});const t=yield e.query(n),o=null==t?void 0:t.records;a&&o.length>a?i({type:"SET_SOURCE_STATUS",value:l.ExceedLimit}):(i({type:"SET_SOURCE_STATUS",value:l.Loaded}),s(o))}catch(e){i({type:"SET_SOURCE_STATUS",value:l.LoadError}),console.error(e)}}))},[r,t,n]),u},te=(e,t,n,l)=>{var a;const i=((e,t)=>{const n=o.ReactRedux.useSelector(t=>{var n,l;return(null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[e])||void 0===l?void 0:l.status)!==o.DataSourceStatus.NotReady}),l=o.ReactRedux.useSelector(t=>{var n,l;return null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[e])||void 0===l?void 0:l.instanceStatus}),a=o.ReactRedux.useSelector(t=>{var n,l;return null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[e])||void 0===l?void 0:l.widgetQueries}),i=o.ReactRedux.useSelector(t=>{var n,l;return null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[e])||void 0===l?void 0:l.gdbVersion}),u=o.ReactRedux.useSelector(t=>{var n,l;return null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[e])||void 0===l?void 0:l.sourceVersion}),s=o.ReactRedux.useSelector(e=>{var n,l;return null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[t])||void 0===l?void 0:l.widgetQueries}),v=o.ReactRedux.useSelector(e=>{var n,l;return null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[t])||void 0===l?void 0:l.sourceVersion}),c=o.ReactRedux.useSelector(e=>{var n,l;return null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[t])||void 0===l?void 0:l.gdbVersion}),[d,h]=o.React.useState(0);return r.hooks.useUpdateEffect(()=>{l===o.DataSourceStatus.Created&&n&&h(e=>e+1)},[l,n,a,s,v,u,i,c]),d})(null==e?void 0:e.id,null===(a=null==e?void 0:e.belongToDataSource)||void 0===a?void 0:a.id),u=ee(e,t,n,i,l);o.React.useEffect(()=>{if(!X(t)||!u)return;const e=ne(u);t.setSourceRecords(e),t.setStatus(o.DataSourceStatus.Unloaded),t.setCountStatus(o.DataSourceStatus.Unloaded)},[t,u])},ne=e=>null==e?void 0:e.map((e,t)=>{const n=e,l=n.getData();return l[O.f]=t,n.feature.attributes=l,e}),le=e=>{var t,n;const l=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query,r=null!==(n=null==e?void 0:e.length)&&void 0!==n?n:0;return o.React.useMemo(()=>Object(T.e)(e)?(e=>{var t;const[n,l]=Object(j.c)(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.query);let r=Object(o.Immutable)({});if(void 0!==e[0].query){r=e[0].query;let t=e[0].x+" IS NOT NULL";switch(n){case w.a.ByFeature:e.length>1&&(r=((e,t)=>(t.slice(1).forEach(t=>{var n,l,o;const r=null===(l=null===(n=t.query)||void 0===n?void 0:n.outFields)||void 0===l?void 0:l[1],a=(null!==(o=e.outFields)&&void 0!==o?o:[]).concat(r?[r]:[]);e=e.set("outFields",a)}),e))(r,e));break;case w.a.ByGroup:if(l){const n=Object(j.k)(e[0]);""!==n&&(t=Object(x.combineFilters)([t,n+" IS NOT NULL"]),r=r.set("where",t),r=((e,t,n)=>(void 0!==e.groupByFieldsForStatistics?!1===e.groupByFieldsForStatistics.includes(t)&&(e=e.set("groupByFieldsForStatistics",e.groupByFieldsForStatistics.concat(t))):n===t&&(e=e.set("groupByFieldsForStatistics",[n])),e))(r,n,e[0].x))}else e.length>1&&(r=((e,t)=>(t.slice(1).forEach(t=>{var n,l,o;const r=(null!==(n=e.outStatistics)&&void 0!==n?n:[]).concat(null!==(o=null===(l=t.query)||void 0===l?void 0:l.outStatistics)&&void 0!==o?o:[]);e=e.set("outStatistics",r)}),e))(r,e));break;case w.a.ByField:}}return r=r.set("returnGeometry",!1),r})(e):null,[l,r])},oe=e=>{const{widgetId:t,series:n,useDataSource:a,outputDataSourceId:i}=e,{dataSource:u,outputDataSource:s,sourceStatus:v}=d(),c=h(),f=(null==n?void 0:n.length)?O.c/(null==n?void 0:n.length):void 0,p=le(n);te(u,s,p,f),((e,t)=>{const n=h(),{sourceStatus:a}=d(),i=r.hooks.useRefValue(a);r.hooks.useUpdateEffect(()=>{e||n({type:"SET_SOURCE_STATUS",value:l.NotReady})},[e]);const u=o.ReactRedux.useSelector(t=>{var n,l;return null===(l=null===(n=t.dataSourcesInfo)||void 0===n?void 0:n[null==e?void 0:e.dataSourceId])||void 0===l?void 0:l.status});o.React.useEffect(()=>{u===o.DataSourceStatus.NotReady&&i.current!==l.NotReady?n({type:"SET_SOURCE_STATUS",value:l.NotReady}):i.current===l.NotReady&&n({type:"SET_SOURCE_STATUS",value:l.Ready})},[n,u,i]),r.hooks.useUpdateEffect(()=>{null==t&&i.current!==l.NotReady&&n({type:"SET_SOURCE_STATUS",value:l.Ready})},[t])})(a,p),((e,t)=>{r.hooks.useUpdateEffect(()=>{t!==l.LoadError&&t!==l.ExceedLimit||e.getStatus()!==o.DataSourceStatus.NotReady&&(e.setStatus(o.DataSourceStatus.NotReady),e.setCountStatus(o.DataSourceStatus.NotReady))},[t,e])})(s,v),(e=>{const{dataSource:t,filter:n}=d(),l=r.hooks.useRefValue(t);o.React.useEffect(()=>{var t;l.current&&l.current.updateQueryParams({where:null!==(t=null==n?void 0:n.sql)&&void 0!==t?t:"1=1"},e)},[l,n,e])})(t);const g=o.React.useMemo(()=>{if(i)return Object(o.Immutable)({dataSourceId:i,mainDataSourceId:i})},[i]);return o.React.createElement(o.React.Fragment,null,o.React.createElement(o.DataSourceComponent,{widgetId:t,useDataSource:a,onDataSourceCreated:e=>{c({type:"SET_DATA_SOURCE",value:e})}}),o.React.createElement(o.DataSourceComponent,{widgetId:t,useDataSource:g,onDataSourceCreated:e=>{c({type:"SET_OUTPUT_DATA_SOURCE",value:e})},onDataSourceSchemaChange:()=>{s&&s.getStatus()!==o.DataSourceStatus.NotReady&&(s.setStatus(o.DataSourceStatus.NotReady),s.setCountStatus(o.DataSourceStatus.NotReady))}}))},re=e=>{const{dataSource:t,sourceStatus:n}=d(),{widgetId:a,useDataSource:i,config:u,enableDataAction:s}=e,{tools:v,webChart:c,_templateType:h}=u,f=(p=null==c?void 0:c.background,o.React.useMemo(()=>o.css`
      position: relative;
      background-color: ${p} !important;
    `,[p]));var p;const g=((e,t)=>{const n=Y(e);return n||(null!=t?t:"column")})(null==c?void 0:c.series,h),S=(e=>e===l.Loaded||e===l.Loading)(n),m=i&&(e=>e===l.NotReady||e===l.ExceedLimit||e===l.LoadError)(n),y=n===l.ExceedLimit?"basic":"tooltip",b=((e,t,n)=>{const a=r.hooks.useTranslate(o.defaultMessages,r.defaultMessages,G);let i="";if(e===l.NotReady){const e=Q(t,n);i=a("outputDataIsNotGenerated",{outputDsLabel:e.dataSourceLabel,sourceWidgetName:e.widgetLabel})}else e===l.ExceedLimit?i=a("datalimitedTip"):e===l.LoadError&&(i=a("widgetLoadError"));return i})(n,i,t);return Object(o.jsx)("div",{css:f,className:"chart-runtime w-100 h-100"},S&&Object(o.jsx)(W,{widgetId:a,webChart:c,enableDataAction:s,tools:v}),!S&&Object(o.jsx)(K,{templateType:g,message:b,messageType:y,showMessage:m}))};t.default=e=>{var t;const{outputDataSources:n,useDataSources:l,config:r,id:a,enableDataAction:i}=e;return o.React.createElement("div",{className:"jimu-widget widget-chart "},o.React.createElement(c,null,o.React.createElement(oe,{widgetId:a,series:null===(t=null==r?void 0:r.webChart)||void 0===t?void 0:t.series,useDataSource:null==l?void 0:l[0],outputDataSourceId:null==n?void 0:n[0]}),o.React.createElement(re,{widgetId:a,useDataSource:null==l?void 0:l[0],config:r,enableDataAction:i})))}},99:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M15 0v1.53h-.062L9.556 6.825v7.982a.5.5 0 01-.851.356l-2.26-2.224V6.818L1.07 1.53H1V0h14zm-1 1H2v.042l5.444 5.357v6.121l1.111 1.093V6.406L14 1.05V1z" fill="#C5C5C5" fill-rule="nonzero"></path><circle cx="3" cy="3" r="3" transform="translate(15 -5)" fill="#050505"></circle></g></svg>'}}))}}}));