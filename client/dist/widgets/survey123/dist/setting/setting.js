System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-for-builder"],(function(e){var t,s,i,r,n;return{setters:[function(e){t=e},function(e){s=e},function(e){i=e},function(e){r=e},function(e){n=e}],execute:function(){e(function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=530)}({0:function(e,s){e.exports=t},1:function(e,t){e.exports=s},10:function(e,t){e.exports=n},2:function(e,t){e.exports=i},4:function(e,t){e.exports=r},476:function(e,t){e.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.462 12l10.235 10.235a1.034 1.034 0 11-1.462 1.462L12 13.462 1.765 23.697a1.034 1.034 0 11-1.462-1.462L10.538 12 .303 1.765A1.034 1.034 0 111.765.303L12 10.538 22.235.303a1.034 1.034 0 111.462 1.462L13.462 12z" fill="#000" fill-rule="nonzero"></path></svg>'},477:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 32"><path d="M19.6 26.267a2.8 2.8 0 01-2.8 2.8h-3.733C5.85 29.067 0 23.217 0 16S5.85 2.933 13.067 2.933H16.8a2.8 2.8 0 010 5.6h-3.733a7.467 7.467 0 100 14.934H16.8a2.8 2.8 0 012.8 2.8zm8.4-2.8h3.733a7.467 7.467 0 100-14.934H28a2.8 2.8 0 010-5.6h3.733C38.95 2.933 44.8 8.783 44.8 16s-5.85 13.067-13.067 13.067H28a2.8 2.8 0 010-5.6zM15.867 13.2h13.067a2.8 2.8 0 010 5.6H15.867a2.8 2.8 0 010-5.6z"></path></svg>'},530:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return d}));var i=s(0),r=s(10),n=s(2),a=s(4),o=s(1),l=s(54),u={chooseSurvey:"Select which survey to run in the widget:",createNewSurveyLabel:"Create new survey",chooseSurveyLabel:"Select existing survey",draftSurveyPostfix:" (draft)",previewDraftSurveyMsg:"This survey is not published yet. Edit and publish the survey to preview the content here.",selectSurveyTip:"Please select",noExistingSurvey:"There is no available survey to this account.",searchHint:"Search",surveyDetailLabel:"Survey Details:",currentSurveyLabel:"Current survey",resetSurveyLabel:"Reset survey",summaryLabel:"Summary",insertLabel:"Insert",surveyTitleLabel:"Name",surveyTitleRequiredMsg:"The name of the survey is required.",surveyTitleDuplicateMsg:"A survey with this name already exists, please use a different name.",surveyTagLabel:"Tags",surveyTagHint:"Separate tags with commas",surveyTagsRequiredMsg:"One or more tags are required.",surveySummaryLabel:"Summary",createSurveyBtn:"Create",editSurveyBtn:"Edit survey",appearanceTitle:"Appearance",showOptionsBarLabel:"Show options bar",showOptionsHeaderLabel:"Show survey header",showOptionsDesLabel:"Show survey description",showOptionsFooterLabel:"Show survey footer",useSurveyTheme:"Enable survey theme",resetSurveyTip:"Reset survey will remove all settings to this survey widget.",confirmResetSurveyTip:"Are you sure you want to continue?",sendDataToSurveyTitle:"Send data to this survey",sendDataToSurveyDesc:"Attributes and geometry of a feature in the source layer can be sent to survey questions.",sendDataDisabled1:"Please add a map widget that contains at least one feature layer to use this capability.",sourceLayer:"Source layer",selectSourceWidget:"Select an interactive map",selectSourceLayer:"Select the source layer",triggerEventListTitle:"Trigger event for sending data",triggerEventSelect:"When an existing feature is selected",triggerEventAdd:"When a new feature is added",triggerEventDesc1:"Data will be sent to this survey when a feature is selected in the layer.",addConnTitle:"Field/question connections",addConnSelectField:"Select a field",addConnSelectQuestion:"Select a survey question",addConnFailed1:"The survey question type is not compatible with the field type.",addConnBtn:"Add connection",geometryLabel:"*Shape",geometryTypePoint:"Point",geometryTypeMultiPoint:"MultiPoint",geometryTypePolyline:"Polyline",geometryTypePolygon:"Polygon",errmsgGeneralLoading:"An error occurred while loading.",errmsgGeneralCreatingNewSvy:"An error occurred while creating the new survey. Pleasey try again later.",msgUnsavedBeforeLeaving:"Changes you made may not be saved."};function c(e){var t;const s=null===(t=null==e?void 0:e.components)||void 0===t?void 0:t.input;return i.css`
    &.survey123{
      input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0px 1000px ${s.bg} inset;
        -webkit-text-fill-color: ${s.color};
      }
      .survey123__section {

          input + span {
            // margin-left:5px; 
          }
          .jimu-widget-setting--section-header.row >h6 {
            font-size: 0.875rem;
            color: ${e.colors.palette.dark[600]};
          }

          .survey-list-msg {
            padding: 0 5px;
          }
          .survey-list-loading-outter {
            position: relative;
            top: -18px;
          }
          .survey123__section-createSurvey, .select-survey-section {
            .error-message {
              color: ${e.colors.danger};
            }
            .no-survey-message {
              color: ${e.colors.palette.dark[400]};
            }
          }
          .select-survey-section {
            hr.split-line {
              display: none;
            }
          }
          .create-survey-container {
            .jimu-widget-setting--row.items {
              margin-top: 1.2rem;
              display: block;
              h6 {
                color: ${e.colors.palette.dark[500]};
              }
              div.w-100 {
                font-size: 0.8125rem;
                line-height: 1.1875rem;
                margin-top: 0.3125rem;

              }
            }
            .jimu-widget-setting--row >label {
              font-size: 0.875rem;
              font-weight: 400;
              +p.w-100 {
                font-size: 0.8125rem;
                line-height: 1.1875rem;
                margin-top: 0.3125rem;
              }
            }
          }
      
          .appearance, .section-title {
            display: flex;
            justify-content: space-between;
            width:100%;
            h6 {
              margin-bottom: 0;
            }
          }

          .select{
            select {
              width: 100%;
            }
          }

          .mapping-container {
            padding: 0.615em;
            background: ${e.colors.secondary};
            border-radius: 2px;
            margin: 0.6em 0;
            position: relative;
            >select {
              height: 26px;
              vertical-align: middle;
              font-size: 1em;
              line-height: 26px;
              padding: 0 22px 0 6px;
              &:first-of-type {
                margin-bottom: 8px;
              }
            }
            .btn-group {
              width: 100%;
              overflow: hidden;
              .icon-remove-mapping {
                padding: 0 0.25em;
                margin-left: 0;
                margin-right: 0;
                svg.left-icon {
                  margin-right: 0;
                  margin-left: 0;
                }
              }
              button {
                margin: 8px 0 8px 8px;
                height: 26px;
                line-height: 26px;
                padding: 0;
                padding: 0px 14px;
              }
            }
            >.link-info {
              > p {
                margin-bottom: 0;
                line-height: 2em;
              }
              > div.center-line {
                width: 96%;
                height: 1px;
                background: ${e.colors.palette.secondary[800]};
                text-align: center;
                margin: 0.5em 2% 0.5em 2%;
                >.connect {
                  display: inline-block;
                  width: 26px;
                  height: 20px;
                  background: ${e.colors.secondary};
                  position: relative;
                  top: -10px;
                }
              }
              > div.delete-connect {
                display: none;
                position: absolute;
                right: 0;
                top: 0;
                cursor: pointer;
                background: ${e.colors.palette.secondary[400]};
                text-align: center;
                width: 24px;
                height: 24px;
              }
              &:hover > div.delete-connect {
                display: block;
              }
            }
            
          }

          .setting-row {
            margin: 0.5rem 0 0 0;
            display: flex;
            flex-flow: row wrap;
            align-items: center;
          }
      
          .section-title h5{
            display: inline-block;
            font-weight: 500;
          }
          
          .section-title h6{
            word-break: break-word;
          }

          .fea-layer-outter {
            flex-wrap:wrap;
          }

          .use-feature-layer-setting {
            width: 100%;
            margin-top: 0.92em;
          }
          .feature-layer-dropdown {
            width: 100%;
            margin: 0.5rem 0 0 0;
          }
          &-resetSurvey {
            position:relative;
            // top: -8px;
            height: 26px;
            float:right;
            line-height: 8px;

            svg {
              margin:0px !important;
            }
          }

          .cursor-pointer{
            &:hover{
              cursor:pointer;
            }
          }
            
          &-surveyMenu {}
      
          &-selectExistingSurvey {}
      
          &-createSurvey {
            overflow-y: hidden;
            
            span.isRequired{
              position:relative;
              /* left:-180px; */
              color: ${e.colors.danger};
              top: 4px;
              left: 4px;
            }
          }
      
          &-surveySettings {
            
          }
        }
    }
  `}const p={style:{maxWidth:228}};class d extends i.React.PureComponent{constructor(e){super(e),this.supportedMapTypes=Object(i.Immutable)([a.ArcGISDataSourceTypes.WebMap]),this.supportedLayerTypes=Object(i.Immutable)([i.DataSourceTypes.FeatureLayer]),this.dsManager=i.DataSourceManager.getInstance(),this.state={newSurveyTitle:null,newSurveyTags:null,newSurveyTitleDirty:!1,newSurveyTagsDirty:!1,newSurveySnippet:null,newSurveyItemId:null,newSurveyThumbnailUrls:["https://survey123.arcgis.com/assets/img/default-thumbnails/Image01.png","https://survey123.arcgis.com/assets/img/default-thumbnails/Image02.png","https://survey123.arcgis.com/assets/img/default-thumbnails/Image03.png"],newSurveyMsg:null,newSurveyLoading:!1,existSurveyMsg:null,existSurveys:[],selectedSurvey:null,modalIsOpen:!1,mode:"none",isCheckedSurveyItemId:!1,isShowSurveyQuestionField:!1,surveyQuestionFields:[],selectedQuestionField:null,createSurveyErrorMsg:null,surveyStatusCode:0,isShowCloseDesignerAlert:!1,surveyChanged:!1,dsMapView:null,dsFeatureLayer:null,dsFeatureLayerFields:[],mapWidgetList:[],addMapping:null,editMapping:null},this.newDefaultValue={key:"",value:""},this.API={survey123:null,Survey123WebForm:null},this.isPortal=!1,this.isOrgAdmin=!1,this.iconRefresh=s(66),this.closeIcon24=s(476),this.iconLink=s(477),this.iconRemove=s(80),this.prepare=()=>Promise.resolve(!0).then(()=>{if(this.isPortal){const e=this.props.config.portalUrl||this.props.portalUrl;return l.a.getSurveyHostUrlFromPortal(e)}return!0}).then(()=>!this.isPortal||this.loadSurveyAPI()),this.componentDidMount=()=>{const e=this.props.useDataSources,t=e&&e.length?e[0].dataSourceId:null;if(t){const e=this.dsManager.getDataSource(t),s=e?e.layer:null;this.setState({dsFeatureLayer:s,dsFeatureLayerFields:this.getLayerFields(s)})}const s=this.props.user;this.isOrgAdmin=!(!s||"org_admin"!==s.role),this.isPortal=!i.portalUrlUtils.isAGOLDomain(this.props.config.portalUrl||this.props.portalUrl)},this.loadSurveyAPI=()=>{const e=l.a.getSurvey123HostAPIUrl();return this.API.survey123?Promise.resolve(this.API.survey123):i.moduleLoader.loadModule(e).then(e=>(this.API=e,e))},this.getLayerFields=e=>{if(!e)return[];const t=Object.assign({},{fields:e.fields}).fields;if("feature"!==e.type)return t;if((t||[]).find(e=>"geometry"===e.name))return t;const s=e.geometryType,i=this.nls("geometryType"+s.substr(0,1).toUpperCase()+s.substr(1));return t.push({alias:`${this.nls("geometryLabel")}(${i})`,name:"geometry"}),t},this.onValueChanged=e=>{const t=e.currentTarget;this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t.name,t.value)})},this.nls=e=>this.props.intl.formatMessage({id:e,defaultMessage:u[e]}),this.addDefaultValue=e=>{this.newDefaultValue.key&&this.newDefaultValue.value&&(this.newDefaultValue={key:"",value:""})},this.addDesigerHandler=()=>{window.addEventListener("message",e=>{if(e.data){let t=e.data;try{"string"==typeof e.data&&(t=JSON.parse(e.data)||{})}catch(e){}if("survey123:design:onFormPublished"===t.event&&t.data){let e=this.state.surveyStatusCode||0;e++,r.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"surveyStatusCode",value:e}),this.setState({surveyStatusCode:e}),this.handleCloseModal()}else"survey123:design:onFormUnsaved"===t.event&&t.data?this.setState({surveyChanged:!0}):"survey123:design:onFormSaved"===t.event&&t.data&&this.setState({surveyChanged:!1})}})},this.getFielAlias=e=>{const t=(this.state.dsFeatureLayerFields||[]).find(t=>t.name===e);return t?t.alias||t.name:e},this.getQuestionLabel=e=>{const t=(this.state.surveyQuestionFields||[]).find(t=>t.name===e);return t?t.label||t.name:e},this.onNewSurveyValueChanged=(e,t)=>{const s=e.currentTarget;t&&this.setState({[t]:s.value}),"newSurveyTags"===t&&this.setState({newSurveyTagsDirty:!0}),"newSurveyTitle"===t&&this.setState({newSurveyTitleDirty:!0})},this.onExistSurveyChanged=e=>{const t=e.currentTarget;if(t.value&&"null"!==t.value){const e=this.state.existSurveys.find(e=>e.id===t.value);this.updateMapWidgetList(),this.setState({selectedSurvey:e})}},this.createSurvey=()=>{const e=this.state.newSurveyTitle;let t=null;this.state.newSurveyTags&&(this.state.newSurveyTags+"").trim()&&(t=(this.state.newSurveyTags||"").split(",").map(e=>e.trim()));const s=this.state.newSurveySnippet;if(e||this.setState({newSurveyTitleDirty:!0}),this.state.newSurveyTags||this.setState({newSurveyTagsDirty:!0}),e&&t&&t.length)return Promise.resolve(!0).then(()=>{var i;this.setState({newSurveyMsg:"",newSurveyLoading:!0});const r=parseInt(10*Math.random()+"")%3,n=this.state.newSurveyThumbnailUrls[r];if(this.isPortal){const s={title:e,tags:t,token:this.props.token,thumbnailUrl:n,portalUrl:this.props.config.portalUrl||this.props.portalUrl};return this.API.survey123.createSurvey(s)}return l.a.createSurvey(e,t,{token:this.props.token,username:null===(i=this.props.user)||void 0===i?void 0:i.username,portalUrl:this.props.config.portalUrl||this.props.portalUrl},{snippet:s,thumbnailUrl:n})}).then(e=>{if(this.isPortal&&e.id||!this.isPortal&&!0===e.success)return this.updateMapWidgetList(),this.setState({createSurveyErrorMsg:null,newSurveyItemId:e.id,selectedSurvey:e,newSurveyLoading:!1}),e.id;throw e}).then(e=>{e&&(this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hides",["navbar","header","description","footer","theme"])}),this.showSurvey123DesignerModal(e))}).catch(e=>{if(e){if(e.error&&e.error.code+""=="400")return this.setState({createSurveyErrorMsg:this.props.intl.formatMessage({id:"surveyTitleDuplicateMsg",defaultMessage:u.surveyTitleDuplicateMsg}),newSurveyLoading:!1,newSurveyTitleDirty:!1}),null;this.setState({newSurveyMsg:e.message?e.message:"string"==typeof e?e:"",newSurveyLoading:!1})}console.error(e)})},this.querySurvey=e=>(e=Object.assign({isShared:!1,isPublished:!1},e||{}),Promise.resolve(!0).then(()=>{var t;if(this.props.config.surveyItemId&&this.props.config.selectedSurvey){const s=this.props.config.selectedSurvey;setTimeout(()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",s.id)}),this.updateMapWidgetList(),this.setState({existSurveyMsg:null,mode:"settings",selectedSurvey:s})},0);const i={isShared:e.isShared,isPublished:e.isPublished,queryFromClient:this.isPortal,surveyClientAPI:this.API};return this.isOrgAdmin&&(i.searchSurveyType="all-admin"),l.a.querySurvey({username:null===(t=this.props.user)||void 0===t?void 0:t.username,token:this.props.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl},i).then(e=>{this.setState({existSurveys:e})})}}).then(()=>{"none"===this.state.mode&&this.setState({mode:"survey-createSurvey"}),this.setState({existSurveyMsg:'<div class="survey-list-loading-outter"><div class="jimu-secondary-loading"></div></div>'});const t={isShared:e.isShared,isPublished:e.isPublished,queryFromClient:this.isPortal,surveyClientAPI:this.API};return this.isOrgAdmin&&(t.searchSurveyType="all-admin"),l.a.querySurvey({username:this.props.user.username,token:this.props.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl},t)}).then(e=>{this.setState({existSurveyMsg:null,existSurveys:e}),e&&e.length||this.setState({existSurveyMsg:`<p class="no-survey-message">${this.props.intl.formatMessage({id:"noExistingSurvey",defaultMessage:u.noExistingSurvey})}</p>`});const t=this.props.config.surveyItemId;if(t){const s=e.find(e=>e.id===t);s&&(this.updateMapWidgetList(),this.setState({selectedSurvey:s}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedSurvey",s)}))}}).catch(e=>{this.setState({mode:"survey-createSurvey",existSurveyMsg:`<p class="error-message">${this.props.intl.formatMessage({id:"errmsgGeneralLoading",defaultMessage:u.errmsgGeneralLoading})}</p>`}),console.log(e)})),this.getSurveyQuestionFields=()=>{const e=this.props.config.surveyItemId;return Promise.resolve(!0).then(()=>{if(e&&this.props.token&&this.isPortal&&this.API.getForm){const t={itemId:e,token:this.props.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl||"https://www.arcgis.com"};return this.API.getForm(t).then(e=>e&&e.questions?e.questions:null)}return null}).then(t=>t||(e&&this.props.token?l.a.getSurveyQuestionFields(e,{token:this.props.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl||"https://www.arcgis.com"}):null)).then(e=>(e&&this.setState({surveyQuestionFields:e}),e))},this.showSettingPage=()=>{this.setState({mode:"settings"}),this.getSurveyQuestionFields()},this.handleCloseModal=()=>{if(this.state.surveyChanged)return void this.setState({isShowCloseDesignerAlert:!0});this.setState({modalIsOpen:!1}),this.setState({surveyChanged:!1}),this.showSettingPage();const e=this.state.newSurveyItemId||this.props.config.surveyItemId;e&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",e).set("timestamp",Date.now())}),this.querySurvey()},this.handleCloseDesignerAlert=e=>{this.setState({isShowCloseDesignerAlert:!1}),e&&(this.setState({surveyChanged:!1}),setTimeout(()=>{this.handleCloseModal()},0))},this.getThumbnailUrl=()=>{const e=this.props.config.portalUrl||this.props.portalUrl||"https://www.arcgis.com",t=this.state.selectedSurvey.id,s=this.state.selectedSurvey.thumbnail;return(s+"").startsWith("http://")||(s+"").startsWith("https://")?s:`${e}/sharing/rest/content/items/${t}/info/${s}?token=${this.props.token}`},this.setSurveyItemId=()=>{const e=this.state.selectedSurvey;e&&e.id&&(this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",e.id).set("hides",["navbar","header","description","footer","theme"])}),this.setState({mode:"settings"}))},this.editSurvey=()=>{this.showSurvey123DesignerModal()},this.setAppearance=(e,t)=>{const s=[].concat(this.props.config.hides||[]);if(e&&s.indexOf(t)>=0){const e=s.indexOf(t);s.splice(e,1)}else s.push(t);this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hides",s)})},this.onMapWidgetSelected=e=>{e&&e.length||this.clearMapping(),this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.updateMapWidgetList=()=>{const e=window._appState,t=window&&window.jimuConfig&&window.jimuConfig.isBuilder?e.appStateInBuilder&&e.appStateInBuilder.appConfig:e.appConfig,s=t&&t.widgets,i=s?Object.keys(s).filter(e=>s[e]&&s[e].manifest&&s[e].manifest.properties&&s[e].manifest.properties.canCreateMapView).map(e=>s[e]):[];this.setState({mapWidgetList:i})},this.activeLinkDataChange=e=>{const t=e.currentTarget.checked;t&&this.updateMapWidgetList(),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("activeLinkData",t)})},this.onFieldSelected=(e,t,s)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["title","field"],t.name),useDataSources:[{dataSourceId:this.props.useDataSources[0].dataSourceId,mainDataSourceId:this.props.useDataSources[0].mainDataSourceId,dataViewId:this.props.useDataSources[0].dataViewId,rootDataSourceId:this.props.useDataSources[0].rootDataSourceId,fields:[t.name]}]})},this.onDataSourceSelected=e=>{e||this.clearMapping();const t=e?e.dataSourceId:null,s=this.dsManager.getDataSource(t),i=s?s.layer:null;t&&s&&i||this.clearMapping(),this.setState({dsFeatureLayer:i,dsFeatureLayerFields:this.getLayerFields(i)});const r=e?e.rootDataSourceId:null;this.props.onSettingChange({id:this.props.id,useDataSources:[{dataSourceId:t,mainDataSourceId:t,rootDataSourceId:r}],config:this.props.config.set("layerViewInfo",e).set("fieldQuestionMapping",null)})},this.addMapppingChange=(e,t)=>{const s=t.currentTarget.value;let i=this.state.addMapping?this.state.addMapping.field:null,r=this.state.addMapping?this.state.addMapping.question:null;"field"===e?i=s:r=s,this.setState({addMapping:{field:i,question:r}})},this.clearMapping=()=>{},this.onDataSourceRemoved=()=>{},this.triggerEventTypeChange=()=>{},this.showEditMappingPanel=(e,t)=>{if((this.state.editMapping||{}).index===e)return;let s=this.props.config.fieldQuestionMapping||[];s=e>=0&&e<s.length?s[e]:null;const i=Object.assign({},s);i.index=e,this.setState({editMapping:i,addMapping:null})},this.changeEditMapping=(e,t)=>{const s=t.currentTarget.value,i=Object.assign({},this.state.editMapping||{});"field"===e?i.field=s:i.question=s,this.setState({editMapping:i})},this.editMapping=e=>{const t=[].concat(this.props.config.fieldQuestionMapping||[]),s=this.state.editMapping||{};e>=0&&e<t.length&&(t[e]={field:s.field,question:s.question}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",t)})},this.activeAddFieldQuestionConnPanel=()=>{this.setState({addMapping:{field:null,question:null},editMapping:null})},this.deactiveAddFieldQuestionConnPanel=()=>{this.setState({addMapping:null})},this.deleteConnection=(e,t)=>{t&&t.stopPropagation();const s=[].concat(this.props.config.fieldQuestionMapping||[]);e>=0&&e<s.length&&s.splice(e,1),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",s)})},this.addFieldQuestionConn=e=>{const t=this.state.addMapping.field,s=this.state.addMapping.question;if(!t||!s)return void console.log("Please ensure field/question is not null.");const i=[].concat(this.props.config.fieldQuestionMapping||[]);i.push({field:t,question:s}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",i)}),this.deactiveAddFieldQuestionConnPanel()},this.onSurveyQuestionFieldChanged=e=>{const t=e.currentTarget.value;t&&"null"!==t&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedSurveyQuestionFields",[t])})},this.isDsConfigured=()=>!(!this.props.useDataSources||1!==this.props.useDataSources.length),this.resetSurvey=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",null).set("hides",[]).set("embeds",["fullScreen","onSubmitted"]).set("selectedSurveyQuestionFields",[]).set("fieldQuestionMapping",[]).set("activeLinkData",!1).set("dsType",null).set("selectedSurvey",null)}),this.setState({mode:"survey-createSurvey",selectedSurvey:null,isCheckedSurveyItemId:!1,surveyQuestionFields:[],dsMapView:null,dsFeatureLayer:null,dsFeatureLayerFields:[]})},l.a.setQueryObject(this.props.queryObject),this.isPortal=!i.portalUrlUtils.isAGOLDomain(this.props.config.portalUrl||this.props.portalUrl);const t=this.props.user;this.isOrgAdmin=!(!t||"org_admin"!==t.role),this.prepare().then(()=>{this.querySurvey(),this.addDesigerHandler()})}showSurvey123DesignerModal(e){e=e||this.props.config.surveyItemId;const t=i.SessionManager.getInstance(),s=this.props.config.portalUrl||this.props.portalUrl;if(!e)throw new Error("cannot get survey item id to open survey123 designer");let r=l.a.getSurvey123DesignerUrl(e,{portalUrl:s});const n=t.getMainSession();n&&n.token&&n.username&&n.tokenDuration&&(r+=`#access_token=${n.token}&username=${n.username}&expires_in=${n.tokenDuration}`),this.setState({modalIsOpen:!0,newSurveyMsg:null});const a=this;let o=0;const u=setInterval(()=>{a.state.modalIsOpen||a.setState({modalIsOpen:!0}),o++;const e=document.getElementById("survey123-designer");(e||o>100)&&(clearInterval(u),e.src=r)},50)}render(){return this.state.selectedSurvey&&this.props.config.surveyItemId&&!1===this.state.isCheckedSurveyItemId&&(this.setState({isCheckedSurveyItemId:!0}),this.showSettingPage()),Object(i.jsx)("div",{css:c(this.props.theme),className:"jimu-widget-setting survey123"},Object(i.jsx)("div",{className:"survey123__section",style:-1!==this.state.mode.indexOf("survey-")?{display:"block"}:{display:"none"}},Object(i.jsx)(n.SettingSection,null,Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("p",null,this.props.intl.formatMessage({id:"chooseSurvey",defaultMessage:u.chooseSurvey}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Radio,{name:"survey-survey",className:"cursor-pointer",id:"survey-survey-createNewSurvey",checked:"survey-createSurvey"===this.state.mode,onChange:()=>{this.setState({mode:"survey-createSurvey"})}}),Object(i.jsx)(o.Label,{for:"survey-survey-createNewSurvey",className:"cursor-pointer"},"  ",this.props.intl.formatMessage({id:"createNewSurveyLabel",defaultMessage:u.createNewSurveyLabel}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Radio,{name:"survey-survey",className:"cursor-pointer",id:"survey-survey-chooseExistingSurvey",checked:"survey-selectExistingSurvey"===this.state.mode,onChange:()=>{this.setState({mode:"survey-selectExistingSurvey"})}}),Object(i.jsx)(o.Label,{for:"survey-survey-chooseExistingSurvey",className:"cursor-pointer"},"  ",this.props.intl.formatMessage({id:"chooseSurveyLabel",defaultMessage:u.chooseSurveyLabel})))),Object(i.jsx)("div",{className:"survey123__section-selectExistingSurvey",style:"survey-selectExistingSurvey"===this.state.mode?{display:"block"}:{display:"none"}},Object(i.jsx)(n.SettingSection,{className:"select-survey-section"},Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Select,{onChange:this.onExistSurveyChanged,disabled:0===this.state.existSurveys.length,value:this.state.selectedSurvey?this.state.selectedSurvey.id:"null",menuProps:p,style:{width:"100%",padding:"2px 5px"}},Object(i.jsx)("option",{value:"null"},this.props.intl.formatMessage({id:"selectSurveyTip",defaultMessage:u.selectSurveyTip})),this.state.existSurveys.length>0?this.state.existSurveys.map(e=>Object(i.jsx)("option",{value:e.id,key:e.id},Object(i.jsx)("div",{css:i.css`text-overflow: ellipsis; white-space: nowrap;overflow: hidden;`,title:e.title},e.title))):"")),Object(i.jsx)("div",{className:"survey-list-msg",dangerouslySetInnerHTML:{__html:this.state.existSurveyMsg}})),Object(i.jsx)("div",{style:{display:this.state.selectedSurvey?"block":"none"}},Object(i.jsx)(n.SettingSection,{title:this.nls("surveyDetailLabel"),className:"create-survey-container"},this.state.selectedSurvey?[Object(i.jsx)(n.SettingRow,{key:"surveyThumnail"},Object(i.jsx)("img",{src:this.getThumbnailUrl(),style:{width:"100%",height:"auto"}})),Object(i.jsx)(n.SettingRow,{key:"surveyTitle"},Object(i.jsx)("span",{style:{wordBreak:"break-word",fontSize:"0.8125rem",color:"#FFFFFF"}},this.state.selectedSurvey.title)),this.state.selectedSurvey.snippet?Object(i.jsx)(n.SettingRow,{className:"items",key:"surveySnippet"},Object(i.jsx)("h6",null,this.nls("summaryLabel")),Object(i.jsx)("div",{className:"w-100"},this.state.selectedSurvey.snippet)):null,Object(i.jsx)(n.SettingRow,{key:"surveyInsertBtn"},Object(i.jsx)(o.Button,{type:"primary",className:"w-100",onClick:this.setSurveyItemId},this.props.intl.formatMessage({id:"insertLabel",defaultMessage:u.insertLabel})))]:null))),Object(i.jsx)("div",{className:"survey123__section-createSurvey",style:"survey-createSurvey"===this.state.mode?{display:"block"}:{display:"none"}},Object(i.jsx)(n.SettingSection,null,Object(i.jsx)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2"},Object(i.jsx)("div",null,this.nls("surveyTitleLabel"),Object(i.jsx)("span",{className:"isRequired"},"*")),Object(i.jsx)(o.TextInput,{className:"w-100",value:this.state.newSurveyTitle||"",onChange:e=>this.onNewSurveyValueChanged(e,"newSurveyTitle")}),!this.state.newSurveyTitle&&this.state.newSurveyTitleDirty?Object(i.jsx)("div",{className:"error-message"},this.props.intl.formatMessage({id:"surveyTitleRequiredMsg",defaultMessage:u.surveyTitleRequiredMsg})):"",this.state.createSurveyErrorMsg&&!this.state.newSurveyTitleDirty?Object(i.jsx)("div",{className:"error-message"},this.props.intl.formatMessage({id:"surveyTitleDuplicateMsg",defaultMessage:u.surveyTitleDuplicateMsg})):""),Object(i.jsx)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2"},Object(i.jsx)("div",null,this.nls("surveyTagLabel"),Object(i.jsx)("span",{className:"isRequired"},"*")),Object(i.jsx)(o.TextInput,{className:"w-100",value:this.state.newSurveyTags||"",onChange:e=>this.onNewSurveyValueChanged(e,"newSurveyTags")}),!this.state.newSurveyTags&&this.state.newSurveyTagsDirty?Object(i.jsx)("div",{className:"error-message"},this.props.intl.formatMessage({id:"surveyTagsRequiredMsg",defaultMessage:u.surveyTagsRequiredMsg})):""),Object(i.jsx)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2"},Object(i.jsx)("div",null,this.nls("surveySummaryLabel")),Object(i.jsx)(o.TextInput,{className:"w-100",value:this.state.newSurveySnippet||"",onChange:e=>this.onNewSurveyValueChanged(e,"newSurveySnippet")})),Object(i.jsx)(n.SettingRow,{flow:"wrap"},Object(i.jsx)(o.Button,{type:"primary",className:"w-100",disabled:!0===this.state.newSurveyLoading,onClick:this.createSurvey},this.props.intl.formatMessage({id:"createSurveyBtn",defaultMessage:u.createSurveyBtn})),Object(i.jsx)("span",{style:{color:"#ff0000",marginTop:"10px"}},this.state.newSurveyMsg),Object(i.jsx)("div",{className:"w-100",style:{position:"relative",display:"block",marginTop:"50px"}},Object(i.jsx)("div",{className:"jimu-secondary-loading",style:!0===this.state.newSurveyLoading?{display:"block"}:{display:"none"}})))))),Object(i.jsx)("div",{className:"survey123__section",style:-1!==this.state.mode.indexOf("settings")?{display:"block"}:{display:"none"}},Object(i.jsx)(n.SettingSection,null,Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"section-title"},Object(i.jsx)("h6",null,this.state.selectedSurvey?this.state.selectedSurvey.title:""),Object(i.jsx)(o.Button,{className:"survey123__section-resetSurvey",onClick:()=>this.setState({mode:"confirmResetSurvey"})},Object(i.jsx)(o.Icon,{size:"8",icon:this.iconRefresh})))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Button,{className:"w-100",color:"primary",type:"primary",onClick:this.editSurvey},this.props.intl.formatMessage({id:"editSurveyBtn",defaultMessage:u.editSurveyBtn})))),Object(i.jsx)(n.SettingSection,{title:this.nls("appearanceTitle")},Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"appearance"},Object(i.jsx)("span",null,this.props.intl.formatMessage({id:"showOptionsBarLabel",defaultMessage:u.showOptionsBarLabel})),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.hides.indexOf("navbar")<0,onChange:e=>{this.setAppearance(e.target.checked,"navbar")}}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"appearance"},Object(i.jsx)("span",null,this.props.intl.formatMessage({id:"showOptionsHeaderLabel",defaultMessage:u.showOptionsHeaderLabel})),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.hides.indexOf("header")<0,onChange:e=>{this.setAppearance(e.target.checked,"header")}}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"appearance"},Object(i.jsx)("span",null,this.props.intl.formatMessage({id:"showOptionsDesLabel",defaultMessage:u.showOptionsDesLabel})),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.hides.indexOf("description")<0,onChange:e=>{this.setAppearance(e.target.checked,"description")}}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"appearance"},Object(i.jsx)("span",null,this.props.intl.formatMessage({id:"showOptionsFooterLabel",defaultMessage:u.showOptionsFooterLabel})),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.hides.indexOf("footer")<0,onChange:e=>{this.setAppearance(e.target.checked,"footer")}}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"appearance"},Object(i.jsx)("span",null,this.props.intl.formatMessage({id:"useSurveyTheme",defaultMessage:u.useSurveyTheme})),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.hides.indexOf("theme")<0,onChange:e=>{this.setAppearance(e.target.checked,"theme")}})))),Object(i.jsx)(n.SettingSection,null,Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("div",{className:"section-title"},Object(i.jsx)("h6",null,this.nls("sendDataToSurveyTitle")),Object(i.jsx)(o.Switch,{className:"can-x-switch",checked:this.props.config.activeLinkData,onChange:this.activeLinkDataChange}))),this.props.config.activeLinkData&&Object(i.jsx)(i.React.Fragment,null,this.state.mapWidgetList&&this.state.mapWidgetList.length>0?Object(i.jsx)(i.React.Fragment,null,Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("span",{className:"w-100"},this.nls("sendDataToSurveyDesc"))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("span",null,this.nls("selectSourceWidget"))),Object(i.jsx)("div",{className:"setting-row"},Object(i.jsx)(n.JimuMapViewSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:this.props.useMapWidgetIds})),Object(i.jsx)(n.SettingRow,{className:"fea-layer-outter"},Object(i.jsx)(n.SettingRow,{className:"use-feature-layer-setting"},Object(i.jsx)("span",null,this.nls("selectSourceLayer"))),Object(i.jsx)("div",{className:"feature-layer-dropdown"},Object(i.jsx)(n.JimuLayerViewSelector,{onSelect:this.onDataSourceSelected,useMapWidgetIds:this.props.useMapWidgetIds,jimuLayerViewInfo:this.props.config&&this.props.config.layerViewInfo}))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("span",{className:"w-100"},this.nls("triggerEventDesc1"))),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("span",null,this.nls("addConnTitle"))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length&&this.props.config&&this.props.config.layerViewInfo&&this.props.config.layerViewInfo.dataSourceId?Object(i.jsx)(i.React.Fragment,null,this.props.config.fieldQuestionMapping&&this.props.config.fieldQuestionMapping.length>0?Object(i.jsx)("div",null,this.props.config.fieldQuestionMapping.asMutable().map((e,t)=>{const s=e.field,r=e.question;return Object(i.jsx)("div",{key:s+"_"+r+"_"+t,className:"mapping-container"},this.state.editMapping&&this.state.editMapping.index===t?Object(i.jsx)(i.React.Fragment,null,Object(i.jsx)(o.Select,{value:this.state.editMapping.field||"",style:{marginBottom:"8px"},onChange:e=>this.changeEditMapping("field",e)},this.state.dsFeatureLayerFields.map(e=>Object(i.jsx)("option",{key:"edit_"+e.name+"_"+t,value:e.name},e.alias||e.name))),Object(i.jsx)(o.Select,{value:this.state.editMapping.question||"",onChange:e=>this.changeEditMapping("question",e)},this.state.surveyQuestionFields.length>0&&this.state.surveyQuestionFields.map(e=>Object(i.jsx)("option",{key:"edit_"+e.name+"_"+t,value:e.name},e.label))),Object(i.jsx)("div",{className:"btn-group"},Object(i.jsx)(o.Button,{className:"float-left icon-remove-mapping",type:"primary",color:"primary",onClick:()=>{this.deleteConnection(t),this.setState({editMapping:null})}},Object(i.jsx)(o.Icon,{size:"16",style:{marginLeft:"0",marginRight:"0"},icon:this.iconRemove})),Object(i.jsx)(o.Button,{className:"float-right",type:"secondary",onClick:()=>{this.setState({editMapping:null})}},this.nls("cancel")),Object(i.jsx)(o.Button,{className:"float-right",type:"primary",color:"primary",onClick:()=>{this.editMapping(t),this.setState({editMapping:null})}},this.nls("ok")))):Object(i.jsx)(i.React.Fragment,null,Object(i.jsx)("div",{className:"link-info",onClick:e=>this.showEditMappingPanel(t,e)},Object(i.jsx)("p",null,this.getFielAlias(s)),Object(i.jsx)("div",{className:"center-line"},Object(i.jsx)("div",{className:"connect"},Object(i.jsx)(o.Icon,{size:"16",icon:this.iconLink}))),Object(i.jsx)("p",null,this.getQuestionLabel(r)),Object(i.jsx)("div",{className:"delete-connect",onClick:e=>this.deleteConnection(t,e)},Object(i.jsx)(o.Icon,{size:"12",icon:this.iconRemove})))))})):"",this.state.addMapping&&this.state.dsFeatureLayer&&this.state.dsFeatureLayerFields&&this.state.dsFeatureLayerFields.length>0&&Object(i.jsx)("div",{className:"mapping-container"},Object(i.jsx)(o.Select,{value:this.state.addMapping.field||"null",style:{marginBottom:"8px"},onChange:e=>this.addMapppingChange("field",e)},Object(i.jsx)("option",{key:"add_field_default",value:"null"},this.nls("addConnSelectField")),this.state.dsFeatureLayerFields.map(e=>Object(i.jsx)("option",{key:"add_"+e.name,value:e.name},e.alias||e.name))),Object(i.jsx)(o.Select,{value:this.state.addMapping.question||"null",onChange:e=>this.addMapppingChange("question",e)},Object(i.jsx)("option",{key:"add_question_default",value:"null"},this.nls("addConnSelectQuestion")),this.state.surveyQuestionFields.length>0&&this.state.surveyQuestionFields.map(e=>Object(i.jsx)("option",{key:"add_"+e.name,value:e.name},e.label))),Object(i.jsx)("div",{className:"btn-group"},Object(i.jsx)(o.Button,{className:"float-right",type:"secondary",onClick:this.deactiveAddFieldQuestionConnPanel},this.nls("cancel")),Object(i.jsx)(o.Button,{className:"float-right",type:"primary",disabled:!this.state.addMapping.field||"null"===this.state.addMapping.field||!this.state.addMapping.question||"null"===this.state.addMapping.question,onClick:this.addFieldQuestionConn},this.nls("ok"))))):"",Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Button,{className:"w-100",type:"primary",disabled:null!==this.state.addMapping||null!==this.state.editMapping||!(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length&&this.props.config&&this.props.config.layerViewInfo&&this.props.config.layerViewInfo.dataSourceId),onClick:this.activeAddFieldQuestionConnPanel},this.nls("addConnBtn")))):Object(i.jsx)(n.SettingRow,null,Object(i.jsx)("span",null,this.nls("sendDataDisabled1")))))),Object(i.jsx)("div",{className:"survey123__section",style:-1!==this.state.mode.indexOf("confirmResetSurvey")?{display:"block"}:{display:"none"}},Object(i.jsx)(n.SettingSection,{title:this.nls("resetSurveyLabel")},Object(i.jsx)(n.SettingRow,null,this.props.intl.formatMessage({id:"resetSurveyTip",defaultMessage:u.resetSurveyTip})),this.props.intl.formatMessage({id:"confirmResetSurveyTip",defaultMessage:u.confirmResetSurveyTip}),Object(i.jsx)(n.SettingRow,null),Object(i.jsx)(n.SettingRow,null,Object(i.jsx)(o.Button,{type:"primary",onClick:()=>this.resetSurvey()},this.nls("yes")),Object(i.jsx)(o.Button,{onClick:()=>this.showSettingPage()},this.nls("no"))))),Object(i.jsx)(o.Modal,{isOpen:this.state.modalIsOpen,className:"w-100 h-100 p-0 m-0",css:i.css`
          z-index: 100000;
          overflow: hidden;
          max-width: 100% !important;
          .modal-content{
            width: 100%;
            height: 100%;
          }
        `},Object(i.jsx)("div",{style:{width:"100%",height:"80px",padding:"23px 60px 23px 30px",color:"#ffffff",backgroundColor:"#000000"}},Object(i.jsx)("p",{style:{fontSize:"24px",marginBottom:0,lineHeight:"33px"}},this.props.intl.formatMessage({id:"editSurveyBtn",defaultMessage:u.editSurveyBtn})),Object(i.jsx)("button",{color:"primary",onClick:this.handleCloseModal,style:{position:"absolute",top:"28px",right:"30px",backgroundColor:"#000000",color:"#ffffff",border:"0px",cursor:"pointer",padding:0}},Object(i.jsx)(o.Icon,{size:"24",icon:this.closeIcon24}))),Object(i.jsx)("iframe",{id:"survey123-designer",width:"100%",style:{height:"calc(100% - 90px)",width:"100%",border:"0px"}}),Object(i.jsx)(o.AlertPopup,{isOpen:this.state.isShowCloseDesignerAlert,okLabel:this.nls("ok"),title:this.props.label,toggle:this.handleCloseDesignerAlert},Object(i.jsx)("div",{style:{fontSize:"1rem"}},this.nls("msgUnsavedBeforeLeaving")))))}}},54:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i=new class{setQueryObject(e){const t=e?e.survey123:"",s=t?decodeURIComponent(t+""):"",i=this._urlParamToJson(s);this.queryObj=i}getSurveyHostUrlFromPortal(e){if(e=e||"https://www.arcgis.com",this.surveyUrlFromPortal||null===this.surveyUrlFromPortal)return Promise.resolve(this.surveyUrlFromPortal);const t=window.esriGeowConfig;if(t&&t.surveyUrl)return this.surveyUrlFromPortal=t.surveyUrl,Promise.resolve(this.surveyUrlFromPortal);let s="";e.endsWith("/")||(e+="/"),s=e+"home/js/arcgisonline/config.js";const i=document.createElement("script");return i.type="text/javascript",i.src=s,new Promise((e,t)=>{i.onload=()=>{const t=window.esriGeowConfig;t&&t.surveyUrl?(this.surveyUrlFromPortal=t.surveyUrl,e(t.surveyUrl)):(this.surveyUrlFromPortal=null,e(null))},i.onerror=()=>{console.log("Failed to get survey url from portal's config.js, will fallback to use the default survey123 url."),this.surveyUrlFromPortal=null,e(null)},document.getElementsByTagName("head")[0].appendChild(i)})}getSurvey123HostUrl(){let e="https://survey123.arcgis.com";this.surveyUrlFromPortal&&(e=this.surveyUrlFromPortal);let t=window.jimuConfig.hostEnv;if(this.queryObj&&this.queryObj.env&&(t=this.queryObj.env+"",t.startsWith("http://")||t.startsWith("https://")))return t;let s=!0;if("https://survey123.arcgis.com"!==e){const t=e.match(/https:\/\/survey123(.[^\.]*)\.arcgis\.com/);s=!(!t||!t.length)}return t&&"prd"!==t&&"prod"!==t&&s&&(e=`https://survey123${t}.arcgis.com`),e}getSurvey123HostAPIUrl(){let e=this.getSurvey123HostUrl()+"/api/jsapi/3.12";return this.queryObj&&this.queryObj.jsapi&&(e=this.getSurvey123HostUrl()+"/api/jsapi/"+this.queryObj.jsapi),e}createSurvey(e,t,s,i){return i=Object.assign({snippet:""},i||{}),Promise.resolve(!0).then(()=>{if(!(e&&t&&s&&s.token&&s.username))throw new Error("missing title, tags, username or token")}).then(()=>{const r=this.getSurvey123HostUrl()+"/api/survey/create",n={title:e,tags:t.join(","),snippet:i.snippet,thumbnailUrl:i.thumbnailUrl,token:s.token,username:s.username,portalUrl:s.portalUrl||"https://www.arcgis.com"};return fetch(r,{mode:"cors",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(e=>{if(e.ok)return e.json();throw e})})}isPortal(e){return!["www.arcgis.com","devext.arcgis.com","qaext.arcgis.com"].find((t,s)=>-1!==e.indexOf(t))}querySurvey(e,t){return t=Object.assign({isShared:!1,isPublished:!0,isSearchAll:!0,queryFromClient:!1,surveyClientAPI:null},t||{}),Promise.resolve(!0).then(()=>{if(!e||!e.token||!e.username)throw new Error("missing token or username")}).then(()=>{const s={isShared:t.isShared,isPublished:t.isPublished,isSearchAll:t.isSearchAll,token:e.token,username:e.username,portalUrl:e.portalUrl||"https://www.arcgis.com"};if(t.searchSurveyType&&(s.searchSurveyType=t.searchSurveyType),t.queryFromClient)return t.surveyClientAPI?t.surveyClientAPI.survey123.searchSurvey(s).then(e=>{if(e&&e.results)return e.results;throw e}):(console.log("Survey client api is not provided."),null);{let e=this.getSurvey123HostUrl()+"/api/survey/search";return e=`${e}?${Object.keys(s).map(e=>e+"="+s[e]).join("&")}`,fetch(e,{mode:"cors",method:"GET"}).then(e=>{if(e.ok)return e.json();throw e}).then(e=>{if(e&&e.results)return e.results;if(e&&Array.isArray(e))return e;throw e})}})}getSurvey123DesignerUrl(e,t){t=Object.assign({},t||{});let s=`${this.getSurvey123HostUrl()}/surveys/${e}/design?embed=exb`;return t.portalUrl&&"https://www.arcgis.com"!==t.portalUrl&&(s+="&portalUrl="+t.portalUrl),("https://survey123dev.arcgis.com"===this.getSurvey123HostUrl()&&!t.portalUrl||"https://www.arcgis.com"===t.portalUrl)&&(s+="&portalUrl="+t.portalUrl),s}getSurvey123WebformUrl(e,t){t=Object.assign({queryParams:[]},t||{});let s=`${this.getSurvey123HostUrl()}/share/${e}`;return t.queryParams.length>0&&(s+="?"+t.queryParams.join("&")),s}flatQuestions(e){let t=[];return e.forEach(e=>{e.questions?"esriQuestionTypeRepeat"!==e.type&&(t=t.concat(this.flatQuestions(e.questions))):t.push(e)}),t}getSurveyQuestionFields(e,t){return Promise.resolve(!0).then(()=>{if(!e||!t||!t.token)throw new Error("missing surveyItemId or token")}).then(()=>{let s=`${this.getSurvey123HostUrl()}/api/survey/${e}/form`;const i={token:t.token};return s=`${s}?${Object.keys(i).map(e=>e+"="+i[e]).join("&")}`,fetch(s,{mode:"cors",method:"GET"}).then(e=>{if(e.ok)return e.json();throw e})}).then(e=>{const t=[];if(e&&e.questions&&e.questions.length>0){this.flatQuestions(e.questions).forEach(e=>{const s=(e.type+"").replace("esriQuestionType","");(e.fieldName||["geopoint","polyline","polygon"].indexOf(s.toLowerCase())>=0)&&t.push({name:e.fieldName||e.name,label:e.label})})}return t})}_urlParamToJson(e){if(!e)return null;const t=(e+="").split(";");if(t.length<2&&e.split(":").length<2)return e.split(",").length>1?e.split(","):e;{const e={};return t.forEach(t=>{const s=(t+"").split(":");if(s.length>1){const t=s[0];let i=(Array.isArray(s.slice(1))?s.slice(1):[]).join(":");i.length&&"{"===i[0]&&(i=this._stringToJson(i)),"string"==typeof i&&i.split(",").length>1&&(i=i.split(",")),e[t]=i}}),e}}_stringToJson(e){let t=e;try{t=JSON.parse(e)}catch(s){t=e}return t}}},66:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},80:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M2.561 7.876l1.138 20.023C3.699 30.164 5.83 32 8.459 32h15.724c2.629 0 4.76-1.836 4.76-4.101l1.095-20.023H2.562zm28.806-1.42c.005-.844.008-.901.008-.957 0-2.202-1.483-3.411-3.472-3.411l-5.537.005C22.366.937 21.082 0 19.768 0h-6.893c-1.314 0-2.64.937-2.64 2.093l-5.543-.005c-2.197 0-3.472 1.473-3.472 3.411 0 .057.003.113.008.957h30.139zm-10.306 6.682c0-.638.588-1.156 1.314-1.156s1.314.517 1.314 1.156v13.24c0 .638-.588 1.156-1.314 1.156s-1.314-.517-1.314-1.156v-13.24zm-6.077 0c0-.638.589-1.156 1.315-1.156s1.314.517 1.314 1.156v13.24c0 .638-.588 1.156-1.314 1.156s-1.315-.517-1.315-1.156v-13.24zm-6.074 0c0-.638.588-1.156 1.315-1.156s1.314.517 1.314 1.156v13.24c0 .638-.589 1.156-1.314 1.156s-1.315-.517-1.315-1.156v-13.24z"></path></svg>'}}))}}}));