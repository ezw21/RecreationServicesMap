System.register(["jimu-core"],(function(e){var t;return{setters:[function(e){t=e}],execute:function(){e(function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=126)}({0:function(e,n){e.exports=t},1:function(e,t,n){"use strict";t.a={frameworkAction_TriggerLayer:"Trigger data",frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",foldable:"Foldable",billboard:"Billboard",jewelrybox:"JewelryBox",launchpad:"Launchpad",introduction:"Introduction",gallery:"Gallery",general:"General",blankfullscreen:"Blank fullscreen",blankscrollable:"Blank scrolling",scenic:"Scenic",exhibition:"Exhibition",journey:"Journey",ribbon:"Ribbon",snapshot:"Snapshot",epic:"Epic",summary:"Summary",quicknavigation:"Quick navigation",parallax:"Parallax",dashboard:"Dashboard",pocket:"Pocket",dart:"Dart",timeline:"Timeline",monitor:"Monitor",dash:"Dash",reveal:"Reveal",indicator:"Indicator",block1:"Block 1",block2:"Block 2",block3:"Block 3",block4:"Block 4",block5:"Block 5",block6:"Block 6",dialog1:"Confirm",dialog2:"Alert",dialog3:"Simple",dialog4:"Vogue",dialog5:"Novel",dialog6:"Sidebar",dialog7:"Tooltip",dialogTitle:"Title",screenGroup1:"Cascade",screenGroup2:"Index",screenGroup3:"Stream",screenGroup4:"Guide",screenGroup5:"Showcase",screenGroup6:"Slideshow",screenGroup7:"Portfolio",screenGroup8:"Melt",screenGroup9:"Flyer",indicatorDescription:"Indicator provides a multi-page layout with a unique collection of widgets designed to create a modern dashboard.",monitorDescription:"Monitor is a single-page template that includes a combination of widgets built to organize, track, and display your data visualizations using a dashboard layout.",dashDescription:"Dash is a template designed to display key metrics using charts, maps, cards, and text widgets.",revealDescription:"Reveal allows you to create a narrative tour highlighting important data points with the use of tables, charts, and bookmarks.",foldableDescription:"Foldable is a template with a simple, open interface that focuses on the map, featuring a header and a controller widget.",billboardDescription:"Billboard was created with simplicity in mind; it contains a map and a controller widget.",jewelryboxDescription:"JewelryBox is a template created to display features in a list combined with a map.",launchpadDescription:"Launchpad is a template designed with the emphasis on the map and a controller widget anchored at the bottom of the page.",introductionDescription:"Introduction is a template with a modular layout designed to showcase your images and striking headlines.",galleryDescription:"Gallery is a template designed with prominent thumbnail images to highlight your rich content.",generalDescription:"General provides a long scrolling template created to share the stories behind your content.",blankfullscreenDescription:"A blank template to create your own design in a fullscreen app.",blankscrollableDescription:"A blank template to create your design in a scrolling page.",scenicDescription:"Scenic allows you to create a narrative tour using the bookmark widget in a multi-page layout.",exhibitionDescription:"Exhibition provides a multi-page layout for building a website that highlights your images and content using cards, list, and map widgets.",journeyDescription:"Journey is a template created that uses the bookmark widget and a map to provide an interactive tour experience.",ribbonDescription:"Ribbon is a template designed with the emphasis on the bookmark to control the navigation of the map.",snapshotDescription:"Snapshot is a template designed to showcase your captivating images with the use of a section, views navigation, and cards.",epicDescription:"Epic provides a long scrolling template designed for building a website experience.",summaryDescription:"Summary is a template created to be used as a secondary or ending page that focuses on short text descriptions and actionable links to additional content.",timelineDescription:"Timeline is a template designed to display your images and content in chronological order.",quicknavigationDescription:"Quick navigation allows you to quickly switch between multiple views and bookmarks on a single page.",parallaxDescription:"Parallax allows you to add a hero image layout in your experience.",dashboardDescription:"Dashboard is designed to provide a view of your geographic information and data through multiple widgets that work together on a single screen.",pocketDescription:"Pocket is a template created to display your bookmarks in an interactive slider to help navigate the features on your map.",dartDescription:"Dart is a template that focuses on the map, the widgets are placed inside a fixed panel positioned at the bottom of the map.",block1Description:"Block 1",block2Description:"Block 2",block3Description:"Block 3",block4Description:"Block 4",block5Description:"Block 5",block6Description:"Block 6",screenGroup1Description:"Screen group 1",screenGroup2Description:"Screen group 2",screenGroup3Description:"Screen group 3",screenGroup4Description:"Screen group 4",screenGroup5Description:"Screen group 5",screenGroup6Description:"Screen group 6",screenGroup7Description:"Screen group 7",screenGroup8Description:"Screen group 8",screenGroup9Description:"Screen group 9",subTitlePlaceholder:"Here is the subtitle",titlePlaceholder:"Here is the title",defaultTextPlaceholder:"Double click to edit text",copyrightPlaceholder:"Copyright info",appItemCopy:"copy",cardTitle:"Card title",bookmark:"Bookmark",card:"Card",number:"Number"}},126:function(e,t,n){"use strict";n.r(t),n.d(t,"SearchType",(function(){return s})),n.d(t,"AppType",(function(){return c})),n.d(t,"PublishStatus",(function(){return u})),n.d(t,"getResourceOrigin",(function(){return ue})),n.d(t,"appServices",(function(){return o})),n.d(t,"userServices",(function(){return r}));var i={};n.r(i),n.d(i,"searchItems",(function(){return l})),n.d(i,"createItem",(function(){return j})),n.d(i,"getItemData",(function(){return P})),n.d(i,"getItem",(function(){return k})),n.d(i,"getItemResources",(function(){return O})),n.d(i,"removeItem",(function(){return U})),n.d(i,"removeItemResource",(function(){return I})),n.d(i,"updateItem",(function(){return D})),n.d(i,"updateItemResource",(function(){return M})),n.d(i,"addItemResource",(function(){return E})),n.d(i,"request",(function(){return p})),n.d(i,"getOriginUrl",(function(){return v})),n.d(i,"getUserContentUrl",(function(){return m})),n.d(i,"getUserName",(function(){return g})),n.d(i,"getRequestMethod",(function(){return y}));var o={};n.r(o),n.d(o,"createAppByItemTemplate",(function(){return Se})),n.d(o,"createAppByTemplateId",(function(){return Pe})),n.d(o,"createAppByDefaultTemplate",(function(){return ke})),n.d(o,"createTemplateByApp",(function(){return Oe})),n.d(o,"duplicateApp",(function(){return xe})),n.d(o,"getAppConfig",(function(){return Ae})),n.d(o,"searchApp",(function(){return Ue})),n.d(o,"getAppInfo",(function(){return Ie})),n.d(o,"updateAppInfo",(function(){return Te})),n.d(o,"updateAppThumbnail",(function(){return De})),n.d(o,"deleteApp",(function(){return Me})),n.d(o,"saveApp",(function(){return Re})),n.d(o,"publishApp",(function(){return Ee})),n.d(o,"getFolders",(function(){return $e})),n.d(o,"addToFavorites",(function(){return Ge})),n.d(o,"removeFromFavorites",(function(){return Ce})),n.d(o,"getAppGroups",(function(){return _e})),n.d(o,"changeAppFolder",(function(){return Be})),n.d(o,"getUserTags",(function(){return Fe})),n.d(o,"searchGroups",(function(){return Le})),n.d(o,"getDefaultTemplateConfig",(function(){return qe})),n.d(o,"removeAppResource",(function(){return Ne})),n.d(o,"addAppResource",(function(){return Je})),n.d(o,"getAppResources",(function(){return We})),n.d(o,"updateAppResource",(function(){return Ke}));var r={};n.r(r),n.d(r,"addUserResource",(function(){return Ze})),n.d(r,"getUserResource",(function(){return et})),n.d(r,"getUserResources",(function(){return tt})),n.d(r,"removeUserResource",(function(){return nt})),n.d(r,"updateUserResource",(function(){return it})),n.d(r,"initUserResource",(function(){return ot}));var s,c,u,a=n(0);!function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(s||(s={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(c||(c={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(u||(u={}));var d=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function l(e,t=s.Other){return d(this,void 0,void 0,(function*(){return yield function e(t,n,i=s.Other){return d(this,void 0,void 0,(function*(){let o,r;return o=(i===s.AGOL?"https://www.arcgis.com":window.location.origin)+"/sharing/rest/search",r="string"==typeof t||t instanceof a.esri.restPortal.SearchQueryBuilder?{params:{q:t}}:a.esri.restRequest.appendCustomParams(t,["q","num","start","sortField","sortOrder","portalUrl"]),yield p(o,r).then(i=>(i.nextStart&&-1!==i.nextStart&&(i.nextPage=function(){return d(this,void 0,void 0,(function*(){let o;return"string"==typeof t||t instanceof a.esri.restPortal.SearchQueryBuilder?o={q:t,start:i.nextStart}:(o=t,o.start=i.nextStart),yield e(o,n)}))}),i))}))}(e,"item",t)}))}var f=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function p(e,t={params:{f:"json"}},n="POST"){return f(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"):""}(t.params);return yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>f(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>f(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}return"POST"===n?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then(e=>f(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>f(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then(e=>f(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>f(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))):yield Promise.reject(null)}))}const h=a.esri.restRequest.request;function v(e=!1){return e?a.urlUtils.getArcgisOnlineUrl():window.location.origin}function m(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}function g(){var e;return null===(e=Object(a.getAppStore)().getState().user)||void 0===e?void 0:e.username}function y(e=!1){return e?h:p}function b(e){const t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}var w=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function j(e){return w(this,void 0,void 0,(function*(){const t=Object.assign({folderId:null},e);return yield function(e){var t,n;return w(this,void 0,void 0,(function*(){if(e.file&&!e.multipart)return yield Promise.reject(new Error("The request must be a multipart request for file uploading."));if(e.multipart&&!e.filename)return yield Promise.reject(new Error("The file name is required for a multipart request."));const i=g(),o=`${v()}${m()}addItem`;e.params=Object.assign(Object.assign(Object.assign({},e.params),b(e.item)),{portalUrl:null===(n=null===(t=Object(a.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl});const r=a.esri.restRequest.appendCustomParams(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return r.params.username=i,yield p(o,r)}))}(t)}))}var S=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function P(e,t,n=!1){return S(this,void 0,void 0,(function*(){const i=`${v(n)}${m(n)}items/${e}/data`,o=Object.assign({params:{}},t);o.file&&(o.params.f=null),n&&!x()&&delete o.authentication;const r=y(n);return yield r(i,o).catch(e=>{if(!RegExp(/Unexpected end of (JSON input|data at line 1 column 1)/i).test(e.message))throw e})}))}function k(e,t,n=!1){return S(this,void 0,void 0,(function*(){const i=`${v(n)}${m(n)}items/${e}`,o=Object.assign({},t);n&&!x()&&delete o.authentication;const r=y(n);return yield r(i,o)}))}function O(e,t,n=!1){return S(this,void 0,void 0,(function*(){const i=`${v(n)}${m(n)}items/${e}/resources`;t.params=Object.assign(Object.assign({},t.params),{num:1e3}),n&&!x()&&delete t.authentication;const o=y(n);return yield o(i,t)}))}function x(){const e=Object(a.getAppStore)().getState().portalUrl;return a.portalUrlUtils.isAGOLDomain(e)}var A=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function U(e){return A(this,void 0,void 0,(function*(){const t=g(),n=v();e.userName=t;const i=`${n}${m()}items/${e.id}/delete`;return yield p(i,e)}))}function I(e){return A(this,void 0,void 0,(function*(){const t=`${v()}${m()}items/${e.id}/removeResources`;return e.params=Object.assign(Object.assign({},e.params),{resource:e.resource}),yield p(t,e)}))}var T=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function D(e){return T(this,void 0,void 0,(function*(){const t=g(),n=v();e.userName=t;const i=`${n}${m()}items/${e.item.id}/update`;if(e.params=Object.assign(Object.assign({},e.params),b(e.item)),e.item.thumbnail&&"string"!=typeof e.item.thumbnail){e.params=Object.assign(Object.assign({},e.params),e.item);const t=Object.keys(e.params),n=new FormData;for(let i=0;i<t.length;i++)n.append(t[i],e.params[t[i]]);e.params=n}return yield p(i,e)}))}function M(e){return T(this,void 0,void 0,(function*(){const t=`${v()}${m()}items/${e.id}/updateResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource,void 0!==e.private&&(e.params.access=e.private?"private":"inherit");const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield p(t,e)}))}var R=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function E(e){return R(this,void 0,void 0,(function*(){const t=`${v()}${m()}items/${e.id}/addResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content,access:e.private?"private":"inherit"},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource;const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield p(t,e)}))}var $=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};const G=a.SessionManager.getInstance().isTrustedServer(Object(a.getAppStore)().getState().portalUrl);function C(e,t={f:"json"},n="POST"){return $(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"):""}(t);return yield fetch(n,{credentials:G?"include":"same-origin",method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>$(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>$(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}return"POST"===n?t&&"FormData"===t.constructor.name?yield fetch(e,{credentials:G?"include":"same-origin",method:"POST",body:t}).then(e=>$(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>$(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))):yield fetch(e,{credentials:G?"include":"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>$(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>$(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))):yield Promise.reject(null)}))}var _=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};var B=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};var F=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};var L=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};var q=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function N(e){return q(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=Object(a.getAppStore)().getState().portalUrl+"/sharing/rest/content/itemsgroups",i={params:e,httpMethod:"GET",authentication:t};return yield a.esri.restRequest.request(n,i)}))}var J=n(1),W=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};const K=a.esri.restRequest.request;function H(e){var t,n;if(!(null==e?void 0:e.portalUrl))return!window.jimuConfig.isDevEdition;const i=(null==e?void 0:e.portalUrl)||"",o=(null===(n=null===(t=Object(a.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl)||"",r=(null==o?void 0:o.includes(i))||(null==i?void 0:i.includes(o));return(a.portalUrlUtils.isAGOLDomain(i)&&a.portalUrlUtils.isAGOLDomain(i)||r)&&!X(e)}function Q(e){if(!(null==e?void 0:e.portalUrl))return!1;const t=(null==e?void 0:e.portalUrl)||"",n=a.portalUrlUtils.isAGOLDomain(t),i=!H(e),o=!X(e);return i&&o&&n}function X(e){return!!((null==e?void 0:e.portalUrl)||"").endsWith("localhost:")||e.isLocalApp}function z(e){if(X(e))return{};const t=a.SessionManager.getInstance().getMainSession();return H(e)?t:{}}function V(e,t=!1,n=""){return W(this,void 0,void 0,(function*(){const i=a.SessionManager.getInstance().getMainSession();let o=null;const r=(null==n?void 0:n.includes("Template"))?c.TemplateType:c.ExperienceType;return yield Ue({q:`type: "${r}" AND owner:${null==i?void 0:i.username} AND  title:"${e}"`,sortField:"modified",sortOrder:"desc"},s.Other).then(n=>W(this,void 0,void 0,(function*(){const i=n.results;if(i&&i.length>0){const n=function(e,t){const n=[],i=/^[\d]+$/;return e.forEach(e=>{var o,r;const s=null===(r=null===(o=e.title)||void 0===o?void 0:o.split(t+" ")[1])||void 0===r?void 0:r.split(" ")[0];i.test(s)&&n.push(Number(s))}),n.sort((function(e,t){return e<t?1:-1})),n[0]||1}(i,e);return o=function e(t,n,i=1,o=!1){const r=1==i&&o?t:`${t} ${i}`;if(!function(e,t){let n=!1;return t.forEach(t=>{e==t.title&&(n=!0)}),n}(r,n))return r;return e(t,n,i+1)}(e,i,n,t),yield Promise.resolve(o)}return o=t?e:e+" 1",yield Promise.resolve(o)}))).catch(e=>W(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))}))}function Y(e,t,n=!1){return W(this,void 0,void 0,(function*(){return yield function(e){return W(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession();return yield pe({item:{id:e,owner:null==t?void 0:t.username,text:"",data:{__not_publish:!0}},authentication:a.SessionManager.getInstance().getMainSession()}).then(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)})),e=>W(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))}))}(e).then(i=>W(this,void 0,void 0,(function*(){return i?n?yield function(e,t){return W(this,void 0,void 0,(function*(){return yield function(e,t){return W(this,void 0,void 0,(function*(){return yield Ae(t).then(n=>W(this,void 0,void 0,(function*(){const i=te(n,t);i.customTheme=a.themeUtils.appendSharedTheme(i),delete i.appProxies;const o=z({portalUrl:window.jimuConfig.isDevEdition?"localhost:":Object(a.getAppStore)().getState().portalUrl});if(null==n?void 0:n.__not_publish)return yield Promise.reject("This item is not published");const r=new Blob([JSON.stringify(i)],{type:"application/json"});return yield ge({id:e,resource:r,name:"config.json",params:{resourcesPrefix:"config"},authentication:o}).then(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)})),e=>W(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))})),e=>W(this,void 0,void 0,(function*(){return yield Promise.reject("Resource does not exist or is inaccessible")})))}))}(e,t).then(n=>W(this,void 0,void 0,(function*(){return yield Z(e,t,!0).then(e=>W(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")})),e=>W(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))})))}))}(e,t):yield function(e,t){return W(this,void 0,void 0,(function*(){return yield Z(e,t).then(e=>W(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")})),e=>W(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}))}(e,t):yield Promise.reject(null)})),e=>W(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}))}function Z(e,t,n=!1){return W(this,void 0,void 0,(function*(){const i=z(t);return yield me(t,{authentication:i}).then(i=>W(this,void 0,void 0,(function*(){const o=[],r=i&&i.resources;let s=!1;if(r)for(let i=0;i<r.length;i++){const c="config/config.json"===r[i].resource;n&&c||(c&&(s=!0),o.push(ee(e,t,r[i])))}return s||n?yield Promise.all(o):yield Promise.resolve(null)})),e=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(null)})))}))}function ee(e,t,n){return W(this,void 0,void 0,(function*(){const i=z(t),o=H(t)?"?token="+(null==i?void 0:i.token):"",r=`${ue(t)}${t.id}/resources/`;if("config/config.json"===n.resource||"images/image-resources-list.json"===n.resource){const s=r+n.resource+o;return yield fetch(s,{cache:"no-cache"}).then(e=>W(this,void 0,void 0,(function*(){return yield e.json()}))).then(o=>W(this,void 0,void 0,(function*(){const r="config/config.json"===n.resource?te(o,t):o;return yield function(e,t,n){return W(this,void 0,void 0,(function*(){const i=ue(t)+t+"/resources/",o=new RegExp("^"+i);const r={matchFunction:function(e){return o.test(e)},matchHandle:function(n){const i=n.obj,o=n.key,r=n.value;"number"==typeof n.i?i[o][n.i]=r.replace(t,e):i[o]=r.replace("/"+t+"/","/"+e+"/")}};return a.appConfigUtils.replaceAppConfigNodeValue(n,r)}))}(e,t.id,r).then(t=>W(this,void 0,void 0,(function*(){delete t.appProxies;const o=new Blob([JSON.stringify(t)],{type:"application/json"});return yield ge({id:e,resource:o,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:i}).then(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)})),e=>W(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))})))}))).catch(e=>W(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))}{const t=r+n.resource+o;return yield new Promise((function(o,r){const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(t){if(200==this.status){const t=this.response;return ge({id:e,resource:t,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:i}).then(()=>o(!0),()=>o(!1))}return o(!1)},s.onerror=function(e){return o(!1)},s.send()}))}}))}function te(e,t){var n;const i=Object(a.getAppStore)().getState().portalUrl;e.attributes&&(e.attributes.portalUrl=i);const o=null==e?void 0:e.dataSources;if(o&&Q(t))for(const e in o){ne(null===(n=o[e])||void 0===n?void 0:n.portalUrl)&&(o[e].portalUrl=i)}return e}function ne(e){let t=!1;const n=Object(a.getAppStore)().getState().portalUrl;return(ie(n,e,"mapsdevext.arcgis.com")||ie(n,e,"mapsqa.arcgis.com")||ie(n,e,"maps.arcgis.com"))&&(t=!0),t}function ie(e,t,n){return((null==e?void 0:e.endsWith(n))||(null==e?void 0:e.endsWith(n+"/")))&&((null==t?void 0:t.endsWith(n))||(null==t?void 0:t.endsWith(n+"/")))}function oe(e,t,n){return W(this,void 0,void 0,(function*(){return yield Ie(e).then(i=>W(this,void 0,void 0,(function*(){if(i){const o=t?c.TemplateType:c.ExperienceType;return yield V(i.title).then(r=>W(this,void 0,void 0,(function*(){if(r){const s={name:r,tags:i.tags,thumbnail:i.thumbnail,type:o};return yield se(s,n).then(n=>W(this,void 0,void 0,(function*(){return n?yield Y(n.id,e,!t).then(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(n.id)})),e=>W(this,void 0,void 0,(function*(){return console.error(e),Me(n.id),yield Promise.reject(e)}))):yield Promise.reject(null)})))}return yield Promise.reject(null)})))}return yield Promise.reject(null)})))}))}function re(e){const t="version:"+a.version;if(!e||0==e.length)return["EXB Experience","Ready To Use","JavaScript","status: Draft",t];let n=!1,i=!1;const o=e.map(e=>e.includes("status:")?(n=!0,"status: Draft"):e);return!n&&o.push("status: Draft"),!i&&o.push(t),o}function se(e,t){return W(this,void 0,void 0,(function*(){const n={title:e.name,type:e.type||"Web Experience",typeKeywords:re(null==e?void 0:e.typeKeywords),snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:e.tags,thumbnail:e.thumbnail};return yield ae(n,t)}))}function ce(e){return W(this,void 0,void 0,(function*(){return yield function(e){return W(this,void 0,void 0,(function*(){const t=Object(a.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!1};return yield Ie(n).then(e=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(n)}))).catch(e=>W(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")})))}))}(e).then(e=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))).catch(t=>W(this,void 0,void 0,(function*(){return yield function(e){return W(this,void 0,void 0,(function*(){const t=Object(a.getAppStore)().getState().portalUrl;if(a.portalUrlUtils.isAGOLDomain(t))return yield Promise.reject(!1);const n={id:e,portalUrl:"https://maps.arcgis.com",isLocalApp:!1};return yield Ie(n).then(e=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(n)}))).catch(e=>W(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")})))}))}(e).then(e=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))).catch(t=>W(this,void 0,void 0,(function*(){return yield function(e){return W(this,void 0,void 0,(function*(){if(window.jimuConfig.isDevEdition){const t=Object(a.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!0};return yield Ie(n).then(e=>W(this,void 0,void 0,(function*(){return(null==e?void 0:e.success)?yield Promise.resolve(n):yield Promise.reject("Item does not exist or is inaccessible.")}))).catch(e=>W(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")})))}return yield Promise.reject("Item does not exist or is inaccessible.")}))}(e)})))})))}))}function ue(e){const t=Q(e)?a.urlUtils.getArcgisOnlineUrl():Object(a.getAppStore)().getState().portalUrl;return(null==e?void 0:e.isLocalApp)?v()+"/apps/":a.portalUrlUtils.getHostUrlByOrgUrl(t)+"/sharing/rest/content/items/"}function ae(e,t){return W(this,void 0,void 0,(function*(){return t?yield(n={item:e,folderId:t,authentication:a.SessionManager.getInstance().getMainSession()},a.esri.restPortal.createItemInFolder(n)):yield function(e){return de(this,void 0,void 0,(function*(){return le("createItem")(e)}))}({item:e,authentication:a.SessionManager.getInstance().getMainSession()});var n}))}var de=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function le(e,t,n){const o=n?i[n]:i[e],r=a.esri.restPortal[e];return t?H(t)?r:o:window.jimuConfig.isDevEdition?o:r}function fe(e,t){return de(this,void 0,void 0,(function*(){return function(e){let t;const n=Object(a.getAppStore)().getState().portalUrl,i=a.portalUrlUtils.isAGOLDomain(n);switch(e){case s.Portal:t=a.esri.restPortal.searchItems;break;case s.AGOL:t=i?a.esri.restPortal.searchItems:l;break;case s.Other:t=window.jimuConfig.isDevEdition?l:a.esri.restPortal.searchItems}return t}(t)(e,t)}))}function pe(e){return de(this,void 0,void 0,(function*(){return le("updateItem")(e)}))}function he(e){return de(this,void 0,void 0,(function*(){return window.jimuConfig.isDevEdition?yield D(e):yield function(e){return _(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=e.owner?e.owner:null==t?void 0:t.username,i=`${Object(a.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${n}/items/${e.item.id}/update`;e.params=Object.assign(Object.assign({},e.params),e.item);const o=Object.keys(e.params),r=new FormData;for(let t=0;t<o.length;t++)r.append(o[t],e.params[o[t]]);return e.params=r,yield C(i,r)}))}(e)}))}function ve(e,t){return de(this,void 0,void 0,(function*(){return le("getItem",e)(e.id,t,Q(e))}))}function me(e,t){return de(this,void 0,void 0,(function*(){return le("getItemResources",e)(e.id,t,Q(e))}))}function ge(e){return de(this,void 0,void 0,(function*(){return le("addItemResource")(e)}))}function ye(e){return de(this,void 0,void 0,(function*(){return yield function(e){return F(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=`${Object(a.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/share`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const i=Object.keys(e),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e[i[t]]);return e=o,yield C(n,e)}))}(e)}))}function be(e){return de(this,void 0,void 0,(function*(){return yield function(e){return L(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=`${Object(a.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/unshare`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const i=Object.keys(e),o=new FormData;for(let t=0;t<i.length;t++)o.append(i[t],e[i[t]]);return e=o,yield C(n,e)}))}(e)}))}function we(e){return function(e){return B(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=`${Object(a.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${null==t?void 0:t.username}`,i=Object.assign(Object.assign({},e.params),{f:"json",token:null==t?void 0:t.token});return yield C(n,i,"GET")}))}(e)}var je=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};function Se(e,t){return je(this,void 0,void 0,(function*(){return yield oe(e,!1,t)}))}function Pe(e){return je(this,void 0,void 0,(function*(){return yield ce(e).then(e=>je(this,void 0,void 0,(function*(){return yield Se(e)})))}))}function ke(e,t,n){return je(this,void 0,void 0,(function*(){return yield V(e).then(e=>je(this,void 0,void 0,(function*(){if(e){const i={template:t,name:e,description:"",type:c.ExperienceType};return yield Promise.all([qe(i)]).then((function(e){return je(this,void 0,void 0,(function*(){const t=e[0];return t.template=i.template,t.attributes?t.attributes.portalUrl=Object(a.getAppStore)().getState().portalUrl:t.attributes={portalUrl:Object(a.getAppStore)().getState().portalUrl},t.customTheme=a.themeUtils.appendSharedTheme(t),yield function(e,t){return W(this,void 0,void 0,(function*(){const n={title:e.name,type:e.type||"Web Experience",typeKeywords:["EXB Experience","Ready To Use","JavaScript","status: Draft","version:"+a.version],snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:e.tags,data:{__not_publish:!0}};return yield(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(!1)})))().then((function(e){return W(this,void 0,void 0,(function*(){return e?yield Promise.reject("app existed."):yield ae(n,t)}))}))}))}(i,n).then(e=>je(this,void 0,void 0,(function*(){return yield function(e,t){return W(this,void 0,void 0,(function*(){const n=a.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance(),i=t.id;let o=a.utils.replaceI18nPlaceholdersInObject(e,a.i18n.getIntl(),J.a);return o=function(e){e.attributes||(e.attributes={});e.widgets||(e.widgets={});e.widgetsManifest||(e.widgetsManifest={});e.views||(e.views={});e.sections||(e.sections={});e.dialogs||(e.dialogs={});e.pages||(e.pages={});e.layouts||(e.layouts={});e.dataSources||(e.dataSources={});e.messageConfigs||(e.messageConfigs={});return e}(o),n.uploadAppConfigFileToPortal(i.toString(),o).then(()=>W(this,void 0,void 0,(function*(){return yield Promise.resolve(t)})))}))}(t,e)})))}))})).catch(e=>je(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)})))}return yield Promise.reject(null)})))}))}function Oe(e,t){return je(this,void 0,void 0,(function*(){return yield oe(e,!0,t)}))}function xe(e,t){return je(this,void 0,void 0,(function*(){return yield Ie(e).then(n=>je(this,void 0,void 0,(function*(){if(n){const i=a.i18n.getIntl().formatMessage({id:"appItemCopy"})||"copy";return yield V(`${n.title} ${i}`,!0,e.type).then(i=>je(this,void 0,void 0,(function*(){if(i){const o={name:i,description:(null==n?void 0:n.description)||"",snippet:(null==n?void 0:n.snippet)||"",typeKeywords:(null==n?void 0:n.typeKeywords)||[],tags:n.tags,thumbnail:n.thumbnail,type:e.type||n.type};return yield se(o,t).then(t=>je(this,void 0,void 0,(function*(){return t?yield function(e,t,n){return W(this,void 0,void 0,(function*(){const i=z({portalUrl:window.jimuConfig.isDevEdition?"localhost:":Object(a.getAppStore)().getState().portalUrl}),o=z(t);if(n){const r=`${ue(t)}${t.id}/info/${n}?token=${null==o?void 0:o.token}`,s=`${ue(t)}${t.id}/${n}`,c=H(t)?r:s;return yield new Promise((function(t,n){const o=new XMLHttpRequest;o.open("GET",c,!0),o.responseType="blob",o.onload=function(o){if(200==this.status){const o=this.response;return De({id:e,thumbnail:o,f:"json",token:null==i?void 0:i.token}).then(()=>t(!0),()=>n(!1))}return n(!1)},o.onerror=function(e){return n()},o.send()}))}return Promise.resolve(!0)}))}(t.id,e,n.thumbnail).then(()=>je(this,void 0,void 0,(function*(){return yield Y(t.id,e,!1).then(()=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)})),e=>je(this,void 0,void 0,(function*(){return console.error(e),Me(t.id),yield Promise.reject(e)})))}))):yield Promise.reject(null)})))}return yield Promise.reject(null)})))}return yield Promise.reject(null)})))}))}function Ae(e){return je(this,void 0,void 0,(function*(){const t=z(e);return yield function(e,t){return de(this,void 0,void 0,(function*(){return le("getItemData",e)(e.id,t,Q(e))}))}(e,{authentication:t}).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})),e=>je(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}))}function Ue(e,t){return je(this,void 0,void 0,(function*(){const n=function(e){let t;const n=Object(a.getAppStore)().getState().portalUrl,i=a.SessionManager.getInstance().getMainSession(),o=a.portalUrlUtils.isAGOLDomain(n);switch(e){case s.Portal:t=i;break;case s.AGOL:t=o?i:{};break;case s.Other:t=window.jimuConfig.isDevEdition?{}:i}return t}(t);return yield fe(Object.assign(Object.assign({},e),{authentication:n}),t).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))}function Ie(e){return je(this,void 0,void 0,(function*(){const t=z(e);return yield ve(e,{authentication:t}).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))}function Te(e){return je(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession(),n=window.jimuConfig.isDevEdition?"localhost:":Object(a.getAppStore)().getState().portalUrl,i={id:e.id,portalUrl:n};return yield ve(i,{authentication:t}).then(n=>je(this,void 0,void 0,(function*(){return yield pe({item:e,owner:n.owner,authentication:t}).then(()=>null)})))}))}function De(e,t=""){return je(this,void 0,void 0,(function*(){const n=a.SessionManager.getInstance().getMainSession();return yield he({item:e,authentication:n,owner:t}).then(()=>null)}))}function Me(e){return je(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession();return yield ve({id:e},{authentication:t}).then(t=>je(this,void 0,void 0,(function*(){return yield function(e){return de(this,void 0,void 0,(function*(){return le("removeItem")(e)}))}({id:e,owner:t.owner,authentication:a.SessionManager.getInstance().getMainSession()})})))}))}function Re(e,t){return je(this,void 0,void 0,(function*(){const n=a.SessionManager.getInstance().getMainSession(),i=a.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager,o=a.moduleLoader.getModuleSync("jimu-for-builder").appConfigUtils,r=(null==e?void 0:e.owner)||n.username,s=Object.assign({},o.getCleanAppConfig(t)),c=i.getInstance();return s.customTheme=a.themeUtils.appendSharedTheme(s),c.setAppConfigLocalFileToResource(s).then(t=>t?c.uploadAppConfigFileToPortal(e.id,t,r).then(()=>{if(c.getResourcesInDraft().imageResources){const e={};Object.keys(c.getResourcesInDraft().imageResources).forEach(t=>{e[t]=Object.assign({},c.getResourcesInDraft().imageResources[t])});const n=a.appConfigUtils.cleanPortalInfoFromResource(e);return c.uploadImageConfigFileToPortal(n,t)}return Promise.resolve()}):Promise.reject(),()=>je(this,void 0,void 0,(function*(){return yield Promise.reject()}))).catch(e=>je(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}))}function Ee(e){return je(this,void 0,void 0,(function*(){return yield function(e){return W(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance();var n=(new Date).getTime();return window.jimuConfig.isDevEdition?yield window.fetch(`/apps/${e}/resources/config/config.json`).then(e=>W(this,void 0,void 0,(function*(){return yield e.json()}))):yield K(`${a.portalUrlUtils.getPortalRestUrl(Object(a.getAppStore)().getState().portalUrl)}/content/items/${e}/resources/config/config.json`,{authentication:t.getSessionByUrl(Object(a.getAppStore)().getState().portalUrl),httpMethod:"GET",params:{timestamp:n}}).catch(e=>W(this,void 0,void 0,(function*(){return yield this._handleAuthError(e)})))}))}(e.id).then(t=>je(this,void 0,void 0,(function*(){const n=a.SessionManager.getInstance().getMainSession();if(t){const i=function(e){let t=!1;const n=e.map(e=>e.includes("status:")?(t=!0,"status: "+u.Published):e);if(!t){const e="status: "+u.Published;n.push(e)}return n}(null==e?void 0:e.typeKeywords);return a.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance().setAppConfigLocalFileToResource(t).then(t=>je(this,void 0,void 0,(function*(){if(!t)return yield Promise.reject();const o=function(e){const{type:t,id:n}=e,{isDevEdition:i,isInPortal:o,hostEnv:r}=window.jimuConfig,s=t===c.TemplateType,u=!i&&!o;if(i)return null;let d=a.urlUtils.getAppUrl({appId:n,isTemplate:s});if(u)switch(r){case"prod":d="https://experience.arcgis.com"+d;break;case"dev":d="https://experiencedev.arcgis.com"+d;break;case"qa":d="https://experienceqa.arcgis.com"+d}return o&&(d=`${window.location.origin}${d}`),d}(e);return yield pe({item:{id:e.id,owner:e.owner||(null==n?void 0:n.username),data:t,typeKeywords:i,url:o},authentication:a.SessionManager.getInstance().getMainSession()}).then(()=>je(this,void 0,void 0,(function*(){return yield Promise.resolve()})),()=>je(this,void 0,void 0,(function*(){return yield Promise.reject()})))})),()=>je(this,void 0,void 0,(function*(){return yield Promise.reject()}))).catch(e=>je(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}return yield Promise.reject()})))}))}function $e(e){return je(this,void 0,void 0,(function*(){return we(e).then(e=>je(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.folders)||[];return yield Promise.resolve(t)})),e=>je(this,void 0,void 0,(function*(){return yield Promise.reject(e)})))}))}function Ge(e){return je(this,void 0,void 0,(function*(){return yield ye(e).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))}function Ce(e){return je(this,void 0,void 0,(function*(){return yield be(e).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))}function _e(e){return je(this,void 0,void 0,(function*(){return yield function(e){return de(this,void 0,void 0,(function*(){return yield N(e)}))}(e).then(e=>je(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))}function Be(e){return je(this,void 0,void 0,(function*(){return yield function(e){return de(this,void 0,void 0,(function*(){return yield a.esri.restPortal.moveItem(e)}))}(Object.assign(Object.assign({},e),{authentication:a.SessionManager.getInstance().getMainSession()}))}))}function Fe(e){return je(this,void 0,void 0,(function*(){return yield function(e){return de(this,void 0,void 0,(function*(){return yield a.esri.restPortal.getUserTags(e)}))}({username:e,authentication:a.SessionManager.getInstance().getMainSession()})}))}function Le(e){return je(this,void 0,void 0,(function*(){return yield function(e){return de(this,void 0,void 0,(function*(){return yield a.esri.restPortal.searchGroups(e)}))}(e)}))}function qe(e){return je(this,void 0,void 0,(function*(){return yield fetch(`../templates/${e.template}.json`).then(e=>je(this,void 0,void 0,(function*(){return yield e.json()}))).then(e=>e)}))}function Ne(e){return je(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession();return yield function(e){return de(this,void 0,void 0,(function*(){return le("removeItemResource")(e)}))}(Object.assign(Object.assign({},e),{authentication:t}))}))}function Je(e){return je(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession();return yield ge(Object.assign(Object.assign({},e),{authentication:t}))}))}function We(e,t){return je(this,void 0,void 0,(function*(){const n=a.SessionManager.getInstance().getMainSession();return yield me(e,Object.assign({authentication:n},t))}))}function Ke(e){return je(this,void 0,void 0,(function*(){const t=a.SessionManager.getInstance().getMainSession();return yield function(e){return de(this,void 0,void 0,(function*(){return le("updateItemResource")(e)}))}(Object.assign(Object.assign({},e),{authentication:t}))}))}var He=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function c(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};const Qe=a.esri.restRequest.request;var Xe;let ze,Ve;function Ye(e,t){return He(this,void 0,void 0,(function*(){const n=a.SessionManager.getInstance().getMainSession(),{username:i}=n,o=Object(a.getAppStore)().getState().portalUrl,r=a.portalUrlUtils.getBaseUserUrl(o),s=yield st.getInstance().getToken();let c;switch(t=null!=t?t:rt(),e){case Xe.Add:c=r+"/"+i+"/addResource/?token="+s;break;case Xe.Remove:c=r+"/"+i+"/removeResource/?token="+s;break;case Xe.Get:c=r+"/"+i+"/resources/"+t+"?token="+s;break;case Xe.GetAll:c=r+"/"+i+"/resources/?token="+s}return yield Promise.resolve(c)}))}function Ze(e,t){return He(this,void 0,void 0,(function*(){t=null!=t?t:rt();const n={httpMethod:"POST",params:Object.assign(Object.assign({},e),{key:t,access:"UserPrivateAllApps"})};return yield Ye(Xe.Add).then(e=>He(this,void 0,void 0,(function*(){return yield Qe(e,n).then(e=>He(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed adding user resource:"+e.message))})))}))}function et(e){return He(this,void 0,void 0,(function*(){return e=null!=e?e:rt(),yield Ye(Xe.Get,e).then(e=>He(this,void 0,void 0,(function*(){return yield Qe(e,{params:{f:"json"}}).then(e=>He(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource:"+e.message))})))}))}function tt(){return He(this,void 0,void 0,(function*(){return yield Ye(Xe.GetAll).then(e=>He(this,void 0,void 0,(function*(){return yield Qe(e,{params:{f:"json"}}).then(e=>He(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource list:"+e.message))})))}))}function nt(e){return He(this,void 0,void 0,(function*(){return e=null!=e?e:rt(),yield Ye(Xe.Remove).then(t=>He(this,void 0,void 0,(function*(){const n={params:{key:e}};return yield Qe(t,n).then(e=>He(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed removing user resource:"+e.message))})))}))}function it(e){return He(this,void 0,void 0,(function*(){return yield et().then(t=>He(this,void 0,void 0,(function*(){const n=Object(a.Immutable)(null!=t?t:{}).merge(e,{deep:!0});return yield Ze({text:JSON.stringify(Object.assign({},n))})}))).then(e=>He(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed updating user resource:"+e.message))})))}))}function ot(){return He(this,void 0,void 0,(function*(){return ze||(ze=tt().then(e=>He(this,void 0,void 0,(function*(){if(0===e.total)return yield Ze({text:"{}"});{const t=e.userResources[0],n=rt();return t.key===n?yield Promise.resolve({success:!0}):yield et(t.key).catch(e=>null).then(e=>He(this,void 0,void 0,(function*(){return e&&(e.showGuides||0===Object.keys(e).length)?yield nt(t.key).then(()=>He(this,void 0,void 0,(function*(){return yield Ze({text:JSON.stringify(Object.assign({},e))})}))):yield Ze({text:"{}"})})))}}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed initializing user resource:"+e.message))})))),ze}))}function rt(){if(!Ve){const e=a.SessionManager.getInstance().getMainSession();Ve=`${a.USER_SETTING_FILE_KEY}${(null==e?void 0:e.clientId)?"_"+e.clientId:""}.json`}return Ve}!function(e){e.Add="ADD",e.Remove="REMOVE",e.Get="GET",e.GetAll="GETALL"}(Xe||(Xe={}));class st{constructor(){this.session=a.SessionManager.getInstance().getMainSession()}static getInstance(){return st.instance||(st.instance=new st),st.instance}_shouldExchangeToken(){return He(this,void 0,void 0,(function*(){if(!this.exchangedToken||this.session.tokenExpires<new Date){if(!this.portalSelfPromise){const e=Object(a.getAppStore)().getState().portalUrl;this.portalSelfPromise=Qe(`${e}/sharing/rest/community/self?token=${this.session.token}`).then(({appInfo:e})=>He(this,void 0,void 0,(function*(){return yield Promise.resolve("experienceBuilder"!==(null==e?void 0:e.appId))}))).catch(e=>He(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(e.message))})))}return yield this.portalSelfPromise}return yield Promise.resolve(!1)}))}_exchangeToken(){return He(this,void 0,void 0,(function*(){const e=Object(a.getAppStore)().getState().portalUrl+"/sharing/rest/oauth2/exchangeToken",t={params:{client_id:this.session.clientId,token:this.session.token}};return yield Qe(e,t)}))}getToken(){var e;return He(this,void 0,void 0,(function*(){return(yield this._shouldExchangeToken())?yield this._exchangeToken().catch(e=>(console.warn("Failed exchanging token. Using default token from user sesion."),{token:this.session.token})).then(e=>He(this,void 0,void 0,(function*(){return this.exchangedToken=null==e?void 0:e.token,yield Promise.resolve(this.exchangedToken)}))):yield Promise.resolve(null!==(e=this.exchangedToken)&&void 0!==e?e:this.session.token)}))}}}}))}}}));